/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";var e={243:t=>{function e(){return n(null,[].slice.call(arguments,0))}function n(t,e){for(var n,s,r,o,a,h=e.length,c=e[0],l={},u=t&&t.equal||i,d=1;d<h;d++)for(n=e[d],r=(s=Object.keys(n)).length,a=0;a<r;a++)u(n[o=s[a]],c[o])||(l[o]=n[o]);return l}function i(t,e){return t===e}e.custom=function(t){return n(t,[].slice.call(arguments,1))},t.exports=e}},n={};function i(t){var s=n[t];if(void 0!==s)return s.exports;var r=n[t]={exports:{}};return e[t](r,r.exports,i),r.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var e={};i.r(e),i.d(e,{BaseLink:()=>uo,BezierLink:()=>So,Capsule:()=>no,CapsuleGroup:()=>Sa,CapsuleVertical:()=>io,CapsuleVerticalGroup:()=>Ba,Diamond:()=>ro,DiamondGroup:()=>Ea,DiamondVerticalGroup:()=>Ta,Group:()=>ka,GroupFactory:()=>Qr,Icon:()=>_o,Instance:()=>Mr,JFLOW_MODE:()=>gr,JFlowEvent:()=>Jr,LinearLayout:()=>Eo,Link:()=>yo,Node:()=>Rr,Point:()=>to,PointGroup:()=>Oa,PolyLink:()=>xo,Rectangle:()=>eo,Rhombus:()=>so,RhombusGroup:()=>Ca,ScrollGroup:()=>co,ShadowDom:()=>vo,Text:()=>mo,TextElement:()=>ta,TextGroup:()=>xa,commonEventAdapter:()=>lo,default:()=>ja});var n=Object.freeze({});function s(t){return null==t}function r(t){return null!=t}function o(t){return!0===t}function a(t){return"string"==typeof t||"number"==typeof t||"symbol"==typeof t||"boolean"==typeof t}function h(t){return null!==t&&"object"==typeof t}var c=Object.prototype.toString;function l(t){return"[object Object]"===c.call(t)}function u(t){var e=parseFloat(String(t));return e>=0&&Math.floor(e)===e&&isFinite(t)}function d(t){return r(t)&&"function"==typeof t.then&&"function"==typeof t.catch}function f(t){return null==t?"":Array.isArray(t)||l(t)&&t.toString===c?JSON.stringify(t,null,2):String(t)}function p(t){var e=parseFloat(t);return isNaN(e)?t:e}function g(t,e){for(var n=Object.create(null),i=t.split(","),s=0;s<i.length;s++)n[i[s]]=!0;return e?function(t){return n[t.toLowerCase()]}:function(t){return n[t]}}g("slot,component",!0);var m=g("key,ref,slot,slot-scope,is");function _(t,e){if(t.length){var n=t.indexOf(e);if(n>-1)return t.splice(n,1)}}var v=Object.prototype.hasOwnProperty;function y(t,e){return v.call(t,e)}function b(t){var e=Object.create(null);return function(n){return e[n]||(e[n]=t(n))}}var w=/-(\w)/g,x=b((function(t){return t.replace(w,(function(t,e){return e?e.toUpperCase():""}))})),k=b((function(t){return t.charAt(0).toUpperCase()+t.slice(1)})),S=/\B([A-Z])/g,C=b((function(t){return t.replace(S,"-$1").toLowerCase()})),E=Function.prototype.bind?function(t,e){return t.bind(e)}:function(t,e){function n(n){var i=arguments.length;return i?i>1?t.apply(e,arguments):t.call(e,n):t.call(e)}return n._length=t.length,n};function T(t,e){e=e||0;for(var n=t.length-e,i=new Array(n);n--;)i[n]=t[n+e];return i}function B(t,e){for(var n in e)t[n]=e[n];return t}function O(t){for(var e={},n=0;n<t.length;n++)t[n]&&B(e,t[n]);return e}function I(t,e,n){}var j=function(t,e,n){return!1},L=function(t){return t};function P(t,e){if(t===e)return!0;var n=h(t),i=h(e);if(!n||!i)return!n&&!i&&String(t)===String(e);try{var s=Array.isArray(t),r=Array.isArray(e);if(s&&r)return t.length===e.length&&t.every((function(t,n){return P(t,e[n])}));if(t instanceof Date&&e instanceof Date)return t.getTime()===e.getTime();if(s||r)return!1;var o=Object.keys(t),a=Object.keys(e);return o.length===a.length&&o.every((function(n){return P(t[n],e[n])}))}catch(t){return!1}}function M(t,e){for(var n=0;n<t.length;n++)if(P(t[n],e))return n;return-1}function R(t){var e=!1;return function(){e||(e=!0,t.apply(this,arguments))}}var A="data-server-rendered",D=["component","directive","filter"],$=["beforeCreate","created","beforeMount","mounted","beforeUpdate","updated","beforeDestroy","destroyed","activated","deactivated","errorCaptured","serverPrefetch"],N={optionMergeStrategies:Object.create(null),silent:!1,productionTip:!1,devtools:!1,performance:!1,errorHandler:null,warnHandler:null,ignoredElements:[],keyCodes:Object.create(null),isReservedTag:j,isReservedAttr:j,isUnknownElement:j,getTagNamespace:I,parsePlatformTagName:L,mustUseProp:j,async:!0,_lifecycleHooks:$};function F(t,e,n,i){Object.defineProperty(t,e,{value:n,enumerable:!!i,writable:!0,configurable:!0})}var V,W=new RegExp("[^"+/a-zA-Z\u00B7\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u037D\u037F-\u1FFF\u200C-\u200D\u203F-\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD/.source+".$_\\d]"),H="__proto__"in{},z="undefined"!=typeof window,X="undefined"!=typeof WXEnvironment&&!!WXEnvironment.platform,Y=X&&WXEnvironment.platform.toLowerCase(),G=z&&window.navigator.userAgent.toLowerCase(),U=G&&/msie|trident/.test(G),q=G&&G.indexOf("msie 9.0")>0,J=G&&G.indexOf("edge/")>0,K=(G&&G.indexOf("android"),G&&/iphone|ipad|ipod|ios/.test(G)||"ios"===Y),Z=(G&&/chrome\/\d+/.test(G),G&&/phantomjs/.test(G),G&&G.match(/firefox\/(\d+)/)),Q={}.watch,tt=!1;if(z)try{var et={};Object.defineProperty(et,"passive",{get:function(){tt=!0}}),window.addEventListener("test-passive",null,et)}catch(t){}var nt=function(){return void 0===V&&(V=!z&&!X&&void 0!==i.g&&i.g.process&&"server"===i.g.process.env.VUE_ENV),V},it=z&&window.__VUE_DEVTOOLS_GLOBAL_HOOK__;function st(t){return"function"==typeof t&&/native code/.test(t.toString())}var rt,ot="undefined"!=typeof Symbol&&st(Symbol)&&"undefined"!=typeof Reflect&&st(Reflect.ownKeys);rt="undefined"!=typeof Set&&st(Set)?Set:function(){function t(){this.set=Object.create(null)}return t.prototype.has=function(t){return!0===this.set[t]},t.prototype.add=function(t){this.set[t]=!0},t.prototype.clear=function(){this.set=Object.create(null)},t}();var at=I,ht=0,ct=function(){this.id=ht++,this.subs=[]};ct.prototype.addSub=function(t){this.subs.push(t)},ct.prototype.removeSub=function(t){_(this.subs,t)},ct.prototype.depend=function(){ct.target&&ct.target.addDep(this)},ct.prototype.notify=function(){for(var t=this.subs.slice(),e=0,n=t.length;e<n;e++)t[e].update()},ct.target=null;var lt=[];function ut(t){lt.push(t),ct.target=t}function dt(){lt.pop(),ct.target=lt[lt.length-1]}var ft=function(t,e,n,i,s,r,o,a){this.tag=t,this.data=e,this.children=n,this.text=i,this.elm=s,this.ns=void 0,this.context=r,this.fnContext=void 0,this.fnOptions=void 0,this.fnScopeId=void 0,this.key=e&&e.key,this.componentOptions=o,this.componentInstance=void 0,this.parent=void 0,this.raw=!1,this.isStatic=!1,this.isRootInsert=!0,this.isComment=!1,this.isCloned=!1,this.isOnce=!1,this.asyncFactory=a,this.asyncMeta=void 0,this.isAsyncPlaceholder=!1},pt={child:{configurable:!0}};pt.child.get=function(){return this.componentInstance},Object.defineProperties(ft.prototype,pt);var gt=function(t){void 0===t&&(t="");var e=new ft;return e.text=t,e.isComment=!0,e};function mt(t){return new ft(void 0,void 0,void 0,String(t))}function _t(t){var e=new ft(t.tag,t.data,t.children&&t.children.slice(),t.text,t.elm,t.context,t.componentOptions,t.asyncFactory);return e.ns=t.ns,e.isStatic=t.isStatic,e.key=t.key,e.isComment=t.isComment,e.fnContext=t.fnContext,e.fnOptions=t.fnOptions,e.fnScopeId=t.fnScopeId,e.asyncMeta=t.asyncMeta,e.isCloned=!0,e}var vt=Array.prototype,yt=Object.create(vt);["push","pop","shift","unshift","splice","sort","reverse"].forEach((function(t){var e=vt[t];F(yt,t,(function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];var s,r=e.apply(this,n),o=this.__ob__;switch(t){case"push":case"unshift":s=n;break;case"splice":s=n.slice(2)}return s&&o.observeArray(s),o.dep.notify(),r}))}));var bt=Object.getOwnPropertyNames(yt),wt=!0;function xt(t){wt=t}var kt=function(t){this.value=t,this.dep=new ct,this.vmCount=0,F(t,"__ob__",this),Array.isArray(t)?(H?function(t,e){t.__proto__=e}(t,yt):function(t,e,n){for(var i=0,s=n.length;i<s;i++){var r=n[i];F(t,r,e[r])}}(t,yt,bt),this.observeArray(t)):this.walk(t)};function St(t,e){var n;if(h(t)&&!(t instanceof ft))return y(t,"__ob__")&&t.__ob__ instanceof kt?n=t.__ob__:wt&&!nt()&&(Array.isArray(t)||l(t))&&Object.isExtensible(t)&&!t._isVue&&(n=new kt(t)),e&&n&&n.vmCount++,n}function Ct(t,e,n,i,s){var r=new ct,o=Object.getOwnPropertyDescriptor(t,e);if(!o||!1!==o.configurable){var a=o&&o.get,h=o&&o.set;a&&!h||2!==arguments.length||(n=t[e]);var c=!s&&St(n);Object.defineProperty(t,e,{enumerable:!0,configurable:!0,get:function(){var e=a?a.call(t):n;return ct.target&&(r.depend(),c&&(c.dep.depend(),Array.isArray(e)&&Bt(e))),e},set:function(e){var i=a?a.call(t):n;e===i||e!=e&&i!=i||a&&!h||(h?h.call(t,e):n=e,c=!s&&St(e),r.notify())}})}}function Et(t,e,n){if(Array.isArray(t)&&u(e))return t.length=Math.max(t.length,e),t.splice(e,1,n),n;if(e in t&&!(e in Object.prototype))return t[e]=n,n;var i=t.__ob__;return t._isVue||i&&i.vmCount?n:i?(Ct(i.value,e,n),i.dep.notify(),n):(t[e]=n,n)}function Tt(t,e){if(Array.isArray(t)&&u(e))t.splice(e,1);else{var n=t.__ob__;t._isVue||n&&n.vmCount||y(t,e)&&(delete t[e],n&&n.dep.notify())}}function Bt(t){for(var e=void 0,n=0,i=t.length;n<i;n++)(e=t[n])&&e.__ob__&&e.__ob__.dep.depend(),Array.isArray(e)&&Bt(e)}kt.prototype.walk=function(t){for(var e=Object.keys(t),n=0;n<e.length;n++)Ct(t,e[n])},kt.prototype.observeArray=function(t){for(var e=0,n=t.length;e<n;e++)St(t[e])};var Ot=N.optionMergeStrategies;function It(t,e){if(!e)return t;for(var n,i,s,r=ot?Reflect.ownKeys(e):Object.keys(e),o=0;o<r.length;o++)"__ob__"!==(n=r[o])&&(i=t[n],s=e[n],y(t,n)?i!==s&&l(i)&&l(s)&&It(i,s):Et(t,n,s));return t}function jt(t,e,n){return n?function(){var i="function"==typeof e?e.call(n,n):e,s="function"==typeof t?t.call(n,n):t;return i?It(i,s):s}:e?t?function(){return It("function"==typeof e?e.call(this,this):e,"function"==typeof t?t.call(this,this):t)}:e:t}function Lt(t,e){var n=e?t?t.concat(e):Array.isArray(e)?e:[e]:t;return n?function(t){for(var e=[],n=0;n<t.length;n++)-1===e.indexOf(t[n])&&e.push(t[n]);return e}(n):n}function Pt(t,e,n,i){var s=Object.create(t||null);return e?B(s,e):s}Ot.data=function(t,e,n){return n?jt(t,e,n):e&&"function"!=typeof e?t:jt(t,e)},$.forEach((function(t){Ot[t]=Lt})),D.forEach((function(t){Ot[t+"s"]=Pt})),Ot.watch=function(t,e,n,i){if(t===Q&&(t=void 0),e===Q&&(e=void 0),!e)return Object.create(t||null);if(!t)return e;var s={};for(var r in B(s,t),e){var o=s[r],a=e[r];o&&!Array.isArray(o)&&(o=[o]),s[r]=o?o.concat(a):Array.isArray(a)?a:[a]}return s},Ot.props=Ot.methods=Ot.inject=Ot.computed=function(t,e,n,i){if(!t)return e;var s=Object.create(null);return B(s,t),e&&B(s,e),s},Ot.provide=jt;var Mt=function(t,e){return void 0===e?t:e};function Rt(t,e,n){if("function"==typeof e&&(e=e.options),function(t,e){var n=t.props;if(n){var i,s,r={};if(Array.isArray(n))for(i=n.length;i--;)"string"==typeof(s=n[i])&&(r[x(s)]={type:null});else if(l(n))for(var o in n)s=n[o],r[x(o)]=l(s)?s:{type:s};t.props=r}}(e),function(t,e){var n=t.inject;if(n){var i=t.inject={};if(Array.isArray(n))for(var s=0;s<n.length;s++)i[n[s]]={from:n[s]};else if(l(n))for(var r in n){var o=n[r];i[r]=l(o)?B({from:r},o):{from:o}}}}(e),function(t){var e=t.directives;if(e)for(var n in e){var i=e[n];"function"==typeof i&&(e[n]={bind:i,update:i})}}(e),!e._base&&(e.extends&&(t=Rt(t,e.extends,n)),e.mixins))for(var i=0,s=e.mixins.length;i<s;i++)t=Rt(t,e.mixins[i],n);var r,o={};for(r in t)a(r);for(r in e)y(t,r)||a(r);function a(i){var s=Ot[i]||Mt;o[i]=s(t[i],e[i],n,i)}return o}function At(t,e,n,i){if("string"==typeof n){var s=t[e];if(y(s,n))return s[n];var r=x(n);if(y(s,r))return s[r];var o=k(r);return y(s,o)?s[o]:s[n]||s[r]||s[o]}}function Dt(t,e,n,i){var s=e[t],r=!y(n,t),o=n[t],a=Vt(Boolean,s.type);if(a>-1)if(r&&!y(s,"default"))o=!1;else if(""===o||o===C(t)){var h=Vt(String,s.type);(h<0||a<h)&&(o=!0)}if(void 0===o){o=function(t,e,n){if(y(e,"default")){var i=e.default;return t&&t.$options.propsData&&void 0===t.$options.propsData[n]&&void 0!==t._props[n]?t._props[n]:"function"==typeof i&&"Function"!==Nt(e.type)?i.call(t):i}}(i,s,t);var c=wt;xt(!0),St(o),xt(c)}return o}var $t=/^\s*function (\w+)/;function Nt(t){var e=t&&t.toString().match($t);return e?e[1]:""}function Ft(t,e){return Nt(t)===Nt(e)}function Vt(t,e){if(!Array.isArray(e))return Ft(e,t)?0:-1;for(var n=0,i=e.length;n<i;n++)if(Ft(e[n],t))return n;return-1}function Wt(t,e,n){ut();try{if(e)for(var i=e;i=i.$parent;){var s=i.$options.errorCaptured;if(s)for(var r=0;r<s.length;r++)try{if(!1===s[r].call(i,t,e,n))return}catch(t){zt(t,i,"errorCaptured hook")}}zt(t,e,n)}finally{dt()}}function Ht(t,e,n,i,s){var r;try{(r=n?t.apply(e,n):t.call(e))&&!r._isVue&&d(r)&&!r._handled&&(r.catch((function(t){return Wt(t,i,s+" (Promise/async)")})),r._handled=!0)}catch(t){Wt(t,i,s)}return r}function zt(t,e,n){if(N.errorHandler)try{return N.errorHandler.call(null,t,e,n)}catch(e){e!==t&&Xt(e)}Xt(t)}function Xt(t,e,n){if(!z&&!X||"undefined"==typeof console)throw t;console.error(t)}var Yt,Gt=!1,Ut=[],qt=!1;function Jt(){qt=!1;var t=Ut.slice(0);Ut.length=0;for(var e=0;e<t.length;e++)t[e]()}if("undefined"!=typeof Promise&&st(Promise)){var Kt=Promise.resolve();Yt=function(){Kt.then(Jt),K&&setTimeout(I)},Gt=!0}else if(U||"undefined"==typeof MutationObserver||!st(MutationObserver)&&"[object MutationObserverConstructor]"!==MutationObserver.toString())Yt="undefined"!=typeof setImmediate&&st(setImmediate)?function(){setImmediate(Jt)}:function(){setTimeout(Jt,0)};else{var Zt=1,Qt=new MutationObserver(Jt),te=document.createTextNode(String(Zt));Qt.observe(te,{characterData:!0}),Yt=function(){Zt=(Zt+1)%2,te.data=String(Zt)},Gt=!0}function ee(t,e){var n;if(Ut.push((function(){if(t)try{t.call(e)}catch(t){Wt(t,e,"nextTick")}else n&&n(e)})),qt||(qt=!0,Yt()),!t&&"undefined"!=typeof Promise)return new Promise((function(t){n=t}))}var ne=new rt;function ie(t){se(t,ne),ne.clear()}function se(t,e){var n,i,s=Array.isArray(t);if(!(!s&&!h(t)||Object.isFrozen(t)||t instanceof ft)){if(t.__ob__){var r=t.__ob__.dep.id;if(e.has(r))return;e.add(r)}if(s)for(n=t.length;n--;)se(t[n],e);else for(n=(i=Object.keys(t)).length;n--;)se(t[i[n]],e)}}var re=b((function(t){var e="&"===t.charAt(0),n="~"===(t=e?t.slice(1):t).charAt(0),i="!"===(t=n?t.slice(1):t).charAt(0);return{name:t=i?t.slice(1):t,once:n,capture:i,passive:e}}));function oe(t,e){function n(){var t=arguments,i=n.fns;if(!Array.isArray(i))return Ht(i,null,arguments,e,"v-on handler");for(var s=i.slice(),r=0;r<s.length;r++)Ht(s[r],null,t,e,"v-on handler")}return n.fns=t,n}function ae(t,e,n,i,r,a){var h,c,l,u;for(h in t)c=t[h],l=e[h],u=re(h),s(c)||(s(l)?(s(c.fns)&&(c=t[h]=oe(c,a)),o(u.once)&&(c=t[h]=r(u.name,c,u.capture)),n(u.name,c,u.capture,u.passive,u.params)):c!==l&&(l.fns=c,t[h]=l));for(h in e)s(t[h])&&i((u=re(h)).name,e[h],u.capture)}function he(t,e,n){var i;t instanceof ft&&(t=t.data.hook||(t.data.hook={}));var a=t[e];function h(){n.apply(this,arguments),_(i.fns,h)}s(a)?i=oe([h]):r(a.fns)&&o(a.merged)?(i=a).fns.push(h):i=oe([a,h]),i.merged=!0,t[e]=i}function ce(t,e,n,i,s){if(r(e)){if(y(e,n))return t[n]=e[n],s||delete e[n],!0;if(y(e,i))return t[n]=e[i],s||delete e[i],!0}return!1}function le(t){return a(t)?[mt(t)]:Array.isArray(t)?de(t):void 0}function ue(t){return r(t)&&r(t.text)&&!1===t.isComment}function de(t,e){var n,i,h,c,l=[];for(n=0;n<t.length;n++)s(i=t[n])||"boolean"==typeof i||(c=l[h=l.length-1],Array.isArray(i)?i.length>0&&(ue((i=de(i,(e||"")+"_"+n))[0])&&ue(c)&&(l[h]=mt(c.text+i[0].text),i.shift()),l.push.apply(l,i)):a(i)?ue(c)?l[h]=mt(c.text+i):""!==i&&l.push(mt(i)):ue(i)&&ue(c)?l[h]=mt(c.text+i.text):(o(t._isVList)&&r(i.tag)&&s(i.key)&&r(e)&&(i.key="__vlist"+e+"_"+n+"__"),l.push(i)));return l}function fe(t,e){if(t){for(var n=Object.create(null),i=ot?Reflect.ownKeys(t):Object.keys(t),s=0;s<i.length;s++){var r=i[s];if("__ob__"!==r){for(var o=t[r].from,a=e;a;){if(a._provided&&y(a._provided,o)){n[r]=a._provided[o];break}a=a.$parent}if(!a&&"default"in t[r]){var h=t[r].default;n[r]="function"==typeof h?h.call(e):h}}}return n}}function pe(t,e){if(!t||!t.length)return{};for(var n={},i=0,s=t.length;i<s;i++){var r=t[i],o=r.data;if(o&&o.attrs&&o.attrs.slot&&delete o.attrs.slot,r.context!==e&&r.fnContext!==e||!o||null==o.slot)(n.default||(n.default=[])).push(r);else{var a=o.slot,h=n[a]||(n[a]=[]);"template"===r.tag?h.push.apply(h,r.children||[]):h.push(r)}}for(var c in n)n[c].every(ge)&&delete n[c];return n}function ge(t){return t.isComment&&!t.asyncFactory||" "===t.text}function me(t){return t.isComment&&t.asyncFactory}function _e(t,e,i){var s,r=Object.keys(e).length>0,o=t?!!t.$stable:!r,a=t&&t.$key;if(t){if(t._normalized)return t._normalized;if(o&&i&&i!==n&&a===i.$key&&!r&&!i.$hasNormal)return i;for(var h in s={},t)t[h]&&"$"!==h[0]&&(s[h]=ve(e,h,t[h]))}else s={};for(var c in e)c in s||(s[c]=ye(e,c));return t&&Object.isExtensible(t)&&(t._normalized=s),F(s,"$stable",o),F(s,"$key",a),F(s,"$hasNormal",r),s}function ve(t,e,n){var i=function(){var t=arguments.length?n.apply(null,arguments):n({}),e=(t=t&&"object"==typeof t&&!Array.isArray(t)?[t]:le(t))&&t[0];return t&&(!e||1===t.length&&e.isComment&&!me(e))?void 0:t};return n.proxy&&Object.defineProperty(t,e,{get:i,enumerable:!0,configurable:!0}),i}function ye(t,e){return function(){return t[e]}}function be(t,e){var n,i,s,o,a;if(Array.isArray(t)||"string"==typeof t)for(n=new Array(t.length),i=0,s=t.length;i<s;i++)n[i]=e(t[i],i);else if("number"==typeof t)for(n=new Array(t),i=0;i<t;i++)n[i]=e(i+1,i);else if(h(t))if(ot&&t[Symbol.iterator]){n=[];for(var c=t[Symbol.iterator](),l=c.next();!l.done;)n.push(e(l.value,n.length)),l=c.next()}else for(o=Object.keys(t),n=new Array(o.length),i=0,s=o.length;i<s;i++)a=o[i],n[i]=e(t[a],a,i);return r(n)||(n=[]),n._isVList=!0,n}function we(t,e,n,i){var s,r=this.$scopedSlots[t];r?(n=n||{},i&&(n=B(B({},i),n)),s=r(n)||("function"==typeof e?e():e)):s=this.$slots[t]||("function"==typeof e?e():e);var o=n&&n.slot;return o?this.$createElement("template",{slot:o},s):s}function xe(t){return At(this.$options,"filters",t)||L}function ke(t,e){return Array.isArray(t)?-1===t.indexOf(e):t!==e}function Se(t,e,n,i,s){var r=N.keyCodes[e]||n;return s&&i&&!N.keyCodes[e]?ke(s,i):r?ke(r,t):i?C(i)!==e:void 0===t}function Ce(t,e,n,i,s){if(n&&h(n)){var r;Array.isArray(n)&&(n=O(n));var o=function(o){if("class"===o||"style"===o||m(o))r=t;else{var a=t.attrs&&t.attrs.type;r=i||N.mustUseProp(e,a,o)?t.domProps||(t.domProps={}):t.attrs||(t.attrs={})}var h=x(o),c=C(o);h in r||c in r||(r[o]=n[o],s&&((t.on||(t.on={}))["update:"+o]=function(t){n[o]=t}))};for(var a in n)o(a)}return t}function Ee(t,e){var n=this._staticTrees||(this._staticTrees=[]),i=n[t];return i&&!e||Be(i=n[t]=this.$options.staticRenderFns[t].call(this._renderProxy,null,this),"__static__"+t,!1),i}function Te(t,e,n){return Be(t,"__once__"+e+(n?"_"+n:""),!0),t}function Be(t,e,n){if(Array.isArray(t))for(var i=0;i<t.length;i++)t[i]&&"string"!=typeof t[i]&&Oe(t[i],e+"_"+i,n);else Oe(t,e,n)}function Oe(t,e,n){t.isStatic=!0,t.key=e,t.isOnce=n}function Ie(t,e){if(e&&l(e)){var n=t.on=t.on?B({},t.on):{};for(var i in e){var s=n[i],r=e[i];n[i]=s?[].concat(s,r):r}}return t}function je(t,e,n,i){e=e||{$stable:!n};for(var s=0;s<t.length;s++){var r=t[s];Array.isArray(r)?je(r,e,n):r&&(r.proxy&&(r.fn.proxy=!0),e[r.key]=r.fn)}return i&&(e.$key=i),e}function Le(t,e){for(var n=0;n<e.length;n+=2){var i=e[n];"string"==typeof i&&i&&(t[e[n]]=e[n+1])}return t}function Pe(t,e){return"string"==typeof t?e+t:t}function Me(t){t._o=Te,t._n=p,t._s=f,t._l=be,t._t=we,t._q=P,t._i=M,t._m=Ee,t._f=xe,t._k=Se,t._b=Ce,t._v=mt,t._e=gt,t._u=je,t._g=Ie,t._d=Le,t._p=Pe}function Re(t,e,i,s,r){var a,h=this,c=r.options;y(s,"_uid")?(a=Object.create(s))._original=s:(a=s,s=s._original);var l=o(c._compiled),u=!l;this.data=t,this.props=e,this.children=i,this.parent=s,this.listeners=t.on||n,this.injections=fe(c.inject,s),this.slots=function(){return h.$slots||_e(t.scopedSlots,h.$slots=pe(i,s)),h.$slots},Object.defineProperty(this,"scopedSlots",{enumerable:!0,get:function(){return _e(t.scopedSlots,this.slots())}}),l&&(this.$options=c,this.$slots=this.slots(),this.$scopedSlots=_e(t.scopedSlots,this.$slots)),c._scopeId?this._c=function(t,e,n,i){var r=We(a,t,e,n,i,u);return r&&!Array.isArray(r)&&(r.fnScopeId=c._scopeId,r.fnContext=s),r}:this._c=function(t,e,n,i){return We(a,t,e,n,i,u)}}function Ae(t,e,n,i,s){var r=_t(t);return r.fnContext=n,r.fnOptions=i,e.slot&&((r.data||(r.data={})).slot=e.slot),r}function De(t,e){for(var n in e)t[x(n)]=e[n]}Me(Re.prototype);var $e={init:function(t,e){if(t.componentInstance&&!t.componentInstance._isDestroyed&&t.data.keepAlive){var n=t;$e.prepatch(n,n)}else(t.componentInstance=function(t,e){var n={_isComponent:!0,_parentVnode:t,parent:e},i=t.data.inlineTemplate;return r(i)&&(n.render=i.render,n.staticRenderFns=i.staticRenderFns),new t.componentOptions.Ctor(n)}(t,Ze)).$mount(e?t.elm:void 0,e)},prepatch:function(t,e){var i=e.componentOptions;!function(t,e,i,s,r){var o=s.data.scopedSlots,a=t.$scopedSlots,h=!!(o&&!o.$stable||a!==n&&!a.$stable||o&&t.$scopedSlots.$key!==o.$key||!o&&t.$scopedSlots.$key),c=!!(r||t.$options._renderChildren||h);if(t.$options._parentVnode=s,t.$vnode=s,t._vnode&&(t._vnode.parent=s),t.$options._renderChildren=r,t.$attrs=s.data.attrs||n,t.$listeners=i||n,e&&t.$options.props){xt(!1);for(var l=t._props,u=t.$options._propKeys||[],d=0;d<u.length;d++){var f=u[d],p=t.$options.props;l[f]=Dt(f,p,e,t)}xt(!0),t.$options.propsData=e}i=i||n;var g=t.$options._parentListeners;t.$options._parentListeners=i,Ke(t,i,g),c&&(t.$slots=pe(r,s.context),t.$forceUpdate())}(e.componentInstance=t.componentInstance,i.propsData,i.listeners,e,i.children)},insert:function(t){var e,n=t.context,i=t.componentInstance;i._isMounted||(i._isMounted=!0,sn(i,"mounted")),t.data.keepAlive&&(n._isMounted?((e=i)._inactive=!1,on.push(e)):en(i,!0))},destroy:function(t){var e=t.componentInstance;e._isDestroyed||(t.data.keepAlive?nn(e,!0):e.$destroy())}},Ne=Object.keys($e);function Fe(t,e,i,a,c){if(!s(t)){var l=i.$options._base;if(h(t)&&(t=l.extend(t)),"function"==typeof t){var u;if(s(t.cid)&&(t=function(t,e){if(o(t.error)&&r(t.errorComp))return t.errorComp;if(r(t.resolved))return t.resolved;var n=Xe;if(n&&r(t.owners)&&-1===t.owners.indexOf(n)&&t.owners.push(n),o(t.loading)&&r(t.loadingComp))return t.loadingComp;if(n&&!r(t.owners)){var i=t.owners=[n],a=!0,c=null,l=null;n.$on("hook:destroyed",(function(){return _(i,n)}));var u=function(t){for(var e=0,n=i.length;e<n;e++)i[e].$forceUpdate();t&&(i.length=0,null!==c&&(clearTimeout(c),c=null),null!==l&&(clearTimeout(l),l=null))},f=R((function(n){t.resolved=Ye(n,e),a?i.length=0:u(!0)})),p=R((function(e){r(t.errorComp)&&(t.error=!0,u(!0))})),g=t(f,p);return h(g)&&(d(g)?s(t.resolved)&&g.then(f,p):d(g.component)&&(g.component.then(f,p),r(g.error)&&(t.errorComp=Ye(g.error,e)),r(g.loading)&&(t.loadingComp=Ye(g.loading,e),0===g.delay?t.loading=!0:c=setTimeout((function(){c=null,s(t.resolved)&&s(t.error)&&(t.loading=!0,u(!1))}),g.delay||200)),r(g.timeout)&&(l=setTimeout((function(){l=null,s(t.resolved)&&p(null)}),g.timeout)))),a=!1,t.loading?t.loadingComp:t.resolved}}(u=t,l),void 0===t))return function(t,e,n,i,s){var r=gt();return r.asyncFactory=t,r.asyncMeta={data:e,context:n,children:i,tag:s},r}(u,e,i,a,c);e=e||{},Cn(t),r(e.model)&&function(t,e){var n=t.model&&t.model.prop||"value",i=t.model&&t.model.event||"input";(e.attrs||(e.attrs={}))[n]=e.model.value;var s=e.on||(e.on={}),o=s[i],a=e.model.callback;r(o)?(Array.isArray(o)?-1===o.indexOf(a):o!==a)&&(s[i]=[a].concat(o)):s[i]=a}(t.options,e);var f=function(t,e,n){var i=e.options.props;if(!s(i)){var o={},a=t.attrs,h=t.props;if(r(a)||r(h))for(var c in i){var l=C(c);ce(o,h,c,l,!0)||ce(o,a,c,l,!1)}return o}}(e,t);if(o(t.options.functional))return function(t,e,i,s,o){var a=t.options,h={},c=a.props;if(r(c))for(var l in c)h[l]=Dt(l,c,e||n);else r(i.attrs)&&De(h,i.attrs),r(i.props)&&De(h,i.props);var u=new Re(i,h,o,s,t),d=a.render.call(null,u._c,u);if(d instanceof ft)return Ae(d,i,u.parent,a);if(Array.isArray(d)){for(var f=le(d)||[],p=new Array(f.length),g=0;g<f.length;g++)p[g]=Ae(f[g],i,u.parent,a);return p}}(t,f,e,i,a);var p=e.on;if(e.on=e.nativeOn,o(t.options.abstract)){var g=e.slot;e={},g&&(e.slot=g)}!function(t){for(var e=t.hook||(t.hook={}),n=0;n<Ne.length;n++){var i=Ne[n],s=e[i],r=$e[i];s===r||s&&s._merged||(e[i]=s?Ve(r,s):r)}}(e);var m=t.options.name||c;return new ft("vue-component-"+t.cid+(m?"-"+m:""),e,void 0,void 0,void 0,i,{Ctor:t,propsData:f,listeners:p,tag:c,children:a},u)}}}function Ve(t,e){var n=function(n,i){t(n,i),e(n,i)};return n._merged=!0,n}function We(t,e,n,i,s,c){return(Array.isArray(n)||a(n))&&(s=i,i=n,n=void 0),o(c)&&(s=2),function(t,e,n,i,s){if(r(n)&&r(n.__ob__))return gt();if(r(n)&&r(n.is)&&(e=n.is),!e)return gt();var o,a,c;(Array.isArray(i)&&"function"==typeof i[0]&&((n=n||{}).scopedSlots={default:i[0]},i.length=0),2===s?i=le(i):1===s&&(i=function(t){for(var e=0;e<t.length;e++)if(Array.isArray(t[e]))return Array.prototype.concat.apply([],t);return t}(i)),"string"==typeof e)?(a=t.$vnode&&t.$vnode.ns||N.getTagNamespace(e),o=N.isReservedTag(e)?new ft(N.parsePlatformTagName(e),n,i,void 0,void 0,t):n&&n.pre||!r(c=At(t.$options,"components",e))?new ft(e,n,i,void 0,void 0,t):Fe(c,n,t,i,e)):o=Fe(e,n,t,i);return Array.isArray(o)?o:r(o)?(r(a)&&He(o,a),r(n)&&function(t){h(t.style)&&ie(t.style),h(t.class)&&ie(t.class)}(n),o):gt()}(t,e,n,i,s)}function He(t,e,n){if(t.ns=e,"foreignObject"===t.tag&&(e=void 0,n=!0),r(t.children))for(var i=0,a=t.children.length;i<a;i++){var h=t.children[i];r(h.tag)&&(s(h.ns)||o(n)&&"svg"!==h.tag)&&He(h,e,n)}}var ze,Xe=null;function Ye(t,e){return(t.__esModule||ot&&"Module"===t[Symbol.toStringTag])&&(t=t.default),h(t)?e.extend(t):t}function Ge(t){if(Array.isArray(t))for(var e=0;e<t.length;e++){var n=t[e];if(r(n)&&(r(n.componentOptions)||me(n)))return n}}function Ue(t,e){ze.$on(t,e)}function qe(t,e){ze.$off(t,e)}function Je(t,e){var n=ze;return function i(){var s=e.apply(null,arguments);null!==s&&n.$off(t,i)}}function Ke(t,e,n){ze=t,ae(e,n||{},Ue,qe,Je,t),ze=void 0}var Ze=null;function Qe(t){var e=Ze;return Ze=t,function(){Ze=e}}function tn(t){for(;t&&(t=t.$parent);)if(t._inactive)return!0;return!1}function en(t,e){if(e){if(t._directInactive=!1,tn(t))return}else if(t._directInactive)return;if(t._inactive||null===t._inactive){t._inactive=!1;for(var n=0;n<t.$children.length;n++)en(t.$children[n]);sn(t,"activated")}}function nn(t,e){if(!(e&&(t._directInactive=!0,tn(t))||t._inactive)){t._inactive=!0;for(var n=0;n<t.$children.length;n++)nn(t.$children[n]);sn(t,"deactivated")}}function sn(t,e){ut();var n=t.$options[e],i=e+" hook";if(n)for(var s=0,r=n.length;s<r;s++)Ht(n[s],t,null,t,i);t._hasHookEvent&&t.$emit("hook:"+e),dt()}var rn=[],on=[],an={},hn=!1,cn=!1,ln=0,un=0,dn=Date.now;if(z&&!U){var fn=window.performance;fn&&"function"==typeof fn.now&&dn()>document.createEvent("Event").timeStamp&&(dn=function(){return fn.now()})}function pn(){var t,e;for(un=dn(),cn=!0,rn.sort((function(t,e){return t.id-e.id})),ln=0;ln<rn.length;ln++)(t=rn[ln]).before&&t.before(),e=t.id,an[e]=null,t.run();var n=on.slice(),i=rn.slice();ln=rn.length=on.length=0,an={},hn=cn=!1,function(t){for(var e=0;e<t.length;e++)t[e]._inactive=!0,en(t[e],!0)}(n),function(t){for(var e=t.length;e--;){var n=t[e],i=n.vm;i._watcher===n&&i._isMounted&&!i._isDestroyed&&sn(i,"updated")}}(i),it&&N.devtools&&it.emit("flush")}var gn=0,mn=function(t,e,n,i,s){this.vm=t,s&&(t._watcher=this),t._watchers.push(this),i?(this.deep=!!i.deep,this.user=!!i.user,this.lazy=!!i.lazy,this.sync=!!i.sync,this.before=i.before):this.deep=this.user=this.lazy=this.sync=!1,this.cb=n,this.id=++gn,this.active=!0,this.dirty=this.lazy,this.deps=[],this.newDeps=[],this.depIds=new rt,this.newDepIds=new rt,this.expression="","function"==typeof e?this.getter=e:(this.getter=function(t){if(!W.test(t)){var e=t.split(".");return function(t){for(var n=0;n<e.length;n++){if(!t)return;t=t[e[n]]}return t}}}(e),this.getter||(this.getter=I)),this.value=this.lazy?void 0:this.get()};mn.prototype.get=function(){var t;ut(this);var e=this.vm;try{t=this.getter.call(e,e)}catch(t){if(!this.user)throw t;Wt(t,e,'getter for watcher "'+this.expression+'"')}finally{this.deep&&ie(t),dt(),this.cleanupDeps()}return t},mn.prototype.addDep=function(t){var e=t.id;this.newDepIds.has(e)||(this.newDepIds.add(e),this.newDeps.push(t),this.depIds.has(e)||t.addSub(this))},mn.prototype.cleanupDeps=function(){for(var t=this.deps.length;t--;){var e=this.deps[t];this.newDepIds.has(e.id)||e.removeSub(this)}var n=this.depIds;this.depIds=this.newDepIds,this.newDepIds=n,this.newDepIds.clear(),n=this.deps,this.deps=this.newDeps,this.newDeps=n,this.newDeps.length=0},mn.prototype.update=function(){this.lazy?this.dirty=!0:this.sync?this.run():function(t){var e=t.id;if(null==an[e]){if(an[e]=!0,cn){for(var n=rn.length-1;n>ln&&rn[n].id>t.id;)n--;rn.splice(n+1,0,t)}else rn.push(t);hn||(hn=!0,ee(pn))}}(this)},mn.prototype.run=function(){if(this.active){var t=this.get();if(t!==this.value||h(t)||this.deep){var e=this.value;if(this.value=t,this.user){var n='callback for watcher "'+this.expression+'"';Ht(this.cb,this.vm,[t,e],this.vm,n)}else this.cb.call(this.vm,t,e)}}},mn.prototype.evaluate=function(){this.value=this.get(),this.dirty=!1},mn.prototype.depend=function(){for(var t=this.deps.length;t--;)this.deps[t].depend()},mn.prototype.teardown=function(){if(this.active){this.vm._isBeingDestroyed||_(this.vm._watchers,this);for(var t=this.deps.length;t--;)this.deps[t].removeSub(this);this.active=!1}};var _n={enumerable:!0,configurable:!0,get:I,set:I};function vn(t,e,n){_n.get=function(){return this[e][n]},_n.set=function(t){this[e][n]=t},Object.defineProperty(t,n,_n)}var yn={lazy:!0};function bn(t,e,n){var i=!nt();"function"==typeof n?(_n.get=i?wn(e):xn(n),_n.set=I):(_n.get=n.get?i&&!1!==n.cache?wn(e):xn(n.get):I,_n.set=n.set||I),Object.defineProperty(t,e,_n)}function wn(t){return function(){var e=this._computedWatchers&&this._computedWatchers[t];if(e)return e.dirty&&e.evaluate(),ct.target&&e.depend(),e.value}}function xn(t){return function(){return t.call(this,this)}}function kn(t,e,n,i){return l(n)&&(i=n,n=n.handler),"string"==typeof n&&(n=t[n]),t.$watch(e,n,i)}var Sn=0;function Cn(t){var e=t.options;if(t.super){var n=Cn(t.super);if(n!==t.superOptions){t.superOptions=n;var i=function(t){var e,n=t.options,i=t.sealedOptions;for(var s in n)n[s]!==i[s]&&(e||(e={}),e[s]=n[s]);return e}(t);i&&B(t.extendOptions,i),(e=t.options=Rt(n,t.extendOptions)).name&&(e.components[e.name]=t)}}return e}function En(t){this._init(t)}function Tn(t){return t&&(t.Ctor.options.name||t.tag)}function Bn(t,e){return Array.isArray(t)?t.indexOf(e)>-1:"string"==typeof t?t.split(",").indexOf(e)>-1:(n=t,!("[object RegExp]"!==c.call(n))&&t.test(e));var n}function On(t,e){var n=t.cache,i=t.keys,s=t._vnode;for(var r in n){var o=n[r];if(o){var a=o.name;a&&!e(a)&&In(n,r,i,s)}}}function In(t,e,n,i){var s=t[e];!s||i&&s.tag===i.tag||s.componentInstance.$destroy(),t[e]=null,_(n,e)}!function(t){t.prototype._init=function(t){var e=this;e._uid=Sn++,e._isVue=!0,t&&t._isComponent?function(t,e){var n=t.$options=Object.create(t.constructor.options),i=e._parentVnode;n.parent=e.parent,n._parentVnode=i;var s=i.componentOptions;n.propsData=s.propsData,n._parentListeners=s.listeners,n._renderChildren=s.children,n._componentTag=s.tag,e.render&&(n.render=e.render,n.staticRenderFns=e.staticRenderFns)}(e,t):e.$options=Rt(Cn(e.constructor),t||{},e),e._renderProxy=e,e._self=e,function(t){var e=t.$options,n=e.parent;if(n&&!e.abstract){for(;n.$options.abstract&&n.$parent;)n=n.$parent;n.$children.push(t)}t.$parent=n,t.$root=n?n.$root:t,t.$children=[],t.$refs={},t._watcher=null,t._inactive=null,t._directInactive=!1,t._isMounted=!1,t._isDestroyed=!1,t._isBeingDestroyed=!1}(e),function(t){t._events=Object.create(null),t._hasHookEvent=!1;var e=t.$options._parentListeners;e&&Ke(t,e)}(e),function(t){t._vnode=null,t._staticTrees=null;var e=t.$options,i=t.$vnode=e._parentVnode,s=i&&i.context;t.$slots=pe(e._renderChildren,s),t.$scopedSlots=n,t._c=function(e,n,i,s){return We(t,e,n,i,s,!1)},t.$createElement=function(e,n,i,s){return We(t,e,n,i,s,!0)};var r=i&&i.data;Ct(t,"$attrs",r&&r.attrs||n,null,!0),Ct(t,"$listeners",e._parentListeners||n,null,!0)}(e),sn(e,"beforeCreate"),function(t){var e=fe(t.$options.inject,t);e&&(xt(!1),Object.keys(e).forEach((function(n){Ct(t,n,e[n])})),xt(!0))}(e),function(t){t._watchers=[];var e=t.$options;e.props&&function(t,e){var n=t.$options.propsData||{},i=t._props={},s=t.$options._propKeys=[];t.$parent&&xt(!1);var r=function(r){s.push(r);var o=Dt(r,e,n,t);Ct(i,r,o),r in t||vn(t,"_props",r)};for(var o in e)r(o);xt(!0)}(t,e.props),e.methods&&function(t,e){for(var n in t.$options.props,e)t[n]="function"!=typeof e[n]?I:E(e[n],t)}(t,e.methods),e.data?function(t){var e=t.$options.data;l(e=t._data="function"==typeof e?function(t,e){ut();try{return t.call(e,e)}catch(t){return Wt(t,e,"data()"),{}}finally{dt()}}(e,t):e||{})||(e={});for(var n,i=Object.keys(e),s=t.$options.props,r=(t.$options.methods,i.length);r--;){var o=i[r];s&&y(s,o)||(n=void 0,36===(n=(o+"").charCodeAt(0))||95===n)||vn(t,"_data",o)}St(e,!0)}(t):St(t._data={},!0),e.computed&&function(t,e){var n=t._computedWatchers=Object.create(null),i=nt();for(var s in e){var r=e[s],o="function"==typeof r?r:r.get;i||(n[s]=new mn(t,o||I,I,yn)),s in t||bn(t,s,r)}}(t,e.computed),e.watch&&e.watch!==Q&&function(t,e){for(var n in e){var i=e[n];if(Array.isArray(i))for(var s=0;s<i.length;s++)kn(t,n,i[s]);else kn(t,n,i)}}(t,e.watch)}(e),function(t){var e=t.$options.provide;e&&(t._provided="function"==typeof e?e.call(t):e)}(e),sn(e,"created"),e.$options.el&&e.$mount(e.$options.el)}}(En),function(t){Object.defineProperty(t.prototype,"$data",{get:function(){return this._data}}),Object.defineProperty(t.prototype,"$props",{get:function(){return this._props}}),t.prototype.$set=Et,t.prototype.$delete=Tt,t.prototype.$watch=function(t,e,n){var i=this;if(l(e))return kn(i,t,e,n);(n=n||{}).user=!0;var s=new mn(i,t,e,n);if(n.immediate){var r='callback for immediate watcher "'+s.expression+'"';ut(),Ht(e,i,[s.value],i,r),dt()}return function(){s.teardown()}}}(En),function(t){var e=/^hook:/;t.prototype.$on=function(t,n){var i=this;if(Array.isArray(t))for(var s=0,r=t.length;s<r;s++)i.$on(t[s],n);else(i._events[t]||(i._events[t]=[])).push(n),e.test(t)&&(i._hasHookEvent=!0);return i},t.prototype.$once=function(t,e){var n=this;function i(){n.$off(t,i),e.apply(n,arguments)}return i.fn=e,n.$on(t,i),n},t.prototype.$off=function(t,e){var n=this;if(!arguments.length)return n._events=Object.create(null),n;if(Array.isArray(t)){for(var i=0,s=t.length;i<s;i++)n.$off(t[i],e);return n}var r,o=n._events[t];if(!o)return n;if(!e)return n._events[t]=null,n;for(var a=o.length;a--;)if((r=o[a])===e||r.fn===e){o.splice(a,1);break}return n},t.prototype.$emit=function(t){var e=this,n=e._events[t];if(n){n=n.length>1?T(n):n;for(var i=T(arguments,1),s='event handler for "'+t+'"',r=0,o=n.length;r<o;r++)Ht(n[r],e,i,e,s)}return e}}(En),function(t){t.prototype._update=function(t,e){var n=this,i=n.$el,s=n._vnode,r=Qe(n);n._vnode=t,n.$el=s?n.__patch__(s,t):n.__patch__(n.$el,t,e,!1),r(),i&&(i.__vue__=null),n.$el&&(n.$el.__vue__=n),n.$vnode&&n.$parent&&n.$vnode===n.$parent._vnode&&(n.$parent.$el=n.$el)},t.prototype.$forceUpdate=function(){this._watcher&&this._watcher.update()},t.prototype.$destroy=function(){var t=this;if(!t._isBeingDestroyed){sn(t,"beforeDestroy"),t._isBeingDestroyed=!0;var e=t.$parent;!e||e._isBeingDestroyed||t.$options.abstract||_(e.$children,t),t._watcher&&t._watcher.teardown();for(var n=t._watchers.length;n--;)t._watchers[n].teardown();t._data.__ob__&&t._data.__ob__.vmCount--,t._isDestroyed=!0,t.__patch__(t._vnode,null),sn(t,"destroyed"),t.$off(),t.$el&&(t.$el.__vue__=null),t.$vnode&&(t.$vnode.parent=null)}}}(En),function(t){Me(t.prototype),t.prototype.$nextTick=function(t){return ee(t,this)},t.prototype._render=function(){var t,e=this,n=e.$options,i=n.render,s=n._parentVnode;s&&(e.$scopedSlots=_e(s.data.scopedSlots,e.$slots,e.$scopedSlots)),e.$vnode=s;try{Xe=e,t=i.call(e._renderProxy,e.$createElement)}catch(n){Wt(n,e,"render"),t=e._vnode}finally{Xe=null}return Array.isArray(t)&&1===t.length&&(t=t[0]),t instanceof ft||(t=gt()),t.parent=s,t}}(En);var jn=[String,RegExp,Array],Ln={name:"keep-alive",abstract:!0,props:{include:jn,exclude:jn,max:[String,Number]},methods:{cacheVNode:function(){var t=this,e=t.cache,n=t.keys,i=t.vnodeToCache,s=t.keyToCache;if(i){var r=i.tag,o=i.componentInstance,a=i.componentOptions;e[s]={name:Tn(a),tag:r,componentInstance:o},n.push(s),this.max&&n.length>parseInt(this.max)&&In(e,n[0],n,this._vnode),this.vnodeToCache=null}}},created:function(){this.cache=Object.create(null),this.keys=[]},destroyed:function(){for(var t in this.cache)In(this.cache,t,this.keys)},mounted:function(){var t=this;this.cacheVNode(),this.$watch("include",(function(e){On(t,(function(t){return Bn(e,t)}))})),this.$watch("exclude",(function(e){On(t,(function(t){return!Bn(e,t)}))}))},updated:function(){this.cacheVNode()},render:function(){var t=this.$slots.default,e=Ge(t),n=e&&e.componentOptions;if(n){var i=Tn(n),s=this.include,r=this.exclude;if(s&&(!i||!Bn(s,i))||r&&i&&Bn(r,i))return e;var o=this.cache,a=this.keys,h=null==e.key?n.Ctor.cid+(n.tag?"::"+n.tag:""):e.key;o[h]?(e.componentInstance=o[h].componentInstance,_(a,h),a.push(h)):(this.vnodeToCache=e,this.keyToCache=h),e.data.keepAlive=!0}return e||t&&t[0]}},Pn={KeepAlive:Ln};!function(t){var e={get:function(){return N}};Object.defineProperty(t,"config",e),t.util={warn:at,extend:B,mergeOptions:Rt,defineReactive:Ct},t.set=Et,t.delete=Tt,t.nextTick=ee,t.observable=function(t){return St(t),t},t.options=Object.create(null),D.forEach((function(e){t.options[e+"s"]=Object.create(null)})),t.options._base=t,B(t.options.components,Pn),function(t){t.use=function(t){var e=this._installedPlugins||(this._installedPlugins=[]);if(e.indexOf(t)>-1)return this;var n=T(arguments,1);return n.unshift(this),"function"==typeof t.install?t.install.apply(t,n):"function"==typeof t&&t.apply(null,n),e.push(t),this}}(t),function(t){t.mixin=function(t){return this.options=Rt(this.options,t),this}}(t),function(t){t.cid=0;var e=1;t.extend=function(t){t=t||{};var n=this,i=n.cid,s=t._Ctor||(t._Ctor={});if(s[i])return s[i];var r=t.name||n.options.name,o=function(t){this._init(t)};return(o.prototype=Object.create(n.prototype)).constructor=o,o.cid=e++,o.options=Rt(n.options,t),o.super=n,o.options.props&&function(t){var e=t.options.props;for(var n in e)vn(t.prototype,"_props",n)}(o),o.options.computed&&function(t){var e=t.options.computed;for(var n in e)bn(t.prototype,n,e[n])}(o),o.extend=n.extend,o.mixin=n.mixin,o.use=n.use,D.forEach((function(t){o[t]=n[t]})),r&&(o.options.components[r]=o),o.superOptions=n.options,o.extendOptions=t,o.sealedOptions=B({},o.options),s[i]=o,o}}(t),function(t){D.forEach((function(e){t[e]=function(t,n){return n?("component"===e&&l(n)&&(n.name=n.name||t,n=this.options._base.extend(n)),"directive"===e&&"function"==typeof n&&(n={bind:n,update:n}),this.options[e+"s"][t]=n,n):this.options[e+"s"][t]}}))}(t)}(En),Object.defineProperty(En.prototype,"$isServer",{get:nt}),Object.defineProperty(En.prototype,"$ssrContext",{get:function(){return this.$vnode&&this.$vnode.ssrContext}}),Object.defineProperty(En,"FunctionalRenderContext",{value:Re}),En.version="2.6.14";var Mn=g("style,class"),Rn=g("input,textarea,option,select,progress"),An=g("contenteditable,draggable,spellcheck"),Dn=g("events,caret,typing,plaintext-only"),$n=g("allowfullscreen,async,autofocus,autoplay,checked,compact,controls,declare,default,defaultchecked,defaultmuted,defaultselected,defer,disabled,enabled,formnovalidate,hidden,indeterminate,inert,ismap,itemscope,loop,multiple,muted,nohref,noresize,noshade,novalidate,nowrap,open,pauseonexit,readonly,required,reversed,scoped,seamless,selected,sortable,truespeed,typemustmatch,visible"),Nn="http://www.w3.org/1999/xlink",Fn=function(t){return":"===t.charAt(5)&&"xlink"===t.slice(0,5)},Vn=function(t){return Fn(t)?t.slice(6,t.length):""},Wn=function(t){return null==t||!1===t};function Hn(t,e){return{staticClass:zn(t.staticClass,e.staticClass),class:r(t.class)?[t.class,e.class]:e.class}}function zn(t,e){return t?e?t+" "+e:t:e||""}function Xn(t){return Array.isArray(t)?function(t){for(var e,n="",i=0,s=t.length;i<s;i++)r(e=Xn(t[i]))&&""!==e&&(n&&(n+=" "),n+=e);return n}(t):h(t)?function(t){var e="";for(var n in t)t[n]&&(e&&(e+=" "),e+=n);return e}(t):"string"==typeof t?t:""}var Yn={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"},Gn=g("html,body,base,head,link,meta,style,title,address,article,aside,footer,header,h1,h2,h3,h4,h5,h6,hgroup,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,rtc,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,menuitem,summary,content,element,shadow,template,blockquote,iframe,tfoot"),Un=g("svg,animate,circle,clippath,cursor,defs,desc,ellipse,filter,font-face,foreignobject,g,glyph,image,line,marker,mask,missing-glyph,path,pattern,polygon,polyline,rect,switch,symbol,text,textpath,tspan,use,view",!0),qn=function(t){return Gn(t)||Un(t)},Jn=Object.create(null),Kn=g("text,number,password,search,email,tel,url"),Zn=Object.freeze({createElement:function(t,e){var n=document.createElement(t);return"select"!==t||e.data&&e.data.attrs&&void 0!==e.data.attrs.multiple&&n.setAttribute("multiple","multiple"),n},createElementNS:function(t,e){return document.createElementNS(Yn[t],e)},createTextNode:function(t){return document.createTextNode(t)},createComment:function(t){return document.createComment(t)},insertBefore:function(t,e,n){t.insertBefore(e,n)},removeChild:function(t,e){t.removeChild(e)},appendChild:function(t,e){t.appendChild(e)},parentNode:function(t){return t.parentNode},nextSibling:function(t){return t.nextSibling},tagName:function(t){return t.tagName},setTextContent:function(t,e){t.textContent=e},setStyleScope:function(t,e){t.setAttribute(e,"")}}),Qn={create:function(t,e){ti(e)},update:function(t,e){t.data.ref!==e.data.ref&&(ti(t,!0),ti(e))},destroy:function(t){ti(t,!0)}};function ti(t,e){var n=t.data.ref;if(r(n)){var i=t.context,s=t.componentInstance||t.elm,o=i.$refs;e?Array.isArray(o[n])?_(o[n],s):o[n]===s&&(o[n]=void 0):t.data.refInFor?Array.isArray(o[n])?o[n].indexOf(s)<0&&o[n].push(s):o[n]=[s]:o[n]=s}}var ei=new ft("",{},[]),ni=["create","activate","update","remove","destroy"];function ii(t,e){return t.key===e.key&&t.asyncFactory===e.asyncFactory&&(t.tag===e.tag&&t.isComment===e.isComment&&r(t.data)===r(e.data)&&function(t,e){if("input"!==t.tag)return!0;var n,i=r(n=t.data)&&r(n=n.attrs)&&n.type,s=r(n=e.data)&&r(n=n.attrs)&&n.type;return i===s||Kn(i)&&Kn(s)}(t,e)||o(t.isAsyncPlaceholder)&&s(e.asyncFactory.error))}function si(t,e,n){var i,s,o={};for(i=e;i<=n;++i)r(s=t[i].key)&&(o[s]=i);return o}var ri={create:oi,update:oi,destroy:function(t){oi(t,ei)}};function oi(t,e){(t.data.directives||e.data.directives)&&function(t,e){var n,i,s,r=t===ei,o=e===ei,a=hi(t.data.directives,t.context),h=hi(e.data.directives,e.context),c=[],l=[];for(n in h)i=a[n],s=h[n],i?(s.oldValue=i.value,s.oldArg=i.arg,li(s,"update",e,t),s.def&&s.def.componentUpdated&&l.push(s)):(li(s,"bind",e,t),s.def&&s.def.inserted&&c.push(s));if(c.length){var u=function(){for(var n=0;n<c.length;n++)li(c[n],"inserted",e,t)};r?he(e,"insert",u):u()}if(l.length&&he(e,"postpatch",(function(){for(var n=0;n<l.length;n++)li(l[n],"componentUpdated",e,t)})),!r)for(n in a)h[n]||li(a[n],"unbind",t,t,o)}(t,e)}var ai=Object.create(null);function hi(t,e){var n,i,s=Object.create(null);if(!t)return s;for(n=0;n<t.length;n++)(i=t[n]).modifiers||(i.modifiers=ai),s[ci(i)]=i,i.def=At(e.$options,"directives",i.name);return s}function ci(t){return t.rawName||t.name+"."+Object.keys(t.modifiers||{}).join(".")}function li(t,e,n,i,s){var r=t.def&&t.def[e];if(r)try{r(n.elm,t,n,i,s)}catch(i){Wt(i,n.context,"directive "+t.name+" "+e+" hook")}}var ui=[Qn,ri];function di(t,e){var n=e.componentOptions;if(!(r(n)&&!1===n.Ctor.options.inheritAttrs||s(t.data.attrs)&&s(e.data.attrs))){var i,o,a=e.elm,h=t.data.attrs||{},c=e.data.attrs||{};for(i in r(c.__ob__)&&(c=e.data.attrs=B({},c)),c)o=c[i],h[i]!==o&&fi(a,i,o,e.data.pre);for(i in(U||J)&&c.value!==h.value&&fi(a,"value",c.value),h)s(c[i])&&(Fn(i)?a.removeAttributeNS(Nn,Vn(i)):An(i)||a.removeAttribute(i))}}function fi(t,e,n,i){i||t.tagName.indexOf("-")>-1?pi(t,e,n):$n(e)?Wn(n)?t.removeAttribute(e):(n="allowfullscreen"===e&&"EMBED"===t.tagName?"true":e,t.setAttribute(e,n)):An(e)?t.setAttribute(e,function(t,e){return Wn(e)||"false"===e?"false":"contenteditable"===t&&Dn(e)?e:"true"}(e,n)):Fn(e)?Wn(n)?t.removeAttributeNS(Nn,Vn(e)):t.setAttributeNS(Nn,e,n):pi(t,e,n)}function pi(t,e,n){if(Wn(n))t.removeAttribute(e);else{if(U&&!q&&"TEXTAREA"===t.tagName&&"placeholder"===e&&""!==n&&!t.__ieph){var i=function(e){e.stopImmediatePropagation(),t.removeEventListener("input",i)};t.addEventListener("input",i),t.__ieph=!0}t.setAttribute(e,n)}}var gi={create:di,update:di};function mi(t,e){var n=e.elm,i=e.data,o=t.data;if(!(s(i.staticClass)&&s(i.class)&&(s(o)||s(o.staticClass)&&s(o.class)))){var a=function(t){for(var e=t.data,n=t,i=t;r(i.componentInstance);)(i=i.componentInstance._vnode)&&i.data&&(e=Hn(i.data,e));for(;r(n=n.parent);)n&&n.data&&(e=Hn(e,n.data));return s=e.staticClass,o=e.class,r(s)||r(o)?zn(s,Xn(o)):"";var s,o}(e),h=n._transitionClasses;r(h)&&(a=zn(a,Xn(h))),a!==n._prevClass&&(n.setAttribute("class",a),n._prevClass=a)}}var _i,vi={create:mi,update:mi};function yi(t,e,n){var i=_i;return function s(){var r=e.apply(null,arguments);null!==r&&xi(t,s,n,i)}}var bi=Gt&&!(Z&&Number(Z[1])<=53);function wi(t,e,n,i){if(bi){var s=un,r=e;e=r._wrapper=function(t){if(t.target===t.currentTarget||t.timeStamp>=s||t.timeStamp<=0||t.target.ownerDocument!==document)return r.apply(this,arguments)}}_i.addEventListener(t,e,tt?{capture:n,passive:i}:n)}function xi(t,e,n,i){(i||_i).removeEventListener(t,e._wrapper||e,n)}function ki(t,e){if(!s(t.data.on)||!s(e.data.on)){var n=e.data.on||{},i=t.data.on||{};_i=e.elm,function(t){if(r(t.__r)){var e=U?"change":"input";t[e]=[].concat(t.__r,t[e]||[]),delete t.__r}r(t.__c)&&(t.change=[].concat(t.__c,t.change||[]),delete t.__c)}(n),ae(n,i,wi,xi,yi,e.context),_i=void 0}}var Si,Ci={create:ki,update:ki};function Ei(t,e){if(!s(t.data.domProps)||!s(e.data.domProps)){var n,i,o=e.elm,a=t.data.domProps||{},h=e.data.domProps||{};for(n in r(h.__ob__)&&(h=e.data.domProps=B({},h)),a)n in h||(o[n]="");for(n in h){if(i=h[n],"textContent"===n||"innerHTML"===n){if(e.children&&(e.children.length=0),i===a[n])continue;1===o.childNodes.length&&o.removeChild(o.childNodes[0])}if("value"===n&&"PROGRESS"!==o.tagName){o._value=i;var c=s(i)?"":String(i);Ti(o,c)&&(o.value=c)}else if("innerHTML"===n&&Un(o.tagName)&&s(o.innerHTML)){(Si=Si||document.createElement("div")).innerHTML="<svg>"+i+"</svg>";for(var l=Si.firstChild;o.firstChild;)o.removeChild(o.firstChild);for(;l.firstChild;)o.appendChild(l.firstChild)}else if(i!==a[n])try{o[n]=i}catch(t){}}}}function Ti(t,e){return!t.composing&&("OPTION"===t.tagName||function(t,e){var n=!0;try{n=document.activeElement!==t}catch(t){}return n&&t.value!==e}(t,e)||function(t,e){var n=t.value,i=t._vModifiers;if(r(i)){if(i.number)return p(n)!==p(e);if(i.trim)return n.trim()!==e.trim()}return n!==e}(t,e))}var Bi={create:Ei,update:Ei},Oi=b((function(t){var e={},n=/:(.+)/;return t.split(/;(?![^(]*\))/g).forEach((function(t){if(t){var i=t.split(n);i.length>1&&(e[i[0].trim()]=i[1].trim())}})),e}));function Ii(t){var e=ji(t.style);return t.staticStyle?B(t.staticStyle,e):e}function ji(t){return Array.isArray(t)?O(t):"string"==typeof t?Oi(t):t}var Li,Pi=/^--/,Mi=/\s*!important$/,Ri=function(t,e,n){if(Pi.test(e))t.style.setProperty(e,n);else if(Mi.test(n))t.style.setProperty(C(e),n.replace(Mi,""),"important");else{var i=Di(e);if(Array.isArray(n))for(var s=0,r=n.length;s<r;s++)t.style[i]=n[s];else t.style[i]=n}},Ai=["Webkit","Moz","ms"],Di=b((function(t){if(Li=Li||document.createElement("div").style,"filter"!==(t=x(t))&&t in Li)return t;for(var e=t.charAt(0).toUpperCase()+t.slice(1),n=0;n<Ai.length;n++){var i=Ai[n]+e;if(i in Li)return i}}));function $i(t,e){var n=e.data,i=t.data;if(!(s(n.staticStyle)&&s(n.style)&&s(i.staticStyle)&&s(i.style))){var o,a,h=e.elm,c=i.staticStyle,l=i.normalizedStyle||i.style||{},u=c||l,d=ji(e.data.style)||{};e.data.normalizedStyle=r(d.__ob__)?B({},d):d;var f=function(t,e){for(var n,i={},s=t;s.componentInstance;)(s=s.componentInstance._vnode)&&s.data&&(n=Ii(s.data))&&B(i,n);(n=Ii(t.data))&&B(i,n);for(var r=t;r=r.parent;)r.data&&(n=Ii(r.data))&&B(i,n);return i}(e);for(a in u)s(f[a])&&Ri(h,a,"");for(a in f)(o=f[a])!==u[a]&&Ri(h,a,null==o?"":o)}}var Ni={create:$i,update:$i},Fi=/\s+/;function Vi(t,e){if(e&&(e=e.trim()))if(t.classList)e.indexOf(" ")>-1?e.split(Fi).forEach((function(e){return t.classList.add(e)})):t.classList.add(e);else{var n=" "+(t.getAttribute("class")||"")+" ";n.indexOf(" "+e+" ")<0&&t.setAttribute("class",(n+e).trim())}}function Wi(t,e){if(e&&(e=e.trim()))if(t.classList)e.indexOf(" ")>-1?e.split(Fi).forEach((function(e){return t.classList.remove(e)})):t.classList.remove(e),t.classList.length||t.removeAttribute("class");else{for(var n=" "+(t.getAttribute("class")||"")+" ",i=" "+e+" ";n.indexOf(i)>=0;)n=n.replace(i," ");(n=n.trim())?t.setAttribute("class",n):t.removeAttribute("class")}}function Hi(t){if(t){if("object"==typeof t){var e={};return!1!==t.css&&B(e,zi(t.name||"v")),B(e,t),e}return"string"==typeof t?zi(t):void 0}}var zi=b((function(t){return{enterClass:t+"-enter",enterToClass:t+"-enter-to",enterActiveClass:t+"-enter-active",leaveClass:t+"-leave",leaveToClass:t+"-leave-to",leaveActiveClass:t+"-leave-active"}})),Xi=z&&!q,Yi="transition",Gi="animation",Ui="transition",qi="transitionend",Ji="animation",Ki="animationend";Xi&&(void 0===window.ontransitionend&&void 0!==window.onwebkittransitionend&&(Ui="WebkitTransition",qi="webkitTransitionEnd"),void 0===window.onanimationend&&void 0!==window.onwebkitanimationend&&(Ji="WebkitAnimation",Ki="webkitAnimationEnd"));var Zi=z?window.requestAnimationFrame?window.requestAnimationFrame.bind(window):setTimeout:function(t){return t()};function Qi(t){Zi((function(){Zi(t)}))}function ts(t,e){var n=t._transitionClasses||(t._transitionClasses=[]);n.indexOf(e)<0&&(n.push(e),Vi(t,e))}function es(t,e){t._transitionClasses&&_(t._transitionClasses,e),Wi(t,e)}function ns(t,e,n){var i=ss(t,e),s=i.type,r=i.timeout,o=i.propCount;if(!s)return n();var a=s===Yi?qi:Ki,h=0,c=function(){t.removeEventListener(a,l),n()},l=function(e){e.target===t&&++h>=o&&c()};setTimeout((function(){h<o&&c()}),r+1),t.addEventListener(a,l)}var is=/\b(transform|all)(,|$)/;function ss(t,e){var n,i=window.getComputedStyle(t),s=(i[Ui+"Delay"]||"").split(", "),r=(i[Ui+"Duration"]||"").split(", "),o=rs(s,r),a=(i[Ji+"Delay"]||"").split(", "),h=(i[Ji+"Duration"]||"").split(", "),c=rs(a,h),l=0,u=0;return e===Yi?o>0&&(n=Yi,l=o,u=r.length):e===Gi?c>0&&(n=Gi,l=c,u=h.length):u=(n=(l=Math.max(o,c))>0?o>c?Yi:Gi:null)?n===Yi?r.length:h.length:0,{type:n,timeout:l,propCount:u,hasTransform:n===Yi&&is.test(i[Ui+"Property"])}}function rs(t,e){for(;t.length<e.length;)t=t.concat(t);return Math.max.apply(null,e.map((function(e,n){return os(e)+os(t[n])})))}function os(t){return 1e3*Number(t.slice(0,-1).replace(",","."))}function as(t,e){var n=t.elm;r(n._leaveCb)&&(n._leaveCb.cancelled=!0,n._leaveCb());var i=Hi(t.data.transition);if(!s(i)&&!r(n._enterCb)&&1===n.nodeType){for(var o=i.css,a=i.type,c=i.enterClass,l=i.enterToClass,u=i.enterActiveClass,d=i.appearClass,f=i.appearToClass,g=i.appearActiveClass,m=i.beforeEnter,_=i.enter,v=i.afterEnter,y=i.enterCancelled,b=i.beforeAppear,w=i.appear,x=i.afterAppear,k=i.appearCancelled,S=i.duration,C=Ze,E=Ze.$vnode;E&&E.parent;)C=E.context,E=E.parent;var T=!C._isMounted||!t.isRootInsert;if(!T||w||""===w){var B=T&&d?d:c,O=T&&g?g:u,I=T&&f?f:l,j=T&&b||m,L=T&&"function"==typeof w?w:_,P=T&&x||v,M=T&&k||y,A=p(h(S)?S.enter:S),D=!1!==o&&!q,$=ls(L),N=n._enterCb=R((function(){D&&(es(n,I),es(n,O)),N.cancelled?(D&&es(n,B),M&&M(n)):P&&P(n),n._enterCb=null}));t.data.show||he(t,"insert",(function(){var e=n.parentNode,i=e&&e._pending&&e._pending[t.key];i&&i.tag===t.tag&&i.elm._leaveCb&&i.elm._leaveCb(),L&&L(n,N)})),j&&j(n),D&&(ts(n,B),ts(n,O),Qi((function(){es(n,B),N.cancelled||(ts(n,I),$||(cs(A)?setTimeout(N,A):ns(n,a,N)))}))),t.data.show&&(e&&e(),L&&L(n,N)),D||$||N()}}}function hs(t,e){var n=t.elm;r(n._enterCb)&&(n._enterCb.cancelled=!0,n._enterCb());var i=Hi(t.data.transition);if(s(i)||1!==n.nodeType)return e();if(!r(n._leaveCb)){var o=i.css,a=i.type,c=i.leaveClass,l=i.leaveToClass,u=i.leaveActiveClass,d=i.beforeLeave,f=i.leave,g=i.afterLeave,m=i.leaveCancelled,_=i.delayLeave,v=i.duration,y=!1!==o&&!q,b=ls(f),w=p(h(v)?v.leave:v),x=n._leaveCb=R((function(){n.parentNode&&n.parentNode._pending&&(n.parentNode._pending[t.key]=null),y&&(es(n,l),es(n,u)),x.cancelled?(y&&es(n,c),m&&m(n)):(e(),g&&g(n)),n._leaveCb=null}));_?_(k):k()}function k(){x.cancelled||(!t.data.show&&n.parentNode&&((n.parentNode._pending||(n.parentNode._pending={}))[t.key]=t),d&&d(n),y&&(ts(n,c),ts(n,u),Qi((function(){es(n,c),x.cancelled||(ts(n,l),b||(cs(w)?setTimeout(x,w):ns(n,a,x)))}))),f&&f(n,x),y||b||x())}}function cs(t){return"number"==typeof t&&!isNaN(t)}function ls(t){if(s(t))return!1;var e=t.fns;return r(e)?ls(Array.isArray(e)?e[0]:e):(t._length||t.length)>1}function us(t,e){!0!==e.data.show&&as(e)}var ds=function(t){var e,n,i={},h=t.modules,c=t.nodeOps;for(e=0;e<ni.length;++e)for(i[ni[e]]=[],n=0;n<h.length;++n)r(h[n][ni[e]])&&i[ni[e]].push(h[n][ni[e]]);function l(t){var e=c.parentNode(t);r(e)&&c.removeChild(e,t)}function u(t,e,n,s,a,h,l){if(r(t.elm)&&r(h)&&(t=h[l]=_t(t)),t.isRootInsert=!a,!function(t,e,n,s){var a=t.data;if(r(a)){var h=r(t.componentInstance)&&a.keepAlive;if(r(a=a.hook)&&r(a=a.init)&&a(t,!1),r(t.componentInstance))return d(t,e),f(n,t.elm,s),o(h)&&function(t,e,n,s){for(var o,a=t;a.componentInstance;)if(r(o=(a=a.componentInstance._vnode).data)&&r(o=o.transition)){for(o=0;o<i.activate.length;++o)i.activate[o](ei,a);e.push(a);break}f(n,t.elm,s)}(t,e,n,s),!0}}(t,e,n,s)){var u=t.data,g=t.children,m=t.tag;r(m)?(t.elm=t.ns?c.createElementNS(t.ns,m):c.createElement(m,t),v(t),p(t,g,e),r(u)&&_(t,e),f(n,t.elm,s)):o(t.isComment)?(t.elm=c.createComment(t.text),f(n,t.elm,s)):(t.elm=c.createTextNode(t.text),f(n,t.elm,s))}}function d(t,e){r(t.data.pendingInsert)&&(e.push.apply(e,t.data.pendingInsert),t.data.pendingInsert=null),t.elm=t.componentInstance.$el,m(t)?(_(t,e),v(t)):(ti(t),e.push(t))}function f(t,e,n){r(t)&&(r(n)?c.parentNode(n)===t&&c.insertBefore(t,e,n):c.appendChild(t,e))}function p(t,e,n){if(Array.isArray(e))for(var i=0;i<e.length;++i)u(e[i],n,t.elm,null,!0,e,i);else a(t.text)&&c.appendChild(t.elm,c.createTextNode(String(t.text)))}function m(t){for(;t.componentInstance;)t=t.componentInstance._vnode;return r(t.tag)}function _(t,n){for(var s=0;s<i.create.length;++s)i.create[s](ei,t);r(e=t.data.hook)&&(r(e.create)&&e.create(ei,t),r(e.insert)&&n.push(t))}function v(t){var e;if(r(e=t.fnScopeId))c.setStyleScope(t.elm,e);else for(var n=t;n;)r(e=n.context)&&r(e=e.$options._scopeId)&&c.setStyleScope(t.elm,e),n=n.parent;r(e=Ze)&&e!==t.context&&e!==t.fnContext&&r(e=e.$options._scopeId)&&c.setStyleScope(t.elm,e)}function y(t,e,n,i,s,r){for(;i<=s;++i)u(n[i],r,t,e,!1,n,i)}function b(t){var e,n,s=t.data;if(r(s))for(r(e=s.hook)&&r(e=e.destroy)&&e(t),e=0;e<i.destroy.length;++e)i.destroy[e](t);if(r(e=t.children))for(n=0;n<t.children.length;++n)b(t.children[n])}function w(t,e,n){for(;e<=n;++e){var i=t[e];r(i)&&(r(i.tag)?(x(i),b(i)):l(i.elm))}}function x(t,e){if(r(e)||r(t.data)){var n,s=i.remove.length+1;for(r(e)?e.listeners+=s:e=function(t,e){function n(){0==--n.listeners&&l(t)}return n.listeners=e,n}(t.elm,s),r(n=t.componentInstance)&&r(n=n._vnode)&&r(n.data)&&x(n,e),n=0;n<i.remove.length;++n)i.remove[n](t,e);r(n=t.data.hook)&&r(n=n.remove)?n(t,e):e()}else l(t.elm)}function k(t,e,n,i){for(var s=n;s<i;s++){var o=e[s];if(r(o)&&ii(t,o))return s}}function S(t,e,n,a,h,l){if(t!==e){r(e.elm)&&r(a)&&(e=a[h]=_t(e));var d=e.elm=t.elm;if(o(t.isAsyncPlaceholder))r(e.asyncFactory.resolved)?T(t.elm,e,n):e.isAsyncPlaceholder=!0;else if(o(e.isStatic)&&o(t.isStatic)&&e.key===t.key&&(o(e.isCloned)||o(e.isOnce)))e.componentInstance=t.componentInstance;else{var f,p=e.data;r(p)&&r(f=p.hook)&&r(f=f.prepatch)&&f(t,e);var g=t.children,_=e.children;if(r(p)&&m(e)){for(f=0;f<i.update.length;++f)i.update[f](t,e);r(f=p.hook)&&r(f=f.update)&&f(t,e)}s(e.text)?r(g)&&r(_)?g!==_&&function(t,e,n,i,o){for(var a,h,l,d=0,f=0,p=e.length-1,g=e[0],m=e[p],_=n.length-1,v=n[0],b=n[_],x=!o;d<=p&&f<=_;)s(g)?g=e[++d]:s(m)?m=e[--p]:ii(g,v)?(S(g,v,i,n,f),g=e[++d],v=n[++f]):ii(m,b)?(S(m,b,i,n,_),m=e[--p],b=n[--_]):ii(g,b)?(S(g,b,i,n,_),x&&c.insertBefore(t,g.elm,c.nextSibling(m.elm)),g=e[++d],b=n[--_]):ii(m,v)?(S(m,v,i,n,f),x&&c.insertBefore(t,m.elm,g.elm),m=e[--p],v=n[++f]):(s(a)&&(a=si(e,d,p)),s(h=r(v.key)?a[v.key]:k(v,e,d,p))?u(v,i,t,g.elm,!1,n,f):ii(l=e[h],v)?(S(l,v,i,n,f),e[h]=void 0,x&&c.insertBefore(t,l.elm,g.elm)):u(v,i,t,g.elm,!1,n,f),v=n[++f]);d>p?y(t,s(n[_+1])?null:n[_+1].elm,n,f,_,i):f>_&&w(e,d,p)}(d,g,_,n,l):r(_)?(r(t.text)&&c.setTextContent(d,""),y(d,null,_,0,_.length-1,n)):r(g)?w(g,0,g.length-1):r(t.text)&&c.setTextContent(d,""):t.text!==e.text&&c.setTextContent(d,e.text),r(p)&&r(f=p.hook)&&r(f=f.postpatch)&&f(t,e)}}}function C(t,e,n){if(o(n)&&r(t.parent))t.parent.data.pendingInsert=e;else for(var i=0;i<e.length;++i)e[i].data.hook.insert(e[i])}var E=g("attrs,class,staticClass,staticStyle,key");function T(t,e,n,i){var s,a=e.tag,h=e.data,c=e.children;if(i=i||h&&h.pre,e.elm=t,o(e.isComment)&&r(e.asyncFactory))return e.isAsyncPlaceholder=!0,!0;if(r(h)&&(r(s=h.hook)&&r(s=s.init)&&s(e,!0),r(s=e.componentInstance)))return d(e,n),!0;if(r(a)){if(r(c))if(t.hasChildNodes())if(r(s=h)&&r(s=s.domProps)&&r(s=s.innerHTML)){if(s!==t.innerHTML)return!1}else{for(var l=!0,u=t.firstChild,f=0;f<c.length;f++){if(!u||!T(u,c[f],n,i)){l=!1;break}u=u.nextSibling}if(!l||u)return!1}else p(e,c,n);if(r(h)){var g=!1;for(var m in h)if(!E(m)){g=!0,_(e,n);break}!g&&h.class&&ie(h.class)}}else t.data!==e.text&&(t.data=e.text);return!0}return function(t,e,n,a){if(!s(e)){var h,l=!1,d=[];if(s(t))l=!0,u(e,d);else{var f=r(t.nodeType);if(!f&&ii(t,e))S(t,e,d,null,null,a);else{if(f){if(1===t.nodeType&&t.hasAttribute(A)&&(t.removeAttribute(A),n=!0),o(n)&&T(t,e,d))return C(e,d,!0),t;h=t,t=new ft(c.tagName(h).toLowerCase(),{},[],void 0,h)}var p=t.elm,g=c.parentNode(p);if(u(e,d,p._leaveCb?null:g,c.nextSibling(p)),r(e.parent))for(var _=e.parent,v=m(e);_;){for(var y=0;y<i.destroy.length;++y)i.destroy[y](_);if(_.elm=e.elm,v){for(var x=0;x<i.create.length;++x)i.create[x](ei,_);var k=_.data.hook.insert;if(k.merged)for(var E=1;E<k.fns.length;E++)k.fns[E]()}else ti(_);_=_.parent}r(g)?w([t],0,0):r(t.tag)&&b(t)}}return C(e,d,l),e.elm}r(t)&&b(t)}}({nodeOps:Zn,modules:[gi,vi,Ci,Bi,Ni,z?{create:us,activate:us,remove:function(t,e){!0!==t.data.show?hs(t,e):e()}}:{}].concat(ui)});q&&document.addEventListener("selectionchange",(function(){var t=document.activeElement;t&&t.vmodel&&bs(t,"input")}));var fs={inserted:function(t,e,n,i){"select"===n.tag?(i.elm&&!i.elm._vOptions?he(n,"postpatch",(function(){fs.componentUpdated(t,e,n)})):ps(t,e,n.context),t._vOptions=[].map.call(t.options,_s)):("textarea"===n.tag||Kn(t.type))&&(t._vModifiers=e.modifiers,e.modifiers.lazy||(t.addEventListener("compositionstart",vs),t.addEventListener("compositionend",ys),t.addEventListener("change",ys),q&&(t.vmodel=!0)))},componentUpdated:function(t,e,n){if("select"===n.tag){ps(t,e,n.context);var i=t._vOptions,s=t._vOptions=[].map.call(t.options,_s);s.some((function(t,e){return!P(t,i[e])}))&&(t.multiple?e.value.some((function(t){return ms(t,s)})):e.value!==e.oldValue&&ms(e.value,s))&&bs(t,"change")}}};function ps(t,e,n){gs(t,e),(U||J)&&setTimeout((function(){gs(t,e)}),0)}function gs(t,e,n){var i=e.value,s=t.multiple;if(!s||Array.isArray(i)){for(var r,o,a=0,h=t.options.length;a<h;a++)if(o=t.options[a],s)r=M(i,_s(o))>-1,o.selected!==r&&(o.selected=r);else if(P(_s(o),i))return void(t.selectedIndex!==a&&(t.selectedIndex=a));s||(t.selectedIndex=-1)}}function ms(t,e){return e.every((function(e){return!P(e,t)}))}function _s(t){return"_value"in t?t._value:t.value}function vs(t){t.target.composing=!0}function ys(t){t.target.composing&&(t.target.composing=!1,bs(t.target,"input"))}function bs(t,e){var n=document.createEvent("HTMLEvents");n.initEvent(e,!0,!0),t.dispatchEvent(n)}function ws(t){return!t.componentInstance||t.data&&t.data.transition?t:ws(t.componentInstance._vnode)}var xs={bind:function(t,e,n){var i=e.value,s=(n=ws(n)).data&&n.data.transition,r=t.__vOriginalDisplay="none"===t.style.display?"":t.style.display;i&&s?(n.data.show=!0,as(n,(function(){t.style.display=r}))):t.style.display=i?r:"none"},update:function(t,e,n){var i=e.value;!i!=!e.oldValue&&((n=ws(n)).data&&n.data.transition?(n.data.show=!0,i?as(n,(function(){t.style.display=t.__vOriginalDisplay})):hs(n,(function(){t.style.display="none"}))):t.style.display=i?t.__vOriginalDisplay:"none")},unbind:function(t,e,n,i,s){s||(t.style.display=t.__vOriginalDisplay)}},ks={model:fs,show:xs},Ss={name:String,appear:Boolean,css:Boolean,mode:String,type:String,enterClass:String,leaveClass:String,enterToClass:String,leaveToClass:String,enterActiveClass:String,leaveActiveClass:String,appearClass:String,appearActiveClass:String,appearToClass:String,duration:[Number,String,Object]};function Cs(t){var e=t&&t.componentOptions;return e&&e.Ctor.options.abstract?Cs(Ge(e.children)):t}function Es(t){var e={},n=t.$options;for(var i in n.propsData)e[i]=t[i];var s=n._parentListeners;for(var r in s)e[x(r)]=s[r];return e}function Ts(t,e){if(/\d-keep-alive$/.test(e.tag))return t("keep-alive",{props:e.componentOptions.propsData})}var Bs=function(t){return t.tag||me(t)},Os=function(t){return"show"===t.name},Is={name:"transition",props:Ss,abstract:!0,render:function(t){var e=this,n=this.$slots.default;if(n&&(n=n.filter(Bs)).length){var i=this.mode,s=n[0];if(function(t){for(;t=t.parent;)if(t.data.transition)return!0}(this.$vnode))return s;var r=Cs(s);if(!r)return s;if(this._leaving)return Ts(t,s);var o="__transition-"+this._uid+"-";r.key=null==r.key?r.isComment?o+"comment":o+r.tag:a(r.key)?0===String(r.key).indexOf(o)?r.key:o+r.key:r.key;var h=(r.data||(r.data={})).transition=Es(this),c=this._vnode,l=Cs(c);if(r.data.directives&&r.data.directives.some(Os)&&(r.data.show=!0),l&&l.data&&!function(t,e){return e.key===t.key&&e.tag===t.tag}(r,l)&&!me(l)&&(!l.componentInstance||!l.componentInstance._vnode.isComment)){var u=l.data.transition=B({},h);if("out-in"===i)return this._leaving=!0,he(u,"afterLeave",(function(){e._leaving=!1,e.$forceUpdate()})),Ts(t,s);if("in-out"===i){if(me(r))return c;var d,f=function(){d()};he(h,"afterEnter",f),he(h,"enterCancelled",f),he(u,"delayLeave",(function(t){d=t}))}}return s}}},js=B({tag:String,moveClass:String},Ss);function Ls(t){t.elm._moveCb&&t.elm._moveCb(),t.elm._enterCb&&t.elm._enterCb()}function Ps(t){t.data.newPos=t.elm.getBoundingClientRect()}function Ms(t){var e=t.data.pos,n=t.data.newPos,i=e.left-n.left,s=e.top-n.top;if(i||s){t.data.moved=!0;var r=t.elm.style;r.transform=r.WebkitTransform="translate("+i+"px,"+s+"px)",r.transitionDuration="0s"}}delete js.mode;var Rs={Transition:Is,TransitionGroup:{props:js,beforeMount:function(){var t=this,e=this._update;this._update=function(n,i){var s=Qe(t);t.__patch__(t._vnode,t.kept,!1,!0),t._vnode=t.kept,s(),e.call(t,n,i)}},render:function(t){for(var e=this.tag||this.$vnode.data.tag||"span",n=Object.create(null),i=this.prevChildren=this.children,s=this.$slots.default||[],r=this.children=[],o=Es(this),a=0;a<s.length;a++){var h=s[a];h.tag&&null!=h.key&&0!==String(h.key).indexOf("__vlist")&&(r.push(h),n[h.key]=h,(h.data||(h.data={})).transition=o)}if(i){for(var c=[],l=[],u=0;u<i.length;u++){var d=i[u];d.data.transition=o,d.data.pos=d.elm.getBoundingClientRect(),n[d.key]?c.push(d):l.push(d)}this.kept=t(e,null,c),this.removed=l}return t(e,null,r)},updated:function(){var t=this.prevChildren,e=this.moveClass||(this.name||"v")+"-move";t.length&&this.hasMove(t[0].elm,e)&&(t.forEach(Ls),t.forEach(Ps),t.forEach(Ms),this._reflow=document.body.offsetHeight,t.forEach((function(t){if(t.data.moved){var n=t.elm,i=n.style;ts(n,e),i.transform=i.WebkitTransform=i.transitionDuration="",n.addEventListener(qi,n._moveCb=function t(i){i&&i.target!==n||i&&!/transform$/.test(i.propertyName)||(n.removeEventListener(qi,t),n._moveCb=null,es(n,e))})}})))},methods:{hasMove:function(t,e){if(!Xi)return!1;if(this._hasMove)return this._hasMove;var n=t.cloneNode();t._transitionClasses&&t._transitionClasses.forEach((function(t){Wi(n,t)})),Vi(n,e),n.style.display="none",this.$el.appendChild(n);var i=ss(n);return this.$el.removeChild(n),this._hasMove=i.hasTransform}}}};En.config.mustUseProp=function(t,e,n){return"value"===n&&Rn(t)&&"button"!==e||"selected"===n&&"option"===t||"checked"===n&&"input"===t||"muted"===n&&"video"===t},En.config.isReservedTag=qn,En.config.isReservedAttr=Mn,En.config.getTagNamespace=function(t){return Un(t)?"svg":"math"===t?"math":void 0},En.config.isUnknownElement=function(t){if(!z)return!0;if(qn(t))return!1;if(t=t.toLowerCase(),null!=Jn[t])return Jn[t];var e=document.createElement(t);return t.indexOf("-")>-1?Jn[t]=e.constructor===window.HTMLUnknownElement||e.constructor===window.HTMLElement:Jn[t]=/HTMLUnknownElement/.test(e.toString())},B(En.options.directives,ks),B(En.options.components,Rs),En.prototype.__patch__=z?ds:I,En.prototype.$mount=function(t,e){return function(t,e,n){var i;return t.$el=e,t.$options.render||(t.$options.render=gt),sn(t,"beforeMount"),i=function(){t._update(t._render(),n)},new mn(t,i,I,{before:function(){t._isMounted&&!t._isDestroyed&&sn(t,"beforeUpdate")}},!0),n=!1,null==t.$vnode&&(t._isMounted=!0,sn(t,"mounted")),t}(this,t=t&&z?function(t){return"string"==typeof t?document.querySelector(t)||document.createElement("div"):t}(t):void 0,e)},z&&setTimeout((function(){N.devtools&&it&&it.emit("init",En)}),0);const As=En;function Ds(t){const e=document.createElement("canvas"),n=e.getContext("2d"),{width:i,height:s,left:r,top:o}=t.getBoundingClientRect();e.style.width=i+"px",e.style.height=s+"px",e.style.userSelect="none";const a=window.devicePixelRatio;return e.width=Math.floor(i*a),e.height=Math.floor(s*a),t&&(t.style.position="relative",t.style.overflow="hidden",t.append(e)),{canvas:e,width:i,height:s,raw_width:e.width,raw_height:e.height,left:r,top:o,ctx:n,scale:a}}const $s=document.createElement("canvas");$s.width=1,$s.height=1;const Ns=$s.getContext("2d"),Fs=window.devicePixelRatio;function Vs(t){Ns.clearRect(0,0,5,5),Ns.save(),t(Ns),Ns.restore(),Ns.clearRect(0,0,5,5)}function Ws(t,e){const n=matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`);function i(){console.log("devicePixelRatio changed: "+window.devicePixelRatio),t(window.devicePixelRatio),Ws(t,e)}e((()=>{console.log("remove devicePixelRatio event handler"),n.removeEventListener("change",i,{once:!0})})),n.addEventListener("change",i,{once:!0})}Ns.scale(Fs,Fs);const{abs:Hs,cos:zs,sin:Xs,acos:Ys,atan2:Gs,sqrt:Us,pow:qs}=Math;function Js(t){return t<0?-qs(-t,1/3):qs(t,1/3)}const Ks=Math.PI,Zs=2*Ks,Qs=Ks/2,tr=Number.MAX_SAFE_INTEGER||9007199254740991,er=Number.MIN_SAFE_INTEGER||-9007199254740991,nr={x:0,y:0,z:0},ir={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(t,e){const n=e(t);let i=n.x*n.x+n.y*n.y;return void 0!==n.z&&(i+=n.z*n.z),Us(i)},compute:function(t,e,n){if(0===t)return e[0].t=0,e[0];const i=e.length-1;if(1===t)return e[i].t=1,e[i];const s=1-t;let r=e;if(0===i)return e[0].t=t,e[0];if(1===i){const e={x:s*r[0].x+t*r[1].x,y:s*r[0].y+t*r[1].y,t};return n&&(e.z=s*r[0].z+t*r[1].z),e}if(i<4){let e,o,a,h=s*s,c=t*t,l=0;2===i?(r=[r[0],r[1],r[2],nr],e=h,o=s*t*2,a=c):3===i&&(e=h*s,o=h*t*3,a=s*c*3,l=t*c);const u={x:e*r[0].x+o*r[1].x+a*r[2].x+l*r[3].x,y:e*r[0].y+o*r[1].y+a*r[2].y+l*r[3].y,t};return n&&(u.z=e*r[0].z+o*r[1].z+a*r[2].z+l*r[3].z),u}const o=JSON.parse(JSON.stringify(e));for(;o.length>1;){for(let e=0;e<o.length-1;e++)o[e]={x:o[e].x+(o[e+1].x-o[e].x)*t,y:o[e].y+(o[e+1].y-o[e].y)*t},void 0!==o[e].z&&(o[e]=o[e].z+(o[e+1].z-o[e].z)*t);o.splice(o.length-1,1)}return o[0].t=t,o[0]},computeWithRatios:function(t,e,n,i){const s=1-t,r=n,o=e;let a,h=r[0],c=r[1],l=r[2],u=r[3];return h*=s,c*=t,2===o.length?(a=h+c,{x:(h*o[0].x+c*o[1].x)/a,y:(h*o[0].y+c*o[1].y)/a,z:!!i&&(h*o[0].z+c*o[1].z)/a,t}):(h*=s,c*=2*s,l*=t*t,3===o.length?(a=h+c+l,{x:(h*o[0].x+c*o[1].x+l*o[2].x)/a,y:(h*o[0].y+c*o[1].y+l*o[2].y)/a,z:!!i&&(h*o[0].z+c*o[1].z+l*o[2].z)/a,t}):(h*=s,c*=1.5*s,l*=3*s,u*=t*t*t,4===o.length?(a=h+c+l+u,{x:(h*o[0].x+c*o[1].x+l*o[2].x+u*o[3].x)/a,y:(h*o[0].y+c*o[1].y+l*o[2].y+u*o[3].y)/a,z:!!i&&(h*o[0].z+c*o[1].z+l*o[2].z+u*o[3].z)/a,t}):void 0))},derive:function(t,e){const n=[];for(let i=t,s=i.length,r=s-1;s>1;s--,r--){const t=[];for(let n,s=0;s<r;s++)n={x:r*(i[s+1].x-i[s].x),y:r*(i[s+1].y-i[s].y)},e&&(n.z=r*(i[s+1].z-i[s].z)),t.push(n);n.push(t),i=t}return n},between:function(t,e,n){return e<=t&&t<=n||ir.approximately(t,e)||ir.approximately(t,n)},approximately:function(t,e,n){return Hs(t-e)<=(n||1e-6)},length:function(t){const e=ir.Tvalues.length;let n=0;for(let i,s=0;s<e;s++)i=.5*ir.Tvalues[s]+.5,n+=ir.Cvalues[s]*ir.arcfn(i,t);return.5*n},map:function(t,e,n,i,s){return i+(t-e)/(n-e)*(s-i)},lerp:function(t,e,n){const i={x:e.x+t*(n.x-e.x),y:e.y+t*(n.y-e.y)};return void 0!==e.z&&void 0!==n.z&&(i.z=e.z+t*(n.z-e.z)),i},pointToString:function(t){let e=t.x+"/"+t.y;return void 0!==t.z&&(e+="/"+t.z),e},pointsToString:function(t){return"["+t.map(ir.pointToString).join(", ")+"]"},copy:function(t){return JSON.parse(JSON.stringify(t))},angle:function(t,e,n){const i=e.x-t.x,s=e.y-t.y,r=n.x-t.x,o=n.y-t.y;return Gs(i*o-s*r,i*r+s*o)},round:function(t,e){const n=""+t,i=n.indexOf(".");return parseFloat(n.substring(0,i+1+e))},dist:function(t,e){const n=t.x-e.x,i=t.y-e.y;return Us(n*n+i*i)},closest:function(t,e){let n,i,s=qs(2,63);return t.forEach((function(t,r){i=ir.dist(e,t),i<s&&(s=i,n=r)})),{mdist:s,mpos:n}},abcratio:function(t,e){if(2!==e&&3!==e)return!1;if(void 0===t)t=.5;else if(0===t||1===t)return t;const n=qs(t,e)+qs(1-t,e);return Hs((n-1)/n)},projectionratio:function(t,e){if(2!==e&&3!==e)return!1;if(void 0===t)t=.5;else if(0===t||1===t)return t;const n=qs(1-t,e);return n/(qs(t,e)+n)},lli8:function(t,e,n,i,s,r,o,a){const h=(t-n)*(r-a)-(e-i)*(s-o);return 0!=h&&{x:((t*i-e*n)*(s-o)-(t-n)*(s*a-r*o))/h,y:((t*i-e*n)*(r-a)-(e-i)*(s*a-r*o))/h}},lli4:function(t,e,n,i){const s=t.x,r=t.y,o=e.x,a=e.y,h=n.x,c=n.y,l=i.x,u=i.y;return ir.lli8(s,r,o,a,h,c,l,u)},lli:function(t,e){return ir.lli4(t,t.c,e,e.c)},makeline:function(t,e){const n=t.x,i=t.y,s=e.x,r=e.y,o=(s-n)/3,a=(r-i)/3;return new fr(n,i,n+o,i+a,n+2*o,i+2*a,s,r)},findbbox:function(t){let e=tr,n=tr,i=er,s=er;return t.forEach((function(t){const r=t.bbox();e>r.x.min&&(e=r.x.min),n>r.y.min&&(n=r.y.min),i<r.x.max&&(i=r.x.max),s<r.y.max&&(s=r.y.max)})),{x:{min:e,mid:(e+i)/2,max:i,size:i-e},y:{min:n,mid:(n+s)/2,max:s,size:s-n}}},shapeintersections:function(t,e,n,i,s){if(!ir.bboxoverlap(e,i))return[];const r=[],o=[t.startcap,t.forward,t.back,t.endcap],a=[n.startcap,n.forward,n.back,n.endcap];return o.forEach((function(e){e.virtual||a.forEach((function(i){if(i.virtual)return;const o=e.intersects(i,s);o.length>0&&(o.c1=e,o.c2=i,o.s1=t,o.s2=n,r.push(o))}))})),r},makeshape:function(t,e,n){const i=e.points.length,s=t.points.length,r=ir.makeline(e.points[i-1],t.points[0]),o=ir.makeline(t.points[s-1],e.points[0]),a={startcap:r,forward:t,back:e,endcap:o,bbox:ir.findbbox([r,t,e,o]),intersections:function(t){return ir.shapeintersections(a,a.bbox,t,t.bbox,n)}};return a},getminmax:function(t,e,n){if(!n)return{min:0,max:0};let i,s,r=tr,o=er;-1===n.indexOf(0)&&(n=[0].concat(n)),-1===n.indexOf(1)&&n.push(1);for(let a=0,h=n.length;a<h;a++)i=n[a],s=t.get(i),s[e]<r&&(r=s[e]),s[e]>o&&(o=s[e]);return{min:r,mid:(r+o)/2,max:o,size:o-r}},align:function(t,e){const n=e.p1.x,i=e.p1.y,s=-Gs(e.p2.y-i,e.p2.x-n);return t.map((function(t){return{x:(t.x-n)*zs(s)-(t.y-i)*Xs(s),y:(t.x-n)*Xs(s)+(t.y-i)*zs(s)}}))},roots:function(t,e){e=e||{p1:{x:0,y:0},p2:{x:1,y:0}};const n=t.length-1,i=ir.align(t,e),s=function(t){return 0<=t&&t<=1};if(2===n){const t=i[0].y,e=i[1].y,n=i[2].y,r=t-2*e+n;if(0!==r){const i=-Us(e*e-t*n),o=-t+e;return[-(i+o)/r,-(-i+o)/r].filter(s)}return e!==n&&0===r?[(2*e-n)/(2*e-2*n)].filter(s):[]}const r=i[0].y,o=i[1].y,a=i[2].y;let h=3*o-r-3*a+i[3].y,c=3*r-6*o+3*a,l=-3*r+3*o,u=r;if(ir.approximately(h,0)){if(ir.approximately(c,0))return ir.approximately(l,0)?[]:[-u/l].filter(s);const t=Us(l*l-4*c*u),e=2*c;return[(t-l)/e,(-l-t)/e].filter(s)}c/=h,l/=h,u/=h;const d=(3*l-c*c)/3,f=d/3,p=(2*c*c*c-9*c*l+27*u)/27,g=p/2,m=g*g+f*f*f;let _,v,y,b,w;if(m<0){const t=-d/3,e=Us(t*t*t),n=-p/(2*e),i=Ys(n<-1?-1:n>1?1:n),r=2*Js(e);return y=r*zs(i/3)-c/3,b=r*zs((i+Zs)/3)-c/3,w=r*zs((i+2*Zs)/3)-c/3,[y,b,w].filter(s)}if(0===m)return _=g<0?Js(-g):-Js(g),y=2*_-c/3,b=-_-c/3,[y,b].filter(s);{const t=Us(m);return _=Js(-g+t),v=Js(g+t),[_-v-c/3].filter(s)}},droots:function(t){if(3===t.length){const e=t[0],n=t[1],i=t[2],s=e-2*n+i;if(0!==s){const t=-Us(n*n-e*i),r=-e+n;return[-(t+r)/s,-(-t+r)/s]}return n!==i&&0===s?[(2*n-i)/(2*(n-i))]:[]}if(2===t.length){const e=t[0],n=t[1];return e!==n?[e/(e-n)]:[]}return[]},curvature:function(t,e,n,i,s){let r,o,a,h,c=0,l=0;const u=ir.compute(t,e),d=ir.compute(t,n),f=u.x*u.x+u.y*u.y;if(i?(r=Us(qs(u.y*d.z-d.y*u.z,2)+qs(u.z*d.x-d.z*u.x,2)+qs(u.x*d.y-d.x*u.y,2)),o=qs(f+u.z*u.z,1.5)):(r=u.x*d.y-u.y*d.x,o=qs(f,1.5)),0===r||0===o)return{k:0,r:0};if(c=r/o,l=o/r,!s){const s=ir.curvature(t-.001,e,n,i,!0).k,r=ir.curvature(t+.001,e,n,i,!0).k;h=(r-c+(c-s))/2,a=(Hs(r-c)+Hs(c-s))/2}return{k:c,r:l,dk:h,adk:a}},inflections:function(t){if(t.length<4)return[];const e=ir.align(t,{p1:t[0],p2:t.slice(-1)[0]}),n=e[2].x*e[1].y,i=e[3].x*e[1].y,s=e[1].x*e[2].y,r=18*(-3*n+2*i+3*s-e[3].x*e[2].y),o=18*(3*n-i-3*s),a=18*(s-n);if(ir.approximately(r,0)){if(!ir.approximately(o,0)){let t=-a/o;if(0<=t&&t<=1)return[t]}return[]}const h=o*o-4*r*a,c=Math.sqrt(h),l=2*r;return ir.approximately(l,0)?[]:[(c-o)/l,-(o+c)/l].filter((function(t){return 0<=t&&t<=1}))},bboxoverlap:function(t,e){const n=["x","y"],i=n.length;for(let s,r,o,a,h=0;h<i;h++)if(s=n[h],r=t[s].mid,o=e[s].mid,a=(t[s].size+e[s].size)/2,Hs(r-o)>=a)return!1;return!0},expandbox:function(t,e){e.x.min<t.x.min&&(t.x.min=e.x.min),e.y.min<t.y.min&&(t.y.min=e.y.min),e.z&&e.z.min<t.z.min&&(t.z.min=e.z.min),e.x.max>t.x.max&&(t.x.max=e.x.max),e.y.max>t.y.max&&(t.y.max=e.y.max),e.z&&e.z.max>t.z.max&&(t.z.max=e.z.max),t.x.mid=(t.x.min+t.x.max)/2,t.y.mid=(t.y.min+t.y.max)/2,t.z&&(t.z.mid=(t.z.min+t.z.max)/2),t.x.size=t.x.max-t.x.min,t.y.size=t.y.max-t.y.min,t.z&&(t.z.size=t.z.max-t.z.min)},pairiteration:function(t,e,n){const i=t.bbox(),s=e.bbox(),r=1e5,o=n||.5;if(i.x.size+i.y.size<o&&s.x.size+s.y.size<o)return[(r*(t._t1+t._t2)/2|0)/r+"/"+(r*(e._t1+e._t2)/2|0)/r];let a=t.split(.5),h=e.split(.5),c=[{left:a.left,right:h.left},{left:a.left,right:h.right},{left:a.right,right:h.right},{left:a.right,right:h.left}];c=c.filter((function(t){return ir.bboxoverlap(t.left.bbox(),t.right.bbox())}));let l=[];return 0===c.length||(c.forEach((function(t){l=l.concat(ir.pairiteration(t.left,t.right,o))})),l=l.filter((function(t,e){return l.indexOf(t)===e}))),l},getccenter:function(t,e,n){const i=e.x-t.x,s=e.y-t.y,r=n.x-e.x,o=n.y-e.y,a=i*zs(Qs)-s*Xs(Qs),h=i*Xs(Qs)+s*zs(Qs),c=r*zs(Qs)-o*Xs(Qs),l=r*Xs(Qs)+o*zs(Qs),u=(t.x+e.x)/2,d=(t.y+e.y)/2,f=(e.x+n.x)/2,p=(e.y+n.y)/2,g=u+a,m=d+h,_=f+c,v=p+l,y=ir.lli8(u,d,g,m,f,p,_,v),b=ir.dist(y,t);let w,x=Gs(t.y-y.y,t.x-y.x),k=Gs(e.y-y.y,e.x-y.x),S=Gs(n.y-y.y,n.x-y.x);return x<S?((x>k||k>S)&&(x+=Zs),x>S&&(w=S,S=x,x=w)):S<k&&k<x?(w=S,S=x,x=w):S+=Zs,y.s=x,y.e=S,y.r=b,y},numberSort:function(t,e){return t-e}};class sr{constructor(t){this.curves=[],this._3d=!1,t&&(this.curves=t,this._3d=this.curves[0]._3d)}valueOf(){return this.toString()}toString(){return"["+this.curves.map((function(t){return ir.pointsToString(t.points)})).join(", ")+"]"}addCurve(t){this.curves.push(t),this._3d=this._3d||t._3d}length(){return this.curves.map((function(t){return t.length()})).reduce((function(t,e){return t+e}))}curve(t){return this.curves[t]}bbox(){const t=this.curves;for(var e=t[0].bbox(),n=1;n<t.length;n++)ir.expandbox(e,t[n].bbox());return e}offset(t){const e=[];return this.curves.forEach((function(n){e.push(...n.offset(t))})),new sr(e)}}const{abs:rr,min:or,max:ar,cos:hr,sin:cr,acos:lr,sqrt:ur}=Math,dr=Math.PI;class fr{constructor(t){let e=t&&t.forEach?t:Array.from(arguments).slice(),n=!1;if("object"==typeof e[0]){n=e.length;const t=[];e.forEach((function(e){["x","y","z"].forEach((function(n){void 0!==e[n]&&t.push(e[n])}))})),e=t}let i=!1;const s=e.length;if(n){if(n>4){if(1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");i=!0}}else if(6!==s&&8!==s&&9!==s&&12!==s&&1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");const r=this._3d=!i&&(9===s||12===s)||t&&t[0]&&void 0!==t[0].z,o=this.points=[];for(let t=0,n=r?3:2;t<s;t+=n){var a={x:e[t],y:e[t+1]};r&&(a.z=e[t+2]),o.push(a)}const h=this.order=o.length-1,c=this.dims=["x","y"];r&&c.push("z"),this.dimlen=c.length;const l=ir.align(o,{p1:o[0],p2:o[h]});this._linear=!l.some((t=>rr(t.y)>1e-4)),this._lut=[],this._t1=0,this._t2=1,this.update()}static quadraticFromPoints(t,e,n,i){if(void 0===i&&(i=.5),0===i)return new fr(e,e,n);if(1===i)return new fr(t,e,e);const s=fr.getABC(2,t,e,n,i);return new fr(t,s.A,n)}static cubicFromPoints(t,e,n,i,s){void 0===i&&(i=.5);const r=fr.getABC(3,t,e,n,i);void 0===s&&(s=ir.dist(e,r.C));const o=s*(1-i)/i,a=ir.dist(t,n),h=(n.x-t.x)/a,c=(n.y-t.y)/a,l=s*h,u=s*c,d=o*h,f=o*c,p=e.x-l,g=e.y-u,m=e.x+d,_=e.y+f,v=r.A,y=v.x+(p-v.x)/(1-i),b=v.y+(g-v.y)/(1-i),w=v.x+(m-v.x)/i,x=v.y+(_-v.y)/i,k={x:t.x+(y-t.x)/i,y:t.y+(b-t.y)/i},S={x:n.x+(w-n.x)/(1-i),y:n.y+(x-n.y)/(1-i)};return new fr(t,k,S,n)}static getUtils(){return ir}getUtils(){return fr.getUtils()}static get PolyBezier(){return sr}valueOf(){return this.toString()}toString(){return ir.pointsToString(this.points)}toSVG(){if(this._3d)return!1;const t=this.points,e=["M",t[0].x,t[0].y,2===this.order?"Q":"C"];for(let n=1,i=t.length;n<i;n++)e.push(t[n].x),e.push(t[n].y);return e.join(" ")}setRatios(t){if(t.length!==this.points.length)throw new Error("incorrect number of ratio values");this.ratios=t,this._lut=[]}verify(){const t=this.coordDigest();t!==this._print&&(this._print=t,this.update())}coordDigest(){return this.points.map((function(t,e){return""+e+t.x+t.y+(t.z?t.z:0)})).join("")}update(){this._lut=[],this.dpoints=ir.derive(this.points,this._3d),this.computedirection()}computedirection(){const t=this.points,e=ir.angle(t[0],t[this.order],t[1]);this.clockwise=e>0}length(){return ir.length(this.derivative.bind(this))}static getABC(t=2,e,n,i,s=.5){const r=ir.projectionratio(s,t),o=1-r,a={x:r*e.x+o*i.x,y:r*e.y+o*i.y},h=ir.abcratio(s,t);return{A:{x:n.x+(n.x-a.x)/h,y:n.y+(n.y-a.y)/h},B:n,C:a,S:e,E:i}}getABC(t,e){e=e||this.get(t);let n=this.points[0],i=this.points[this.order];return fr.getABC(this.order,n,e,i,t)}getLUT(t){if(this.verify(),t=t||100,this._lut.length===t)return this._lut;this._lut=[],t--;for(let e,n,i=0;i<t;i++)n=i/(t-1),e=this.compute(n),e.t=n,this._lut.push(e);return this._lut}on(e,n){n=n||5;const i=this.getLUT(),s=[];for(let t,r=0,o=0;r<i.length;r++)t=i[r],ir.dist(t,e)<n&&(s.push(t),o+=r/i.length);return!!s.length&&(t/=s.length)}project(t){const e=this.getLUT(),n=e.length-1,i=ir.closest(e,t),s=i.mpos,r=(s-1)/n,o=(s+1)/n,a=.1/n;let h,c,l=i.mdist,u=r,d=u;for(l+=1;u<o+a;u+=a)h=this.compute(u),c=ir.dist(t,h),c<l&&(l=c,d=u);return d=d<0?0:d>1?1:d,h=this.compute(d),h.t=d,h.d=l,h}get(t){return this.compute(t)}point(t){return this.points[t]}compute(t){return this.ratios?ir.computeWithRatios(t,this.points,this.ratios,this._3d):ir.compute(t,this.points,this._3d,this.ratios)}raise(){const t=this.points,e=[t[0]],n=t.length;for(let i,s,r=1;r<n;r++)i=t[r],s=t[r-1],e[r]={x:(n-r)/n*i.x+r/n*s.x,y:(n-r)/n*i.y+r/n*s.y};return e[n]=t[n-1],new fr(e)}derivative(t){return ir.compute(t,this.dpoints[0],this._3d)}dderivative(t){return ir.compute(t,this.dpoints[1],this._3d)}align(){let t=this.points;return new fr(ir.align(t,{p1:t[0],p2:t[t.length-1]}))}curvature(t){return ir.curvature(t,this.dpoints[0],this.dpoints[1],this._3d)}inflections(){return ir.inflections(this.points)}normal(t){return this._3d?this.__normal3(t):this.__normal2(t)}__normal2(t){const e=this.derivative(t),n=ur(e.x*e.x+e.y*e.y);return{x:-e.y/n,y:e.x/n}}__normal3(t){const e=this.derivative(t),n=this.derivative(t+.01),i=ur(e.x*e.x+e.y*e.y+e.z*e.z),s=ur(n.x*n.x+n.y*n.y+n.z*n.z);e.x/=i,e.y/=i,e.z/=i,n.x/=s,n.y/=s,n.z/=s;const r={x:n.y*e.z-n.z*e.y,y:n.z*e.x-n.x*e.z,z:n.x*e.y-n.y*e.x},o=ur(r.x*r.x+r.y*r.y+r.z*r.z);r.x/=o,r.y/=o,r.z/=o;const a=[r.x*r.x,r.x*r.y-r.z,r.x*r.z+r.y,r.x*r.y+r.z,r.y*r.y,r.y*r.z-r.x,r.x*r.z-r.y,r.y*r.z+r.x,r.z*r.z];return{x:a[0]*e.x+a[1]*e.y+a[2]*e.z,y:a[3]*e.x+a[4]*e.y+a[5]*e.z,z:a[6]*e.x+a[7]*e.y+a[8]*e.z}}hull(t){let e=this.points,n=[],i=[],s=0;for(i[s++]=e[0],i[s++]=e[1],i[s++]=e[2],3===this.order&&(i[s++]=e[3]);e.length>1;){n=[];for(let r,o=0,a=e.length-1;o<a;o++)r=ir.lerp(t,e[o],e[o+1]),i[s++]=r,n.push(r);e=n}return i}split(t,e){if(0===t&&e)return this.split(e).left;if(1===e)return this.split(t).right;const n=this.hull(t),i={left:2===this.order?new fr([n[0],n[3],n[5]]):new fr([n[0],n[4],n[7],n[9]]),right:2===this.order?new fr([n[5],n[4],n[2]]):new fr([n[9],n[8],n[6],n[3]]),span:n};return i.left._t1=ir.map(0,0,1,this._t1,this._t2),i.left._t2=ir.map(t,0,1,this._t1,this._t2),i.right._t1=ir.map(t,0,1,this._t1,this._t2),i.right._t2=ir.map(1,0,1,this._t1,this._t2),e?(e=ir.map(e,t,1,0,1),i.right.split(e).left):i}extrema(){const t={};let e=[];return this.dims.forEach(function(n){let i=function(t){return t[n]},s=this.dpoints[0].map(i);t[n]=ir.droots(s),3===this.order&&(s=this.dpoints[1].map(i),t[n]=t[n].concat(ir.droots(s))),t[n]=t[n].filter((function(t){return t>=0&&t<=1})),e=e.concat(t[n].sort(ir.numberSort))}.bind(this)),t.values=e.sort(ir.numberSort).filter((function(t,n){return e.indexOf(t)===n})),t}bbox(){const t=this.extrema(),e={};return this.dims.forEach(function(n){e[n]=ir.getminmax(this,n,t[n])}.bind(this)),e}overlaps(t){const e=this.bbox(),n=t.bbox();return ir.bboxoverlap(e,n)}offset(t,e){if(void 0!==e){const n=this.get(t),i=this.normal(t),s={c:n,n:i,x:n.x+i.x*e,y:n.y+i.y*e};return this._3d&&(s.z=n.z+i.z*e),s}if(this._linear){const e=this.normal(0),n=this.points.map((function(n){const i={x:n.x+t*e.x,y:n.y+t*e.y};return n.z&&e.z&&(i.z=n.z+t*e.z),i}));return[new fr(n)]}return this.reduce().map((function(e){return e._linear?e.offset(t)[0]:e.scale(t)}))}simple(){if(3===this.order){const t=ir.angle(this.points[0],this.points[3],this.points[1]),e=ir.angle(this.points[0],this.points[3],this.points[2]);if(t>0&&e<0||t<0&&e>0)return!1}const t=this.normal(0),e=this.normal(1);let n=t.x*e.x+t.y*e.y;return this._3d&&(n+=t.z*e.z),rr(lr(n))<dr/3}reduce(){let t,e,n=0,i=0,s=.01,r=[],o=[],a=this.extrema().values;for(-1===a.indexOf(0)&&(a=[0].concat(a)),-1===a.indexOf(1)&&a.push(1),n=a[0],t=1;t<a.length;t++)i=a[t],e=this.split(n,i),e._t1=n,e._t2=i,r.push(e),n=i;return r.forEach((function(t){for(n=0,i=0;i<=1;)for(i=n+s;i<=1.01;i+=s)if(e=t.split(n,i),!e.simple()){if(i-=s,rr(n-i)<s)return[];e=t.split(n,i),e._t1=ir.map(n,0,1,t._t1,t._t2),e._t2=ir.map(i,0,1,t._t1,t._t2),o.push(e),n=i;break}n<1&&(e=t.split(n,1),e._t1=ir.map(n,0,1,t._t1,t._t2),e._t2=t._t2,o.push(e))})),o}scale(t){const e=this.order;let n=!1;if("function"==typeof t&&(n=t),n&&2===e)return this.raise().scale(n);const i=this.clockwise,s=n?n(0):t,r=n?n(1):t,o=[this.offset(0,10),this.offset(1,10)],a=this.points,h=[],c=ir.lli4(o[0],o[0].c,o[1],o[1].c);if(!c)throw new Error("cannot scale this curve. Try reducing it first.");return[0,1].forEach((function(t){const n=h[t*e]=ir.copy(a[t*e]);n.x+=(t?r:s)*o[t].n.x,n.y+=(t?r:s)*o[t].n.y})),n?([0,1].forEach((function(s){if(2!==e||!s){var r=a[s+1],o={x:r.x-c.x,y:r.y-c.y},l=n?n((s+1)/e):t;n&&!i&&(l=-l);var u=ur(o.x*o.x+o.y*o.y);o.x/=u,o.y/=u,h[s+1]={x:r.x+l*o.x,y:r.y+l*o.y}}})),new fr(h)):([0,1].forEach((t=>{if(2===e&&t)return;const n=h[t*e],i=this.derivative(t),s={x:n.x+i.x,y:n.y+i.y};h[t+1]=ir.lli4(n,s,c,a[t+1])})),new fr(h))}outline(t,e,n,i){e=void 0===e?t:e;const s=this.reduce(),r=s.length,o=[];let a,h=[],c=0,l=this.length();const u=void 0!==n&&void 0!==i;function d(t,e,n,i,s){return function(r){const o=i/n,a=(i+s)/n,h=e-t;return ir.map(r,0,1,t+o*h,t+a*h)}}s.forEach((function(s){const r=s.length();u?(o.push(s.scale(d(t,n,l,c,r))),h.push(s.scale(d(-e,-i,l,c,r)))):(o.push(s.scale(t)),h.push(s.scale(-e))),c+=r})),h=h.map((function(t){return a=t.points,a[3]?t.points=[a[3],a[2],a[1],a[0]]:t.points=[a[2],a[1],a[0]],t})).reverse();const f=o[0].points[0],p=o[r-1].points[o[r-1].points.length-1],g=h[r-1].points[h[r-1].points.length-1],m=h[0].points[0],_=ir.makeline(g,f),v=ir.makeline(p,m),y=[_].concat(o).concat([v]).concat(h);return y.length,new sr(y)}outlineshapes(t,e,n){e=e||t;const i=this.outline(t,e).curves,s=[];for(let t=1,e=i.length;t<e/2;t++){const r=ir.makeshape(i[t],i[e-t],n);r.startcap.virtual=t>1,r.endcap.virtual=t<e/2-1,s.push(r)}return s}intersects(t,e){return t?t.p1&&t.p2?this.lineIntersects(t):(t instanceof fr&&(t=t.reduce()),this.curveintersects(this.reduce(),t,e)):this.selfintersects(e)}lineIntersects(t){const e=or(t.p1.x,t.p2.x),n=or(t.p1.y,t.p2.y),i=ar(t.p1.x,t.p2.x),s=ar(t.p1.y,t.p2.y);return ir.roots(this.points,t).filter((t=>{var r=this.get(t);return ir.between(r.x,e,i)&&ir.between(r.y,n,s)}))}selfintersects(t){const e=this.reduce(),n=e.length-2,i=[];for(let s,r,o,a=0;a<n;a++)r=e.slice(a,a+1),o=e.slice(a+2),s=this.curveintersects(r,o,t),i.push(...s);return i}curveintersects(t,e,n){const i=[];t.forEach((function(t){e.forEach((function(e){t.overlaps(e)&&i.push({left:t,right:e})}))}));let s=[];return i.forEach((function(t){const e=ir.pairiteration(t.left,t.right,n);e.length>0&&(s=s.concat(e))})),s}arcs(t){return t=t||.5,this._iterate(t,[])}_error(t,e,n,i){const s=(i-n)/4,r=this.get(n+s),o=this.get(i-s),a=ir.dist(t,e),h=ir.dist(t,r),c=ir.dist(t,o);return rr(h-a)+rr(c-a)}_iterate(t,e){let n,i=0,s=1;do{n=0,s=1;let r,o,a,h,c,l=this.get(i),u=!1,d=!1,f=s,p=1,g=0;do{if(d=u,h=a,f=(i+s)/2,g++,r=this.get(f),o=this.get(s),a=ir.getccenter(l,r,o),a.interval={start:i,end:s},u=this._error(a,l,i,s)<=t,c=d&&!u,c||(p=s),u){if(s>=1){if(a.interval.end=p=1,h=a,s>1){let t={x:a.x+a.r*hr(a.e),y:a.y+a.r*cr(a.e)};a.e+=ir.angle({x:a.x,y:a.y},t,this.get(1))}break}s+=(s-i)/2}else s=f}while(!c&&n++<100);if(n>=100)break;h=h||a,e.push(h),i=p}while(s<1);return e}}const pr={RIGHT:0,BOTTOM:1,LEFT:2,TOP:3,SELF:100},gr={DEFAULT:"DEFAULT",LINKING:"LINKING"};function mr(t){if(0===t.length)return{width:1,height:1,x:0,y:0};let e=1/0,n=1/0,i=-1/0,s=-1/0;for(let r in t){const o=t[r];o[0]<e&&(e=o[0]),o[0]>i&&(i=o[0]),o[1]<n&&(n=o[1]),o[1]>s&&(s=o[1])}return{width:Math.max(i-e,10),height:Math.max(s-n,10),x:e,y:n}}function _r(t){return t*t}function vr(t,e){return _r(t[0]-e[0])+_r(t[1]-e[1])}function yr(t,e,n){const i=vr(e,n);if(0===i)return vr(t,e);let s=((t[0]-e[0])*(n[0]-e[0])+(t[1]-e[1])*(n[1]-e[1]))/i;return s=Math.max(0,Math.min(1,s)),vr(t,[e[0]+s*(n[0]-e[0]),e[1]+s*(n[1]-e[1])])}function br(t,e){const n={fromDir:null,fromP:null,toDir:null,toP:null,distMin:1/0};return Object.keys(t).forEach((i=>{if(+i===pr.SELF)return;let s=t[i];Object.keys(e).forEach((t=>{if(+t===pr.SELF)return;let r=e[t];const o=vr(s,r);o<n.distMin&&Object.assign(n,{distMin:o,fromDir:+i,fromP:s,toDir:+t,toP:r})}))})),n}function wr(t,e,n,i){return e===pr.TOP?[t[0],t[1]-i]:e===pr.BOTTOM?[t[0],t[1]+i]:e===pr.LEFT?[t[0]-n,t[1]]:e===pr.RIGHT?[t[0]+n,t[1]]:void 0}function xr(t,e,n=pr.TOP,i=pr.TOP,s=0,r=0){const o=Math.max(Math.abs((t[0]-e[0])/2),s),a=Math.max(Math.abs((t[1]-e[1])/2),r),h=wr(t,n,o,a),c=wr(e,i,o,a),l=[pr.TOP,pr.LEFT].includes(i)?-5:5,u=[pr.TOP,pr.BOTTOM].includes(i);return[...h,...c,u?e[0]:e[0]+l,u?e[1]+l:e[1]]}function kr(t,e,n,i,s,r,o,a,h){var c=Math.pow(1-t,2)*(i-e)+2*t*(1-t)*(r-i)+t*t*(a-r),l=Math.pow(1-t,2)*(s-n)+2*t*(1-t)*(o-s)+t*t*(h-o);return-Math.atan2(c,l)+.5*Math.PI}function Sr(t,e,n,i=pr.TOP,s=pr.TOP,r=10,o=10,a){const h=Math.abs(i-s),c=i===pr.TOP||i===pr.BOTTOM;switch(t.length=0,h){case 0:if(i===pr.TOP){const i=Math.min(e[1],n[1])-o;t.push([e[0],i]),t.push([n[0],i])}if(i===pr.BOTTOM){const i=Math.max(e[1],n[1])+o;t.push([e[0],i]),t.push([n[0],i])}if(i===pr.LEFT){const i=Math.min(e[0],n[0])-r;t.push([i,e[1]]),t.push([i,n[1]])}if(i===pr.RIGHT){const i=Math.max(e[0],n[0])+r;t.push([i,e[1]]),t.push([i,n[1]])}break;case 1:case 3:if(a)c?(t.push([e[0],e[1]+o]),t.push([n[0]+r,e[1]+o]),t.push([n[0]+r,n[1]])):(t.push([e[0]+r,e[1]]),t.push([e[0]+r,n[1]+o]),t.push([n[0],n[1]+o]));else{const i=c?[e[0],n[1]]:[n[0],e[1]];t.push(i)}break;case 2:const s=[(e[0]-n[0])/2+n[0],(e[1]-n[1])/2+n[1]];c?(t.push([e[0],s[1]]),t.push([n[0],s[1]])):(t.push([s[0],e[1]]),t.push([s[0],n[1]]))}t.unshift(e),t.push(n)}function Cr(t,e){return[t[0]-e[0],t[1]-e[1]]}function Er(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Tr(t,e){return[t[0]*e,t[1]*e]}function Br(t,e){return t[0]!=t[2]&&t[1]!=t[3]&&e[0]!=e[2]&&e[1]!=e[3]&&!(t[2]<=e[0]||t[3]<=e[1]||t[0]>=e[2]||t[1]>=e[3])}function Or(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Ir(t,e){t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]}const jr=Symbol("ishit"),Lr=Symbol("isInViewBox");class Pr extends EventTarget{constructor(t={}){super(),Object.assign(this,t),this.visible=!0,this._belongs=void 0,this[jr]=!1,this.borderWidth=t.borderWidth||0,this.borderColor=t.borderColor||"transparent",this.backgroundColor=t.backgroundColor||"transparent",this.shadowColor=t.shadowColor,this.shadowBlur=t.shadowBlur||5,this.shadowOffsetX=t.shadowOffsetX||0,this.shadowOffsetY=t.shadowOffsetY||0,this.opacity=t.opacity||1,this._boundingrect=[0,0,0,0]}get _isTargeting(){return this===(this._jflow._target.instance||this._jflow._target.link)}get _isMoving(){return this===this._jflow._getMovingTarget()&&this._jflow._target.status.movingState}get _isHit(){return this[jr]}get _jflow(){return"jflow"===this._belongs.uniqueName?this._belongs:this._belongs._jflow}set _isHit(t){this[jr]!==t&&this.dispatchEvent(new CustomEvent(t?"mouseenter":"mouseleave",{detail:{instance:this,jflow:this._jflow}})),this[jr]=t}get isInViewBox(){return this[Lr]}set _isInViewBox(t){t!==this[Lr]&&(t?this.onEnterViewbox():this.onLeaveViewbox()),this[Lr]=t}onEnterViewbox(){}onLeaveViewbox(){}setConfig(t){Object.keys(t).forEach((e=>{void 0!==t[e]&&null!==t[e]&&(this[e]=t[e])}))}render(t){throw"require render implement"}isHit(t){throw"require isHit implement"}getBoundingRect(){throw"require getBoundingRect implement"}calculateIntersection(){throw"require calculateIntersection implement"}getIntersectionsInFourDimension(){throw"require getIntersectionsInFourDimension implement"}getCenter(){return this.anchor}getBoundingDimension(){const t=instance.getBoundingRect();let e=1/0,n=-1/0,i=1/0,s=-1/0;return t.forEach((t=>{n=Math.max(n,t[1]),e=Math.min(e,t[1]),s=Math.max(s,t[0]),i=Math.min(i,t[0])})),{height:n-e,width:s-i}}bubbleEvent(t){t.detail.currentTarget=this,this.dispatchEvent(t),t.detail.bubbles&&(this._belongs.bubbleEvent?this._belongs.bubbleEvent(t):this._belongs.dispatchEvent(t))}calculateToRealWorld(t){return this._belongs&&this._belongs.calculateToRealWorld?this._belongs.calculateToRealWorld(t):t}calculateToRealWorldWithScalar(t){return this._jflow.scale*t}recalculateUp(){this.belongs&&this.belongs.recalculateUp()}destroy(){}}const Mr=Pr,Rr=class extends Mr{constructor(t={}){super(t),this._rawConfigs=t,this.anchor=t.anchor||[0,0],this.absolutePosition=t.absolutePosition}setConfig(t){Object.keys(t).forEach((e=>{void 0!==t[e]&&null!==t[e]&&(this[e]=t[e],this._rawConfigs[e]=t[e])}))}setAnchorX(t){this.anchor[0]=t}setAnchorY(t){this.anchor[1]=t}setAnchor(t,e){this.anchor[0]=t,this.anchor[1]=e}beforeRender(){return Br(this._belongs._getViewBox(),this.getBoundingRect())}clone(){const t=new(0,this.constructor)(this._rawConfigs);return t.visible=this.visible,t}},Ar=class extends Rr{constructor(t){super(t)}render(t){}isHit(t){return!1}calculateIntersection(t){return this.anchor}getBoundingRect(){const[t,e]=this.anchor;return[t,e,t,e]}getBoundingDimension(){return{width:0,height:0}}getIntersectionsInFourDimension(){const[t,e]=this.anchor;return{[pr.RIGHT]:[t+1,e],[pr.LEFT]:[t-1,e],[pr.BOTTOM]:[t,e+1],[pr.TOP]:[t,e-1]}}};class Dr{constructor(){this._map=new WeakMap}get(t){return this._map.get(t)}set(t){const e={layoutNode:void 0,jflowNode:void 0,jflowlinks:[],jflowFromLinks:[],jflowToLinks:[]};return this._map.set(t,e),e}has(t){return this._map.has(t)}delete(t){this._map.delete(t)}clear(){this._map.clear()}}const $r={initNodeWeakMap(){this.source_Layout_Render_NodeMap=new Dr},getRenderNodeBySource(t){const e=this.source_Layout_Render_NodeMap.get(t);if(e)return e.jflowNode},getLayoutNodeBySource(t){const e=this.source_Layout_Render_NodeMap.get(t);if(e)return e.layoutNode},getSourceRenderMeta(t){return this.source_Layout_Render_NodeMap.get(t)},_getMap(t){const e=this.source_Layout_Render_NodeMap;let n;return n=e.has(t)?e.get(t):e.set(t),n},setLayoutNodeBySource(t,e){this._getMap(t).layoutNode=e},setRenderNodeBySource(t,e){this._getMap(t).jflowNode=e},addLinkNodeBySource(t,e,n){let i=this._getMap(t);i.jflowFromLinks.push(n),i=this._getMap(e),i.jflowToLinks.push(n)},removeLinkNodeBySource(t,e,n){let i=this._getMap(t),s=i.jflowFromLinks.findIndex((t=>t===n));-1!==s&&i.jflowFromLinks.splice(s,1),i=this._getMap(e),s=i.jflowToLinks.findIndex((t=>t===n)),-1!==s&&i.jflowToLinks.splice(s,1)}},Nr=class extends Array{constructor(){super(),this._currentHit=null}render(t,e){let n;this.forEach((i=>{if(i._isMoving)n=i;else if(i.visible&&(!e||e(i))){if(i.beforeRender&&!i.beforeRender(t))return;t.save(),i.render(t),t.restore()}})),n&&(t.save(),n.render(t),t.restore())}resetHitStatus(){this._currentHit=null,this.forEach((t=>{t._stack&&t._stack.resetHitStatus(),t._isHit=!1}))}checkHit(t,e,n){let i=this.length-1;for(;i>=0;){const s=this[i];if(s.visible&&!s.ignoreHit){if(e&&e(s)){i--;continue}if(n&&!n(s)){i--;continue}const r=s.isHit(t,e);if(r)return this._currentHit!==s&&(this._currentHit&&(this._currentHit._isHit=!1),s._isHit=!0,this._currentHit=s),"boolean"!=typeof r?r:s;s._isHit=!1}i--}return this._currentHit=null,null}getBoundingRectPoints(){const t=[];return this.forEach((e=>{if(e.visible&&!e.absolutePosition){const n=e.getBoundingRect();t.push([n[0],n[1]]),t.push([n[2],n[3]])}})),t}getAnchorRectPoints(){const t=[];return this.forEach((e=>{e.visible&&!e.absolutePosition&&t.push(e.anchor)})),t}},Fr={instances:[],links:[],_stack:null,_linkStack:null,initStack({data:t}){this._stack=new Nr,this._linkStack=new Nr,t&&(this.instances=t.instances,this.links=t.links,this.instances.forEach((t=>{this._stack.push(t),t._belongs=this})),this.links.forEach((t=>{this._linkStack.push(t),t._belongs=this})))},addToStack(t){t._belongs=this,this._stack.push(t)},replaceFromStack(t,e){const n=this._stack.findIndex((e=>e===t));this._stack.splice(n,1,e),t._belongs=null,e._belongs=this},addToLinkStack(t){t._belongs=this,this._linkStack.push(t)},removeFromStack(t){const e=this._stack.findIndex((e=>e===t));-1!==e&&this._stack.splice(e,1)},removeFromLinkStack(t){const e=this._linkStack.findIndex((e=>e===t));-1!==e&&this._linkStack.splice(e,1)},emptyLink(){this._linkStack=new Nr},resetChildrenPosition(){this._stack.forEach((t=>{t.anchor=[0,0]}))},addInstanceToLink(t,e){this.addToStack(e);const{from:n,to:i}=t,s=this._linkStack.findIndex((e=>e===t)),r=t.__proto__.constructor,o=new r({from:n,to:e});o._belongs=this;const a=new r({from:e,to:i});a._belongs=this,this._linkStack.splice(s,1,o,a)},interateNodeStack(t){this._stack.forEach((e=>{t(e)}))}},Vr=Fr,Wr={_layout:null,initLayout(t){this._layout=t.layout},recalculateUp(){let t=!0;if(this.getBoundingDimension){const{width:e,height:n}=this.getBoundingDimension();this.resetChildrenPosition&&this.resetChildrenPosition(),this._getBoundingGroupRect&&this._getBoundingGroupRect(),this.reflow(),this._getBoundingGroupRect&&this._getBoundingGroupRect();const{width:i,height:s}=this.getBoundingDimension();t=e!==i||n!==s}else this.reflow();this._belongs&&t&&this._belongs.recalculateUp()},recalculate(){this.reflow(),this._getBoundingGroupRect&&this._getBoundingGroupRect()},staticCheck(t){return!!this._layout&&this._layout.staticCheck(t,this)},reflow(){this._layout&&this._layout.reflow(this)}},Hr={_message:null,sendMessage(t){this._message=t},consumeMessage(){const t=this._message;return this._message=null,t},readMessage(){return this._message}},zr={initAnime(){this.anime_queue=[],this.__animeClock__=void 0},requestJFlowAnime(t){const e=this.enqueueAnime(t);return this._runAnime(),e},enqueueAnime(t){const e={start:void 0,callback:t,cancel:()=>{this._cancelAnime(e),this._render()}};return this.anime_queue.push(e),e},_cancelAnime(t){const e=this.anime_queue.findIndex((e=>e===t));~e&&this.anime_queue.splice(e,1)},runAnime(){this._runAnime()},_runAnime(){this.anime_queue.length&&requestAnimationFrame((()=>{this.scheduleRender(),this._runAnime()}))},runAnimeFrame(){this.anime_queue.forEach((t=>{const e=Date.now();t.start||(t.start=e);const n=e-t.start;t.callback(n)}))}},Xr={captureMap(t,{padding:e=0,placement:n="normal"}){this._getBoundingGroupRect();const{width:i,height:s,x:r,y:o}=this.bounding_box;if(!this.miniMap){this.miniMap=Ds(t);const{width:e,height:n,raw_width:i,raw_height:s}=this.miniMap;this.addEventListener("zoompan",(()=>{this._renderMap&&this._renderMap()}));let r=!1;this.miniMap.canvas.addEventListener("pointerdown",(t=>{let{offsetX:e,offsetY:n,deltaX:i,deltaY:s}=t;r=!0,this._onMoveMap&&this._onMoveMap(e,n)})),this.miniMap.canvas.addEventListener("pointermove",(t=>{let{offsetX:i,offsetY:s,deltaX:o,deltaY:a}=t;r&&this._onMoveMap&&this._onMoveMap(i,s),(s<5||i<5||i>e-5||s>n-5)&&(r=!1)})),this.miniMap.canvas.addEventListener("pointerup",(()=>{r=!1}));const o=document.createElement("canvas");o.width=i,o.height=s,this.cacheMinimapCtx=o.getContext("2d")}const{width:a,height:h,raw_width:c,raw_height:l,left:u,top:d,scale:f,ctx:p}=this.miniMap,g=2*e,m=e,_=(a-g)/i,v=(h-g)/s,y=Math.min(_,v);let b=0,w=0;"center"===n?(w=(h-s*y)/2-o*y,b=(a-i*y)/2-r*y):_<v?(w=(h-s*y)/2-o*y,b=m):(b=(a-i*y)/2-r*y,w=m);const x=this.cacheMinimapCtx;x.setTransform(),x.clearRect(0,0,c,l),x.scale(f,f),x.transform(y,0,0,y,b,w);const k=[0,0,0,0];this.NodeRenderTop?(this._linkStack.render(x,(t=>(t.isInViewBox(k),!0))),this._stack.render(x)):(this._stack.render(x),this._linkStack.render(x,(t=>(t.isInViewBox(k),!0))));const S=x.getImageData(0,0,c,l);this._renderMap=()=>{p.save(),p.setTransform(),p.clearRect(0,0,c,l),p.scale(f,f),p.putImageData(S,0,0),p.transform(y,0,0,y,b,w);const[t,e,n,i]=this._getViewBox();p.beginPath(),p.rect(t,e,n-t,i-e),p.setTransform(),p.rect(0,0,c,l),p.clip("evenodd"),p.fillStyle="rgba(0,0,0,0.4)",p.fillRect(0,0,c,l),p.restore()},this._renderMap(),this._onMoveMap=(t,e)=>{const[n,i,s,r]=this._getViewBox(),o=[((s-n)/2+n)*y+b,((r-i)/2+i)*y+w];this._recalculatePosition((o[0]-t)/y*this.scale,(o[1]-e)/y*this.scale),this._render(),this._renderMap()}}};class Yr{constructor(t,e={}){this.anchor=[0,0],this.width=e.barWidth||4,this.height=e.barWidth||4,this.barMarginX=0,this.barMarginY=0,this.dir=t,this.plainColor=e.plainColor||"rgba(0, 0, 0, 0.15)",this.focusColor=e.focusColor||"rgba(0, 0, 0, 0.25)",this.isFocus=!1}render(t){const[e,n]=this.anchor;if(t.save(),t.beginPath(),"x"===this.dir){const i=this.height/2,s=n+i,r=n+this.height,o=e+this.width-2*this.barMarginX-i,a=e+this.barMarginX+i;t.moveTo(a,r),t.arc(a,s,i,Math.PI/2,Math.PI/2*3),t.lineTo(o,n),t.arc(o,s,i,-Math.PI/2,Math.PI/2),t.closePath()}else{const i=this.width/2,s=n+this.barMarginY+i,r=n+this.height-2*this.barMarginY-i,o=e+i,a=e+this.width;t.moveTo(e,s),t.arc(o,s,i,-Math.PI,0),t.lineTo(a,r),t.arc(o,r,i,0,Math.PI),t.closePath()}t.fillStyle=this.isFocus?this.focusColor:this.plainColor,t.fill(),t.restore()}isHit(t){const e=this.anchor,n=this.width,i=this.height;return t[0]>e[0]-5&&t[0]<e[0]+n+5&&t[1]>e[1]-5&&t[1]<e[1]+i+5}}const Gr={initScrollBar(t={}){const{barColor:e,barFocusColor:n,barMarginX:i,barMarginY:s,barWidth:r}=t;this._scrollbarEnable=!0,this._scrollbarX=new Yr("x",{plainColor:e,focusColor:n,barWidth:r}),this._scrollbarX.barMarginX=i||5,this._scrollbarY=new Yr("y",{plainColor:e,focusColor:n,barWidth:r}),this._scrollbarY.barMarginY=s||5,this._scrollBarStatus={dragging:!1,target:null,xscale:void 0,yscale:void 0,barInitX:0,barInitY:0},this.addEventListener("zoompan",(()=>{this.scrollBarOnPanAndZoom()})),this.scrollBarOnPanAndZoom(),this.canvas.addEventListener("pointerdown",(t=>{const{offsetX:e,offsetY:n,clientX:i,clientY:s}=t;this.onScrollbarPressStart(e,n,i,s)}))},checkScrollDragging(){return this._scrollBarStatus&&this._scrollBarStatus.dragging},onScrollbarPressStart(t,e,n,i){this._scrollbarX.isHit([t,e])&&Object.assign(this._scrollBarStatus,{dragging:!0,target:this._scrollbarX,barStartX:this._scrollbarX.anchor[0],barInitX:n}),this._scrollbarY.isHit([t,e])&&Object.assign(this._scrollBarStatus,{dragging:!0,target:this._scrollbarY,barStartY:this._scrollbarY.anchor[1],barInitY:i});const s=(t=>{const{offsetX:e,offsetY:n,clientX:i,clientY:s}=t;this.onDraggingScrollbar(e,n,i,s)}).bind(this);document.addEventListener("pointermove",s);const r=(t=>{Object.assign(this._scrollBarStatus,{dragging:!1,target:null,x:void 0,y:void 0}),document.removeEventListener("pointermove",s),document.removeEventListener("pointerup",r),this.canvas.removeEventListener("pointerup",r)}).bind(this);this.canvas.addEventListener("pointerup",r,{once:!0}),document.addEventListener("pointerup",r,{once:!0})},onDraggingScrollbar(t,e,n,i){if(this._scrollbarEnable&&this._scrollBarStatus.dragging){const{target:t,barInitX:e,barStartX:s,barInitY:r,barStartY:o,xscale:a,yscale:h,scollbarHeight:c,scollbarWidth:l,realR:u,realL:d,realT:f,realB:p}=this._scrollBarStatus,{actual_width:g,actual_height:m}=this.canvasMeta,{x:_,y:v}=this.bounding_box;if("x"===t.dir){const i=s+(n-e),r=(_-((u-d)*((t.anchor[0]=Math.max(Math.min(i,g-l),0))/g)+d))*this.scale;Object.assign(this.position,{offsetX:r-_*this.scale,x:r})}if("y"===t.dir){const e=o+(i-r),n=(v-((p-f)*((t.anchor[1]=Math.max(Math.min(e,m-c),0))/m)+f))*this.scale;Object.assign(this.position,{offsetY:n-v*this.scale,y:n})}return this.scheduleRender(),!0}return!1},checkScrollBarHover(t,e){if(this._scrollbarEnable){if(this._scrollbarX.isHit([t,e]))return this._scrollbarX.isFocus||(this._scrollbarX.isFocus=!0,this.scheduleRender()),this.canvas.style.cursor="default",!0;if(this._scrollbarY.isHit([t,e]))return this._scrollbarY.isFocus||(this._scrollbarY.isFocus=!0,this.scheduleRender()),this.canvas.style.cursor="default",!0}return!1},resetScrollBarHover(){this._scrollbarEnable&&(this._scrollbarY.isFocus||this._scrollbarX.isFocus)&&(this._scrollbarY.isFocus=!1,this._scrollbarX.isFocus=!1,this.scheduleRender())},_getScrollViewBoundingbox(){const{width:t,height:e,x:n,y:i}=this.bounding_box;return{width:t+240,height:e+240,x:n-120,y:i-120}},scrollBarOnPanAndZoom(){if(!this._scrollbarEnable||this._scrollBarStatus.dragging)return;const{width:t,height:e,x:n,y:i}=this._getScrollViewBoundingbox();let[s,r,o,a]=this._getViewBox();const h=Math.max(o,n+t),c=Math.min(s,n),l=Math.min(r,i),u=Math.max(a,i+e),d=o-s,f=a-r,{actual_width:p,actual_height:g}=this.canvasMeta,m=d/(h-c);if(m<1){const t=p*m,e=(s-c)*m*this.scale;this._scrollbarX.anchor=[e,g-10],this._scrollbarX.width=t,this._scrollBarStatus.scollbarWidth=t}const _=f/(u-l);if(_<1){const t=g*_,e=(r-l)*_*this.scale;this._scrollbarY.anchor=[p-10,e],this._scrollbarY.height=t,this._scrollBarStatus.scollbarHeight=t}Object.assign(this._scrollBarStatus,{yscale:_,xscale:m,realR:h,realL:c,realT:l,realB:u})},resetScollBarStatus(){this._scrollbarEnable&&Object.assign(this._scrollBarStatus,{dragging:!1,target:null,x:void 0,y:void 0})},renderScrollBar(t){if(this._scrollbarEnable){t.setTransform(),t.scale(this.dpr,this.dpr);const{xscale:e,yscale:n}=this._scrollBarStatus;e<1&&this._scrollbarX.render(t),n<1&&this._scrollbarY.render(t)}}},Ur={initSchedule(){this.__clock__=void 0},scheduleRender(t){requestAnimationFrame((e=>{this.__clock__!==e&&this.__render(),t&&t(e),this.__clock__=e}))}};class qr extends CustomEvent{constructor(t,e={}){super(t,{detail:{...e,originEvent:e.event,target:e.target,jflow:e.jflow,bubbles:e.bubbles||!1}})}}const Jr=qr,Kr={...Vr,...Wr,_setPadding(t){this.padding={top:t.paddingTop||t.padding||0,right:t.paddingRight||t.padding||0,bottom:t.paddingBottom||t.padding||0,left:t.paddingLeft||t.padding||0}},_setMargin(t){this.margin={top:t.marginTop||t.margin||0,right:t.marginRight||t.margin||0,bottom:t.marginBottom||t.margin||0,left:t.marginLeft||t.margin||0}},_getCenter(){const t=this.anchor,e=this.padding,n=this.margin,i=(n.left-n.right)/2,s=(n.top-n.bottom)/2,r=(e.left-e.right)/2+i,o=(e.top-e.bottom)/2+s;return this._shape.anchor=[t[0]+i,t[1]+s],[t[0]+r,t[1]+o]},setAnchorX(t){this.anchor[0]=t,this._getCenter()},setAnchorY(t){this.anchor[1]=t,this._getCenter()},setAnchor(t,e){this.anchor[0]=t,this.anchor[1]=e,this._getCenter()},_calculatePointBack(t){const[e,n]=t,[i,s]=this._getCenter();return[e-i,n-s]},_calculatePointBackWithPoint(t,e,n,i,s){const r=this.anchor,o=this.padding,a=this.margin;n[i]=t-(r[0]+(o.left-o.right)/2+(a.left-a.right)/2),n[s]=e-(r[1]+(o.top-o.bottom)/2+(a.top-a.bottom)/2)},calculateToCoordination(t){const[e,n]=t,[i,s]=this._getCenter(),r=[e+i,n+s];return this._belongs&&this._belongs.calculateToCoordination?this._belongs.calculateToCoordination(r):r},calculateToRealWorld(t){const[e,n]=t,[i,s]=this._getCenter(),r=[e+i,n+s];if(this._belongs&&this._belongs.calculateToRealWorld)return this._belongs.calculateToRealWorld(r)},clone(){const t=new(0,this.constructor)(Object.assign({},this._rawConfigs,{layout:this._layout&&this._layout.clone()}));return this.interateNodeStack((e=>{t.addToStack(e.clone())})),t.recalculate(),t.visible=this.visible,t},getBoundingDimension(){return{width:this.width,height:this.height}},getBoundingRect(){const t=this.anchor,e=this.width/2,n=this.height/2,i=t[0]-e,s=t[1]-n,r=t[0]+e,o=t[1]+n,a=this._boundingrect;return a[0]=i,a[1]=s,a[2]=r,a[3]=o,a},getIntersectionsInFourDimension(){let t=this.anchor;this._belongs&&this._belongs.calculateToCoordination&&(t=this._belongs.calculateToCoordination(t));const[e,n]=t,i=this.width/2,s=this.height/2;return{[pr.RIGHT]:[e+i,n],[pr.LEFT]:[e-i,n],[pr.BOTTOM]:[e,n+s],[pr.TOP]:[e,n-s],[pr.SELF]:[e+.618*i,n+.618*s]}},calculateIntersection(t){const[e,n]=t,[i,s]=this.anchor,r=this.width/2,o=this.height/2,a=i-e,h=s-n,c=o/r,l=Math.abs(h/a),u=e>i,d=n>s;let f,p;return l<c?(f=i+(u?r:-r),p=r*(d?l:-l)+s):(p=s+(d?o:-o),f=o/(u?l:-l)+i),[f,p]},onEnterViewbox(){this.interateNodeStack((t=>{t.onEnterViewbox()}))},onLeaveViewbox(){this.interateNodeStack((t=>{t.onLeaveViewbox()}))},destroy(){this._shape.destroy(),this.interateNodeStack((t=>{t.destroy()}))}};function Zr(t,e){return[t,e]}const Qr=function(t,e={}){const n="function"==typeof e.shapeShift?e.shapeShift:Zr;class i extends Rr{constructor(e){super(e),this.initStack(e),this.initLayout(e),this._shape=new t(e),this._shape.anchor=[0,0],this._shape._belongs=this,this._setPadding(e),this._setMargin(e),this.definedWidth=e.width,this.minWidth=e.minWidth,this.definedHeight=e.height,this.lock=e.lock??!0,this.display=e.display||"default",this.transparent=e.transparent??!1,this._getBoundingGroupRect(),this.reflow(),this._getBoundingGroupRect(),this._cacheViewBox=[]}}return Object.assign(i.prototype,Kr),Object.assign(i.prototype,{reflow(){Kr.reflow.call(this);const t=this.margin,[e,i]=n(this.width-t.left-t.right,this.height-t.top-t.bottom,this._shape);this._shape.width=e,this._shape.height=i},setConfig(t){this._shape.setConfig(t),this._setPadding(t),this._setMargin(t),"opacity"in t&&(this.opacity=t.opacity),t.layout&&this._layout!==t.layout&&(this._layout=t.layout)},_getBoundingGroupRect(){const t=mr(this._stack.getBoundingRectPoints()),e=this.padding,i=this.minWidth,s=this.definedWidth,r=t.width+e.left+e.right,o=t.height+e.top+e.bottom,a=i?Math.max(i,r):s||r,h=this.definedHeight||o;this._paddingWidth=a,this._paddingHeight=h;const[c,l]=n(a,h,this._shape);this._shape.width=c,this._shape.height=l;const u=this.margin;this.width=c+u.left+u.right,this.height=l+u.top+u.bottom},_getViewBox(){const t=this._belongs.getCacheViewBox(),e=this._cacheViewBox;return this._calculatePointBackWithPoint(t[0],t[1],e,0,1),this._calculatePointBackWithPoint(t[2],t[3],e,2,3),this._cacheViewBox},getCacheViewBox(){return this._cacheViewBox},render(t){t.save(),this._isMoving?t.globalAlpha=.6:1!==this.opacity&&(t.globalAlpha=this.opacity);const[e,n]=this._getCenter();this._shape.render(t),t.translate(e,n),this._stack.render(t),t.translate(-e,-n),t.restore()},isHit(t,e){const n=this._calculatePointBack(t);this._currentp=n;return this._stack.checkHit(n,e)||!this.transparent&&this._shape.isHit(t)}}),i},to=class extends Rr{constructor(t){super(t),this.type="Point",this.radius=t.radius||10,this._doCache()}setConfig(t){Object.keys(t).forEach((e=>{void 0!==t[e]&&null!==t[e]&&(this[e]=t[e],this._rawConfigs[e]=t[e])})),this._doCache()}_doCache(){this.width=2*this.radius,this.height=2*this.radius}render(t){t.save(),this._isMoving&&(t.globalAlpha=.6),t.beginPath(),t.arc(this.anchor[0],this.anchor[1],this.radius,0,2*Math.PI),t.fillStyle=this.backgroundColor,t.fill(),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor,t.stroke()),t.restore()}isHit(t){const e=this.anchor;return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)<this.radius*this.radius}getBoundingRect(){const t=this.anchor,e=this.radius,n=t[0]-e,i=t[1]-e,s=t[0]+e,r=t[1]+e,o=this._boundingrect;return o[0]=n,o[1]=i,o[2]=s,o[3]=r,o}calculateIntersection(t){const[e,n]=t,[i,s]=this.anchor,r=i-e,o=s-n,a=Math.sqrt(r*r+o*o),h=this.radius/a;return[i-h*r,s-h*o]}getIntersectionsInFourDimension(){const[t,e]=this.anchor,n=this.radius;return{[pr.RIGHT]:[t+n,e],[pr.LEFT]:[t-n,e],[pr.BOTTOM]:[t,e+n],[pr.TOP]:[t,e-n]}}calculateIntersectionInFourDimension(t,e){const[n,i]=t,[s,r]=this.anchor,o=this.radius,a=s-n,h=r-i,c={[pr.RIGHT]:[s+o,r],[pr.LEFT]:[s-o,r],[pr.BOTTOM]:[s,r+o],[pr.TOP]:[s,r-o]};let l=Math.abs(h)>Math.abs(a)?h<0?pr.BOTTOM:pr.TOP:a<0?pr.RIGHT:pr.LEFT;return{p:c[l],dir:l}}getBoundingDimension(){return{width:this.width,height:this.height}}},eo=class extends Rr{constructor(t={}){super(t),this.type="Rectangle",this.width=t.width||10,this.height=t.height||10,this.borderRadius=t.borderRadius||0,this._setBorder(t)}_setBorder(t){this.border={top:{color:t.border?.top?.borderColor||t.borderColor||"transparent",width:t.border?.top?.borderWidth||t.borderWidth||0,enable:t.border?.top?.borderWidth},right:{color:t.border?.right?.borderColor||t.borderColor||"transparent",width:t.border?.right?.borderWidth||t.borderWidth||0,enable:t.border?.right?.borderWidth},bottom:{color:t.border?.bottom?.borderColor||t.borderColor||"transparent",width:t.border?.bottom?.borderWidth||t.borderWidth||0,enable:t.border?.bottom?.borderWidth},left:{color:t.border?.left?.borderColor||t.borderColor||"transparent",width:t.border?.left?.borderWidth||t.borderWidth||0,enable:t.border?.left?.borderWidth}},this.borderColor=t.borderColor||"transparent",this.borderWidth=t.borderWidth||0}setConfig(t){Object.keys(t).forEach((e=>{void 0!==t[e]&&null!==t[e]&&(this[e]=t[e],this._rawConfigs[e]=t[e])})),this._setBorder(t)}render(t){t.save(),this._isMoving&&(t.globalAlpha=.6);const{borderRadius:e,anchor:n,width:i,height:s}=this,r=this.anchor[0]-this.width/2,o=this.anchor[1]-this.height/2,a=this.anchor[0]+this.width/2,h=this.anchor[1]+this.height/2;if(this.borderRadius?(t.beginPath(),t.moveTo(r+e,o),t.lineTo(r+i-e,o),t.quadraticCurveTo(r+i,o,r+i,o+e),t.lineTo(r+i,o+s-e),t.quadraticCurveTo(r+i,o+s,r+i-e,o+s),t.lineTo(r+e,o+s),t.quadraticCurveTo(r,o+s,r,o+s-e),t.lineTo(r,o+e),t.quadraticCurveTo(r,o,r+e,o),t.closePath()):(t.beginPath(),t.rect(this.anchor[0]-this.width/2,this.anchor[1]-this.height/2,this.width,this.height)),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor),this.shadowColor&&"transparent"!==this.shadowColor){t.shadowColor=this.shadowColor;const n=this._jflow.scale;t.shadowBlur=this.shadowBlur*n,t.shadowOffsetX=this.shadowOffsetX*n,t.shadowOffsetY=this.shadowOffsetY*n;let a=new Path2D;this.borderRadius?(a.moveTo(r+e,o),a.lineTo(r+i-e,o),a.quadraticCurveTo(r+i,o,r+i,o+e),a.lineTo(r+i,o+s-e),a.quadraticCurveTo(r+i,o+s,r+i-e,o+s),a.lineTo(r+e,o+s),a.quadraticCurveTo(r,o+s,r,o+s-e),a.lineTo(r,o+e),a.quadraticCurveTo(r,o,r+e,o),a.closePath()):a.rect(this.anchor[0]-this.width/2,this.anchor[1]-this.height/2,this.width,this.height),a.rect(r-10,o-10,this.width+20,this.height+20),t.save(),t.clip(a,"evenodd"),t.stroke(),t.restore()}if(t.fillStyle=this.backgroundColor,t.fill(),this.borderRadius&&this.borderWidth&&(t.shadowColor="transparent",t.stroke()),this.borderRadius){if(this.border.top.enable){const n=o-this.border.top.width/2;t.beginPath();let s=new Path2D;s.moveTo(r,n+e),s.quadraticCurveTo(r,n,r+e,n),s.lineTo(r+i-e,n),s.quadraticCurveTo(r+i,n,r+i,n+e),s.closePath(),t.clip(s),t.save(),t.shadowColor="transparent",t.fillStyle=this.border.top.color,t.rect(r,n,this.width,this.border.top.width),t.fill(),t.restore()}}else this.border.top.width&&(t.beginPath(),t.moveTo(r,o),t.lineTo(a,o),t.strokeStyle=this.border.top.color,t.lineWidth=this.border.top.width,t.stroke()),this.border.right.width&&(t.beginPath(),t.moveTo(a,o),t.lineTo(a,h),t.strokeStyle=this.border.right.color,t.lineWidth=this.border.right.width,t.stroke()),this.border.bottom.width&&(t.beginPath(),t.moveTo(a,h),t.lineTo(r,h),t.strokeStyle=this.border.bottom.color,t.lineWidth=this.border.bottom.width,t.stroke()),this.border.left.width&&(t.beginPath(),t.moveTo(r,h),t.lineTo(r,o),t.strokeStyle=this.border.left.color,t.lineWidth=this.border.left.width,t.stroke());t.restore()}isHit(t){const e=this.anchor,n=this.width/2,i=this.height/2;return t[0]>e[0]-n&&t[0]<e[0]+n&&t[1]>e[1]-i&&t[1]<e[1]+i}getBoundingRect(){const t=this.anchor,e=this.width/2,n=this.height/2,i=t[0]-e,s=t[1]-n,r=t[0]+e,o=t[1]+n,a=this._boundingrect;return a[0]=i,a[1]=s,a[2]=r,a[3]=o,a}getBoundingDimension(){return{height:this.height,width:this.width}}calculateIntersection(t){const[e,n]=t,[i,s]=this.anchor,r=this.width/2,o=this.height/2,a=i-e,h=s-n,c=o/r,l=Math.abs(h/a),u=e>i,d=n>s;let f,p;return l<c?(f=i+(u?r:-r),p=r*(d?l:-l)+s):(p=s+(d?o:-o),f=o/(u?l:-l)+i),[f,p]}getIntersectionsInFourDimension(){let t=this.anchor;this._belongs&&this._belongs.calculateToCoordination&&(t=this._belongs.calculateToCoordination(t));const[e,n]=t,i=this.width/2,s=this.height/2;return{[pr.RIGHT]:[e+i,n],[pr.LEFT]:[e-i,n],[pr.BOTTOM]:[e,n+s],[pr.TOP]:[e,n-s]}}calculateIntersectionInFourDimension(t,e){const[n,i]=t;let s=this.anchor;this._belongs&&this._belongs.calculateToCoordination&&(s=this._belongs.calculateToCoordination(s));const[r,o]=s,a=this.width/2,h=this.height/2,c={[pr.RIGHT]:[r+a,o],[pr.LEFT]:[r-a,o],[pr.BOTTOM]:[r,o+h],[pr.TOP]:[r,o-h]},l=r-n,u=o-i,d=h/a,f=n>r;let p=Math.abs(u/l)>d?i>o?pr.BOTTOM:pr.TOP:f?pr.RIGHT:pr.LEFT;return{p:c[p],dir:p}}},no=class extends Rr{constructor(t={}){super(t),this.type="Capsule",this.width=t.width||20,this.height=t.height||10}render(t){t.save(),this._isMoving&&(t.globalAlpha=.6),t.beginPath();const[e,n]=this.anchor,i=this.width/2,s=this.height/2,r=e-i+s,o=e+i-s,a=n-s,h=n+s;t.moveTo(r,a),t.lineTo(o,a),t.arc(o,n,s,-Math.PI/2,Math.PI/2),t.lineTo(r,h),t.arc(r,n,s,Math.PI/2,Math.PI/2*3),t.fillStyle=this.backgroundColor,this.shadowColor&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),t.fill(),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor,t.stroke()),t.restore()}isHit(t){const e=this.anchor,n=this.width/2,i=this.height/2,s=Math.abs(n-i),r=e[0]-n+i,o=e[0]+n-i,a=i*i;return t[0]>e[0]-s&&t[0]<e[0]+s&&t[1]>e[1]-i&&t[1]<e[1]+i||Math.pow(t[0]-r,2)+Math.pow(t[1]-e[1],2)<a||Math.pow(t[0]-o,2)+Math.pow(t[1]-e[1],2)<a}getBoundingRect(){const t=this.anchor,e=this.width/2,n=this.height/2,i=t[0]-e,s=t[1]-n,r=t[0]+e,o=t[1]+n,a=this._boundingrect;return a[0]=i,a[1]=s,a[2]=r,a[3]=o,a}getBoundingDimension(){return{height:this.height,width:this.width}}getIntersectionsInFourDimension(){let t=this.anchor;this._belongs&&this._belongs.calculateToCoordination&&(t=this._belongs.calculateToCoordination(t));const[e,n]=t,i=this.width/2,s=this.height/2;return{[pr.RIGHT]:[e+i,n],[pr.LEFT]:[e-i,n],[pr.BOTTOM]:[e,n+s],[pr.TOP]:[e,n-s]}}},io=class extends no{render(t){t.save(),this._isMoving&&(t.globalAlpha=.6),t.beginPath();const[e,n]=this.anchor,i=this.width/2,s=this.height/2,r=n-s+i,o=n+s-i,a=e-i,h=e+i;t.moveTo(a,r),t.arc(e,r,i,-Math.PI,0),t.lineTo(h,o),t.arc(e,o,i,0,Math.PI),t.closePath(),t.fillStyle=this.backgroundColor,this.shadowColor&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),t.fill(),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor,t.stroke()),t.restore()}isHit(t,e){const[n,i]=this.anchor,s=this.width/2,r=this.height/2,o=Math.abs(r-s),a=i-r+s,h=i+r-s,c=s*s;return t[0]>n-s&&t[0]<n+s&&t[1]>i-o&&t[1]<i+o||Math.pow(t[0]-n,2)+Math.pow(t[1]-a,2)<c||Math.pow(t[0]-n,2)+Math.pow(t[1]-h,2)<c}},so=class extends Rr{constructor(t={}){super(t),this.type="Rhombus",this.height=t.diagonalsV||10,this.width=t.diagonalsH||20}render(t){t.save(),this._isMoving&&(t.globalAlpha=.6);const e=this.width/2,n=this.height/2,i=this.anchor;if(t.translate(i[0],i[1]),t.beginPath(),t.moveTo(0,-n),t.lineTo(e,0),t.lineTo(0,n),t.lineTo(-e,0),t.closePath(),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor),this.shadowColor){t.shadowColor=this.shadowColor;const i=this._jflow.scale;t.shadowBlur=this.shadowBlur*i,t.shadowOffsetX=this.shadowOffsetX*i,t.shadowOffsetY=this.shadowOffsetY*i;let s=new Path2D;s.moveTo(0,-n),s.lineTo(e,0),s.lineTo(0,n),s.lineTo(-e,0),s.closePath(),s.rect(-e-10,-n-10,this.width+20,this.height+20),t.save(),t.clip(s,"evenodd"),t.stroke(),t.restore()}t.fillStyle=this.backgroundColor,t.fill(),this.borderWidth&&(t.shadowColor="transparent",t.stroke()),t.translate(-i[0],-i[1]),t.restore()}isHit(t){const e=this.height/2,n=this.width/2,i=this.anchor;return Math.abs(t[0]-i[0])/n+Math.abs(t[1]-i[1])/e<=1}getBoundingRect(){const t=this.anchor,e=this.width/2,n=this.height/2,i=t[0]-e,s=t[1]-n,r=t[0]+e,o=t[1]+n,a=this._boundingrect;return a[0]=i,a[1]=s,a[2]=r,a[3]=o,a}getBoundingDimension(){return{height:this.height,width:this.width}}getIntersectionsInFourDimension(){let t=this.anchor;this._belongs&&this._belongs.calculateToCoordination&&(t=this._belongs.calculateToCoordination(t));const[e,n]=t,i=this.width/2,s=this.height/2;return{[pr.RIGHT]:[e+i,n],[pr.LEFT]:[e-i,n],[pr.BOTTOM]:[e,n+s],[pr.TOP]:[e,n-s],[pr.SELF]:[e+.618*i,n+.618*s]}}},ro=class extends Rr{constructor(t={}){super(t),this.type="Diamond",this.width=t.width||20,this.height=t.height||10,this.side=t.side||6,this._doCache()}setConfig(t){Object.keys(t).forEach((e=>{void 0!==t[e]&&null!==t[e]&&(this[e]=t[e],this._rawConfigs[e]=t[e])})),this._doCache()}_doCache(){this.sinSIDE=Math.sin(Math.PI/3)*this.side,this.cosSIDE=Math.cos(Math.PI/3)*this.side}render(t){const[e,n]=this.anchor,i=this.width/2,s=this.height/2,r=s/1.732,o=e-i+r,a=e+i-r,h=e+i,c=e-i,l=n-s,u=n+s;this._cachePoints=[[a,l],[h,n],[a,u],[o,u],[c,n],[o,l]],t.save(),this._isMoving&&(t.globalAlpha=.6),t.beginPath();const{side:d,sinSIDE:f,cosSIDE:p}=this;t.moveTo(e,l),t.lineTo(a-d,l),t.quadraticCurveTo(a,l,a+p,l+f),t.lineTo(h-p,n-f),t.quadraticCurveTo(h,n,h-p,n+f),t.lineTo(a+p,u-f),t.quadraticCurveTo(a,u,a-d,u),t.lineTo(o+d,u),t.quadraticCurveTo(o,u,o-p,u-f),t.lineTo(c+p,n+f),t.quadraticCurveTo(c,n,c+p,n-f),t.lineTo(o-p,l+f),t.quadraticCurveTo(o,l,o+d,l),t.closePath(),t.fillStyle=this.backgroundColor,this.shadowColor&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),t.fill(),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor,t.stroke()),t.restore()}isHit(t){if(!this._cachePoints)return!1;const e=this._cachePoints;let n=!1;for(let i=0,s=e.length-1;i<e.length;i++)e[i][1]>t[1]!=e[s][1]>t[1]&&t[0]<(e[s][0]-e[i][0])*(t[1]-e[i][1])/(e[s][1]-e[i][1])+e[i][0]&&(n=!n),s=i;return n}getBoundingRect(){const t=this.anchor,e=this.width/2,n=this.height/2,i=t[0]-e,s=t[1]-n,r=t[0]+e,o=t[1]+n,a=this._boundingrect;return a[0]=i,a[1]=s,a[2]=r,a[3]=o,a}getBoundingDimension(){return{height:this.height,width:this.width}}getIntersectionsInFourDimension(){let t=this.anchor;this._belongs&&this._belongs.calculateToCoordination&&(t=this._belongs.calculateToCoordination(t));const[e,n]=t,i=this.width/2,s=this.height/2;return{[pr.RIGHT]:[e+i,n],[pr.LEFT]:[e-i,n],[pr.BOTTOM]:[e,n+s],[pr.TOP]:[e,n-s]}}};Math.sqrt(3);const oo=Symbol("ishit");class ao extends Yr{constructor(t,e={}){super(t,e),this.visible=!1}render(t){this.visible&&super.render(t)}setHit(t){this[oo]!==t&&(this.isFocus=t,this.onHit()),this[oo]=t}}class ho extends Rr{constructor(t){super(t),this.type="ScrollGroup",this.initStack(t),this.initLayout(t),this.initScrollBar(t),this._shape=new eo(t),this._shape.anchor=[0,0],this._shape._belongs=this,this.maxWidth=t.maxWidth||1/0,this.definedWidth=t.definedWidth,this.maxHeight=t.maxHeight||1/0,this.definedHeight=t.definedHeight,this.lock=t.lock??!0,this._offset=[0,0],this._getBoundingGroupRect(),this.reflow(),this._getBoundingGroupRect(),this._resetOffset(),this._cacheViewBox=[]}initScrollBar(t){const{barColor:e,barFocusColor:n,barMarginX:i,barMarginY:s,barWidth:r}=t;this._scrollbarX=new ao("x",{plainColor:e,focusColor:n,barWidth:r}),this._scrollbarY=new ao("y",{plainColor:e,focusColor:n,barWidth:r}),this._scrollbarX.barMarginX=i||1,this._scrollbarY.barMarginY=s||1;const o=()=>{this._jflow.scheduleRender()};this._scrollbarX.onHit=o,this._scrollbarY.onHit=o,this._scrollBarStatus={dragging:!1,target:null,barInitX:0,barInitY:0,barStartX:0,barStartY:0,hitScrollX:!1,hitScrollY:!1},this.addEventListener("instancePressStart",(t=>{if(this._scrollBarStatus.hitScrollX){t.detail.preventDefault(),t.detail.bubbles=!1;const e=t.detail.event.clientX;Object.assign(this._scrollBarStatus,{dragging:!0,target:this._scrollbarX,barStartX:this._scrollbarX.anchor[0],barInitX:e}),this.onScrollbarPressStart()}if(this._scrollBarStatus.hitScrollY){t.detail.preventDefault(),t.detail.bubbles=!1;const e=t.detail.event.clientY;Object.assign(this._scrollBarStatus,{dragging:!0,target:this._scrollbarY,barStartY:this._scrollbarY.anchor[1],barInitY:e}),this.onScrollbarPressStart()}}))}onScrollbarPressStart(){const t=this._jflow.canvas,e=(t=>{const{clientX:e,clientY:n}=t;this.onDraggingScrollbar(e,n)}).bind(this);document.addEventListener("pointermove",e);const n=(i=>{Object.assign(this._scrollBarStatus,{dragging:!1,target:null,barInitX:0,barInitY:0,barStartX:0,barStartY:0,hitScrollX:!1,hitScrollY:!1}),document.removeEventListener("pointermove",e),document.removeEventListener("pointerup",n),t.removeEventListener("pointerup",n)}).bind(this);t.addEventListener("pointerup",n,{once:!0}),document.addEventListener("pointerup",n,{once:!0})}onDraggingScrollbar(t,e){if(this._scrollbarX.visible&&this._scrollBarStatus.dragging){const n=this._jflow,i=n.scale,{target:s,barInitX:r,barStartX:o,barInitY:a,barStartY:h}=this._scrollBarStatus;if("x"===s.dir){const e=this._scrollbarX.width,a=this._outerWidth,h=o+(t-r)/i,c=(s.anchor[0]=Math.max(Math.min(h,a-e),0))/(a-e),l=(this._innerWidth-a)/2;this._offset[0]=l-(this._innerWidth-a)*c,n.scheduleRender()}if("y"===s.dir){const t=this._scrollbarY.height,r=this._outerHeight,o=h+(e-a)/i,c=(s.anchor[1]=Math.max(Math.min(o,r-t),0))/(r-t),l=(this._innerHeight-r)/2;this._offset[1]=l-(this._innerHeight-r)*c,n.scheduleRender()}}}setConfig(t){this._shape.setConfig(t)}_getBoundingGroupRect(){const t=mr(this._stack.getBoundingRectPoints()),e=t.width,n=t.height,i=this.definedWidth||Math.min(e,this.maxWidth),s=this.definedHeight||Math.min(n,this.maxHeight);this._innerWidth=e,this._outerWidth=i,this._innerHeight=n,this._outerHeight=s,this._shape.width=i,this._shape.height=s,this.width=i,this.height=s}_calculatePointBack(t){const[e,n]=t,[i,s]=this._offset,[r,o]=this.anchor;return[e-r-i,n-o-s]}_calculatePointBackWithPoint(t,e,n,i,s){const r=this.anchor,o=this._offset;n[i]=t-r[0]-o[0],n[s]=e-r[1]-o[1]}calculateToCoordination(t){const[e,n]=t,[i,s]=this.anchor,[r,o]=this._offset,a=[e+i-r,n+s-o];return this._belongs&&this._belongs.calculateToCoordination?this._belongs.calculateToCoordination(a):a}calculateToRealWorld(t){const[e,n]=t,[i,s]=this.anchor,[r,o]=this._offset,a=[e+i-r,n+s-o];if(this._belongs&&this._belongs.calculateToRealWorld)return this._belongs.calculateToRealWorld(a)}_getViewBox(){const t=this._cacheViewBox;return this._calculatePointBackWithPoint(0,0,t,0,1),this._calculatePointBackWithPoint(this.width,this.height,t,2,3),t}getCacheViewBox(){return this._cacheViewBox}_resetOffset(){this._offset=[Math.max((this._innerWidth-this._outerWidth)/2,0),Math.max((this._innerHeight-this._outerHeight)/2,0)],this._innerWidth>this._outerWidth?(this._scrollbarX.visible=!0,this._scrollbarX.width=this._outerWidth*this._outerWidth/this._innerWidth,this._scrollbarX.anchor=[0,this._outerHeight-4]):this._scrollbarX.visible=!1,this._innerHeight>this._outerHeight?(this._scrollbarY.visible=!0,this._scrollbarY.height=this._outerHeight*this._outerHeight/this._innerHeight,this._scrollbarY.anchor=[this._outerWidth-4,0]):this._scrollbarY.visible=!1}render(t){this._isMoving?t.globalAlpha=.6:1!==this.opacity&&(t.globalAlpha=this.opacity);const[e,n]=this.anchor,i=this.width,s=this.height,r=i/2,o=s/2,[a,h]=this._offset;t.translate(e,n),this._shape.render(t),t.translate(-r,-o),this._scrollbarX.visible&&this._scrollbarX.render(t),this._scrollbarY.visible&&this._scrollbarY.render(t),t.translate(r,o),t.save(),t.beginPath(),t.rect(-r,-o,i,s),t.clip(),t.translate(a,h),this._stack.render(t),this._linkStack.render(t),t.translate(-e-a,-n-h),t.restore()}isHit(t,e){const[n,i]=t,[s,r]=this.anchor,o=[n-s+this.width/2,i-r+this.height/2];if(this._scrollBarStatus.hitScrollX=!1,this._scrollBarStatus.hitScrollY=!1,this._scrollbarX.visible&&this._scrollbarX.isHit(o))return this._scrollBarStatus.hitScrollX=!0,this._scrollbarX.setHit(!0),!0;if(this._scrollbarX.setHit(!1),this._scrollbarY.visible&&this._scrollbarY.isHit(o))return this._scrollBarStatus.hitScrollY=!0,this._scrollbarY.setHit(!0),!0;if(this._scrollbarY.setHit(!1),this._shape.isHit([n-s,i-r])){const[t,o]=this._offset,a=[n-s-t,i-r-o];this._currentp=a;const h=this._stack.checkHit(a,e);if(h)return h}else this._stack.resetHitStatus();return!1}getBoundingDimension(){return{width:this.width,height:this.height}}getBoundingRect(){const t=this.anchor,e=this.width/2,n=this.height/2,i=t[0]-e,s=t[1]-n,r=t[0]+e,o=t[1]+n,a=this._boundingrect;return a[0]=i,a[1]=s,a[2]=r,a[3]=o,a}getIntersectionsInFourDimension(){let t=this.anchor;this._belongs&&this._belongs.calculateToCoordination&&(t=this._belongs.calculateToCoordination(t));const[e,n]=t,i=this.width/2,s=this.height/2;return{[pr.RIGHT]:[e+i,n],[pr.LEFT]:[e-i,n],[pr.BOTTOM]:[e,n+s],[pr.TOP]:[e,n-s],[pr.SELF]:[e+.618*i,n+.618*s]}}onEnterViewbox(){this.interateNodeStack((t=>{t.onEnterViewbox()}))}onLeaveViewbox(){this.interateNodeStack((t=>{t.onLeaveViewbox()}))}destroy(){this._shape.destroy(),this.interateNodeStack((t=>{t.destroy()}))}clone(){const t=new(0,this.constructor)(Object.assign({},this._rawConfigs,{layout:this._layout&&this._layout.clone()}));return this.interateNodeStack((e=>{t.addToStack(e.clone())})),t.recalculate(),t.visible=this.visible,t}}Object.assign(ho.prototype,Vr),Object.assign(ho.prototype,Wr),Object.assign(ho.prototype,{recalculateUp(){let t=!0;if(this.getBoundingDimension){const e=this._innerWidth,n=this._innerHeight;this.resetChildrenPosition&&this.resetChildrenPosition(),this._getBoundingGroupRect&&this._getBoundingGroupRect(),this.reflow(),this._getBoundingGroupRect&&this._getBoundingGroupRect();const i=this._innerWidth,s=this._innerHeight;t=e!==i||n!==s}else this.reflow();this._belongs&&t&&(this._resetOffset(),this._belongs.recalculateUp())},recalculate(){const{width:t,height:e}=this.getBoundingDimension();this.reflow(),this._getBoundingGroupRect&&this._getBoundingGroupRect();const{width:n,height:i}=this.getBoundingDimension();t===n&&e===i||this._resetOffset()}});const co=ho,lo={canvas:{wheel(t,e){t.preventDefault();let{offsetX:n,offsetY:i,deltaX:s,deltaY:r}=t;t.ctrlKey&&(r=-r),e.zoomHandler(n,i,s,r,t)}}},uo=class extends Mr{constructor(t={}){super(),this.from=t.from,this.to=t.to,this.fromDir=t.fromDir,this.toDir=t.toDir,this._cachePoints=null,this.backgroundColor=t.backgroundColor||"#000",this.isSelf=!!t.isSelf}isInViewBox(t){return!0}bringToTop(){const t=this._jflow._linkStack,e=t.findIndex((t=>t===this));t.splice(e,1),t.push(this),this._jflow._render()}},fo=class extends Rr{constructor(t){super(t),this.width=t.width,this.height=t.height,this.imageBuffer=document.createElement("canvas"),this.imageBuffer.width=this.width+2,this.imageBuffer.height=this.height+2,t.cache(this.imageBuffer.getContext("2d"))}render(t){const[e,n]=this.anchor;t.save(),t.translate(e,n),t.beginPath(),t.drawImage(this.imageBuffer,-this.width/2,-this.height/2),t.translate(-e,-n),t.restore()}getBoundingDimension(){return{height:this.height,width:this.width}}recalculate(){}getBoundingRect(){const t=this.anchor,e=this.width/2,n=this.height/2,i=t[0]-e,s=t[1]-n,r=t[0]+e,o=t[1]+n,a=this._boundingrect;return a[0]=i,a[1]=s,a[2]=r,a[3]=o,a}},po="left",go="right",mo=class extends eo{constructor(t){super(t),this.type="Text",this.content=t.content||"",this.fontFamily=t.fontFamily||"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Tahoma,Arial,Noto Sans,PingFang SC,Microsoft YaHei,Hiragino Sans GB,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji",this.fontSize=t.fontSize||"14px",this.fontWeight=t.fontWeight||"",this.textColor=t.textColor||"white",this.placeholderColor=t.placeholderColor||t.textColor||"white",this.textAlign=t.textAlign||"center",this.textBaseline=t.textBaseline||"middle",this.lineHeight=t.lineHeight,this.indent=t.indent||0,this.backgroundColor=t.backgroundColor,this.editable=t.editable,this.definedWidth=t.definedWidth,this.minWidth=t.minWidth||0,this.maxWidth=t.maxWidth,this.ellipsis=t.ellipsis,this.placeholder=t.placeholder||"",this.emptyWhenInput=t.emptyWhenInput||!1,this.editting=!1,this.disabled=t.disabled,this.cursorColor=t.cursorColor||"#60CFC4",this.textRangeColor=t.textRangeColor||"#4E75EC1A",this._status={editing:!1,cursorshow:!0,cursoranime:null,lastElapsed:0,refreshElapsed:!1,cursorDragging:!1,shiftOn:!1,oldVal:"",inputElement:null},this._cursorOffset=0,this._textRange={enable:!1,rangefrom:null,rangeTo:null,initialRange:null},this.editable&&this._makeFunctional(),this.preCalculateText(),this.shadowCache()}get currentContent(){return this.content||this.placeholder}get isEmpty(){return!this.content}preCalculateText(){Vs((t=>{t.beginPath(),t.font=`${this.fontSize} ${this.fontFamily}`,t.textAlign=this.textAlign,t.textBaseline=this.textBaseline;const e=parseInt(this.fontSize),n=this.currentContent,{fontBoundingBoxAscent:i,fontBoundingBoxDescent:s,width:r}=t.measureText(n);if(this._textWidth=this.indent+r,this.definedWidth){if(this.ellipsis&&this._textWidth>this.definedWidth){const t=this._calculateOffset(this.definedWidth-12);this.ellipsisContent=n.substring(0,t)+"..."}else this.ellipsisContent=n;this.width=this.definedWidth}else if(this.maxWidth&&this.ellipsis){if(this._textWidth>this.maxWidth){const t=this.maxWidth/this._textWidth,e=Math.floor(n.length*t-3);this.ellipsisContent=n.substring(0,e)+"..."}else this.ellipsisContent=n;this.width=Math.min(this.maxWidth,this._textWidth)}else this.width=Math.max(this.minWidth,this._textWidth);const o=Math.abs(i)+Math.abs(s)||e;this._textHeight=o,this.lineHeight?this.height=this.lineHeight:this.height=o}))}shadowCache(){const t=window.devicePixelRatio,e=this.width*t,n=this.height*t,i=this.indent*t,s=parseInt(this.fontSize)*t;this._shadowCache=new fo({width:e,height:n,cache:t=>{t.translate(e/2,n/2);const r=`${this.fontWeight} ${s}px ${this.fontFamily}`;t.font=r,t.textAlign=this.textAlign,t.textBaseline=this.textBaseline,t.fillStyle=this.isEmpty?this.placeholderColor:this.textColor;let o=this.currentContent;if(this.ellipsisContent&&(o=this.ellipsisContent),o)if(this.textAlign===po){const n=e/2;t.fillText(o,i/2-n,0)}else if(this.textAlign===go){const n=e/2;t.fillText(o,n,0)}else t.fillText(o,i/2,0)}})}setConfig(t){Object.keys(t).forEach((e=>{void 0!==t[e]&&null!==t[e]&&(this[e]=t[e],this._rawConfigs[e]=t[e])})),this.preCalculateText(),this.shadowCache()}click(){if(!this._status.editing){let t=!0;if(this.dispatchEvent(new Jr("edit",{target:this,preventDefault(){t=!1}})),!t)return;const e=this._belongs._currentp,n=this._jflow;this._cursorOffset=e?this._positionToCursorOffset(e):0;const i=function(t,e){const n=document.createElement("input");n.setAttribute("style","\n        width: 100px;\n        position: absolute;\n        left: 0;\n        top: 0;\n        border:none;\n        opacity: 0;\n        z-index: -1;\n        contain: strict;"),n.setAttribute("tabindex",-1),n.setAttribute("aria-hidden",!0),n.setAttribute("spellcheck",!1),n.setAttribute("autocorrect","off");let i=!1,s={ctrlOn:!1};return n.addEventListener("beforeinput",(e=>{e.preventDefault(),e.data&&(i||t("Input",e.data))})),n.addEventListener("compositionstart",(e=>{t("compositionstart"),i=!0})),n.addEventListener("compositionupdate",(e=>{t("compositionupdate",e.data)})),n.addEventListener("compositionend",(e=>{t("compositionend",e.data),n.value="",i=!1})),n.addEventListener("keyup",(e=>{switch(e.key){case"Shift":t("Shift",!1);break;case"Meta":case"Control":s.ctrlOn=!1}})),n.addEventListener("keydown",(e=>{switch(e.code){case"Enter":t("Enter");break;case"Backspace":t("Backspace");break;case"ArrowLeft":t("ArrowLeft");break;case"ArrowRight":t("ArrowRight");break;case"ArrowDown":t("ArrowDown");break;case"ArrowUp":t("ArrowUp")}switch(e.key){case"Shift":t("Shift",!0);break;case"Meta":case"Control":s.ctrlOn=!0;break;case"a":s.ctrlOn&&t("CtrlA")}})),n.addEventListener("keyup",(t=>{e("KeyUp",t)})),n.addEventListener("keydown",(t=>{e("KeyDown",t)})),n.addEventListener("copy",(e=>{e.preventDefault(),e.stopPropagation(),t("COPY",null,e)})),n.addEventListener("cut",(e=>{e.preventDefault(),e.stopPropagation(),t("CUT",null,e)})),n.addEventListener("paste",(e=>{e.preventDefault(),e.stopPropagation(),t("PASTE",null,e)})),n}(this._controlCallback.bind(this),this._defaultCallback.bind(this));n.DOMwrapper.append(i),i.focus({preventScroll:!0}),n.setFocusInstance(this),Object.assign(this._status,{editing:!0,oldVal:this.content,inputElement:i,cursoranime:n.requestJFlowAnime((t=>{const e=this._status.lastElapsed;this._status.refreshElapsed&&(this._status.lastElapsed=t,this._status.refreshElapsed=!1),t-e>500&&(this._status.cursorshow=!this._status.cursorshow,this._status.lastElapsed=t)}))}),this.emptyWhenInput&&(this.content=""),this.syncShadowInputPosition()}}_makeFunctional(){const t=t=>{this._status.editing=!1,this._status.inputElement&&this._status.inputElement.remove(),this._belongs&&this._jflow.scheduleRender()};this.addEventListener("dblclick",(t=>{t.currentTarget===this&&this._status.editing&&this._selectFullRange()})),this.addEventListener("click",(t=>{if(t.currentTarget===this){if(this._status.editing){const t=this._belongs._currentp,e=this._positionToCursorOffset(t);if(this._status.shiftOn){const t=this._textRange.initialRange;Object.assign(this._textRange,{rangefrom:Math.min(e,t),rangeTo:Math.max(e,t),enable:!0}),this._cursorOffset=this._textRange.rangeTo,this._status.inputElement.focus({preventScroll:!0})}else this._cursorOffset=e,this._status.inputElement.focus({preventScroll:!0}),this._refreshCursor(),this.syncShadowInputPosition()}this.click()}})),this.addEventListener("blur",(e=>{t(),this.dispatchEvent(new Jr("change",{target:this,oldVal:this._status.oldVal,val:this.content})),this._textRange.enable=!1,this._status.cursoranime.cancel(),Object.assign(this._status,{editing:!1,cursorshow:!0,cursoranime:null,lastElapsed:0,refreshElapsed:!1,cursorDragging:!1,shiftOn:!1,oldVal:"",inputElement:null})})),this.addEventListener("instancePressStart",(t=>{if(this._status.editing&&!this._status.shiftOn){t.detail.bubbles=!1,t.detail.preventDefault();const e=this._belongs._currentp,n=this._positionToCursorOffset(e);this._textRange.initialRange=n;const i=t.detail.jflow;let s=!1;const r=(t=>{s=!0;const{offsetX:e,offsetY:n}=t,r=i._calculatePointBack([e,n]);i._stack.checkHit(r);const o=this._belongs._currentp,a=this._positionToCursorOffset(o),h=this._textRange.initialRange;this._status.editing=!1,Object.assign(this._textRange,{rangefrom:Math.min(a,h),rangeTo:Math.max(a,h),enable:!0})}).bind(this);document.addEventListener("pointermove",r),document.addEventListener("pointerup",(t=>{if(document.removeEventListener("pointermove",r),!s)return void(this._textRange.initialRange=null);const e=this._textRange.rangeTo;this._cursorOffset=e,this._status.editing=!0,this._status.inputElement.focus({preventScroll:!0}),this._textRange.initialRange=null}),{once:!0})}}))}_positionToCursorOffset(t){const[e]=t,n=this.width/2,[i]=this.anchor,s=e-(i-n);let r=0;return r=s>=this._textWidth?this.content.length:this._calculateOffset(s),r}_calculateOffset(t){const e=this.content,n=e.length-1,i=this._textWidth;if(0===i)return 0;const s=i;let r=Math.floor(t/s*n);return Vs((i=>{let o,a,h;i.font=`${this.fontSize} ${this.fontFamily}`;let c=e.substring(0,r),l=e.substring(r-1,r),u=e.substring(r,r+1),d=i.measureText(c).width,f=i.measureText(l).width,p=i.measureText(u).width;o=d-f/2,a=d+p/2;do{if(o<=t&&a>=t)break;if(o>t){const n=a-t;h=r,r-=n<100?1:Math.floor(n/a*h),c=e.substring(r,h),d-=i.measureText(c).width}else if(a<t){const a=t-o;h=r,r+=a<100?1:Math.floor(a/(s-o)*(n-h)),c=e.substring(h,r),d+=i.measureText(c).width}l=e.substring(r-1,r),u=e.substring(r,r+1),f=i.measureText(l).width,p=i.measureText(u).width,o=d-f/2,a=d+p/2}while(r>=0&&r<=n)})),r}_refreshCursor(){this._status.editing&&Object.assign(this._status,{cursorshow:!0,refreshElapsed:!0}),this._textRange.enable&&(this._textRange.enable=!1)}render(t){if(this._isMoving&&(t.globalAlpha=.6),!t.disableCache&&!this._status.editing&&this._jflow.scale*parseInt(this.fontSize)<8){const[e,n]=this.anchor;return t.save(),t.translate(e,n),t.beginPath(),t.drawImage(this._shadowCache.imageBuffer,-this.width/2,-this.height/2,this.width,this.height),t.translate(-e,-n),void t.restore()}const e=`${this.fontWeight} ${this.fontSize} ${this.fontFamily}`;t.font!==e&&(t.font=e),t.textAlign!==this.textAlign&&(t.textAlign=this.textAlign),t.textBaseline!==this.textBaseline&&(t.textBaseline=this.textBaseline),t.fillStyle=this.isEmpty?this.placeholderColor:this.textColor;let n=this.currentContent;if(this.ellipsisContent&&(n=this.ellipsisContent),n)if(this.textAlign===po){const e=this.width/2;t.fillText(n,this.anchor[0]-e+this.indent/2,this.anchor[1])}else if(this.textAlign===go){const e=this.width/2;t.fillText(n,this.anchor[0]+e,this.anchor[1])}else t.fillText(n,this.anchor[0]+this.indent/2,this.anchor[1]);const i=this.width/2,s=this._textHeight,[r,o]=this.anchor,a=r-i,h=o-s/2;if(this._status.cursorshow&&this._status.editing){const e=this._cursorOffset,n=this.content.substring(0,e),i=a+t.measureText(n).width,s=this._textHeight/2;t.beginPath(),t.moveTo(i,o-s),t.lineTo(i,o+s),t.lineWidth=2,t.strokeStyle=this.cursorColor,t.stroke()}if(this._textRange.enable){const{rangefrom:e,rangeTo:n}=this._textRange,i=this.content.substring(0,e),r=this.content.substring(e,n),o=a+t.measureText(i).width,c=t.measureText(r).width;t.beginPath(),t.rect(o,h,c,s),t.fillStyle=this.textRangeColor,t.fill()}}_inputControl(t,e){if(this._textRange.enable&&(this._clearTextRange(),"Backspace"===t))return this.dispatchEvent(new Jr("input",{target:this,oldVal:this._status.oldVal,val:this.content})),this.refresh(),void this.syncShadowInputPosition();const n=this._cursorOffset,i=this.content;let s,r=i.substring(0,n);s=this.cacheIdx?i.substring(this.cacheIdx[1]):i.substring(n);let o=!1;switch(t){case"Input":r+=e,this._cursorOffset+=e.length,this.content=r+s;break;case"compositionstart":this.cacheIdx=[r.length,r.length];break;case"compositionupdate":r=r.substring(0,this.cacheIdx[0]),r+=e,this.content=r+s,this._cursorOffset=this.cacheIdx[0]+e.length,this.cacheIdx[1]=this.cacheIdx[0]+e.length;break;case"compositionend":r=r.substring(0,this.cacheIdx[0]),this._cursorOffset=this.cacheIdx[0]+e.length,this.cacheIdx=null,r+=e,this.content=r+s;break;case"Enter":if(this.cacheIdx)return;let t=!0;this.dispatchEvent(new Jr("enterkeypressed",{target:this,handler:e=>{t=e},stopInput(){o=!0}})),t&&this._jflow.blur();break;case"Backspace":r=r.substring(0,r.length-1),this._cursorOffset=Math.max(0,this._cursorOffset-1),this.content=r+s}o||this.dispatchEvent(new Jr("input",{target:this,oldVal:this._status.oldVal,val:this.content})),this.refresh(),this.syncShadowInputPosition()}refresh(){this.preCalculateText(),this._belongs.recalculateUp(),this._jflow.scheduleRender()}syncShadowInputPosition(){if(this._status.editing){const t=this.width/2,e=this.height/2;let n=this.anchor[0]-t;const i=this._cursorOffset;Vs((t=>{t.beginPath(),t.font=`${this.fontSize} ${this.fontFamily}`;const e=this.content.substring(0,i);n+=t.measureText(e).width}));const s=this.calculateToRealWorld([n,e]),r=this._jflow.canvasMeta,o=Math.min(r.actual_width-120,s[0]);this._status.inputElement.style.transform=`translate(${o}px, ${s[1]}px)`}}_controlCallback(t,e,n){switch(this._status.editing&&Object.assign(this._status,{cursorshow:!0,refreshElapsed:!0}),t){case"Input":case"compositionstart":case"compositionupdate":case"compositionend":case"Enter":case"Backspace":this._inputControl(t,e);break;case"ArrowLeft":this._textRange.enable&&(this._textRange.enable=!1),this._onArrowLeft();break;case"ArrowRight":this._textRange.enable&&(this._textRange.enable=!1),this._onArrowRight();break;case"Shift":this._onShiftToggle(e);break;case"CtrlA":this._selectFullRange();break;case"COPY":this._copy(n);break;case"CUT":this._cut(n);break;case"PASTE":this._paste(n)}}_onArrowLeft(){this._cursorOffset=Math.max(0,this._cursorOffset-1),this._jflow.scheduleRender(),this.syncShadowInputPosition()}_onArrowRight(){this._cursorOffset=Math.min(this.content.length,this._cursorOffset+1),this._jflow.scheduleRender(),this.syncShadowInputPosition()}_onShiftToggle(t){this._status.shiftOn=t,this._textRange.initialRange=t?this._cursorOffset:null}_selectFullRange(){this._textRange={enable:!0,rangefrom:0,rangeTo:this.content.length},this._cursorOffset=this.content.length}_clearTextRange(){if(this._textRange.enable){const{rangefrom:t,rangeTo:e}=this._textRange,n=this.content,i=n.substring(0,t),s=n.substring(e);this.content=i+s,this._cursorOffset=i.length,this._textRange.enable=!1}}_getSelection(){if(this._textRange.enable){const{rangefrom:t,rangeTo:e}=this._textRange;return this.content.substring(t,e)}return null}_copy(t){const e=this._getSelection();e&&t.clipboardData.setData("text/plain",e)}_cut(t){const e=this._getSelection();e&&(t.clipboardData.setData("text/plain",e),this._clearTextRange(),this.refresh())}_paste(t){let e=(t.clipboardData||window.clipboardData).getData("text"),n=!1;if(this.dispatchEvent(new Jr("paste",{target:this,content:e,preventDefault(){n=!0},resolvePasteContent(t){e=t(e)}})),n)return;this._clearTextRange();const i=this._cursorOffset,s=this.content,r=s.substring(0,i),o=s.substring(i);this.content=r+e+o,this._cursorOffset=(r+e).length,this.refresh()}_defaultCallback(t,e){switch(t){case"KeyDown":this.dispatchEvent(new Jr("keydown",{target:this,key:e.key,code:e.code,rawEvent:e}));break;case"KeyUp":this.dispatchEvent(new Jr("keyup",{target:this,key:e.key,code:e.code,rawEvent:e}))}}destroy(){this._jflow._focus.instance===this&&this._jflow.blur()}},_o=class extends eo{constructor(t){super(t),this.image=t.image,this.image.onload=()=>{this._jflow._render()},this.imageBounding={width:t.imageWidth||t.width,height:t.imageHeight||t.height}}setConfig(t){Object.keys(t).forEach((e=>{void 0!==t[e]&&null!==t[e]&&(this[e]=t[e],this._rawConfigs[e]=t[e])})),t.image&&!t.image.complete&&(this.image.onload=()=>{this._jflow._render()}),this.imageBounding={width:t.imageWidth||t.width||this.imageBounding.width,height:t.imageHeight||t.height||this.imageBounding.height}}render(t){t.save(),this._isMoving&&(t.globalAlpha=.6),eo.prototype.render.call(this,t);const e=this.anchor[0]-this.width/2,n=this.anchor[1]-this.height/2;this.opacity<1&&(t.globalAlpha=this.opacity),this.image.complete&&t.drawImage(this.image,e,n,this.imageBounding.width,this.imageBounding.height),t.restore()}},vo=class extends eo{constructor(t){super(t),this.domFactory=t.createDocument,this._dom=null}getRealWorldPosition(){const t=this.getBoundingRect();return this.calculateToRealWorld(t.slice(0,2))}render(t){if(!this._dom&&this.domFactory)requestAnimationFrame((()=>{if(!this._dom){const t=document.createElement("div"),e=this.getRealWorldPosition(),n=this._jflow.scale;t.setAttribute("style",`\n                        position: absolute;\n                        width: ${this.width}px;\n                        height: ${this.height}px;\n                        transform-origin: left top;\n                        top: 0;\n                        left: 0;\n                        transform: translate(${e[0]}px, ${e[1]}px) scale(${n});`),this._dom=t,this._jflow.DOMwrapper.appendChild(t),this.domFactory(t)}}));else{const t=this.getRealWorldPosition(),e=this._jflow.scale;this._dom.style.transform=`translate(${t[0]}px, ${t[1]}px) scale(${e})`}super.render(t)}onEnterViewbox(){this._dom&&(this._dom.style.display="block")}onLeaveViewbox(){this._dom&&(this._dom.style.display="none")}destroy(){this._dom&&this._jflow.DOMwrapper.removeChild(this._dom),super.destroy()}},yo=class extends uo{constructor(t){super(t),this.fontFamily=t.fontFamily="-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Tahoma,Arial,Noto Sans,PingFang SC,Microsoft YaHei,Hiragino Sans GB,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji",this.fontSize=t.fontSize||"12px",this.content=t.content||"",this.lineDash=t.lineDash,this.approximate=t.approximate||6,this._cacheAngle=void 0,this._cachePoints=[],this._cacheBoundingbox={from:[],to:[]}}_calculateAnchorPoints(){const t=this.from.calculateIntersection(this.to.getCenter()),e=this.to.calculateIntersection(this.from.getCenter());this._cachePoints[0]=t,this._cachePoints[1]=e;const n=e[0]-t[0],i=e[1]-t[1],s=Math.atan2(i,n);this._cacheAngle=s}isInViewBox(t){const e=this.from.getBoundingRect(),n=this.to.getBoundingRect(),i=this._cacheBoundingbox;return Or(i.from,e)&&!Or(i.to,n)||(Ir(i.from,e),Ir(i.to,n),this._calculateAnchorPoints()),!0}render(t){const[e,n]=this._cachePoints,i=this._cacheAngle,s=n[0]-e[0],r=n[1]-e[1];if(t.fillStyle=t.strokeStyle=this.backgroundColor,t.beginPath(),this.content){t.textAlign="center",t.font=`${this.fontSize} ${this.fontFamily}`,t.textBaseline="middle";const{actualBoundingBoxLeft:i,actualBoundingBoxRight:o,fontBoundingBoxAscent:a,fontBoundingBoxDescent:h}=t.measureText(this.content),c=s/2+e[0],l=r/2+e[1];t.fillText(this.content,c,l);const u=Math.abs(i)+Math.abs(o)+20,d=1.5*(Math.abs(a)+Math.abs(h));t.beginPath();let f=new Path2D;f.rect(c-u/2,l-d/2,u,d);const p=Math.min(n[0],e[0])-10,g=Math.min(n[1],e[1])-10,m=Math.abs(s)+20,_=Math.abs(r)+20;f.rect(p,g,m,_),t.clip(f,"evenodd")}t.moveTo(e[0],e[1]),t.lineTo(n[0],n[1]),this.lineDash&&(t.save(),t.setLineDash(this.lineDash)),t.stroke(),this.lineDash&&t.restore(),t.translate(n[0],n[1]),t.rotate(i),t.moveTo(0,0),t.lineTo(-5,-4),t.lineTo(-5,4),t.lineTo(0,0),t.fill(),t.rotate(-i),t.translate(-n[0],-n[1])}isHit(t){if(!this._cachePoints)return!1;const[e,n]=this._cachePoints;return yr(t,e,n)<this.approximate}},bo=Math.PI/180;class wo extends uo{constructor(t){super(t),this.approximate=t.approximate||6,this.radius=t.radius||0,this.minSpanX=t.minSpanX||10,this.minSpanY=t.minSpanY||10,this.lineDash=t.lineDash,this.doubleLink=t.doubleLink,this.fontFamily=t.fontFamily="-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Tahoma,Arial,Noto Sans,PingFang SC,Microsoft YaHei,Hiragino Sans GB,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji",this.fontSize=t.fontSize||"12px",this.content=t.content||"",this.isSelf=!!t.isSelf,this.noArrow=!!t.noArrow,this._cacheAngle=[],this._cachePoints=[],this._cacheBoundingbox={from:[],to:[]}}_calculateAnchorPoints(){const t=this.from.getIntersectionsInFourDimension(),e=this.to.getIntersectionsInFourDimension(),n=this._cacheAngle;if(this.isSelf)Sr(this._cachePoints,t[this.fromDir],e[pr.SELF],this.fromDir,this.toDir,this.minSpanX,this.minSpanY,!0),n[0]=this.fromDir,n[1]=this.toDir;else if(void 0!==this.fromDir&&void 0!==this.toDir)Sr(this._cachePoints,t[this.fromDir],e[this.toDir],this.fromDir,this.toDir,this.minSpanX,this.minSpanY),n[0]=this.fromDir,n[1]=this.toDir;else{const i=br(t,e);Sr(this._cachePoints,i.fromP,i.toP,i.fromDir,i.toDir,this.minSpanX,this.minSpanY),n[0]=i.fromDir,n[1]=i.toDir}}isInViewBox(t){return!!this._static||(this._calculateAnchorPoints(),function(t,e){let n=t[0],i=t.length,s=1;const[r,o,a,h]=e;for(;s<i;){const e=t[s];if(n[0]===e[0]){if(n[0]<a&&n[0]>r&&!(n[1]>h&&e[1]>h||n[1]<o&&e[1]<o))return!0}else if(n[1]<h&&n[1]>o&&!(n[0]>a&&e[0]>a||n[0]<r&&e[0]<r))return!0;n=e,s++}return!1}(this._cachePoints,t))}render(t){const e=this.radius,n=this._cachePoints,i=n[0],s=n[n.length-1],r=(this._cacheAngle[1]+2)%4*90*bo;if(t.fillStyle=t.strokeStyle=this.backgroundColor,this.doubleLink){const e=(this._cacheAngle[0]+2)%4*90*bo;t.beginPath(),t.translate(i[0],i[1]),t.rotate(e),t.moveTo(5,0),t.lineTo(0,-4),t.lineTo(0,4),t.lineTo(5,0),t.fill(),t.rotate(-e),t.translate(-i[0],-i[1])}if(t.beginPath(),t.moveTo(i[0],i[1]),n.slice(1,n.length-1).forEach(((i,s)=>{if(this.radius){const r=n[s],o=n[s+2],{p1:a,p2:h}=function(t,e,n,i){const s=Cr(e,t),r=Cr(e,n),o=Er(s),a=Er(r);if(!o||!a)return{p1:null,p2:null};const h=Tr(s,i/o),c=Tr(r,i/a);return{p1:Cr(e,h),p2:Cr(e,c)}}(r,i,o,e);a&&h?(t.lineTo(a[0],a[1]),t.quadraticCurveTo(i[0],i[1],h[0],h[1])):t.lineTo(i[0],i[1])}else t.lineTo(i[0],i[1])})),t.lineTo(s[0],s[1]),this.lineDash&&(t.save(),t.setLineDash(this.lineDash)),t.stroke(),this.lineDash&&t.restore(),this.noArrow||(t.beginPath(),t.translate(s[0],s[1]),t.rotate(r),t.moveTo(0,0),t.lineTo(-5,-4),t.lineTo(-5,4),t.lineTo(0,0),t.fill(),t.rotate(-r),t.translate(-s[0],-s[1])),this.content)switch(t.beginPath(),t.font=`${this.fontSize} ${this.fontFamily}`,this.fromDir){case pr.BOTTOM:t.textAlign="left",t.fillText(this.content,i[0]+2,i[1]+10);break;case pr.RIGHT:t.textAlign="left",t.fillText(this.content,i[0]+10,i[1]-2)}}isHit(t){if(this._static)return!1;if(!this._cachePoints)return!1;const e=this._cachePoints;let n=e[0];const i=e.slice(1);do{const e=i.shift();if(e&&yr(t,n,e)<this.approximate)return!0;n=e}while(n);return!1}cloneStatic(){const t=new wo({});return Object.assign(t,{radius:this.radius,_cachePoints:this._cachePoints,_cacheAngle:this._cacheAngle,backgroundColor:this.backgroundColor,doubleLink:this.doubleLink,radius:this.radius,lineDash:this.lineDash,noArrow:this.noArrow,content:this.content,fontSize:this.fontSize,fontFamily:this.fontFamily,fromDir:this.fromDir,_static:!0}),t}}const xo=wo,ko=Math.PI/180,So=class extends uo{constructor(t){super(t),this.approximate=t.approximate||6,this.minSpanX=t.minSpanX||0,this.minSpanY=t.minSpanY||0,this.lineDash=t.lineDash,this.doubleLink=t.doubleLink,this.fontFamily=t.fontFamily="-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Tahoma,Arial,Noto Sans,PingFang SC,Microsoft YaHei,Hiragino Sans GB,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji",this.fontSize=t.fontSize||"12px",this.content=t.content||"",this.isSelf=!!t.isSelf}_calculateAnchorPoints(){const t=this.from.getIntersectionsInFourDimension(),e=this.to.getIntersectionsInFourDimension();if(this.isSelf){const n=xr(t[this.fromDir],e[pr.SELF],this.fromDir,pr.BOTTOM,this.minSpanX,this.minSpanY);this._cachePoints=[...t[this.fromDir],...n],this._cacheAngle=[this.fromDir,pr.BOTTOM]}else if(void 0!==this.fromDir&&void 0!==this.toDir){const n=xr(t[this.fromDir],e[this.toDir],this.fromDir,this.toDir,this.minSpanX,this.minSpanY);this._cachePoints=[...t[this.fromDir],...n],this._cacheAngle=[this.fromDir,this.toDir]}else{const n=br(t,e),i=xr(n.fromP,n.toP,n.fromDir,n.toDir);this._cachePoints=[...n.fromP,...i],this._cacheAngle=[n.fromDir,n.toDir]}}render(t){this._calculateAnchorPoints();const e=this._cachePoints,n=kr.apply(null,[1,...e]);if(t.fillStyle=t.strokeStyle=this.backgroundColor,this.doubleLink){const n=(this._cacheAngle[0]+2)%4*90*ko;t.beginPath(),t.translate(e[0],e[1]),t.rotate(n),t.moveTo(5,0),t.lineTo(0,-4),t.lineTo(0,4),t.lineTo(5,0),t.fill(),t.rotate(-n),t.translate(-e[0],-e[1])}if(t.beginPath(),t.moveTo(e[0],e[1]),t.bezierCurveTo(...e.slice(2)),this.lineDash&&(t.save(),t.setLineDash(this.lineDash)),t.stroke(),this.lineDash&&t.restore(),t.beginPath(),t.translate(e[6],e[7]),t.rotate(n),t.moveTo(5,0),t.lineTo(0,-4),t.lineTo(0,4),t.lineTo(5,0),t.fill(),t.rotate(-n),t.translate(-e[6],-e[7]),this.content){t.beginPath();const n=e[0]>e[6];let[i,s,r]=function(t,e){const n=.5,i=.125*e[0]+.375*e[2]+.375*e[4]+.125*e[6],s=.125*e[1]+.375*e[3]+.375*e[5]+.125*e[7],r=n*n*(e[2]-e[0])+.5*(e[4]-e[2])+t*t*(e[6]-e[4]),o=n*n*(e[3]-e[1])+.5*(e[5]-e[3])+t*t*(e[7]-e[5]);return[i,s,Math.atan2(o,r)]}(.5,e);t.translate(i,s),t.rotate(r),n&&t.rotate(Math.PI),t.font=`${this.fontSize} ${this.fontFamily}`,t.textAlign="center",t.fillText(this.content,0,-(parseInt(this.fontSize)||12)/4),n&&t.rotate(Math.PI),t.rotate(-r),t.translate(-i,-s)}}isHit(t){if(!this._cachePoints)return!1;const e=function(t,e){const n=new fr(...e).project({x:t[0],y:t[1]});return vr(t,[n.x,n.y])}(t,this._cachePoints);return e<this.approximate}};class Co{constructor(t={}){this.direction=t.direction||"vertical",this.gap=t.gap??5,this.alignment=t.alignment||"center",this.justify=t.justify||"center",this._rawConfigs=t}reflow(t){const e=t._stack.filter((t=>t.visible&&!t.absolutePosition)),n=t._stack.filter((t=>t.visible&&t.absolutePosition)),i=t.width-t.padding.left-t.padding.right;if("vertical"===this.direction){let s=0,r=0,o=0,a=0;const h=e.concat(n);h.forEach(((t,e)=>{"block"===t.display&&(t.width=0,t.resetChildrenPosition(),t.reflow(),t._getBoundingGroupRect())})),e.forEach(((t,e)=>{const{width:n,height:i}=t.getBoundingDimension(),h=e>0?this.gap:0;"outstretch"!==t.display&&(o=Math.max(n,o)),a+=i+h,s+=i/2+h+r,r=i/2,t.anchor=[0,s]})),h.forEach(((e,n)=>{if("block"===e.display)e.resetChildrenPosition(),e.width=o,e.reflow();else if("outstretch"===e.display){const n=t._belongs.width-t._belongs.padding.left-t._belongs.padding.right;e.resetChildrenPosition(),e.width=Math.max(n,o),e.reflow()}})),o=Math.max(i,o),a/=2,"start"===this.alignment&&e.forEach(((t,e)=>{const{width:n}=t.getBoundingDimension();t.anchor[0]=-(o-n)/2,t.anchor[1]-=a})),"end"===this.alignment&&e.forEach(((t,e)=>{const{width:n}=t.getBoundingDimension();t.anchor[0]=(o-n)/2,t.anchor[1]-=a})),"center"===this.alignment&&e.forEach(((t,e)=>{const{width:n}=t.getBoundingDimension();t.anchor[1]-=a}))}if("horizontal"===this.direction){let t=0,n=0,s=0,r=0,o=0;if(e.forEach(((e,i)=>{const{width:a,height:h}=e.getBoundingDimension(),c=i>0?this.gap:0;s=Math.max(h,s),r+=a+c,o+=a,t+=a/2+c+n,n=a/2,e.anchor=[t,0]})),"start"===this.justify){const t=i/2;e.forEach(((e,n)=>{e.anchor[0]-=t}))}if("end"===this.justify){const t=i/2-r;e.forEach(((e,n)=>{e.anchor[0]+=t}))}if("center"===this.justify){const t=r/2;e.forEach(((e,n)=>{e.anchor[0]-=t}))}if("space-between"===this.justify&&e.length>1){const t=Math.max(i,r),n=(t-r)/(e.length-1),s=t/2;e.forEach(((t,e)=>{t.anchor[0]+=n*e-s}))}"start"===this.alignment&&e.forEach(((t,e)=>{const{height:n}=t.getBoundingDimension();t.anchor[1]=-(s-n)/2})),"end"===this.alignment&&e.forEach(((t,e)=>{const{height:n}=t.getBoundingDimension();t.anchor[1]=(s-n)/2}))}if(n.length){"block"===t.display?t.getBoundingDimension():t._getBoundingGroupRect();const e=t.width/2,i=t.height/2,s=(t.padding.top-t.padding.bottom)/2,r=(t.padding.left-t.padding.right)/2;n.forEach((t=>{t.anchor=this._resolveAbsoluteAnchor(t.absolutePosition,t,e,i,r,s)}))}}_resolveAbsoluteAnchor(t,e,n,i,s,r){const{top:o,right:a,bottom:h,left:c,centerX:l,centerY:u}=t,{width:d,height:f}=e.getBoundingDimension(),p=d/2,g=f/2;let m=0,_=0;return"number"==typeof o&&(m=o+g-i-r),"number"==typeof a&&(_=n-a-p-s),"number"==typeof h&&(m=i-h-g-r),"number"==typeof c&&(_=c+p-n-s),"number"==typeof l&&(_=l),"number"==typeof u&&(m=u),[_,m]}clone(){return new Co(this._rawConfigs)}}const Eo=Co,To="input",Bo="control",Oo="input",Io="compositionstart",jo="compositionupdate",Lo="compositionend",Po="enter",Mo="delete",Ro="backspace",Ao="arrowLeft",Do="arrowRight",$o="arrowUp",No="arrowDown",Fo="undo",Vo="redo",Wo="shift_down",Ho="shift_up",zo="ctrla",Xo="startedit",Yo="editclick",Go="shiftonclick",Uo="doubleclick";class qo extends EventTarget{_inputElement=null;constructor(t){super(),this._inputElement=function(t){const e=document.createElement("input");e.setAttribute("style","\n        width: 100px;\n        position: absolute;\n        left: 0;\n        top: 0;\n        border:none;\n        opacity: 0;\n        z-index: -1;\n        contain: strict;"),e.setAttribute("tabindex",-1),e.setAttribute("aria-hidden",!0),e.setAttribute("spellcheck",!1),e.setAttribute("autocorrect","off");let n=!1,i={ctrlOn:!1,shiftOn:!1};return e.addEventListener("beforeinput",(e=>{e.preventDefault(),e.data&&(n||t(Oo,e.data))})),e.addEventListener("compositionstart",(e=>{t(Io),n=!0})),e.addEventListener("compositionupdate",(e=>{t(jo,e.data)})),e.addEventListener("compositionend",(i=>{t(Lo,i.data),e.value="",n=!1})),e.addEventListener("keyup",(e=>{if(!n)switch(e.key){case"Shift":t(Ho),i.shiftOn=!1;break;case"Meta":case"Control":i.ctrlOn=!1}})),e.addEventListener("keydown",(e=>{if(!n){switch(e.code){case"Enter":t(Po);break;case"Backspace":t(Ro);break;case"Delete":t(Mo);break;case"ArrowLeft":t(Ao);break;case"ArrowRight":t(Do);break;case"ArrowDown":t(No);break;case"ArrowUp":t($o)}switch(e.key){case"Shift":t(Wo),i.shiftOn=!0;break;case"Meta":case"Control":i.ctrlOn=!0;break;case"a":i.ctrlOn&&t(zo);break;case"c":i.ctrlOn&&t("ctrlc");break;case"v":i.ctrlOn&&t("ctrlv");break;case"x":i.ctrlOn&&t("ctrlx");break;case"y":i.ctrlOn&&(e.preventDefault(),t(Vo));break;case"z":i.ctrlOn&&i.shiftOn?t(Vo):i.ctrlOn&&t(Fo)}}})),e}(this.controlCallback.bind(this)),t.append(this._inputElement),this._inputElement.focus()}controlCallback(t,e){switch(t){case Oo:case Io:case jo:case Lo:case Po:case Ro:case Mo:this.dispatchEvent(new CustomEvent(To,{detail:{kind:t,data:e}}));break;case Ao:case Do:case $o:case No:case zo:case Wo:case Ho:case Fo:case Vo:this.dispatchEvent(new CustomEvent(Bo,{detail:{kind:t}}))}}focus(){this._inputElement.focus({preventScroll:!0})}syncPosition(t,e){this._inputElement.style.transform=`translate(${t}px, ${e}px)`}destroy(){this._inputElement.remove()}}const Jo=qo;class Ko{_lines=[];get(t){return this._lines[t]}getLineAbove(t){let e=0;const n=this._lines;for(;e<n.length&&!(n[e].reduceHeight>t);)e++;return Math.min(e,n.length-1)}truncate(t){const e=Zo.create(t);return this._lines=[e],e}push(t){this._lines.push(t)}forEach(t){this._lines.forEach(t)}length(){return this._lines.length}}class Zo{width=0;anchorY=0;height=0;reduceHeight=0;_elements=[];static create(t){return new Zo(t)}constructor(t={}){Object.assign(this,t)}_elements=[];get(t){return this._elements[t]}length(){return this._elements.length}insert(t,e){this._elements.splice(t,0,e)}push(t){this._elements.push(t)}tail(){return this._elements[this._elements.length-1]}copy(){return this._elements.slice()}getColumnNearest(t,e,n,i){const s=this._elements;if(t>=this.width){const t=s.length-1,e=s[t];let n=0;return"text"===e.type&&(n=e.source.length),[t,n]}{let r=0,o=0,a=0,h=null;for(;r<s.length-1;){o=a;const n=s[r];if("text"!==n.type){const t=h&&"text"===h.type?2*e:e;a+=n.width+t}else a+=n.width;if(a>t){h=n;break}h=n,r++}a<=t&&(o=a);const c=s[r];if("text"===c.type){const e=function(t,e,n,i){const s=e.source,r=s.length-1;if(0===e.width)return 0;const o=e.width;let a=Math.floor(t/o*r);return Vs((e=>{let h,c,l;e.font=`${n} ${i}`;let u=s.substring(0,a),d=s.substring(a-1,a),f=s.substring(a,a+1),p=e.measureText(u).width,g=e.measureText(d).width,m=e.measureText(f).width;h=p-g/2,c=p+m/2;do{if(h<=t&&c>=t)break;if(h>t){const n=c-t;l=a,a-=n<100?1:Math.floor(n/c*l),u=s.substring(a,l),p-=e.measureText(u).width}else if(c<t){const n=t-h;l=a,a+=n<100?1:Math.floor(n/(o-h)*(r-l)),u=s.substring(l,a),p+=e.measureText(u).width}d=s.substring(a-1,a),f=s.substring(a,a+1),g=e.measureText(d).width,m=e.measureText(f).width,h=p-g/2,c=p+m/2}while(a>=0&&a<=r)})),a}(t-o,c,n,i);return[r,e]}return t-o>h.width/2?[r+1,0]:[r,0]}}forEach(t){this._elements.forEach(t)}}class Qo{static create(t){const e=new Qo;return e.from(t),e}_textElements=[];_records=[];_caretRecord=null;insertBefore(t,e){const n=this.findIndex(t);this.inersetAt(n,e)}insertAfter(t,e){const n=this.findIndex(t);this.get(n+1)&&e.setNeedWrap(t.needWrap||t.isTail),this.inersetAt(n+1,e)}findIndex(t){return this._textElements.findIndex((e=>e===t))}get(t){return this._textElements[t]}from(t){this._textElements=t}inersetAt(t,e){this.splice(t,0,e)}push(t){this.splice(this.length(),0,t)}remove(t){this.splice(t,1)}splice(){const t=this._textElements.splice(...arguments);this._records.push({op:"splice",args:arguments,removed:t})}copy(){return this._textElements.slice()}isEmpty(){return 1===this._textElements.length&&""===this._textElements[0].source}forEach(t){this._textElements.forEach(t)}tail(){return this._textElements[this._textElements.length-1]}filter(t){return this._textElements.filter(t)}length(){return this._textElements.length}startRecord(){return this._caretRecord={before:null,after:null},this._records=[],this._records}getRecord(){return this._records}recordBeforeCaret(t){this._caretRecord.before=t.toRange()}recordAfterCaret(t){this._caretRecord.after=t.toRange()}getCaretRecord(){return this._caretRecord}collectRecords(){return this._records}}class ta{needWrap=!1;width=0;reduceWidth=0;height=0;anchorX=0;anchorY=0;dirty=!0;isTail=!1;constructor(t,e){this.type=t,this.source=e}setSource(t,e){const n=this.source;this.source=t,this.dirty=!0,e&&e.push({op:"setSource",args:[this,t,n]})}setNeedWrap(t,e){const n=this.needWrap;this.needWrap=t,n!==t&&e&&e.push({op:"setNeedWrap",args:[this,t,n]})}shift(t,e){if("text"===this.type){const n=this.source.length,i=t+e;return i<0?"prev":i>n?"next":"self"}return e>0?"next":e<0?"prev":void 0}tailOffset(){return"text"===this.type?this.needWrap||this.isTail?this.source.length:Math.max(0,this.source.length-1):0}headOffset(){return 0}}function ea(t){return 1===t.length&&"setSource"===t[0].op}class na{static length=50;_undo=[];_redo=[];_editor=null;write(t,e){if(0===t.length)return;if(ea(t)){const n=t[0],i=this.getLastUndo();if(i&&ea(i._batch)){const t=i._batch[0];if(t.args[0]===n.args[0])return t.args[1]=n.args[1],void(i._caretMetaTo=e.after)}}const n=new ia(t);n._caretMetaFrom=e.before,n._caretMetaTo=e.after,this._undo.push(n),this._undo.length>na.length&&this._undo.splice(0,1),this._redo.length&&(this._redo=[])}getLastUndo(){return this._undo[this._undo.length-1]}undo(){const t=this._undo.pop();return t&&(t.undo(this._editor),this._redo.push(t)),t}redo(){let t=this._redo.pop();for(;t&&t.SKIP_REDO;)t=this._redo.pop();return t&&(t.redo(this._editor),this._undo.push(t)),t}}class ia{_batch=[];_caretMetaFrom=null;_caretMetaTo=null;constructor(t){this._batch=t}updateCaretMetaTo(t){this._caretMetaTo=t}undo(t){this._batch.slice().reverse().forEach((e=>{switch(e.op){case"range":const[n,i]=e.args,s=t._range;s.setInitialRange(n),s.setRange(i),s.enable();break;case"setSource":const[r,o,a]=e.args;r.source=a,r.dirty=!0;break;case"setNeedWrap":const[h,c,l]=e.args;h.needWrap=l,h.dirty=!0;break;case"splice":const u=t._flattenTxtElem,[d,f,...p]=e.args,g=e.removed;let m=0;p&&(m=p.length),u.splice(d,m,...g)}})),t._caret.fromRange(this._caretMetaFrom)}redo(t){this._batch.forEach((e=>{switch(e.op){case"setSource":const[n,i,s]=e.args;n.source=i,n.dirty=!0;break;case"setNeedWrap":const[r,o,a]=e.args;r.needWrap=o,r.dirty=!0;break;case"splice":t._flattenTxtElem.splice(...e.args)}})),t._caret.fromRange(this._caretMetaTo)}}const sa=class{static create(t){return new this(t)}constructor(t){this._editor=t}exec(){}};class ra extends sa{static name=Ao;exec(){const t=this._editor;t._range.disable();const e=t._flattenTxtElem,n=t._caret,i=n.getRow(),s=n.getColumn(),[r,o]=s,a=t._area.get(i),h=a.get(r),c=e.findIndex(h);switch(h.shift(o,-1)){case"prev":if(r>0){const t=a.get(r-1);n.setColumn([r-1,t.tailOffset()])}else if(c>0){const s=i-1,r=t._area.get(s).length()-1,o=e.get(c-1).tailOffset();n.setRow(s),n.setColumn([r,o])}break;case"self":n.setColumn(1,o-1)}n.refresh(),t.syncShadowInputPosition(),t._jflow._render()}}class oa extends sa{static name=Do;exec(){const t=this._editor;t._range.disable();const e=t._flattenTxtElem,n=t._caret,i=n.getRow(),s=n.getColumn(),[r,o]=s,a=t._area.get(i),h=a.get(r),c=e.findIndex(h);switch(h.shift(o,1,c===e.length()-1)){case"next":if(r<a.length()-1){const t=a.get(r+1);"text"===h.type&&"text"!==t.type?n.setColumn([r+2,t.headOffset()]):n.setColumn([r+1,t.headOffset()])}else if(c<e.length()-1){const t=i+1,s=e.get(c+1).headOffset();n.setRow(t),n.setColumn([0,s])}break;case"self":n.setColumn(1,o+1)}n.refresh(),t.syncShadowInputPosition(),t._jflow._render()}}class aa extends sa{static name=$o;exec(){this._editor._range.disable();const t=this._editor._caret.getRow()-1;t>-1&&this._handler(t)}}class ha extends sa{static name=No;exec(){this._editor._range.disable();const t=this._editor._caret.getRow()+1;t<this._editor._area.length()&&this._handler(t)}}const ca={_handler(t){const e=this._editor,n=e._caret,i=n.getRow(),s=n.getColumn(),[r,o]=s,a=e._area;let h=a.get(i).get(r),c=h.reduceWidth;o>0&&(c+=e.measureTextWidth(h.source.substring(0,o)));const l=a.get(t).getColumnNearest(c,e.elementSpace,e.fontSize,e.fontFamily);n.setRow(t),n.setColumn(l),n.refresh(),e.syncShadowInputPosition(),e._jflow._render()}};function la(t,e,n,i){if(!t)return[n,!1];if("text"===t.type&&"text"===e.type){const n=t.source.length;return t.setSource(t.source+e.source,i),t.setNeedWrap(e.needWrap,i),[n,!0]}return[n,!1]}Object.assign(aa.prototype,ca),Object.assign(ha.prototype,ca);class ua extends sa{static name=To;cacheIdx=null;exec(t,e){const n=this._editor,i=n._range,s=n._caret,r=n._flattenTxtElem,o=n._undoredo,a=r.startRecord();if(r.recordBeforeCaret(s),i.isEnable()&&(i.delete(n,a),t===Ro||t===Mo))return r.collectRecords(),r.recordAfterCaret(s),this._editor.refresh(),void o.write(a,r.getCaretRecord());const h=s.getRow();let[c,l]=s.getColumn();const u=n._area,d=u.get(h);let f=d.get(c),p=d.get(c-1),g="";if("text"===f.type)g=f.source;else if("text"===p?.type)g=p.source,f=p,l=g.length,s.setColumn([c-1,g.length]);else{const t=new ta("text","");r.insertBefore(f,t),f=t}let m,_=g.substring(0,l);switch(m=this.cacheIdx?g.substring(this.cacheIdx[1]):g.substring(l),t){case Oo:if(/\r?\n/.test(e)){let t=e.split(/\r?\n/);t=t.replace(/\t/,"");let n=r.findIndex(f),i=t.shift();f.setSource(_+i,a);let o=h+1;for(n++;t.length>1;){const e=new ta("text",t.shift());e.setNeedWrap(!0,a),o++,r.inersetAt(n,e),n++}i=t.shift();const c=r.get(n);if(c&&"text"===c.type)c.setSource(i+c.source,a);else{const t=new ta("text",i);r.inersetAt(n,t)}s.setRow(o),s.setColumn([0,i.length])}else _+=e,s.setColumn(1,s.getColumn(1)+e.length),f.setSource(_+m,a);break;case Io:this.cacheIdx=[_.length,_.length];break;case jo:_=_.substring(0,this.cacheIdx[0]),_+=e,f.setSource(_+m,a);const t=this.cacheIdx[0]+e.length;s.setColumn(1,t),this.cacheIdx[1]=t;break;case Lo:_=_.substring(0,this.cacheIdx[0]),s.setColumn(1,this.cacheIdx[0]+e.length),this.cacheIdx=null,_+=e,f.setSource(_+m,a);break;case Po:f.setSource(_,a),f.setNeedWrap(!0,a);const n=new ta("text",m);r.insertAfter(f,n),s.setRow(h+1),s.setColumn([0,0]);break;case Ro:switch(f.shift(l,-1)){case"prev":let t=r.findIndex(f);if(c>0){r.splice(t-1,1),t-=1;const[e,n]=la(r.get(t-1),f,0,a);n&&r.remove(t),s.setColumn([c-(e>0?2:1),e])}else if(t>0){const e=h-1,n=u.get(e).length()-1,[i,o]=la(r.get(t-1),f,0,a);o&&r.remove(t),s.setRow(e),s.setColumn([n,i])}break;case"self":_=_.substring(0,_.length-1),s.setColumn(1,s.getColumn(1)-1),f.setSource(_+m,a)}break;case Mo:switch(f.shift(l,1)){case"next":let t=r.findIndex(f);if(c<d.length()-1){r.splice(t+1,1);const e=r.get(t+1),[n,i]=la(f,e,f.source.length,a);i&&r.remove(t+1),s.setColumn([c,n])}else if(t<r.length()-1){const e=r.get(t+1),[n,i]=la(f,e,f.source.length,a);i&&r.remove(t+1),s.setColumn([c,n])}break;case"self":m=m.substring(1),f.setSource(_+m,a)}}r.collectRecords(),r.recordAfterCaret(s),o.write(a,r.getCaretRecord()),this._editor.refresh()}}class da extends sa{static name=Xo;exec(){const t=this._editor;if(!this._startEdit())return;const e=t._jflow;t.moveCaretByHitPoint(),t.createShadowInput(),t._caret.animate(e),t.syncShadowInputPosition()}_startEdit(){let t=!0;const e=this._editor;return e.dispatchEvent(new Jr("edit",{target:e,preventDefault(){t=!1}})),t}}class fa extends sa{static name=Yo;exec(){const t=this._editor;t.moveCaretByHitPoint(),t._caret.refresh(),t.syncShadowInputPosition(),t._range.disable()}}class pa extends sa{static name=Uo;exec(){const t=this._editor;t.moveCaretByHitPoint();const e=t._caret,n=t._range,i=t._area,s=e.getRow(),r=i.get(s),o=r.length()-1;n.setInitialRange([s,0,0]),n.setRange([s,o,r.tail().tailOffset()]),n.handleCaret(e),n.enable(),t.syncShadowInputPosition()}}class ga extends sa{static name=Ho;exec(){this._editor._range.setInitialRange(null),this._editor.toggleShift(!1)}}class ma extends sa{static name=Wo;exec(){const t=this._editor._range,e=this._editor._caret;t.setInitialRange(e.toRange()),this._editor.toggleShift(!0)}}class _a extends sa{static name=Go;exec(){const t=this._editor;t.moveCaretByHitPoint();const e=this._editor._caret,n=this._editor._range;n.setRange(e.toRange()),n.enable(),n.handleCaret(e),e.refresh(),t.syncShadowInputPosition()}}class va extends sa{static name=zo;exec(){const t=this._editor,e=t._caret,n=t._range,i=t._area,s=i.length()-1,r=i.get(s),o=r.length()-1;n.setInitialRange([0,0,0]),n.setRange([s,o,r.tail().tailOffset()]),n.handleCaret(e),n.enable(),t.syncShadowInputPosition()}}class ya extends sa{static name=Fo;exec(){this._editor._range.disable(),this._editor._undoredo.undo(),this._editor.refresh()}}class ba extends sa{static name=Vo;exec(){this._editor._range.disable(),this._editor._undoredo.redo(),this._editor.refresh()}}class wa extends Rr{get currentLineHeight(){return this.lineHeight||parseInt(this.fontSize)}constructor(t){super(t),this.initStack(t),this.initLayout(t),this._undoredo=new na,this._undoredo._editor=this,this._caret=new class{_row=0;_column=[0,0];_status={show:!0,anime:null,lastElapsed:0,refreshElapsed:!1};setRow(t){this._row=t}setColumn(t,e){void 0!==e?this._column[t]=e:this._column=t}getRow(){return this._row}getColumn(t){return void 0!==t?this._column[t]:this._column}animate(t){this._status.anime=t.requestJFlowAnime((t=>{const e=this._status.lastElapsed;this._status.refreshElapsed&&(this._status.lastElapsed=t,this._status.refreshElapsed=!1),t-e>500&&(this._status.show=!this._status.show,this._status.lastElapsed=t)}))}cancelAnimate(){this._status.anime.cancel(),Object.assign(this._status,{show:!0,anime:null,lastElapsed:0})}isShow(){return this._status.show}refresh(){Object.assign(this._status,{show:!0,refreshElapsed:!0})}toRange(){return[this._row,...this._column]}fromRange(t){this._row=t[0],this._column=t.slice(1)}},this._range=new class{_enable=!1;_rangeFrom=null;_rangeTo=null;_initialRange=null;setInitialRange(t){this._initialRange=t}getRangeFrom(){return this._rangeFrom}getRangeTo(){return this._rangeTo}isEnable(){return this._enable}enable(){this._enable=!0}disable(){this._enable=!1}handleCaret(t){const[e,n,i]=this._rangeTo;t.setRow(e),t.setColumn([n,i])}setRange(t){const e=this._initialRange;this._compareRange(e,t)?(this._rangeFrom=e,this._rangeTo=t):(this._rangeFrom=t,this._rangeTo=e)}_compareRange(t,e){return!(t[0]>e[0]||t[0]===e[0]&&t[1]>e[1]||t[0]===e[0]&&t[1]===e[1]&&t[2]>e[2])}delete(t,e){if(this._enable){const n=t._area,i=t._caret,s=this._rangeFrom,r=this._rangeTo,o=n.get(s[0]).get(s[1]),a=n.get(r[0]).get(r[1]);let[h,c,l]=s;if(e.push({op:"range",args:[s.slice(),r.slice()]}),o===a){const t=o.source;o.setSource(t.substring(0,s[2])+t.substring(r[2]),e),o.dirty=!0}else{const n=t._flattenTxtElem;let i,u,d="",f="";const p=n.findIndex(o),g=n.findIndex(a);let m=!1;if("text"===o.type?d=o.source.substring(0,s[2]):i=n.get(p-1),"text"===a.type?(f=a.source.substring(r[2]),m=a.needWrap):u=n.get(g-1),i)if(n.splice(p,g-p+1),"text"===i.type)i.needWrap?h-=1:c-=1,l=i.source.length,i.setSource(i.source+f,e),i.dirty=!0,i.setNeedWrap(m,e);else{const t=new ta("text",d+f);t.setNeedWrap(m,e),n.splice(p,0,t)}else if(n.splice(p,g-p),u){const t=new ta("text",d);n.splice(p,0,t)}else a.setSource(d+f,e),a.dirty=!0;0===n.length()&&n.push(new ta("text",""))}this.disable(),i.setRow(h),i.setColumn([c,l])}}},this._shadowInput=void 0,this.textColor=t.textColor||"transparent",this.fontFamily=t.fontFamily||"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Tahoma,Arial,Noto Sans,PingFang SC,Microsoft YaHei,Hiragino Sans GB,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji",this.fontSize=t.fontSize||"28px",this.fontWeight=t.fontWeight||"",this.elementSpace=t.elementSpace||5,this.lineSpace=t.lineSpace||5,this.placeholder=t.placeholder||"请输入",this.placeholderColor=t.placeholderColor||"#eee",this.cursorColor=t.cursorColor||"#60CFC4",this.textRangeColor=t.textRangeColor||"#4E75EC1A",this.minWidth=t.minWidth||0,this.resolver=()=>{const e=t.resolver();return 0!==e.length&&"text"===e[e.length-1].type||e.push(new ta("text","")),e},this._area=new Ko,this._flattenTxtElem=Qo.create(this.resolver()),this._status={editing:!1,dragover:!1},this.commands=new Map,this.registCommand(da),this.registCommand(fa),this.registCommand(ga),this.registCommand(ma),this.registCommand(_a),this.registCommand(ua),this.registCommand(ra),this.registCommand(oa),this.registCommand(aa),this.registCommand(ha),this.registCommand(va),this.registCommand(pa),this.registCommand(ya),this.registCommand(ba),this._makeFunctional(),this._cacheViewBox=[]}registCommand(t){this.commands.has(t.name)||this.commands.set(t.name,t.create(this))}_makeFunctional(){this.addEventListener("dblclick",(t=>{t.currentTarget===this&&(t.detail.bubbles=!1,this._status.editing&&this.execCommand(Uo))})),this.addEventListener("click",(t=>{if(t.currentTarget!==this)return;let e;t.detail.bubbles=!1,e=this._status.editing?this._status.shiftOn?Go:Yo:Xo,this.execCommand(e)})),this.addEventListener("blur",(t=>{this._status.editing=!1,this._shadowInput&&this._shadowInput.destroy(),this._belongs&&this._jflow._render(),this.dispatchEvent(new Jr("change",{target:this,textElements:this._flattenTxtElem.copy()})),this._range.disable(),this._caret.cancelAnimate()})),this.addEventListener("instancePressStart",(t=>{if(this._status.editing&&!this._status.shiftOn){t.detail.bubbles=!1,t.detail.preventDefault();const e=this._currentp,n=this._positionToCursorOffset(e),i=this._range;i.setInitialRange([n.row,...n.column]);const s=t.detail.jflow;let r=!1;const o=(t=>{this._status.editing=!1,r=!0;const{offsetX:e,offsetY:n}=t,o=s._calculatePointBack([e,n]);s._stack.checkHit(o);const a=this._currentp,h=this._positionToCursorOffset(a);i.setRange([h.row,...h.column]),i.enable()}).bind(this);document.addEventListener("pointermove",o),document.addEventListener("pointerup",(t=>{document.removeEventListener("pointermove",o),i.setInitialRange(null),r&&(i.handleCaret(this._caret),this._status.editing=!0,this._shadowInput.focus())}),{once:!0})}})),this.addEventListener("dragenter",(()=>{this.moveCaretByHitPoint(),this._status.dragover=!0})),this.addEventListener("dragover",(()=>{this.moveCaretByHitPoint()})),this.addEventListener("dragleave",(()=>{this._status.dragover=!1}));const t=(t=>{if(!this._status.dragover)return;t.detail.bubbles=!1,this._status.dragover=!1;const e=this._caret,n=e.getRow(),i=e.getColumn(),s=this._area.get(n);let[r,o]=i;const a=s.get(r),h=s.get(r-1);let c=this._flattenTxtElem,l=c.findIndex(a);"text"!==a.type&&"text"===h?.type&&(o=h.source.length,l=c.findIndex(h));const u=c.length();this.dispatchEvent(new Jr("insert",{...t.detail,type:t.type,textElements:c.copy(),idx:l,offset:o})),c=this._flattenTxtElem,this._status.editing&&(c.length()>u&&e.setColumn([r+c.length()-u,0]),this._shadowInput.focus()),this._status.editing&&this._caret.refresh(),this.syncShadowInputPosition(),this._range.disable()}).bind(this);this.addEventListener("pressEnd",t),this.addEventListener("drop",t)}toggleShift(t){this._status.shiftOn=t}execCommand(t){this.commands.get(t).exec()}createShadowInput(){const t=this._jflow;this._shadowInput=new Jo(t.DOMwrapper),this._shadowInput.addEventListener(Bo,(t=>{const e=t.detail.kind;this.execCommand(e)})),this._shadowInput.addEventListener(To,(t=>{const e=t.detail.kind,n=t.detail.data;this.commands.get(To).exec(e,n)})),this._status.editing=!0,t.setFocusInstance(this)}moveCaretByHitPoint(){const t=this._currentp,e=this._caret,{row:n,column:i}=this._positionToCursorOffset(t);e.setRow(n),e.setColumn(i)}refresh(){this.recalculateUp(),this.syncShadowInputPosition(),this._jflow._render()}refreshTextElements(){this._flattenTxtElem=Qo.create(this.resolver())}_positionToCursorOffset(t){const[e,n]=t,i=this._area,s=e+this.width/2,r=n+this.height/2,o=i.getLineAbove(r);return{row:o,column:i.get(o).getColumnNearest(s,this.elementSpace,this.fontSize,this.fontFamily)}}_caretToPosition(){const t=this._caret.getRow(),e=this._caret.getColumn(),n=this._area.get(t),[i,s]=e,r=n.get(i),o=this._flattenTxtElem.findIndex(r),a=this._flattenTxtElem.get(o-1);let h,c=this.currentLineHeight/2;if("text"===r.type){const t=r.source.substring(0,s);Vs((e=>{e.beginPath(),e.font=`${this.fontSize} ${this.fontFamily}`,h=r.anchorX-r.width/2+e.measureText(t).width}))}else h=r.anchorX-r.width/2,c=Math.max(c,r.height/2);return 0===s&&a&&"text"!==a.type&&(c=Math.max(c,a.height/2)),[h,c,n.anchorY,a,r]}syncShadowInputPosition(){if(this._status.editing){const[t,e,n]=this._caretToPosition(),i=this.calculateToRealWorld([t,n+e]),s=this._jflow.canvasMeta,r=Math.min(s.actual_width-120,i[0]);this._shadowInput.syncPosition(r,i[1]),this._shadowInput.focus()}}render(t){t.save(),this._isMoving?t.globalAlpha=.6:1!==this.opacity&&(t.globalAlpha=this.opacity);const[e,n]=this.anchor,i=this._jflow,s=this._area;t.translate(e,n);const r=this._flattenTxtElem;if(r.isEmpty())return t.beginPath(),t.font=`${this.fontWeight} ${this.fontSize} ${this.fontFamily}`,t.textAlign="center",t.textBaseline="middle",t.fillStyle=this.placeholderColor,t.fillText(this.placeholder,0,0),this._randerCursor(t),t.translate(-e,-n),void t.restore();t.beginPath(),t.font=`${this.fontWeight} ${this.fontSize} ${this.fontFamily}`,t.textAlign="center",t.textBaseline="middle",t.fillStyle=this.textColor,s.forEach((e=>{e.forEach((e=>{"text"===e.type&&t.fillText(e.source,e.anchorX,e.anchorY)}))})),r.forEach((e=>{if("text"!==e.type){const n=i.getRenderNodeBySource(e.source);n.visible&&(t.save(),n.render(t),t.restore())}})),this._randerCursor(t),this._renderRange(t),t.translate(-e,-n),t.restore()}_randerCursor(t){if(this._caret.isShow()&&(this._status.editing||this._status.dragover)){const[e,n,i]=this._caretToPosition();t.beginPath(),t.moveTo(e,i-n),t.lineTo(e,i+n),t.lineWidth=2,t.strokeStyle=this.cursorColor,t.stroke()}}_renderRange(t){const e=this._range;if(e.isEnable()){const n=this._area,i=this.textRangeColor,s=this.height,r=this.width,o=this.lineSpace,[a,h,c]=e.getRangeFrom(),[l,u,d]=e.getRangeTo();if(a===l){if(h===u&&c==d)return;const e=n.get(a);let r=a===n.length()-1?0:o;const l=e.reduceHeight-r-e.height-s/2,f=e.height,p=this._measureElementOffsetX(e.get(h),c,t),g=this._measureElementOffsetX(e.get(u),d,t);t.beginPath(),t.rect(p,l,g-p,f),t.fillStyle=i,t.fill()}else{let e=a,f=!0;for(;e<=l;){const a=n.get(e);let p=e===n.length()-1?0:o;const g=a.reduceHeight-p-a.height-s/2,m=a.height;if(f){const e=a.get(h),n=this._measureElementOffsetX(e,c,t),s=a.tail(),r=s.anchorX+s.width/2;t.beginPath(),t.rect(n,g,r-n,m),t.fillStyle=i,t.fill()}else if(e===l){const e=a.get(u),n=this._measureElementOffsetX(e,d,t);t.beginPath(),t.rect(-r/2,g,e.reduceWidth+(n-e.anchorX+e.width/2),m),t.fillStyle=i,t.fill()}else t.beginPath(),t.rect(-r/2,g,a.width,m),t.fillStyle=i,t.fill();f=!1,e++}}}}_measureElementOffsetX(t,e,n){return"text"!==t.type||0===e?t.anchorX-t.width/2:t.anchorX-t.width/2+n.measureText(t.source.substring(0,e)).width}measureTextWidth(t){let e;return Vs((n=>{n.font=`${this.fontSize} ${this.fontFamily}`,e=n.measureText(t).width})),e}getBoundingDimension(){return{width:this.width,height:this.height}}getBoundingRect(){const t=this.anchor,e=this.width/2,n=this.height/2,i=t[0]-e,s=t[1]-n,r=t[0]+e,o=t[1]+n,a=this._boundingrect;return a[0]=i,a[1]=s,a[2]=r,a[3]=o,a}_getViewBox(){const t=this._belongs.getCacheViewBox(),e=this._cacheViewBox;return this._calculatePointBackWithPoint(t[0],t[1],e,0,1),this._calculatePointBackWithPoint(t[2],t[3],e,2,3),this._cacheViewBox}getCacheViewBox(){return this._cacheViewBox}calculateToCoordination(t){const[e,n]=t,[i,s]=this.anchor,r=[e+i,n+s];return this._belongs&&this._belongs.calculateToCoordination?this._belongs.calculateToCoordination(r):r}calculateToRealWorld(t){const[e,n]=t,[i,s]=this.anchor,r=[e+i,n+s];if(this._belongs&&this._belongs.calculateToRealWorld)return this._belongs.calculateToRealWorld(r)}_calculatePointBack(t){const[e,n]=t,[i,s]=this.anchor;return[e-i,n-s]}_calculatePointBackWithPoint(t,e,n,i,s){n[i]=t-this.anchor[0],n[s]=e-this.anchor[1]}isHit(t,e){const n=this._calculatePointBack(t),i=this._jflow;this._currentp=n;let s=[];this._flattenTxtElem.forEach((t=>{if("text"!==t.type){const e=i.getRenderNodeBySource(t.source);e.visible&&s.push(e)}}));const r=this._stack.checkHit(n,e,(t=>s.includes(t)));if(r)return r;const o=this.anchor,a=this.width/2,h=this.height/2;return t[0]>o[0]-a&&t[0]<o[0]+a&&t[1]>o[1]-h&&t[1]<o[1]+h}clone(){return new fo({width:this.width,height:this.height,cache:t=>{const[e,n]=this.anchor;t.translate(-e+this.width/2,-n+this.height/2),this.render(t)}})}destroy(){this._jflow._focus.instance===this&&this._jflow.blur()}}Object.assign(wa.prototype,Vr),Object.assign(wa.prototype,Wr),Object.assign(wa.prototype,{_getBoundingGroupRect(){},resetChildrenPosition(){},reflow(){let t=this.currentLineHeight;const e=this._flattenTxtElem,n=this._area;if(e.isEmpty()){let i=0;const s=e.get(0);return Vs((t=>{t.font=`${this.fontSize} ${this.fontFamily}`,i=t.measureText(this.placeholder).width})),n.truncate({height:t,reduceHeight:t}).insert(0,s),Object.assign(s,{anchorX:-i/2,height:t,isTail:!0}),this.width=i,void(this.height=t)}const i=this._jflow;Vs((t=>{t.font=`${this.fontSize} ${this.fontFamily}`,e.forEach((e=>{"text"===e.type&&e.dirty&&(e.width=t.measureText(e.source).width,e.dirty=!1)}))}));const s=new Ko;s.truncate({height:t});let r=s.get(0),o=0,a=0,h=null;const c=this.lineSpace,l=this.elementSpace;e.forEach((e=>{if(r.push(e),e.reduceWidth=r.width,"text"===e.type)e.height=t,r.width+=e.width,e.needWrap&&(o+=r.height+c,r.reduceHeight=o,a=Math.max(r.width,a),r=Zo.create({height:t}),s.push(r));else{const t=i.getRenderNodeBySource(e.source);e.height=t.height,r.height=Math.max(r.height,t.height);const n=h&&"text"!==h.type?l:2*l;r.width+=t.width+n}h=e})),e.tail().isTail=!0,o+=r.height,r.reduceHeight=o,a=Math.max(this.minWidth,Math.max(r.width,a));const u=a/2;let d=-o/2,f=0;s.forEach((t=>{const{height:e,reduceHeight:n}=t,s=d+f+e/2;t.anchorY=s;let r=-u,o=null;t.forEach((t=>{if("text"===t.type)t.anchorY=s,t.anchorX=r+t.width/2,r+=t.width;else{const e=i.getRenderNodeBySource(t.source),n=!o||"text"===o.type,a=n?2*l:l;t.width=e.width,t.anchorY=s,t.anchorX=r+t.width/2+(n?a/2:0),e.anchor=[t.anchorX,t.anchorY],r+=t.width+a}o=t})),f=n})),this._area=s,this.width=a,this.height=o}});const xa=wa,ka=Qr(eo),Sa=Qr(no),Ca=Qr(so),Ea=Qr(ro,{shapeShift:(t,e)=>[t+.28865*e,e]}),Ta=Qr(class extends ro{constructor(t){super(t)}render(t){t.save(),this._isMoving&&(t.globalAlpha=.6),t.beginPath();const[e,n]=this.anchor,i=this.width/2,s=this.height/2,r=i/1.732,o=n-s,a=n+s,h=n-s+r,c=n+s-r,l=e-i,u=e+i;t.moveTo(e,o),t.lineTo(u,h),t.lineTo(u,c),t.lineTo(e,a),t.lineTo(l,c),t.lineTo(l,h),t.closePath(),t.fillStyle=this.backgroundColor,this.shadowColor&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),t.fill(),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor,t.stroke()),t.restore(),this._cachePoints=[[e,o],[u,h],[u,c],[e,a],[l,c],[l,h]]}},{shapeShift:(t,e)=>[t,e+.5773*t]}),Ba=Qr(io),Oa=Qr(to,{shapeShift(t,e,n){const i=Math.ceil(Math.sqrt(t*t+e*e)/2);n.radius=i;const s=2*i;return[s,s]}});class Ia extends EventTarget{constructor(t){super(),this.uniqueName="jflow",this.eventAdapter=new class{constructor(t={}){this.plugin=function(){let t={pointerDown:!1,dirty:!1};return{canvas:{wheel:function(t,e){t.preventDefault();let{offsetX:n,offsetY:i,deltaX:s,deltaY:r}=t;t.ctrlKey?(r=-r,e.zoomHandler(n,i,s,r,t)):e.panHandler(-s,-r,t)},pointerdown:function(e,n){const{offsetX:i,offsetY:s,deltaY:r,button:o}=e;0===o&&(t.pointerDown=!0,n.pressStartHandler(i,s,e))},pointermove:function(e,n){const{offsetX:i,offsetY:s}=e;t.pointerDown&&(t.dirty=!0),n.pressMoveHandler(i,s,e)},pointerup:function(e,n){e.preventDefault();const{offsetX:i,offsetY:s,button:r}=e;0===r&&t.pointerDown&&t.dirty&&(t.pointerDown=!1,t.dirty=!1,n.pressUpHanlder(!1,e))},contextmenu:function(t,e){t.preventDefault(),t.stopPropagation();const{offsetX:n,offsetY:i}=t;e.contextMenuHanlder(n,i,t)},dblclick:function(t,e){t.preventDefault(),t.stopPropagation();const{offsetX:n,offsetY:i}=t;e.dblclickHandler(n,i,t)},click:function(e,n){e.preventDefault(),e.stopPropagation();const{offsetX:i,offsetY:s}=e;t.dirty||(t.pointerDown=!1,t.dirty=!1,n.clickHanlder(i,s,e))}},document:{pointerup:function(t,e){e.pressUpHanlder(!0,t)}}}}(),this.use(t),this.canvasHandlers=[],this.documentHandlers=[]}use(t={}){const{canvas:e,document:n}=t;if(e)for(let t in e)e.hasOwnProperty(t)&&(this.plugin.canvas[t]=e[t]);if(n)for(let t in n)n.hasOwnProperty(t)&&(this.plugin.document[t]=n[t])}apply(t){const{canvas:e,document:n}=this.plugin,i=t.canvas;for(let n in e){const s=e[n];function r(e){s(e,t)}i.addEventListener(n,r),this.canvasHandlers.push({eventName:n,handlerWrapperd:r})}for(let e in n){let i,s={};function r(e){i(e,t)}"function"==typeof n[e]?i=n[e]:(i=n[e].handler,Object.assign(s,n[e].options)),document.addEventListener(e,r,s),this.documentHandlers.push({eventName:e,handlerWrapperd:r,options:s})}}unload(t){const e=t.canvas;this.canvasHandlers.forEach((({eventName:t,handlerWrapperd:n})=>{e.removeEventListener(t,n)})),this.documentHandlers.forEach((({eventName:t,handlerWrapperd:e,options:n})=>{console.log("unload",t),document.removeEventListener(t,e,n)}))}}(t.eventAdapter),this.initNodeWeakMap(),this.initAnime(),this.initStack(t),this.initLayout(t),this.ctx=null,this.canvas=null,this.dpr=1,this.padding=20,this.position=null,this.scale=null,this.initialZoom=t.initialZoom,this.initialPosition=t.setInitialPosition,this.maxZoom=t.maxZoom||3,this.minZoom=t.minZoom||.5,this.NodeRenderTop=!!t.NodeRenderTop,this.worldMargin=t.worldMargin,this.draggingbehavior=Object.assign({panInBorder:{enable:!0,padding:20,deltamovement:8,allowMovingTargetInPan:!0}},t.draggingbehavior||{}),this.scrollBarBehavior=Object.assign({enable:!0},t.scrollBarBehavior||{}),this.offeset=null,this._lastState={x:null,y:null,dragging:!1,processing:!1},this._lastDragState={target:null,targetLink:null,processing:!1},this._target={instance:null,link:null,moving:null,isInstanceDirty:!1,isLinkDirty:!1,cache:{stack:null,belongs:null,point:null},meta:{x:void 0,y:void 0,initialX:void 0,initialY:void 0},status:{dragovering:!1,dragging:!1,processing:!1,movingState:!1}},this._focus={instance:null},this._dragOverTarget=null,this.allowDrop=t.allowDrop,this._tempNode=null,this._tempLink=null,this.mode=gr.DEFAULT,this._allowMovingTarget=!0,this.canvasMeta={},this._cacheViewBox=[]}setMovingTargets(t){Object.assign(this._target,{moving:t})}setTempDraggingInstance(t){t._belongs=this,this._tempNode=t,Object.assign(this._target,{moving:[this._tempNode],dragging:!0})}removeTempDraggingInstance(){if(this._tempNode){const t=this._tempNode.anchor;return this._tempNode=null,t}}preventDefaultDragging(){this._allowMovingTarget=!1}allowDefaultDragging(){this._allowMovingTarget=!0}$mount(t){const{canvas:e,ctx:n,scale:i,width:s,height:r,raw_width:o,raw_height:a,left:h,top:c}=Ds(t);this.reflow(),this.ctx=n,this.DOMwrapper=t,this.canvas=e,this.canvas.setAttribute("data-jflow",!0),this.canvas.$jflow=this,this.canvasMeta={width:o,height:a,actual_width:s,actual_height:r},this.dpr=i,this._getBoundingGroupRect();const l=this.padding,{width:u,height:d,x:f,y:p}=this.bounding_box,g={x:l,y:l,width:s-2*l,height:r-2*l},m={x:0,y:0,offsetX:0,offsetY:0},_=g.width/u,v=g.height/d,y=_<=v?"x":"y";let b;b=this.initialZoom?this.initialZoom:Math.min(_,v),this.scale=b,b>this.maxZoom&&(this.maxZoom=b),b<this.minZoom&&(this.minZoom=b);const w=f*b,x=p*b,k=g.width,S=g.height;if(this.initialPosition){const{x:t,y:e}=this.initialPosition(w,x,k,S,g.x,g.y,s,r,f,p,u,d);m.x=t,m.y=e}else m.x="x"===y?g.x:(k-u*b)/2+l,m.y="y"===y?g.y:(S-d*b)/2+l;m.offsetX=m.x-w,m.offsetY=m.y-x,this.position=m,this._readyToRender=!0,this.scrollBarBehavior.enable&&this.initScrollBar(this.scrollBarBehavior),this.__render(),this._createEventHandler(),Ws((t=>{this.dpr=t,this.resizeCanvas(),this.scheduleRender()}),(t=>{this.destroyDprListener=t}))}setLinkingMode(t,e,n){const i=this.getRenderNodeBySource(t);this._tempNode=new Ar,this._tempLink=e(n?{from:this._tempNode,to:i}:{from:i,to:this._tempNode}),this.sendMessage({instance:t}),this.mode=gr.LINKING}isInLinkingMode(){return this.mode===gr.LINKING}setLinkingLink(t){this.mode===gr.LINKING&&this._tempLink.setConfig(t)}resetLinkingLink(){this.mode===gr.LINKING&&this._tempLink.setConfig({to:this._tempNode})}clearTemp(){this._tempNode&&(this._tempNode.destroy(),this._tempNode=null),this._tempLink&&(this._tempLink.destroy(),this._tempLink=null),this._render()}preventClearTemp(){this._preventClearTemp=!0}resizeCanvas(){if(this.canvas&&this.DOMwrapper){const{width:t,height:e,raw_width:n,raw_height:i}=function(t,e){const{width:n,height:i,left:s,top:r}=e.getBoundingClientRect();t.style.width=n+"px",t.style.height=i+"px";const o=window.devicePixelRatio;return t.width=Math.floor(n*o),t.height=Math.floor(i*o),{width:n,height:i,raw_width:t.width,raw_height:t.height}}(this.canvas,this.DOMwrapper);this.canvasMeta={width:n,height:i,actual_width:t,actual_height:e}}}setFocusInstance(t){this._focus.instance=t}focusOn(t){const e=this._calculatePointBack([this.canvasMeta.actual_width/2,this.canvasMeta.actual_height/2]);let n=t.anchor;t._belongs.calculateToCoordination&&(n=t._belongs.calculateToCoordination(n));const i=(e[0]-n[0])*this.scale,s=(e[1]-n[1])*this.scale;this._recalculatePosition(i,s),this._render()}_getBoundingGroupRect(){const t=this._stack.getBoundingRectPoints();if(this.bounding_box){this.bounding_box=mr(t);const{x:e,y:n}=this.bounding_box,i=this.scale;this.position.x=this.position.offsetX+e*i,this.position.y=this.position.offsetY+n*i}else this.bounding_box=mr(t)}_createEventHandler(){const t=this.canvas;let e;this.eventAdapter.apply(this);const n=()=>{this.eventAdapter.unload(this),this.destroyDprListener()};if(e=n,this.allowDrop){const i=this._onDragover.bind(this),s=this._onDrop.bind(this),r=this._onDragLeave.bind(this);t.addEventListener("dragstart",(t=>{t.preventDefault()})),t.addEventListener("dragover",i),t.addEventListener("drop",s),t.addEventListener("dragleave",r),e=()=>{n(),t.removeEventListener("dragover",i),t.removeEventListener("drop",s),t.removeEventListener("dragleave",r)}}this.destroy=e}_targetLockOn(t,e){let n=this._calculatePointBack(t);const i=n;this._currentp=n;let s=this._stack;const r=this._getViewBox(),o=s.checkHit(n,(t=>this._target.status.dragging&&t===this._getMovingTarget()),(t=>Br(r,t.getBoundingRect())));let a,h=this._linkStack;if(o&&o._belongs!==this||(a=h.checkHit(n,(t=>{if(!this._target.status.dragging)return!1;const e=this._getMovingTarget();return t.from===e||t.to===e}))),a||(a=h.checkHit(n,(t=>!t.ON_TOP))),Object.assign(this._target,{instance:o,link:a,isInstanceDirty:o===this._target.instance,isLinkDirty:a===this._target.link}),Object.assign(this._target.cache,{stack:s,belongs:this,point:n,topLayerPoint:i}),Object.assign(this._target.meta,{x:t[0],y:t[1]}),"pressStart"===e&&!this._target.status.dragging&&!this._target.status.dragovering){let t=o;for(;t&&t._belongs.lock&&t!==this;)t=t._belongs;this.setMovingTargets(t&&[t]),t&&o.bubbleEvent(new Jr("afterResolveMovingTarget",{event:e,target:t,jflow:this,bubbles:!0}))}return["pressStart","click","dblclick","contextclick"].includes(e)&&this._focus.instance&&this._focus.instance!==o&&(this._focus.instance.dispatchEvent(new Jr("blur",{relatedTarget:o})),this._focus.instance=null),this._target}blur(){this._focus.instance&&(this._focus.instance.dispatchEvent(new Jr("blur",{relatedTarget:null})),this._focus.instance=null)}_getMovingTarget(){return this._target.moving&&this._target.moving[0]}_processDragOver(t,e){if(this._dragOverTarget!==t){const n=this.readMessage()?.instance;this._dragCurrentData=n;const{point:i}=this._target.cache;if(this._dragOverTarget){const t=this._dragOverTarget;t.dispatchEvent(new Jr("dragleave",{event:e,instance:t,target:n,jflow:this,point:i}))}t&&t.dispatchEvent(new Jr("dragenter",{event:e,instance:t,target:n,jflow:this,point:i})),this._dragOverTarget=t}else this._dragOverTarget&&this._dragOverTarget.dispatchEvent(new Jr("dragover",{event:e,instance:t,jflow:this,target:this._dragCurrentData}));this._processPanInBorder()}_processPanInBorder(){if(this.draggingbehavior?.panInBorder?.enable&&(this.draggingbehavior.panInBorder.timer||(this.draggingbehavior.panInBorder.timer=Date.now()),Date.now()-this.draggingbehavior.panInBorder.timer>500)){const[t,e,n,i]=this._cacheViewBox,[s,r]=this._currentp,{padding:o,deltamovement:a}=this.draggingbehavior.panInBorder;let h=0,c=0;s<t+o&&(h=a),s>n-o&&(h=-a),r<e+o&&(c=a),r>i-o&&(c=-a),this.__processOverAnime&&this.__processOverAnime.cancel(),h||c?this.__processOverAnime=this.requestJFlowAnime((()=>{this.panHandler(h,c)})):this.draggingbehavior.panInBorder.timer=null}}_onDragover(t){if(t.preventDefault(),t.stopPropagation(),this._lastDragState.processing)return;this._lastDragState.processing=!0;const{offsetX:e,offsetY:n}=t;Object.assign(this._target.status,{dragovering:!0}),this._targetLockOn([e,n]);const i=this._target.instance||this._target.link;this._processDragOver(i,t),this._target.isLinkDirty||this._target.isInstanceDirty?Promise.resolve().then((()=>{this._render(),this._target.isLinkDirty=!1,this._target.isInstanceDirty=!1,this._lastDragState.processing=!1})):this._lastDragState.processing=!1}_cancelPanInBorder(){this.__processOverAnime&&this.__processOverAnime.cancel(),this.draggingbehavior?.panInBorder&&(this.draggingbehavior.panInBorder.timer=null)}_onDragLeave(){this._cancelPanInBorder()}_onDrop(t){this._cancelPanInBorder();const e=this.consumeMessage()?.instance;if(this._dragOverTarget){const e=this._dragOverTarget;e.dispatchEvent(new Jr("dragoverend",{event:t,instance:e})),this._dragOverTarget=null}const{link:n,instance:i}=this._target,{point:s,belongs:r}=this._target.cache;n?n.dispatchEvent(new Jr("drop",{event:t,instance:e,link:n,jflow:this,belongs:r,point:s})):i?i.bubbleEvent(new Jr("drop",{event:t,instance:e,jflow:this,target:i,point:s,bubbles:!0})):this.dispatchEvent(new Jr("drop",{event:t,instance:e,jflow:this,target:i,point:s})),requestAnimationFrame((()=>{this.cancelDrop()}))}cancelDrop(){this._target.instance=null,this._target.link=null,Object.assign(this._target.status,{dragovering:!1})}zoomHandler(t,e,n,i,s){if(this._zooming)return;this._zooming=!0;const{width:r,height:o,x:a,y:h}=this.bounding_box,{actual_width:c,actual_height:l}=this.canvasMeta;let u=this.minZoom;if(this.worldMargin){const t=this.worldMargin,e=r+2*t,n=o+2*t;u=Math.max(u,Math.max(c/e,l/n))}let d=this.scale;d*=i>0?1.05:1/1.05,d=Math.min(this.maxZoom,Math.max(u,d));var f=d-this.scale,p=r*this.scale,g=o*this.scale,m=r*f,_=o*f,v=-(t-this.position.x)/p,y=-(e-this.position.y)/g;this.scale=d,this._recalculatePosition(v*m,y*_),this.dispatchEvent(new Jr("zoompan",{deltaX:0,deltaY:0})),this.scheduleRender((()=>{this._zooming=!1}))}panHandler(t,e,n){if(this._panning)return;this._panning=!0;const{dragging:i}=this._target.status;if(i){const n=this._target.moving;n&&this.draggingbehavior.panInBorder.allowMovingTargetInPan&&n.forEach((n=>{n.anchor[0]+=-t/this.scale,n.anchor[1]+=-e/this.scale}))}this._recalculatePosition(t,e),this.dispatchEvent(new Jr("zoompan",{deltaX:t,deltaY:e})),this.scheduleRender((()=>{this._panning=!1}))}pressStartHandler(t,e,n){if(this.checkScrollDragging())return;Object.assign(this._target.meta,{initialX:t,initialY:e});const{link:i,instance:s}=this._targetLockOn([t,e],"pressStart");if(this.mode===gr.LINKING)return;if(Object.assign(this._target.status,{dragging:!0,processing:!1}),this._target.moving){const t=this._getMovingTarget();t.dispatchEvent(new Jr("pressStart",{event:n,instance:t,jflow:this}))}const r=this._resolveLockOnTarget(i,s);r&&r.bubbleEvent(new Jr("instancePressStart",{event:n,target:r,jflow:this,bubbles:!0,preventDefault:()=>{this._preventPressSequeence=!0,this._clearTarget(),document.addEventListener("pointerup",(t=>{t.preventDefault(),t.stopPropagation(),this._preventPressSequeence=!1}),{once:!0})}})),this._preventPressSequeence||this.dispatchEvent(new Jr("jflowPressStart",{event:n,jflow:this}))}pressMoveHandler(t,e,n){if(this._preventPressSequeence)return;if(this.checkScrollDragging())return;const{dragging:i,processing:s}=this._target.status,{x:r,y:o}=this._target.meta;if(!i){if(this.checkScrollBarHover(t,e))return;this.resetScrollBarHover()}if(!i&&!s){const{link:i,instance:s}=this._targetLockOn([t,e]),r=this._resolveLockOnTarget(i,s);if(r?r.bubbleEvent(new Jr("instancemousemove",{event:n,instance:r,jflow:this,bubbles:!0})):this.dispatchEvent(new Jr("instancemousemove",{event:n,instance:null,jflow:this})),this.mode===gr.LINKING)return this._tempNode.anchor=this._currentp,this.scheduleRender((()=>{this._target.isLinkDirty=!1,this._target.isInstanceDirty=!1,this._target.status.processing=!1})),void this._processPanInBorder()}if(this.dispatchEvent(new Jr("canvasmousemove",{event:n,jflow:this})),!i)return;if(s)return;const a=this._target.moving;this._target.status.movingState=!0,this._target.status.processing=!0;const h=t-r,c=e-o;a?this._allowMovingTarget&&a.forEach((t=>{t.anchor[0]+=h/this.scale,t.anchor[1]+=c/this.scale})):(this._recalculatePosition(h,c),this.dispatchEvent(new Jr("zoompan",{deltaX:h,deltaY:c})));const{instance:l,link:u}=this._targetLockOn([t,e]);this._processDragOver(l||u,n),this.scheduleRender((()=>{this._target.isLinkDirty=!1,this._target.isInstanceDirty=!1,this._target.status.processing=!1}))}pressUpHanlder(t,e){if(!this._preventPressSequeence){if(this.__processOverAnime&&this.__processOverAnime.cancel(),this._cancelPanInBorder(),this._target.meta,this.mode===gr.LINKING){const t=this._target.instance,n=this.consumeMessage();let i=!1;const s=()=>{i=!0};if(t)t.bubbleEvent(new Jr("link",{event:e,target:t,jflow:this,payload:n,bubbles:!0,link:this._tempLink,preventDefault:s}));else{const{offsetX:t,offsetY:i}=e;this.dispatchEvent(new Jr("link",{event:e,jflow:this,payload:n,anchor:this._calculatePointBack([t,i]),link:this._tempLink,preventDefault:s}))}if(i)return;return this._clearTarget(),this._preventClearTemp||(this._tempNode&&(this._tempNode.destroy(),this._tempNode=null),this._tempLink&&(this._tempLink.destroy(),this._tempLink=null)),this._preventClearTemp=!1,this.mode=gr.DEFAULT,void this._render()}if(this._target.moving){let t=!1;if(this._layout.static&&(t=this.staticCheck(this._getMovingTarget())),!t&&this._target.link){const{point:t,belongs:n}=this._target.cache,i=this._target.link,s=this._getMovingTarget();i.dispatchEvent(new Jr("drop",{event:e,instance:s,link:i,jflow:this,belongs:n})),this._target.link=null,this._target.instance=null}this._target.moving&&(this._target.instance?this._target.instance.bubbleEvent(new Jr("pressEnd",{event:e,instance:this._getMovingTarget(),jflow:this,target:this._target.instance,bubbles:!0})):this.dispatchEvent(new Jr("pressEnd",{event:e,instance:this._getMovingTarget(),jflow:this}))),this._target.moving=null,this.removeTempDraggingInstance(),this._render()}this._clearTarget()}}clickHanlder(t,e,n){const{link:i,instance:s,meta:r}=this._targetLockOn([t,e],"click");if(Math.abs(r.initialX-r.x)<1&&Math.abs(r.initialY-r.y)<1){if(n.target!==this.canvas)return this._clearTarget(),void Object.assign(this._target.meta,{initialX:void 0,initialY:void 0});const{topLayerPoint:t}=this._target.cache,e=this._resolveLockOnTarget(i,s);if(e){const i=e;i.bubbleEvent(new Jr("click",{event:n,jflow:this,target:i,topLayerPoint:t,bubbles:!0}))}else this.dispatchEvent(new Jr("click",{event:n,jflow:this,topLayerPoint:t}));this._clearTarget(),Object.assign(this._target.meta,{initialX:void 0,initialY:void 0})}}contextMenuHanlder(t,e,n){const{link:i,instance:s}=this._targetLockOn([t,e],"contextclick"),{topLayerPoint:r}=this._target.cache,o=this._resolveLockOnTarget(i,s);if(o){const t=o;t.bubbleEvent(new Jr("contextclick",{event:n,jflow:this,target:t,topLayerPoint:r,bubbles:!0}))}else this.dispatchEvent(new Jr("contextclick",{event:n,jflow:this,topLayerPoint:r}))}dblclickHandler(t,e,n){const{link:i,instance:s}=this._targetLockOn([t,e],"dblclick"),{topLayerPoint:r}=this._target.cache,o=this._resolveLockOnTarget(i,s);if(o){const t=o;t.bubbleEvent(new Jr("dblclick",{event:n,jflow:this,target:t,topLayerPoint:r,bubbles:!0}))}else this.dispatchEvent(new Jr("dblclick",{event:n,jflow:this,topLayerPoint:r}))}_resolveLockOnTarget(t,e){return t?.ON_TOP?t:e||t}_clearTarget(){Object.assign(this._target.meta,{x:void 0,y:void 0}),Object.assign(this._target.status,{dragging:!1,processing:!1,movingState:!1}),Object.assign(this._target,{instance:null,link:null,moving:null})}_recalculatePosition(t,e,n){const{x:i,y:s,width:r,height:o}=this.bounding_box,{actual_width:a,actual_height:h}=this.canvasMeta;if(void 0===n&&(n=this.scale),this.worldMargin){const c=this.worldMargin,l=(i+r+c)*n-a,u=(i-c)*n,d=i*n,f=this.position.x+t-d;this.position.offsetX=Math.min(Math.max(-l,f),-u),this.position.x=this.position.offsetX+d;const p=(s+o+c)*n-h,g=(s-c)*n,m=s*n,_=this.position.y+e-m;this.position.offsetY=Math.min(Math.max(-p,_),-g),this.position.y=this.position.offsetY+m}else this.position.x+=t,this.position.y+=e,this.position.offsetX=this.position.x-i*n,this.position.offsetY=this.position.y-s*n}calculateToRealWorld(t){const e=this.scale,n=this.position;return[t[0]*e+n.offsetX,t[1]*e+n.offsetY]}_calculatePointBack(t){const e=this.scale,n=this.position;return[(t[0]-n.offsetX)/e,(t[1]-n.offsetY)/e]}_calculatePointBackWithPoint(t,e,n,i,s){const r=this.scale,o=this.position;n[i]=(t-o.offsetX)/r,n[s]=(e-o.offsetY)/r}_calculateDistance(t){return this.scale*t}_resetTransform(){const{width:t,height:e}=this.canvasMeta,n=this.position,i=this.scale,s=this.ctx;s.setTransform(),s.clearRect(0,0,t,e),s.scale(this.dpr,this.dpr),s.transform(i,0,0,i,n.offsetX,n.offsetY)}resetTransform(t){const e=this.position,n=this.scale;t.setTransform(),t.scale(this.dpr,this.dpr),t.transform(n,0,0,n,e.offsetX,e.offsetY)}_getViewBox(){const t=this._cacheViewBox;return this._calculatePointBackWithPoint(0,0,t,0,1),this._calculatePointBackWithPoint(this.canvasMeta.actual_width,this.canvasMeta.actual_height,t,2,3),t}setNodeToTopLayer(t){const e=this._stack.findIndex((e=>e===t));if(-1!==e){const[t]=this._stack.splice(e,1);this._stack.push(t)}}getCacheViewBox(){return this._cacheViewBox}_render(){this.scheduleRender()}__render(){if(!this._readyToRender)return;this.runAnimeFrame(),this._resetTransform();const t=this.ctx;this.dispatchEvent(new Jr("beforeJflowRender",{ctx:t}));const e=this._getViewBox();this.NodeRenderTop?(this._linkStack.render(t,(t=>!t.ON_TOP&&t.isInViewBox(e))),this._stack.render(t,(t=>{const n=Br(e,t.getBoundingRect());return t._isInViewBox=n,n})),this._linkStack.render(t,(t=>t.ON_TOP&&t.isInViewBox(e)))):(this._stack.render(t,(t=>{const n=Br(e,t.getBoundingRect());return t._isInViewBox=n,n})),this._linkStack.render(t,(t=>t.isInViewBox(e)))),this._tempNode&&(t.save(),this._tempNode.render(t),t.restore()),this._tempLink&&(t.save(),this._tempLink.isInViewBox(e),this._tempLink.render(t),t.restore()),this.dispatchEvent(new Jr("afterJflowRender",{ctx:t})),this.renderScrollBar(t)}}Object.assign(Ia.prototype,Hr),Object.assign(Ia.prototype,Vr),Object.assign(Ia.prototype,Wr),Object.assign(Ia.prototype,$r),Object.assign(Ia.prototype,zr),Object.assign(Ia.prototype,Xr),Object.assign(Ia.prototype,Ur),Object.assign(Ia.prototype,Gr);const ja=Ia,La={provide(){return{addToStack:this.addToStack,removeFromStack:this.removeFromStack}},data:()=>({stack:[]}),methods:{addToStack(t,e){this._jflowInstance.addToStack(t),e&&t._jflow.setRenderNodeBySource(e,t)},removeFromStack(t){this._jflowInstance.removeFromStack(t)},onStackChangeHandler(){this._jflowInstance.recalculate(),this._jflowInstance.reflow()}}},Pa={mixins:[La],provide(){return{renderJFlow:this.renderJFlow,getJFlow:this.getInstance,addToLinkStack:this.addToLinkStack,removeFromLinkStack:this.removeFromLinkStack}},props:{configs:{type:Object,default:function(){return{}}},loading:Boolean,genVueComponentKey:{type:Function}},data:()=>({renderNodes:[],renderLinks:[]}),render:function(t){return this.renderNodes.length?t("div",[...this.renderNodes.map((({type:t,source:e,layoutNode:n})=>{if(!this.$scopedSlots[t]){if(!this.$scopedSlots.jflowcommon)return null;t="jflowcommon"}if(n.__vnode__)return n.__vnode__;const[i]=this.$scopedSlots[t]({source:e,layoutNode:n});return this.genVueComponentKey&&(i.key=this.genVueComponentKey(e)),n.__vnode__=i,i})).filter((t=>!!t)),...this.renderLinks.map((t=>{let e=t.type||"plainlink";if(!this.$scopedSlots[e])return null;if(t.__vnode__)return t.__vnode__;const[n]=this.$scopedSlots[e]({configs:t});if(this.genVueComponentKey){const e=this.genVueComponentKey(t.from.source),i=this.genVueComponentKey(t.to.source),s=t.part;n.key=`${e}-${i}-${s}`}return t.__vnode__=n,n}))]):t("div",this.$slots.default)},created(){this._jflowInstance=new ja(this.configs),this.$emit("update:loading",!0),this.genNodeLinkMeta(),this.syncNodeLink()},mounted(){this.mountJFlow()},beforeDestroy(){this._jflowInstance?.destroy()},methods:{mountJFlow(){this._jflowInstance.$mount(this.$el),Object.keys(this.$listeners).map((t=>{const e=this.$listeners[t].bind(this);this._jflowInstance.addEventListener(t,e)})),this.$emit("update:loading",!1)},genNodeLinkMeta(){this.nodes=this._jflowInstance._layout.flowStack.map((t=>{const{type:e,layoutNode:n,source:i}=t,s=this._jflowInstance.source_Layout_Render_NodeMap;let r;return r=s.has(i)?s.get(i):s.set(i),r.layoutNode=n,t})),this.links=this._jflowInstance._layout.flowLinkStack.slice()},syncNodeLink(){this.renderNodes=this.nodes.slice(),this.renderLinks=this.links.slice()},reflow(t,e){this.genNodeLinkMeta(),this.syncNodeLink(),this.$nextTick((()=>{t&&t(),this._jflowInstance.recalculate(),this._jflowInstance.scheduleRender((()=>{e&&e()}))}))},getInstance(){return this._jflowInstance},renderJFlow(){this.__renderInSchedule__||(this.__renderInSchedule__=!0,this.$nextTick((()=>{this._jflowInstance._render(),this.__renderInSchedule__=!1})))},addToLinkStack(t,e,n){this._jflowInstance.addToLinkStack(t),e&&n&&t._jflow.addLinkNodeBySource(e,n,t)},removeFromLinkStack(t,e,n){this._jflowInstance.removeFromLinkStack(t),e&&n&&t._jflow.removeLinkNodeBySource(e,n,t)}}};var Ma=i(243),Ra=i.n(Ma);function Aa(t){const n="string"==typeof t?e[t]:t;return{inject:["addToStack","removeFromStack"],props:{configs:{type:Object,default:function(){return{}}},visible:{type:Boolean,default:!0},source:{type:Object}},watch:{configs(t,e){const n=Ra()(t,e);0!==Object.keys(n).length&&this._jflowInstance.setConfig(t)},$listeners(t,e){let n=[],i=[];const s=Object.keys(t).map((e=>({event:e,handler:t[e]}))),r=Object.keys(e).map((t=>({event:t,handler:e[t]})));s.forEach((t=>{const e=t.handler;r.find((t=>t.handler===e))||n.push(t)})),r.forEach((t=>{const e=t.handler;s.find((t=>t.handler===e))||i.push(t)})),n.forEach((t=>{this._jflowInstance.addEventListener(t.event,t.handler)})),i.forEach((t=>{this._jflowInstance.removeEventListener(t.event,t.handler)}))},visible(t){this._jflowInstance.visible=t},source(t){this._jflowInstance._jflow.setRenderNodeBySource(t,this._jflowInstance)}},render:function(t){return null},created(){this._jflowInstance=new n(this.configs),this._jflowInstance.visible=this.visible,this.bindListeners(),this.addToStack(this._jflowInstance,this.source)},destroyed(){this._jflowInstance.destroy(),this.removeFromStack(this._jflowInstance)},methods:{bindListeners(){Object.keys(this.$listeners).map((t=>{const e=this.$listeners[t];this._jflowInstance.addEventListener(t,e)}))}}}}function Da(t,n){const i="string"==typeof t?e[t]:t;return{inject:["addToLinkStack","removeFromLinkStack","getJFlow"],props:{configs:{type:Object,default:function(){return{}}},from:Object,to:Object},render:function(t){return null},created(){const t=this.getJFlow(),e=t.getRenderNodeBySource(this.from),n=t.getRenderNodeBySource(this.to);this.createInstance(e,n)},mounted(){this.unwatch=this.$watch((()=>[this.from,this.to,this.configs]),(()=>{this.refreshConfig()}))},methods:{createInstance(t,e){t&&e&&(this._jflowInstance=new i({...this.configs,from:t,to:e}),this.bindListeners(),this.addToLinkStack(this._jflowInstance,this.from,this.to))},refreshConfig(){const t=this.getJFlow(),e=t.getRenderNodeBySource(this.from),n=t.getRenderNodeBySource(this.to);this._jflowInstance?this._jflowInstance.setConfig({...this.configs,from:e,to:n}):this.createInstance(e,n)},bindListeners(){Object.keys(this.$listeners).map((t=>{const e=this.$listeners[t];this._jflowInstance.addEventListener(t,e)}))}},destroyed(){this.unwatch(),this._jflowInstance&&this.removeFromLinkStack(this._jflowInstance,this.from,this.to)}}}function $a(t){const n="string"==typeof t?e[t]:t;return{mixins:[La],inject:{addToBelongStack:{from:"addToStack"},removeFromBelongStack:{from:"removeFromStack"},renderJFlow:{from:"renderJFlow"}},render:function(t){return t("jflow-group",this.$slots.default)},props:{configs:{type:Object,default:function(){return{}}},visible:{type:Boolean,default:!0},source:{type:Object}},watch:{configs(t,e){JSON.stringify(t)!==JSON.stringify(e)&&this._jflowInstance.setConfig(t)},$listeners(t,e){let n=[],i=[];const s=Object.keys(t).map((e=>({event:e,handler:t[e]}))),r=Object.keys(e).map((t=>({event:t,handler:e[t]})));s.forEach((t=>{const e=t.handler;r.find((t=>t.handler===e))||n.push(t)})),r.forEach((t=>{const e=t.handler;s.find((t=>t.handler===e))||i.push(t)})),n.forEach((t=>{this._jflowInstance.addEventListener(t.event,t.handler)})),i.forEach((t=>{this._jflowInstance.removeEventListener(t.event,t.handler)}))},visible(t){this._jflowInstance.visible=t},source(t){this._jflowInstance._jflow.setRenderNodeBySource(t,this._jflowInstance)}},created(){this._jflowInstance=new n(this.configs),this._jflowInstance.visible=this.visible,Object.keys(this.$listeners).map((t=>{const e=this.$listeners[t].bind(this);this._jflowInstance.addEventListener(t,e)})),this.addToBelongStack(this._jflowInstance,this.source)},mounted(){this._jflowInstance.recalculate()},updated(){this._jflowInstance.recalculateUp()},destroyed(){this._jflowInstance.destroy(),this.removeFromBelongStack(this._jflowInstance)}}}const Na={mixins:[La],inject:{addToBelongStack:{from:"addToStack"},removeFromBelongStack:{from:"removeFromStack"},renderJFlow:{from:"renderJFlow"}},data:()=>({nodes:[]}),props:{configs:{type:Object,default:function(){return{}}},visible:{type:Boolean,default:!0},source:{type:Object},genVueComponentKey:{type:Function}},watch:{configs(t,e){JSON.stringify(t)!==JSON.stringify(e)&&this._jflowInstance.setConfig(t)},$listeners(t,e){let n=[],i=[];const s=Object.keys(t).map((e=>({event:e,handler:t[e]}))),r=Object.keys(e).map((t=>({event:t,handler:e[t]})));s.forEach((t=>{const e=t.handler;r.find((t=>t.handler===e))||n.push(t)})),r.forEach((t=>{const e=t.handler;s.find((t=>t.handler===e))||i.push(t)})),n.forEach((t=>{this._jflowInstance.addEventListener(t.event,t.handler)})),i.forEach((t=>{this._jflowInstance.removeEventListener(t.event,t.handler)}))},visible(t){this._jflowInstance.visible=t},source(t){this._jflowInstance._jflow.setRenderNodeBySource(t,this._jflowInstance)}},created(){this._jflowInstance=new xa(this.configs),this._jflowInstance.visible=this.visible,Object.keys(this.$listeners).map((t=>{const e=this.$listeners[t].bind(this);this._jflowInstance.addEventListener(t,e)})),this.addToBelongStack(this._jflowInstance,this.source),this.genTextElementMeta()},mounted(){this._jflowInstance.recalculate()},updated(){this._jflowInstance.recalculateUp()},destroyed(){this._jflowInstance.destroy(),this.removeFromBelongStack(this._jflowInstance)},render:function(t){return this.nodes.length?t("div",this.nodes.map((t=>{let{type:e,source:n}=t;if(!this.$scopedSlots[e]){if(!this.$scopedSlots.jflowcommon)return;e="jflowcommon"}if(t.__vnode__)return t.__vnode__;const[i]=this.$scopedSlots[e]({source:n,textElement:t});return this.genVueComponentKey&&(i.key=this.genVueComponentKey(n)),t.__vnode__=i,i}))):t("jflow-group",this.$slots.default)},methods:{genTextElementMeta(){this.nodes=this._jflowInstance._flattenTxtElem.filter((t=>"text"!==t.type))},reflow(){this._jflowInstance.refreshTextElements(),this.genTextElementMeta(),this.$nextTick((()=>{this._jflowInstance.refresh()}))}}},Fa=[{name:"Jflow",component:Pa},{name:"Group",component:$a("Group")},...["CapsuleGroup","CapsuleVerticalGroup","DiamondGroup","DiamondVerticalGroup","RhombusGroup","PointGroup","ScrollGroup"].map((t=>({name:t,component:$a(t)}))),...["Point","Rectangle","Capsule","Diamond","Rhombus","Text","Icon","ShadowDom","TextEditor"].map((t=>({name:t,component:Aa(t)}))),...["Link","PolyLink","BezierLink"].map((t=>({name:t,component:Da(t)}))),{name:"TextGroup",component:Na}];customElements.define("jflow-group",class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}});const Va={install:(t,e={})=>{let n="j";e&&e.prefix&&(n=e.prefix),Fa.forEach((e=>{t.component(`${n}${e.name}`,e.component)})),e.customInstance&&Object.keys(e.customInstance).forEach((i=>{t.component(`${n}${i}`,Aa(e.customInstance[i]))})),e.customGroups&&Object.keys(e.customGroups).forEach((i=>{t.component(`${n}${i}`,$a(e.customGroups[i]))})),e.customLink&&Object.keys(e.customLink).forEach((i=>{t.component(`${n}${i}`,Da(e.customLink[i]))}))}};function Wa(t,e,n,i,s,r,o,a){var h,c="function"==typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=n,c._compiled=!0),i&&(c.functional=!0),r&&(c._scopeId="data-v-"+r),o?(h=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),s&&s.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(o)},c._ssrRegister=h):s&&(h=a?function(){s.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:s),h)if(c.functional){c._injectStyles=h;var l=c.render;c.render=function(t,e){return h.call(e),l(t,e)}}else{var u=c.beforeCreate;c.beforeCreate=u?[].concat(u,h):[h]}return{exports:t,options:c}}window.$jflow_version="0.1.0";var Ha=Wa({props:{node:Object,odd:Boolean},computed:{groupConfig:()=>({layout:new Eo({direction:"horizontal",gap:5}),paddingTop:4,paddingBottom:4,margin:2,paddingLeft:10,backgroundColor:"transparent",borderWidth:0})}},(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("j-group",t._g({attrs:{source:t.node,configs:t.groupConfig}},t.$listeners),[n("j-text",{attrs:{configs:{fontSize:"12px",minWidth:110,textAlign:"left",textColor:"#1C1E21",content:t.node.name+"<"+("string"==typeof t.node.ref?t.node.ref:t.node.ref.name)+">"}}})],1)}),[],!1,null,null,null);const za=Wa({components:{"er-property":Ha.exports},props:{node:Object},data(){return console.log(this.node),{folded:!1,configs:{layout:new Eo({direction:"vertical",gap:0}),borderColor:"#A3BF69",backgroundColor:"#ECF2E1",borderWidth:2,borderRadius:0},bodyConfigs:{layout:new Eo({direction:"vertical",gap:0,alignment:"start"}),display:"block",backgroundColor:"#fff",borderRadius:0,borderColor:"#A3BF69",borderWidth:2},headerConfigs:{layout:new Eo({direction:"horizontal",gap:0,alignment:"center"}),paddingTop:2,paddingBottom:2,paddingLeft:15,paddingRight:15},propertyConfig:{layout:new Eo({direction:"vertical",gap:0,alignment:"start"}),border:{bottom:{borderColor:"#A3BF69",borderWidth:2}}}}}},(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("j-group",t._g({attrs:{source:t.node,configs:t.configs}},t.$listeners),[n("j-group",{attrs:{configs:t.headerConfigs}},[n("j-text",{attrs:{configs:{fontSize:"16px",fontWeight:"bold",textColor:"#1C1E21",textAlign:"center",content:t.node.name}}})],1),t._v(" "),n("j-group",{attrs:{configs:t.bodyConfigs}},[n("j-group",{attrs:{configs:t.propertyConfig}},[t.node.properties&&t.node.properties.length?t._l(t.node.properties,(function(t){return n("er-property",{key:t.name,attrs:{node:t}})})):t._e(),t._v(" "),t.node.param&&t.node.param.length?[n("j-text",{attrs:{configs:{fontSize:"12px",textColor:"#1C1E21",textAlign:"left",content:"params:"}}}),t._v(" "),t._l(t.node.param,(function(t){return n("er-property",{key:t.name,attrs:{node:t}})}))]:t._e(),t._v(" "),t.node.return&&t.node.return.length?[n("j-text",{attrs:{configs:{fontSize:"12px",textColor:"#1C1E21",textAlign:"left",content:"returns:"}}}),t._v(" "),t._l(t.node.return,(function(t){return n("er-property",{key:t.name,attrs:{node:t}})}))]:t._e()],2)],1)],1)}),[],!1,null,null,null).exports,Xa=Wa({props:{node:Object},data(){let t,e;return"entity"===this.node.concept&&(t="#37371F",e="#fff"),(this.node.isStructure||"structure"===this.node.concept)&&(t="#EA9010",e="#fff"),"logic"===this.node.concept&&(t="#90BE6D",e="#000"),"viewlogic"===this.node.concept&&(t="#C9E3AC",e="#000"),"viewevents"===this.node.concept&&(t="#CECE5A",e="#000"),"view"===this.node.concept&&(t="#EAEFBD",e="#000"),{folded:!1,textColor:e,configs:{layout:new Eo({direction:"vertical",gap:0}),borderColor:"#A3BF69",backgroundColor:t,borderWidth:2,borderRadius:0,padding:20}}}},(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("j-group",t._g({attrs:{source:t.node,configs:t.configs}},t.$listeners),[n("j-text",{attrs:{configs:{fontSize:"16px",fontWeight:"bold",textColor:t.textColor,textAlign:"center",content:t.node.name}}})],1)}),[],!1,null,null,null).exports;class Ya{constructor(t){this.type="Property",this.source=t,this.name=t.name,this.refName=t.ref.name}}class Ga{constructor(t,e){this.type=e,this.source=t,this.name=t.name,this.properties=(t.properties||[]).map((t=>new Ya(t)))}}let Ua=0;let qa=0,Ja=[],Ka=[],Za=[],Qa=[],th=[],eh=[];function nh(t){const e={id:qa++,concept:"view",source:t,name:t.name,logics:[],events:[]};t.logics.map((n=>{return i=`${t.name}/${n.name}`,s=n,r=e,void th.push({id:qa++,concept:"viewlogic",name:i,param:s.param.slice(),return:s.return.slice(),refByView:[r],refByViewLogic:[]});var i,s,r})),t.events.map((n=>{return i=`${t.name}/${n.element}@${n.event}`,s=n,r=e,void eh.push({id:qa++,concept:"viewevents",name:i,event:s,refByView:[r]});var i,s,r})),Za.push(e)}function ih(t){Qa.push({level:0,id:qa++,concept:"logic",source:t,name:t.name,param:t.param.slice(),return:t.return.slice(),refByLogic:[],refByView:[],refByViewLogic:[],refByViewEvent:[]})}function sh(t){return{id:qa++,concept:"property",source:t,ref:t.ref,name:t.name}}function rh(t){Ja.push({level:0,id:qa++,concept:"structure",source:t,name:t.structure,properties:t.properties.map(sh),refByStructure:[],refByLogic:[],refByView:[],refByViewLogic:[],refByViewEvent:[]})}function oh(t){Ka.push({level:0,id:qa++,concept:"entity",source:t,name:t.entity,refByStructure:[],refByLogic:[],refByView:[],refByViewLogic:[],refByViewEvent:[]})}const ah={name:"jflow-er-diagram",components:{"j-er-node-comp":za,"j-plain-node":Xa},data:()=>({jflowloading:!1,configs:{allowDrop:!0,layout:{},initialZoom:1,minZoom:1e-4,NodeRenderTop:!0},filterContent:"",showProperty:!1,curData:null,currJSON:""}),computed:{statistics(){return this.curData?`entities: ${this.curData.entities.length}, structures: ${this.curData.structures.length}, logics: ${this.curData.logics.length}, views: ${this.curData.views.length}`:""}},methods:{genVueComponentKey:t=>t.id,rerender(){this.configs.layout.reOrder(this.curData),this.$refs.jflow.reflow()},toggleView(){this.configs.layout.toggleView(),this.rerender()},toggleLogic(){this.configs.layout.toggleLogic(),this.rerender()},toggleStructure(){this.configs.layout.toggleStructure(),this.rerender()},toggleLcap(){this.configs.layout.toggleLcap(),this.rerender()},toggleFilterMultiRef(){this.configs.layout.toggleFilterMultiRef(),this.rerender()},togglePrimary(){this.configs.layout.togglePrimaryFilter(),this.rerender()},toggleFilterMultiRefLogic(){this.configs.layout.toggleMultiLogicRefFilter(),this.rerender()},doFilter(t){this.configs.layout.doFilter(this.filterContent,t),this.rerender()},toggleProperty(){this.showProperty=!this.showProperty,this.configs.layout.toggleProperty(this.showProperty),this.rerender()},importData(){this.$refs.datamodal.showModal()},importJSON(){const t=Object.freeze(function(t){qa=0,Ka=[],Ja=[],Za=[],Qa=[],th=[],eh=[],t.entities.map(oh),t.structures.map(rh),t.logics.map(ih),t.views.map(nh);const e=(t,e,n)=>{t.forEach((t=>{const i=e.find((e=>e.name===t));i&&n.push(i)}))};return console.log(eh),Ka.forEach((t=>{const{refByLogic:n,refByView:i,refByViewLogic:s,refByViewEvent:r,refBySturcture:o}=t.source;e(n,Qa,t.refByLogic),e(i,Za,t.refByView),e(s.map((t=>`${t.view}/${t.logic}`)),th,t.refByViewLogic),e(r.map((t=>`${t.view}/${t.element}@${t.event}`)),eh,t.refByViewEvent),e(o,Ja,t.refByStructure)})),Ja.forEach((t=>{const{refByLogic:n,refByView:i,refByViewLogic:s,refByViewEvent:r,refBySturcture:o}=t.source;e(n,Qa,t.refByLogic),e(i,Za,t.refByView),e(s.map((t=>`${t.view}/${t.logic}`)),th,t.refByViewLogic),e(r.map((t=>`${t.view}/${t.element}@${t.event}`)),eh,t.refByViewEvent),e(o,Ja,t.refByStructure)})),Qa.forEach((t=>{const{refByLogic:n,refByView:i,refByViewLogic:s,refByViewEvent:r}=t.source;e(n,Qa,t.refByLogic),e(i,Za,t.refByView),e(s.map((t=>`${t.view}/${t.logic}`)),th,t.refByViewLogic),e(r.map((t=>`${t.view}/${t.element}@${t.event}`)),eh,t.refByViewEvent)})),{structures:Ja.slice(),views:Za.slice(),viewLogics:th.slice(),viewEvents:eh.slice(),logics:Qa.slice(),entities:Ka.slice()}}(JSON.parse(this.currJSON)));this.curData=t,this.$refs.jflow?this.rerender():this.configs.layout=new class{constructor(t){this.static=!1,this.flowStack=[],this.flowLinkStack=[],this.erNodes=[],this.viewVisible=!0,this.logicVisible=!0,this.structureVisible=!0,this.LCAPvisible=!1,this.multiRefFilter=!1,this.multiLogicRefFilter=!1,this.primaryFilter=!1,this.filterContent="",this.filterPart="",this.showProperty=!1,this.reOrder(t)}reOrder(t){this.flowStack=[],this.flowLinkStack=[],this.source=t;const{structures:e,views:n,viewLogics:i,viewEvents:s,logics:r,entities:o}=t;new Set,new Set,new Set,new Set,new Set,new Set,this.filterContent.toLocaleLowerCase();let a=o.map((t=>new Ga(t,"Entity"))),h=e.map((t=>new Ga(t,"Structure"))),c=r.map((t=>new Ga(t,"Logic"))),l=s.map((t=>new Ga(t,"ViewEvent"))),u=i.map((t=>new Ga(t,"ViewLogic"))),d=n.map((t=>new Ga(t,"View")));[...a,...h,...c,...l,...u,...d].forEach((t=>{this.flowStack.push({type:t.type,source:t.source,layoutNode:t})}));const f=(t,e,n)=>{t&&t.forEach((t=>{const i=e.find((e=>e.source===t));i&&this.flowLinkStack.push({from:n,to:i,part:Ua++})}))},p=t=>{const e=t.source;f(e.refByStructure,h,t),f(e.refByLogic,c,t),f(e.refByView,d,t),f(e.refByViewLogic,u,t),f(e.refByViewEvent,l,t)};a.forEach(p),h.forEach(p),c.forEach(p),l.forEach(p),u.forEach(p),Object.assign(this,{entityNodes:a,structNodes:h,logicNodes:c,viewLogicsNodes:u,viewEventsNodes:l,viewNodes:d})}staticCheck(t,e){return!1}reflow(t){const{entityNodes:e,structNodes:n,logicNodes:i,viewLogicsNodes:s,viewEventsNodes:r,viewNodes:o}=this;function a(e,n=0,i,s=!1){let r=0,o=0;return e.forEach(((e,n)=>{const a=t.getRenderNodeBySource(e.source),{width:h,height:c}=a.getBoundingDimension();if(o=Math.max(h,o),!s){const t=c/2;n>0&&(r+=t),a.anchor[1]=r,i&&i(e,r),r+=t+20}})),n+=o/2,e.forEach((e=>{t.getRenderNodeBySource(e.source).anchor[0]=n})),n+=o/2}let h=[e,n].reduce(((t,e)=>0===e.length?t:a(e,t)+200),0),c=new Map;i.forEach((t=>{const e=t.source,n=e.name;c.has(n)||c.set(n,{node:t,level:0}),e.refByLogic.forEach((t=>{const e=i.find((e=>e.source.name===t.name)),n=e.name;c.has(n)||c.set(n,{node:e,level:0}),c.get(n).level++}))}));const l={};c.forEach((t=>{const e=t.level;l[e]||(l[e]=[]),l[e].push(t.node)}));const u=Object.keys(l).sort(((t,e)=>e-t));let d=0;o.forEach((e=>{const n=e.source;let i=d;const o=t.getRenderNodeBySource(n),{height:a}=o.getBoundingDimension();function h(e){let n=i;return e.forEach(((e,i)=>{const s=t.getRenderNodeBySource(e.source),{height:r}=s.getBoundingDimension(),o=r/2;n+=o,s.anchor[1]=n,n+=o+20})),n}o.anchor[1]=a/2+i;const c=s.filter((t=>t.source.refByView.includes(n))),l=r.filter((t=>t.source.refByView.includes(n))),u=Math.max(h(c),h(l));d=u+40})),u.forEach((e=>{const n=l[e];n.forEach((e=>{const n=e.source;let i=0,s=0;function r(e){const n=t.getRenderNodeBySource(e);i+=n.anchor[1],s++}n.refByLogic.forEach(r),n.refByView.forEach(r),n.refByViewLogic.forEach(r),n.refByViewEvent.forEach(r),0===s||(t.getRenderNodeBySource(n).anchor[1]=i/s)})),h=a(n,h,null,!0)+200}));const f=[];n.forEach((e=>{const n=e.source;let i=0,s=0;function r(e){const n=t.getRenderNodeBySource(e);i+=n.anchor[1],s++}n.refByLogic.forEach(r),n.refByView.forEach(r),n.refByViewLogic.forEach(r),n.refByViewEvent.forEach(r),0===s?f.push(e):t.getRenderNodeBySource(n).anchor[1]=i/s}));const p=[];e.forEach((e=>{const n=e.source;let i=0,s=0;function r(e){const n=t.getRenderNodeBySource(e);i+=n.anchor[1],s++}n.refByStructure.forEach(r),n.refByLogic.forEach(r),n.refByView.forEach(r),n.refByViewLogic.forEach(r),n.refByViewEvent.forEach(r),0===s?p.push(e):(console.log(e,i,s),t.getRenderNodeBySource(n).anchor[1]=i/s)})),[s,r,o].reduce(((t,e)=>0===e.length?t:a(e,t,null,!0)+200),h)}toggleView(){this.viewVisible=!this.viewVisible}toggleLogic(){this.logicVisible=!this.logicVisible}toggleStructure(){this.structureVisible=!this.structureVisible}toggleLcap(){this.LCAPvisible=!this.LCAPvisible}toggleFilterMultiRef(){this.multiRefFilter=!this.multiRefFilter}togglePrimaryFilter(){this.primaryFilter=!this.primaryFilter}toggleMultiLogicRefFilter(){this.multiLogicRefFilter=!this.multiLogicRefFilter}doFilter(t,e){this.filterPart=e,this.filterContent=t}toggleProperty(t){this.showProperty=t}}(t)}}};var hh=Wa(ah,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{display:"block",width:"100vw",height:"90vh",border:"1px solid #000",overflow:"visible",position:"relative"}},[t._m(0),t._v(" "),n("div",{staticStyle:{display:"block",width:"100%",height:"100%"}},[t.curData?n("j-jflow",{ref:"jflow",staticStyle:{width:"100%",height:"100%"},attrs:{configs:t.configs,"gen-vue-component-key":t.genVueComponentKey},scopedSlots:t._u([{key:"Structure",fn:function(e){var i=e.source;return[t.showProperty?n("j-er-node-comp",{attrs:{node:i}}):n("j-plain-node",{attrs:{node:i}})]}},{key:"ViewLogic",fn:function(e){var i=e.source;return[t.showProperty?n("j-er-node-comp",{attrs:{node:i}}):n("j-plain-node",{attrs:{node:i}})]}},{key:"ViewEvent",fn:function(t){var e=t.source;return[n("j-plain-node",{attrs:{node:e}})]}},{key:"Logic",fn:function(e){var i=e.source;return[t.showProperty?n("j-er-node-comp",{attrs:{node:i}}):n("j-plain-node",{attrs:{node:i}})]}},{key:"View",fn:function(t){var e=t.source;return[n("j-plain-node",{attrs:{node:e}})]}},{key:"Entity",fn:function(t){var e=t.source;return[n("j-plain-node",{attrs:{node:e}})]}},{key:"plainlink",fn:function(t){var e=t.configs;return[n("jBezierLink",{attrs:{configs:e,from:e.from.source,to:e.to.source}})]}}],null,!1,1530517222)}):t._e()],1),t._v(" "),n("div",[n("button",{on:{click:function(e){return t.$refs.scriptdialog.showModal()}}},[t._v("get script")]),t._v(" "),n("button",{on:{click:t.importData}},[t._v("import data")]),t._v(" "),n("span",[t._v(t._s(t.statistics))]),t._v(" "),n("br")]),t._v(" "),n("dialog",{ref:"datamodal"},[n("form",{attrs:{method:"dialog"}},[n("p",[n("label",[n("span",{staticStyle:{"vertical-align":"top"}},[t._v("json: ")]),t._v(" "),n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.currJSON,expression:"currJSON"}],staticStyle:{"white-space":"pre",width:"600px",height:"400px"},domProps:{value:t.currJSON},on:{input:function(e){e.target.composing||(t.currJSON=e.target.value)}}})])]),t._v(" "),n("div",[n("button",{attrs:{value:"cancel"}},[t._v("close")]),t._v(" "),n("button",{attrs:{id:"confirmBtn",value:"default"},on:{click:t.importJSON}},[t._v("confirm")])])])]),t._v(" "),n("dialog",{ref:"scriptdialog"},[t._m(1)])])}),[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{position:"absolute",left:"20px",top:"10px"}},[n("span",{staticClass:"legend entity"},[t._v("Entity")]),t._v(" "),n("span",{staticClass:"legend structure"},[t._v("Structure")]),t._v(" "),n("span",{staticClass:"legend globallogic"},[t._v("GlobalLogic")]),t._v(" "),n("span",{staticClass:"legend viewlogic"},[t._v("ViewLogic")]),t._v(" "),n("span",{staticClass:"legend viewevent"},[t._v("ViewEvent")]),t._v(" "),n("span",{staticClass:"legend view"},[t._v("View")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("form",{attrs:{method:"dialog"}},[n("textarea",{staticStyle:{"white-space":"pre",width:"600px",height:"400px"}},[t._v("                function getFullName(node) {\n                    return `${node.getNamespace()}.${node.name}`;\n                }\n                function figureOutRefs(result) {\n                    const refByLogic = [];\n                    const refByView = [];\n                    const refByViewEvent = [];\n                    const refByViewLogic = [];\n                    const refBySturcture = [];\n                    const refByOther = [];\n                    for (const entry of result) {\n                        const n = entry[0];\n                        \n                        switch(n.concept) {\n                            \n                            case 'Logic': \n                                refByLogic.push(getFullName(entry[0]));\n                                break;\n                            case 'Structure':\n                                refBySturcture.push(getFullName(entry[0]));\n                                break;\n                            case 'View':\n                            case 'Frontend':\n                \n                                let v = entry[1];\n                                function iterate(node, lastName) {\n                                    node.children.forEach(c => {\n                                        switch(c.node.concept) {\n                                            case 'View':\n                                            case 'Frontend': \n                                                iterate(c, `${lastName}/${c.node.name}`);\n                                                break\n                                            case 'ViewElement':\n                                                iterate(c, lastName);\n                                                break;\n                                            case 'Logic':\n                                                refByViewLogic.push({\n                                                    view: lastName,\n                                                    logic: c.node.name,\n                                                })\n                                                break;\n                                            case 'BindEvent':\n                                                refByViewEvent.push({\n                                                    view: lastName,\n                                                    element: c.node.parentNode.name,\n                                                    event: 'click',\n                                                })\n                                                break;\n                                            default: \n                                                refByView.push(lastName)\n                                        }\n                                    })\n                                }\n                                iterate(v, v.node.name);\n                                break;\n                            default: \n                                refByOther.push(entry[0].name);\n                        }\n                    }\n                    return {\n                        refByLogic,\n                        refByView,\n                        refByOther,\n                        refByViewLogic,\n                        refByViewEvent,\n                        refBySturcture,\n                    }\n                }\n                \n                function getTypeKey(node) {\n                    return (node.typeAnnotation || node.__TypeAnnotation)?.typeKey;\n                }\n                Promise.all([\n                    Promise.all($data.app.dataSources.map(async ds => {\n                            // const dsname = ds.name;\n                            const r = await Promise.all(ds.entities.map(async entity => {\n                                const result = await window.globalData.naslServer.findReferences(entity);\n                                const {\n                                    refByLogic,\n                                    refByView,\n                                    refByOther,\n                                    refByViewLogic,\n                                    refByViewEvent,\n                                    refBySturcture\n                                } = figureOutRefs(result);\n                                return {\n                                    entity: getFullName(entity),\n                                    refByLogic,\n                                    refByView: Array.from(new Set(refByView)),\n                                    refByViewLogic,\n                                    refByViewEvent,\n                                    refBySturcture,\n                                    refByOther\n                                }\n                            }));\n                            return r;\n                        })).then(res => {\n                            return res.flat();\n                        }),\n                    Promise.all($data.app.logics.map(async s => { \n                        const result = await window.globalData.naslServer.findReferences(s);\n                        const {\n                            refByLogic,\n                            refByView,\n                            refByOther,\n                            refByViewLogic,\n                            refByViewEvent\n                        } = figureOutRefs(result);\n                \n                        return {\n                            name: getFullName(s),\n                            param: s.params.map(p => ({\n                                ref: getTypeKey(p),\n                                name: p.name,\n                            })),\n                            return: s.returns.map(p => ({\n                                ref: getTypeKey(p),\n                                name: p.name,\n                            })),\n                            refByLogic: Array.from(new Set(refByLogic)),\n                            refByView: Array.from(new Set(refByView)),\n                            refByViewLogic,\n                            refByViewEvent,\n                            refByOther\n                        }\n                    })).then(res => {\n                        return res\n                    }),\n                    Promise.all($data.app.structures.map(async s => { \n                        const result = await window.globalData.naslServer.findReferences(s);\n                        const {\n                            refByLogic,\n                            refByView,\n                            refByViewLogic,\n                            refByViewEvent,\n                            refBySturcture,\n                            refByOther,\n                        } = figureOutRefs(result);\n                        \n                        return {\n                            structure: getFullName(s),\n                            properties: s.properties.map(p => {\n                                return {\n                                    ref: getTypeKey(p),\n                                    name: p.name\n                                }\n                            }),\n                            refByLogic,\n                            refByView: Array.from(new Set(refByView)),\n                            refByViewLogic,\n                            refByViewEvent,\n                            refBySturcture,\n                            refByOther\n                        }\n                    })).then(res => {\n                        return res\n                    }),\n                    Promise.resolve(\n                        $data.app.frontends.map(f => f.views.map(v => {\n                            const viewNames = [];\n                            function iterate(viewNode, lastName) {\n                \n                                viewNode.getViewBindEvents();\n                \n                                viewNames.push({\n                                    name: lastName,\n                                    logics: viewNode.logics.map(l => ({\n                                        name: l.name,\n                                        param: l.params.map(p => ({\n                                            ref: getTypeKey(p),\n                                            name: p.name,\n                                        })),\n                                        return: l.returns.map(p => ({\n                                            ref: getTypeKey(p),\n                                            name: p.name,\n                                        }))\n                                    })),  \n                                    events: viewNode.getViewBindEvents().map(bindEvent => ({\n                                        element: bindEvent.parentNode.name,\n                                        event: bindEvent.name,\n                                    }))\n                                });\n                                viewNode.children.forEach(c => {\n                                    iterate(c, `${lastName}/${c.name}`);\n                                })\n                            }\n                            iterate(v, `${f.name}/${v.name}`);\n                            return viewNames;\n                        }).reduce((accu, curr) => accu.concat(curr), [])).flat())\n                ]).then(([entities, logics, structures, views]) => {\n                    console.log(JSON.stringify({ entities, logics, structures, views }, null, '\\t'));\n                })\n                                    \n            ")]),t._v(" "),n("button",{attrs:{value:"cancel"}},[t._v("close")])])}],!1,null,null,null);const ch=hh.exports;As.config.productionTip=!1,As.use(Va),new As({render:t=>t(ch)}).$mount("#app")})()})();