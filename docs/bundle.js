/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";var e={243:t=>{function e(){return i(null,[].slice.call(arguments,0))}function i(t,e){for(var i,s,r,o,a,h=e.length,c=e[0],l={},u=t&&t.equal||n,d=1;d<h;d++)for(i=e[d],r=(s=Object.keys(i)).length,a=0;a<r;a++)u(i[o=s[a]],c[o])||(l[o]=i[o]);return l}function n(t,e){return t===e}e.custom=function(t){return i(t,[].slice.call(arguments,1))},t.exports=e}},i={};function n(t){var s=i[t];if(void 0!==s)return s.exports;var r=i[t]={exports:{}};return e[t](r,r.exports,n),r.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var e={};n.r(e),n.d(e,{BaseLink:()=>uo,BezierLink:()=>So,Capsule:()=>io,CapsuleGroup:()=>Sa,CapsuleVertical:()=>no,CapsuleVerticalGroup:()=>Oa,Diamond:()=>ro,DiamondGroup:()=>Ta,DiamondVerticalGroup:()=>Ea,Group:()=>ka,GroupFactory:()=>Qr,Icon:()=>mo,Instance:()=>Mr,JFLOW_MODE:()=>gr,JFlowEvent:()=>Jr,LinearLayout:()=>To,Link:()=>yo,Node:()=>Ar,Point:()=>to,PointGroup:()=>Ba,PolyLink:()=>xo,Rectangle:()=>eo,Rhombus:()=>so,RhombusGroup:()=>Ca,ScrollGroup:()=>co,ShadowDom:()=>vo,Text:()=>_o,TextElement:()=>ta,TextGroup:()=>xa,commonEventAdapter:()=>lo,default:()=>La});var i=Object.freeze({});function s(t){return null==t}function r(t){return null!=t}function o(t){return!0===t}function a(t){return"string"==typeof t||"number"==typeof t||"symbol"==typeof t||"boolean"==typeof t}function h(t){return null!==t&&"object"==typeof t}var c=Object.prototype.toString;function l(t){return"[object Object]"===c.call(t)}function u(t){var e=parseFloat(String(t));return e>=0&&Math.floor(e)===e&&isFinite(t)}function d(t){return r(t)&&"function"==typeof t.then&&"function"==typeof t.catch}function f(t){return null==t?"":Array.isArray(t)||l(t)&&t.toString===c?JSON.stringify(t,null,2):String(t)}function p(t){var e=parseFloat(t);return isNaN(e)?t:e}function g(t,e){for(var i=Object.create(null),n=t.split(","),s=0;s<n.length;s++)i[n[s]]=!0;return e?function(t){return i[t.toLowerCase()]}:function(t){return i[t]}}g("slot,component",!0);var _=g("key,ref,slot,slot-scope,is");function m(t,e){if(t.length){var i=t.indexOf(e);if(i>-1)return t.splice(i,1)}}var v=Object.prototype.hasOwnProperty;function y(t,e){return v.call(t,e)}function b(t){var e=Object.create(null);return function(i){return e[i]||(e[i]=t(i))}}var w=/-(\w)/g,x=b((function(t){return t.replace(w,(function(t,e){return e?e.toUpperCase():""}))})),k=b((function(t){return t.charAt(0).toUpperCase()+t.slice(1)})),S=/\B([A-Z])/g,C=b((function(t){return t.replace(S,"-$1").toLowerCase()})),T=Function.prototype.bind?function(t,e){return t.bind(e)}:function(t,e){function i(i){var n=arguments.length;return n?n>1?t.apply(e,arguments):t.call(e,i):t.call(e)}return i._length=t.length,i};function E(t,e){e=e||0;for(var i=t.length-e,n=new Array(i);i--;)n[i]=t[i+e];return n}function O(t,e){for(var i in e)t[i]=e[i];return t}function B(t){for(var e={},i=0;i<t.length;i++)t[i]&&O(e,t[i]);return e}function I(t,e,i){}var L=function(t,e,i){return!1},j=function(t){return t};function P(t,e){if(t===e)return!0;var i=h(t),n=h(e);if(!i||!n)return!i&&!n&&String(t)===String(e);try{var s=Array.isArray(t),r=Array.isArray(e);if(s&&r)return t.length===e.length&&t.every((function(t,i){return P(t,e[i])}));if(t instanceof Date&&e instanceof Date)return t.getTime()===e.getTime();if(s||r)return!1;var o=Object.keys(t),a=Object.keys(e);return o.length===a.length&&o.every((function(i){return P(t[i],e[i])}))}catch(t){return!1}}function M(t,e){for(var i=0;i<t.length;i++)if(P(t[i],e))return i;return-1}function A(t){var e=!1;return function(){e||(e=!0,t.apply(this,arguments))}}var R="data-server-rendered",D=["component","directive","filter"],$=["beforeCreate","created","beforeMount","mounted","beforeUpdate","updated","beforeDestroy","destroyed","activated","deactivated","errorCaptured","serverPrefetch"],N={optionMergeStrategies:Object.create(null),silent:!1,productionTip:!1,devtools:!1,performance:!1,errorHandler:null,warnHandler:null,ignoredElements:[],keyCodes:Object.create(null),isReservedTag:L,isReservedAttr:L,isUnknownElement:L,getTagNamespace:I,parsePlatformTagName:j,mustUseProp:L,async:!0,_lifecycleHooks:$};function F(t,e,i,n){Object.defineProperty(t,e,{value:i,enumerable:!!n,writable:!0,configurable:!0})}var W,H=new RegExp("[^"+/a-zA-Z\u00B7\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u037D\u037F-\u1FFF\u200C-\u200D\u203F-\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD/.source+".$_\\d]"),z="__proto__"in{},V="undefined"!=typeof window,X="undefined"!=typeof WXEnvironment&&!!WXEnvironment.platform,Y=X&&WXEnvironment.platform.toLowerCase(),G=V&&window.navigator.userAgent.toLowerCase(),U=G&&/msie|trident/.test(G),q=G&&G.indexOf("msie 9.0")>0,J=G&&G.indexOf("edge/")>0,K=(G&&G.indexOf("android"),G&&/iphone|ipad|ipod|ios/.test(G)||"ios"===Y),Z=(G&&/chrome\/\d+/.test(G),G&&/phantomjs/.test(G),G&&G.match(/firefox\/(\d+)/)),Q={}.watch,tt=!1;if(V)try{var et={};Object.defineProperty(et,"passive",{get:function(){tt=!0}}),window.addEventListener("test-passive",null,et)}catch(t){}var it=function(){return void 0===W&&(W=!V&&!X&&void 0!==n.g&&n.g.process&&"server"===n.g.process.env.VUE_ENV),W},nt=V&&window.__VUE_DEVTOOLS_GLOBAL_HOOK__;function st(t){return"function"==typeof t&&/native code/.test(t.toString())}var rt,ot="undefined"!=typeof Symbol&&st(Symbol)&&"undefined"!=typeof Reflect&&st(Reflect.ownKeys);rt="undefined"!=typeof Set&&st(Set)?Set:function(){function t(){this.set=Object.create(null)}return t.prototype.has=function(t){return!0===this.set[t]},t.prototype.add=function(t){this.set[t]=!0},t.prototype.clear=function(){this.set=Object.create(null)},t}();var at=I,ht=0,ct=function(){this.id=ht++,this.subs=[]};ct.prototype.addSub=function(t){this.subs.push(t)},ct.prototype.removeSub=function(t){m(this.subs,t)},ct.prototype.depend=function(){ct.target&&ct.target.addDep(this)},ct.prototype.notify=function(){for(var t=this.subs.slice(),e=0,i=t.length;e<i;e++)t[e].update()},ct.target=null;var lt=[];function ut(t){lt.push(t),ct.target=t}function dt(){lt.pop(),ct.target=lt[lt.length-1]}var ft=function(t,e,i,n,s,r,o,a){this.tag=t,this.data=e,this.children=i,this.text=n,this.elm=s,this.ns=void 0,this.context=r,this.fnContext=void 0,this.fnOptions=void 0,this.fnScopeId=void 0,this.key=e&&e.key,this.componentOptions=o,this.componentInstance=void 0,this.parent=void 0,this.raw=!1,this.isStatic=!1,this.isRootInsert=!0,this.isComment=!1,this.isCloned=!1,this.isOnce=!1,this.asyncFactory=a,this.asyncMeta=void 0,this.isAsyncPlaceholder=!1},pt={child:{configurable:!0}};pt.child.get=function(){return this.componentInstance},Object.defineProperties(ft.prototype,pt);var gt=function(t){void 0===t&&(t="");var e=new ft;return e.text=t,e.isComment=!0,e};function _t(t){return new ft(void 0,void 0,void 0,String(t))}function mt(t){var e=new ft(t.tag,t.data,t.children&&t.children.slice(),t.text,t.elm,t.context,t.componentOptions,t.asyncFactory);return e.ns=t.ns,e.isStatic=t.isStatic,e.key=t.key,e.isComment=t.isComment,e.fnContext=t.fnContext,e.fnOptions=t.fnOptions,e.fnScopeId=t.fnScopeId,e.asyncMeta=t.asyncMeta,e.isCloned=!0,e}var vt=Array.prototype,yt=Object.create(vt);["push","pop","shift","unshift","splice","sort","reverse"].forEach((function(t){var e=vt[t];F(yt,t,(function(){for(var i=[],n=arguments.length;n--;)i[n]=arguments[n];var s,r=e.apply(this,i),o=this.__ob__;switch(t){case"push":case"unshift":s=i;break;case"splice":s=i.slice(2)}return s&&o.observeArray(s),o.dep.notify(),r}))}));var bt=Object.getOwnPropertyNames(yt),wt=!0;function xt(t){wt=t}var kt=function(t){this.value=t,this.dep=new ct,this.vmCount=0,F(t,"__ob__",this),Array.isArray(t)?(z?function(t,e){t.__proto__=e}(t,yt):function(t,e,i){for(var n=0,s=i.length;n<s;n++){var r=i[n];F(t,r,e[r])}}(t,yt,bt),this.observeArray(t)):this.walk(t)};function St(t,e){var i;if(h(t)&&!(t instanceof ft))return y(t,"__ob__")&&t.__ob__ instanceof kt?i=t.__ob__:wt&&!it()&&(Array.isArray(t)||l(t))&&Object.isExtensible(t)&&!t._isVue&&(i=new kt(t)),e&&i&&i.vmCount++,i}function Ct(t,e,i,n,s){var r=new ct,o=Object.getOwnPropertyDescriptor(t,e);if(!o||!1!==o.configurable){var a=o&&o.get,h=o&&o.set;a&&!h||2!==arguments.length||(i=t[e]);var c=!s&&St(i);Object.defineProperty(t,e,{enumerable:!0,configurable:!0,get:function(){var e=a?a.call(t):i;return ct.target&&(r.depend(),c&&(c.dep.depend(),Array.isArray(e)&&Ot(e))),e},set:function(e){var n=a?a.call(t):i;e===n||e!=e&&n!=n||a&&!h||(h?h.call(t,e):i=e,c=!s&&St(e),r.notify())}})}}function Tt(t,e,i){if(Array.isArray(t)&&u(e))return t.length=Math.max(t.length,e),t.splice(e,1,i),i;if(e in t&&!(e in Object.prototype))return t[e]=i,i;var n=t.__ob__;return t._isVue||n&&n.vmCount?i:n?(Ct(n.value,e,i),n.dep.notify(),i):(t[e]=i,i)}function Et(t,e){if(Array.isArray(t)&&u(e))t.splice(e,1);else{var i=t.__ob__;t._isVue||i&&i.vmCount||y(t,e)&&(delete t[e],i&&i.dep.notify())}}function Ot(t){for(var e=void 0,i=0,n=t.length;i<n;i++)(e=t[i])&&e.__ob__&&e.__ob__.dep.depend(),Array.isArray(e)&&Ot(e)}kt.prototype.walk=function(t){for(var e=Object.keys(t),i=0;i<e.length;i++)Ct(t,e[i])},kt.prototype.observeArray=function(t){for(var e=0,i=t.length;e<i;e++)St(t[e])};var Bt=N.optionMergeStrategies;function It(t,e){if(!e)return t;for(var i,n,s,r=ot?Reflect.ownKeys(e):Object.keys(e),o=0;o<r.length;o++)"__ob__"!==(i=r[o])&&(n=t[i],s=e[i],y(t,i)?n!==s&&l(n)&&l(s)&&It(n,s):Tt(t,i,s));return t}function Lt(t,e,i){return i?function(){var n="function"==typeof e?e.call(i,i):e,s="function"==typeof t?t.call(i,i):t;return n?It(n,s):s}:e?t?function(){return It("function"==typeof e?e.call(this,this):e,"function"==typeof t?t.call(this,this):t)}:e:t}function jt(t,e){var i=e?t?t.concat(e):Array.isArray(e)?e:[e]:t;return i?function(t){for(var e=[],i=0;i<t.length;i++)-1===e.indexOf(t[i])&&e.push(t[i]);return e}(i):i}function Pt(t,e,i,n){var s=Object.create(t||null);return e?O(s,e):s}Bt.data=function(t,e,i){return i?Lt(t,e,i):e&&"function"!=typeof e?t:Lt(t,e)},$.forEach((function(t){Bt[t]=jt})),D.forEach((function(t){Bt[t+"s"]=Pt})),Bt.watch=function(t,e,i,n){if(t===Q&&(t=void 0),e===Q&&(e=void 0),!e)return Object.create(t||null);if(!t)return e;var s={};for(var r in O(s,t),e){var o=s[r],a=e[r];o&&!Array.isArray(o)&&(o=[o]),s[r]=o?o.concat(a):Array.isArray(a)?a:[a]}return s},Bt.props=Bt.methods=Bt.inject=Bt.computed=function(t,e,i,n){if(!t)return e;var s=Object.create(null);return O(s,t),e&&O(s,e),s},Bt.provide=Lt;var Mt=function(t,e){return void 0===e?t:e};function At(t,e,i){if("function"==typeof e&&(e=e.options),function(t,e){var i=t.props;if(i){var n,s,r={};if(Array.isArray(i))for(n=i.length;n--;)"string"==typeof(s=i[n])&&(r[x(s)]={type:null});else if(l(i))for(var o in i)s=i[o],r[x(o)]=l(s)?s:{type:s};t.props=r}}(e),function(t,e){var i=t.inject;if(i){var n=t.inject={};if(Array.isArray(i))for(var s=0;s<i.length;s++)n[i[s]]={from:i[s]};else if(l(i))for(var r in i){var o=i[r];n[r]=l(o)?O({from:r},o):{from:o}}}}(e),function(t){var e=t.directives;if(e)for(var i in e){var n=e[i];"function"==typeof n&&(e[i]={bind:n,update:n})}}(e),!e._base&&(e.extends&&(t=At(t,e.extends,i)),e.mixins))for(var n=0,s=e.mixins.length;n<s;n++)t=At(t,e.mixins[n],i);var r,o={};for(r in t)a(r);for(r in e)y(t,r)||a(r);function a(n){var s=Bt[n]||Mt;o[n]=s(t[n],e[n],i,n)}return o}function Rt(t,e,i,n){if("string"==typeof i){var s=t[e];if(y(s,i))return s[i];var r=x(i);if(y(s,r))return s[r];var o=k(r);return y(s,o)?s[o]:s[i]||s[r]||s[o]}}function Dt(t,e,i,n){var s=e[t],r=!y(i,t),o=i[t],a=Wt(Boolean,s.type);if(a>-1)if(r&&!y(s,"default"))o=!1;else if(""===o||o===C(t)){var h=Wt(String,s.type);(h<0||a<h)&&(o=!0)}if(void 0===o){o=function(t,e,i){if(y(e,"default")){var n=e.default;return t&&t.$options.propsData&&void 0===t.$options.propsData[i]&&void 0!==t._props[i]?t._props[i]:"function"==typeof n&&"Function"!==Nt(e.type)?n.call(t):n}}(n,s,t);var c=wt;xt(!0),St(o),xt(c)}return o}var $t=/^\s*function (\w+)/;function Nt(t){var e=t&&t.toString().match($t);return e?e[1]:""}function Ft(t,e){return Nt(t)===Nt(e)}function Wt(t,e){if(!Array.isArray(e))return Ft(e,t)?0:-1;for(var i=0,n=e.length;i<n;i++)if(Ft(e[i],t))return i;return-1}function Ht(t,e,i){ut();try{if(e)for(var n=e;n=n.$parent;){var s=n.$options.errorCaptured;if(s)for(var r=0;r<s.length;r++)try{if(!1===s[r].call(n,t,e,i))return}catch(t){Vt(t,n,"errorCaptured hook")}}Vt(t,e,i)}finally{dt()}}function zt(t,e,i,n,s){var r;try{(r=i?t.apply(e,i):t.call(e))&&!r._isVue&&d(r)&&!r._handled&&(r.catch((function(t){return Ht(t,n,s+" (Promise/async)")})),r._handled=!0)}catch(t){Ht(t,n,s)}return r}function Vt(t,e,i){if(N.errorHandler)try{return N.errorHandler.call(null,t,e,i)}catch(e){e!==t&&Xt(e)}Xt(t)}function Xt(t,e,i){if(!V&&!X||"undefined"==typeof console)throw t;console.error(t)}var Yt,Gt=!1,Ut=[],qt=!1;function Jt(){qt=!1;var t=Ut.slice(0);Ut.length=0;for(var e=0;e<t.length;e++)t[e]()}if("undefined"!=typeof Promise&&st(Promise)){var Kt=Promise.resolve();Yt=function(){Kt.then(Jt),K&&setTimeout(I)},Gt=!0}else if(U||"undefined"==typeof MutationObserver||!st(MutationObserver)&&"[object MutationObserverConstructor]"!==MutationObserver.toString())Yt="undefined"!=typeof setImmediate&&st(setImmediate)?function(){setImmediate(Jt)}:function(){setTimeout(Jt,0)};else{var Zt=1,Qt=new MutationObserver(Jt),te=document.createTextNode(String(Zt));Qt.observe(te,{characterData:!0}),Yt=function(){Zt=(Zt+1)%2,te.data=String(Zt)},Gt=!0}function ee(t,e){var i;if(Ut.push((function(){if(t)try{t.call(e)}catch(t){Ht(t,e,"nextTick")}else i&&i(e)})),qt||(qt=!0,Yt()),!t&&"undefined"!=typeof Promise)return new Promise((function(t){i=t}))}var ie=new rt;function ne(t){se(t,ie),ie.clear()}function se(t,e){var i,n,s=Array.isArray(t);if(!(!s&&!h(t)||Object.isFrozen(t)||t instanceof ft)){if(t.__ob__){var r=t.__ob__.dep.id;if(e.has(r))return;e.add(r)}if(s)for(i=t.length;i--;)se(t[i],e);else for(i=(n=Object.keys(t)).length;i--;)se(t[n[i]],e)}}var re=b((function(t){var e="&"===t.charAt(0),i="~"===(t=e?t.slice(1):t).charAt(0),n="!"===(t=i?t.slice(1):t).charAt(0);return{name:t=n?t.slice(1):t,once:i,capture:n,passive:e}}));function oe(t,e){function i(){var t=arguments,n=i.fns;if(!Array.isArray(n))return zt(n,null,arguments,e,"v-on handler");for(var s=n.slice(),r=0;r<s.length;r++)zt(s[r],null,t,e,"v-on handler")}return i.fns=t,i}function ae(t,e,i,n,r,a){var h,c,l,u;for(h in t)c=t[h],l=e[h],u=re(h),s(c)||(s(l)?(s(c.fns)&&(c=t[h]=oe(c,a)),o(u.once)&&(c=t[h]=r(u.name,c,u.capture)),i(u.name,c,u.capture,u.passive,u.params)):c!==l&&(l.fns=c,t[h]=l));for(h in e)s(t[h])&&n((u=re(h)).name,e[h],u.capture)}function he(t,e,i){var n;t instanceof ft&&(t=t.data.hook||(t.data.hook={}));var a=t[e];function h(){i.apply(this,arguments),m(n.fns,h)}s(a)?n=oe([h]):r(a.fns)&&o(a.merged)?(n=a).fns.push(h):n=oe([a,h]),n.merged=!0,t[e]=n}function ce(t,e,i,n,s){if(r(e)){if(y(e,i))return t[i]=e[i],s||delete e[i],!0;if(y(e,n))return t[i]=e[n],s||delete e[n],!0}return!1}function le(t){return a(t)?[_t(t)]:Array.isArray(t)?de(t):void 0}function ue(t){return r(t)&&r(t.text)&&!1===t.isComment}function de(t,e){var i,n,h,c,l=[];for(i=0;i<t.length;i++)s(n=t[i])||"boolean"==typeof n||(c=l[h=l.length-1],Array.isArray(n)?n.length>0&&(ue((n=de(n,(e||"")+"_"+i))[0])&&ue(c)&&(l[h]=_t(c.text+n[0].text),n.shift()),l.push.apply(l,n)):a(n)?ue(c)?l[h]=_t(c.text+n):""!==n&&l.push(_t(n)):ue(n)&&ue(c)?l[h]=_t(c.text+n.text):(o(t._isVList)&&r(n.tag)&&s(n.key)&&r(e)&&(n.key="__vlist"+e+"_"+i+"__"),l.push(n)));return l}function fe(t,e){if(t){for(var i=Object.create(null),n=ot?Reflect.ownKeys(t):Object.keys(t),s=0;s<n.length;s++){var r=n[s];if("__ob__"!==r){for(var o=t[r].from,a=e;a;){if(a._provided&&y(a._provided,o)){i[r]=a._provided[o];break}a=a.$parent}if(!a&&"default"in t[r]){var h=t[r].default;i[r]="function"==typeof h?h.call(e):h}}}return i}}function pe(t,e){if(!t||!t.length)return{};for(var i={},n=0,s=t.length;n<s;n++){var r=t[n],o=r.data;if(o&&o.attrs&&o.attrs.slot&&delete o.attrs.slot,r.context!==e&&r.fnContext!==e||!o||null==o.slot)(i.default||(i.default=[])).push(r);else{var a=o.slot,h=i[a]||(i[a]=[]);"template"===r.tag?h.push.apply(h,r.children||[]):h.push(r)}}for(var c in i)i[c].every(ge)&&delete i[c];return i}function ge(t){return t.isComment&&!t.asyncFactory||" "===t.text}function _e(t){return t.isComment&&t.asyncFactory}function me(t,e,n){var s,r=Object.keys(e).length>0,o=t?!!t.$stable:!r,a=t&&t.$key;if(t){if(t._normalized)return t._normalized;if(o&&n&&n!==i&&a===n.$key&&!r&&!n.$hasNormal)return n;for(var h in s={},t)t[h]&&"$"!==h[0]&&(s[h]=ve(e,h,t[h]))}else s={};for(var c in e)c in s||(s[c]=ye(e,c));return t&&Object.isExtensible(t)&&(t._normalized=s),F(s,"$stable",o),F(s,"$key",a),F(s,"$hasNormal",r),s}function ve(t,e,i){var n=function(){var t=arguments.length?i.apply(null,arguments):i({}),e=(t=t&&"object"==typeof t&&!Array.isArray(t)?[t]:le(t))&&t[0];return t&&(!e||1===t.length&&e.isComment&&!_e(e))?void 0:t};return i.proxy&&Object.defineProperty(t,e,{get:n,enumerable:!0,configurable:!0}),n}function ye(t,e){return function(){return t[e]}}function be(t,e){var i,n,s,o,a;if(Array.isArray(t)||"string"==typeof t)for(i=new Array(t.length),n=0,s=t.length;n<s;n++)i[n]=e(t[n],n);else if("number"==typeof t)for(i=new Array(t),n=0;n<t;n++)i[n]=e(n+1,n);else if(h(t))if(ot&&t[Symbol.iterator]){i=[];for(var c=t[Symbol.iterator](),l=c.next();!l.done;)i.push(e(l.value,i.length)),l=c.next()}else for(o=Object.keys(t),i=new Array(o.length),n=0,s=o.length;n<s;n++)a=o[n],i[n]=e(t[a],a,n);return r(i)||(i=[]),i._isVList=!0,i}function we(t,e,i,n){var s,r=this.$scopedSlots[t];r?(i=i||{},n&&(i=O(O({},n),i)),s=r(i)||("function"==typeof e?e():e)):s=this.$slots[t]||("function"==typeof e?e():e);var o=i&&i.slot;return o?this.$createElement("template",{slot:o},s):s}function xe(t){return Rt(this.$options,"filters",t)||j}function ke(t,e){return Array.isArray(t)?-1===t.indexOf(e):t!==e}function Se(t,e,i,n,s){var r=N.keyCodes[e]||i;return s&&n&&!N.keyCodes[e]?ke(s,n):r?ke(r,t):n?C(n)!==e:void 0===t}function Ce(t,e,i,n,s){if(i&&h(i)){var r;Array.isArray(i)&&(i=B(i));var o=function(o){if("class"===o||"style"===o||_(o))r=t;else{var a=t.attrs&&t.attrs.type;r=n||N.mustUseProp(e,a,o)?t.domProps||(t.domProps={}):t.attrs||(t.attrs={})}var h=x(o),c=C(o);h in r||c in r||(r[o]=i[o],s&&((t.on||(t.on={}))["update:"+o]=function(t){i[o]=t}))};for(var a in i)o(a)}return t}function Te(t,e){var i=this._staticTrees||(this._staticTrees=[]),n=i[t];return n&&!e||Oe(n=i[t]=this.$options.staticRenderFns[t].call(this._renderProxy,null,this),"__static__"+t,!1),n}function Ee(t,e,i){return Oe(t,"__once__"+e+(i?"_"+i:""),!0),t}function Oe(t,e,i){if(Array.isArray(t))for(var n=0;n<t.length;n++)t[n]&&"string"!=typeof t[n]&&Be(t[n],e+"_"+n,i);else Be(t,e,i)}function Be(t,e,i){t.isStatic=!0,t.key=e,t.isOnce=i}function Ie(t,e){if(e&&l(e)){var i=t.on=t.on?O({},t.on):{};for(var n in e){var s=i[n],r=e[n];i[n]=s?[].concat(s,r):r}}return t}function Le(t,e,i,n){e=e||{$stable:!i};for(var s=0;s<t.length;s++){var r=t[s];Array.isArray(r)?Le(r,e,i):r&&(r.proxy&&(r.fn.proxy=!0),e[r.key]=r.fn)}return n&&(e.$key=n),e}function je(t,e){for(var i=0;i<e.length;i+=2){var n=e[i];"string"==typeof n&&n&&(t[e[i]]=e[i+1])}return t}function Pe(t,e){return"string"==typeof t?e+t:t}function Me(t){t._o=Ee,t._n=p,t._s=f,t._l=be,t._t=we,t._q=P,t._i=M,t._m=Te,t._f=xe,t._k=Se,t._b=Ce,t._v=_t,t._e=gt,t._u=Le,t._g=Ie,t._d=je,t._p=Pe}function Ae(t,e,n,s,r){var a,h=this,c=r.options;y(s,"_uid")?(a=Object.create(s))._original=s:(a=s,s=s._original);var l=o(c._compiled),u=!l;this.data=t,this.props=e,this.children=n,this.parent=s,this.listeners=t.on||i,this.injections=fe(c.inject,s),this.slots=function(){return h.$slots||me(t.scopedSlots,h.$slots=pe(n,s)),h.$slots},Object.defineProperty(this,"scopedSlots",{enumerable:!0,get:function(){return me(t.scopedSlots,this.slots())}}),l&&(this.$options=c,this.$slots=this.slots(),this.$scopedSlots=me(t.scopedSlots,this.$slots)),c._scopeId?this._c=function(t,e,i,n){var r=He(a,t,e,i,n,u);return r&&!Array.isArray(r)&&(r.fnScopeId=c._scopeId,r.fnContext=s),r}:this._c=function(t,e,i,n){return He(a,t,e,i,n,u)}}function Re(t,e,i,n,s){var r=mt(t);return r.fnContext=i,r.fnOptions=n,e.slot&&((r.data||(r.data={})).slot=e.slot),r}function De(t,e){for(var i in e)t[x(i)]=e[i]}Me(Ae.prototype);var $e={init:function(t,e){if(t.componentInstance&&!t.componentInstance._isDestroyed&&t.data.keepAlive){var i=t;$e.prepatch(i,i)}else(t.componentInstance=function(t,e){var i={_isComponent:!0,_parentVnode:t,parent:e},n=t.data.inlineTemplate;return r(n)&&(i.render=n.render,i.staticRenderFns=n.staticRenderFns),new t.componentOptions.Ctor(i)}(t,Ze)).$mount(e?t.elm:void 0,e)},prepatch:function(t,e){var n=e.componentOptions;!function(t,e,n,s,r){var o=s.data.scopedSlots,a=t.$scopedSlots,h=!!(o&&!o.$stable||a!==i&&!a.$stable||o&&t.$scopedSlots.$key!==o.$key||!o&&t.$scopedSlots.$key),c=!!(r||t.$options._renderChildren||h);if(t.$options._parentVnode=s,t.$vnode=s,t._vnode&&(t._vnode.parent=s),t.$options._renderChildren=r,t.$attrs=s.data.attrs||i,t.$listeners=n||i,e&&t.$options.props){xt(!1);for(var l=t._props,u=t.$options._propKeys||[],d=0;d<u.length;d++){var f=u[d],p=t.$options.props;l[f]=Dt(f,p,e,t)}xt(!0),t.$options.propsData=e}n=n||i;var g=t.$options._parentListeners;t.$options._parentListeners=n,Ke(t,n,g),c&&(t.$slots=pe(r,s.context),t.$forceUpdate())}(e.componentInstance=t.componentInstance,n.propsData,n.listeners,e,n.children)},insert:function(t){var e,i=t.context,n=t.componentInstance;n._isMounted||(n._isMounted=!0,ni(n,"mounted")),t.data.keepAlive&&(i._isMounted?((e=n)._inactive=!1,ri.push(e)):ei(n,!0))},destroy:function(t){var e=t.componentInstance;e._isDestroyed||(t.data.keepAlive?ii(e,!0):e.$destroy())}},Ne=Object.keys($e);function Fe(t,e,n,a,c){if(!s(t)){var l=n.$options._base;if(h(t)&&(t=l.extend(t)),"function"==typeof t){var u;if(s(t.cid)&&(t=function(t,e){if(o(t.error)&&r(t.errorComp))return t.errorComp;if(r(t.resolved))return t.resolved;var i=Xe;if(i&&r(t.owners)&&-1===t.owners.indexOf(i)&&t.owners.push(i),o(t.loading)&&r(t.loadingComp))return t.loadingComp;if(i&&!r(t.owners)){var n=t.owners=[i],a=!0,c=null,l=null;i.$on("hook:destroyed",(function(){return m(n,i)}));var u=function(t){for(var e=0,i=n.length;e<i;e++)n[e].$forceUpdate();t&&(n.length=0,null!==c&&(clearTimeout(c),c=null),null!==l&&(clearTimeout(l),l=null))},f=A((function(i){t.resolved=Ye(i,e),a?n.length=0:u(!0)})),p=A((function(e){r(t.errorComp)&&(t.error=!0,u(!0))})),g=t(f,p);return h(g)&&(d(g)?s(t.resolved)&&g.then(f,p):d(g.component)&&(g.component.then(f,p),r(g.error)&&(t.errorComp=Ye(g.error,e)),r(g.loading)&&(t.loadingComp=Ye(g.loading,e),0===g.delay?t.loading=!0:c=setTimeout((function(){c=null,s(t.resolved)&&s(t.error)&&(t.loading=!0,u(!1))}),g.delay||200)),r(g.timeout)&&(l=setTimeout((function(){l=null,s(t.resolved)&&p(null)}),g.timeout)))),a=!1,t.loading?t.loadingComp:t.resolved}}(u=t,l),void 0===t))return function(t,e,i,n,s){var r=gt();return r.asyncFactory=t,r.asyncMeta={data:e,context:i,children:n,tag:s},r}(u,e,n,a,c);e=e||{},Si(t),r(e.model)&&function(t,e){var i=t.model&&t.model.prop||"value",n=t.model&&t.model.event||"input";(e.attrs||(e.attrs={}))[i]=e.model.value;var s=e.on||(e.on={}),o=s[n],a=e.model.callback;r(o)?(Array.isArray(o)?-1===o.indexOf(a):o!==a)&&(s[n]=[a].concat(o)):s[n]=a}(t.options,e);var f=function(t,e,i){var n=e.options.props;if(!s(n)){var o={},a=t.attrs,h=t.props;if(r(a)||r(h))for(var c in n){var l=C(c);ce(o,h,c,l,!0)||ce(o,a,c,l,!1)}return o}}(e,t);if(o(t.options.functional))return function(t,e,n,s,o){var a=t.options,h={},c=a.props;if(r(c))for(var l in c)h[l]=Dt(l,c,e||i);else r(n.attrs)&&De(h,n.attrs),r(n.props)&&De(h,n.props);var u=new Ae(n,h,o,s,t),d=a.render.call(null,u._c,u);if(d instanceof ft)return Re(d,n,u.parent,a);if(Array.isArray(d)){for(var f=le(d)||[],p=new Array(f.length),g=0;g<f.length;g++)p[g]=Re(f[g],n,u.parent,a);return p}}(t,f,e,n,a);var p=e.on;if(e.on=e.nativeOn,o(t.options.abstract)){var g=e.slot;e={},g&&(e.slot=g)}!function(t){for(var e=t.hook||(t.hook={}),i=0;i<Ne.length;i++){var n=Ne[i],s=e[n],r=$e[n];s===r||s&&s._merged||(e[n]=s?We(r,s):r)}}(e);var _=t.options.name||c;return new ft("vue-component-"+t.cid+(_?"-"+_:""),e,void 0,void 0,void 0,n,{Ctor:t,propsData:f,listeners:p,tag:c,children:a},u)}}}function We(t,e){var i=function(i,n){t(i,n),e(i,n)};return i._merged=!0,i}function He(t,e,i,n,s,c){return(Array.isArray(i)||a(i))&&(s=n,n=i,i=void 0),o(c)&&(s=2),function(t,e,i,n,s){if(r(i)&&r(i.__ob__))return gt();if(r(i)&&r(i.is)&&(e=i.is),!e)return gt();var o,a,c;(Array.isArray(n)&&"function"==typeof n[0]&&((i=i||{}).scopedSlots={default:n[0]},n.length=0),2===s?n=le(n):1===s&&(n=function(t){for(var e=0;e<t.length;e++)if(Array.isArray(t[e]))return Array.prototype.concat.apply([],t);return t}(n)),"string"==typeof e)?(a=t.$vnode&&t.$vnode.ns||N.getTagNamespace(e),o=N.isReservedTag(e)?new ft(N.parsePlatformTagName(e),i,n,void 0,void 0,t):i&&i.pre||!r(c=Rt(t.$options,"components",e))?new ft(e,i,n,void 0,void 0,t):Fe(c,i,t,n,e)):o=Fe(e,i,t,n);return Array.isArray(o)?o:r(o)?(r(a)&&ze(o,a),r(i)&&function(t){h(t.style)&&ne(t.style),h(t.class)&&ne(t.class)}(i),o):gt()}(t,e,i,n,s)}function ze(t,e,i){if(t.ns=e,"foreignObject"===t.tag&&(e=void 0,i=!0),r(t.children))for(var n=0,a=t.children.length;n<a;n++){var h=t.children[n];r(h.tag)&&(s(h.ns)||o(i)&&"svg"!==h.tag)&&ze(h,e,i)}}var Ve,Xe=null;function Ye(t,e){return(t.__esModule||ot&&"Module"===t[Symbol.toStringTag])&&(t=t.default),h(t)?e.extend(t):t}function Ge(t){if(Array.isArray(t))for(var e=0;e<t.length;e++){var i=t[e];if(r(i)&&(r(i.componentOptions)||_e(i)))return i}}function Ue(t,e){Ve.$on(t,e)}function qe(t,e){Ve.$off(t,e)}function Je(t,e){var i=Ve;return function n(){var s=e.apply(null,arguments);null!==s&&i.$off(t,n)}}function Ke(t,e,i){Ve=t,ae(e,i||{},Ue,qe,Je,t),Ve=void 0}var Ze=null;function Qe(t){var e=Ze;return Ze=t,function(){Ze=e}}function ti(t){for(;t&&(t=t.$parent);)if(t._inactive)return!0;return!1}function ei(t,e){if(e){if(t._directInactive=!1,ti(t))return}else if(t._directInactive)return;if(t._inactive||null===t._inactive){t._inactive=!1;for(var i=0;i<t.$children.length;i++)ei(t.$children[i]);ni(t,"activated")}}function ii(t,e){if(!(e&&(t._directInactive=!0,ti(t))||t._inactive)){t._inactive=!0;for(var i=0;i<t.$children.length;i++)ii(t.$children[i]);ni(t,"deactivated")}}function ni(t,e){ut();var i=t.$options[e],n=e+" hook";if(i)for(var s=0,r=i.length;s<r;s++)zt(i[s],t,null,t,n);t._hasHookEvent&&t.$emit("hook:"+e),dt()}var si=[],ri=[],oi={},ai=!1,hi=!1,ci=0,li=0,ui=Date.now;if(V&&!U){var di=window.performance;di&&"function"==typeof di.now&&ui()>document.createEvent("Event").timeStamp&&(ui=function(){return di.now()})}function fi(){var t,e;for(li=ui(),hi=!0,si.sort((function(t,e){return t.id-e.id})),ci=0;ci<si.length;ci++)(t=si[ci]).before&&t.before(),e=t.id,oi[e]=null,t.run();var i=ri.slice(),n=si.slice();ci=si.length=ri.length=0,oi={},ai=hi=!1,function(t){for(var e=0;e<t.length;e++)t[e]._inactive=!0,ei(t[e],!0)}(i),function(t){for(var e=t.length;e--;){var i=t[e],n=i.vm;n._watcher===i&&n._isMounted&&!n._isDestroyed&&ni(n,"updated")}}(n),nt&&N.devtools&&nt.emit("flush")}var pi=0,gi=function(t,e,i,n,s){this.vm=t,s&&(t._watcher=this),t._watchers.push(this),n?(this.deep=!!n.deep,this.user=!!n.user,this.lazy=!!n.lazy,this.sync=!!n.sync,this.before=n.before):this.deep=this.user=this.lazy=this.sync=!1,this.cb=i,this.id=++pi,this.active=!0,this.dirty=this.lazy,this.deps=[],this.newDeps=[],this.depIds=new rt,this.newDepIds=new rt,this.expression="","function"==typeof e?this.getter=e:(this.getter=function(t){if(!H.test(t)){var e=t.split(".");return function(t){for(var i=0;i<e.length;i++){if(!t)return;t=t[e[i]]}return t}}}(e),this.getter||(this.getter=I)),this.value=this.lazy?void 0:this.get()};gi.prototype.get=function(){var t;ut(this);var e=this.vm;try{t=this.getter.call(e,e)}catch(t){if(!this.user)throw t;Ht(t,e,'getter for watcher "'+this.expression+'"')}finally{this.deep&&ne(t),dt(),this.cleanupDeps()}return t},gi.prototype.addDep=function(t){var e=t.id;this.newDepIds.has(e)||(this.newDepIds.add(e),this.newDeps.push(t),this.depIds.has(e)||t.addSub(this))},gi.prototype.cleanupDeps=function(){for(var t=this.deps.length;t--;){var e=this.deps[t];this.newDepIds.has(e.id)||e.removeSub(this)}var i=this.depIds;this.depIds=this.newDepIds,this.newDepIds=i,this.newDepIds.clear(),i=this.deps,this.deps=this.newDeps,this.newDeps=i,this.newDeps.length=0},gi.prototype.update=function(){this.lazy?this.dirty=!0:this.sync?this.run():function(t){var e=t.id;if(null==oi[e]){if(oi[e]=!0,hi){for(var i=si.length-1;i>ci&&si[i].id>t.id;)i--;si.splice(i+1,0,t)}else si.push(t);ai||(ai=!0,ee(fi))}}(this)},gi.prototype.run=function(){if(this.active){var t=this.get();if(t!==this.value||h(t)||this.deep){var e=this.value;if(this.value=t,this.user){var i='callback for watcher "'+this.expression+'"';zt(this.cb,this.vm,[t,e],this.vm,i)}else this.cb.call(this.vm,t,e)}}},gi.prototype.evaluate=function(){this.value=this.get(),this.dirty=!1},gi.prototype.depend=function(){for(var t=this.deps.length;t--;)this.deps[t].depend()},gi.prototype.teardown=function(){if(this.active){this.vm._isBeingDestroyed||m(this.vm._watchers,this);for(var t=this.deps.length;t--;)this.deps[t].removeSub(this);this.active=!1}};var _i={enumerable:!0,configurable:!0,get:I,set:I};function mi(t,e,i){_i.get=function(){return this[e][i]},_i.set=function(t){this[e][i]=t},Object.defineProperty(t,i,_i)}var vi={lazy:!0};function yi(t,e,i){var n=!it();"function"==typeof i?(_i.get=n?bi(e):wi(i),_i.set=I):(_i.get=i.get?n&&!1!==i.cache?bi(e):wi(i.get):I,_i.set=i.set||I),Object.defineProperty(t,e,_i)}function bi(t){return function(){var e=this._computedWatchers&&this._computedWatchers[t];if(e)return e.dirty&&e.evaluate(),ct.target&&e.depend(),e.value}}function wi(t){return function(){return t.call(this,this)}}function xi(t,e,i,n){return l(i)&&(n=i,i=i.handler),"string"==typeof i&&(i=t[i]),t.$watch(e,i,n)}var ki=0;function Si(t){var e=t.options;if(t.super){var i=Si(t.super);if(i!==t.superOptions){t.superOptions=i;var n=function(t){var e,i=t.options,n=t.sealedOptions;for(var s in i)i[s]!==n[s]&&(e||(e={}),e[s]=i[s]);return e}(t);n&&O(t.extendOptions,n),(e=t.options=At(i,t.extendOptions)).name&&(e.components[e.name]=t)}}return e}function Ci(t){this._init(t)}function Ti(t){return t&&(t.Ctor.options.name||t.tag)}function Ei(t,e){return Array.isArray(t)?t.indexOf(e)>-1:"string"==typeof t?t.split(",").indexOf(e)>-1:(i=t,!("[object RegExp]"!==c.call(i))&&t.test(e));var i}function Oi(t,e){var i=t.cache,n=t.keys,s=t._vnode;for(var r in i){var o=i[r];if(o){var a=o.name;a&&!e(a)&&Bi(i,r,n,s)}}}function Bi(t,e,i,n){var s=t[e];!s||n&&s.tag===n.tag||s.componentInstance.$destroy(),t[e]=null,m(i,e)}!function(t){t.prototype._init=function(t){var e=this;e._uid=ki++,e._isVue=!0,t&&t._isComponent?function(t,e){var i=t.$options=Object.create(t.constructor.options),n=e._parentVnode;i.parent=e.parent,i._parentVnode=n;var s=n.componentOptions;i.propsData=s.propsData,i._parentListeners=s.listeners,i._renderChildren=s.children,i._componentTag=s.tag,e.render&&(i.render=e.render,i.staticRenderFns=e.staticRenderFns)}(e,t):e.$options=At(Si(e.constructor),t||{},e),e._renderProxy=e,e._self=e,function(t){var e=t.$options,i=e.parent;if(i&&!e.abstract){for(;i.$options.abstract&&i.$parent;)i=i.$parent;i.$children.push(t)}t.$parent=i,t.$root=i?i.$root:t,t.$children=[],t.$refs={},t._watcher=null,t._inactive=null,t._directInactive=!1,t._isMounted=!1,t._isDestroyed=!1,t._isBeingDestroyed=!1}(e),function(t){t._events=Object.create(null),t._hasHookEvent=!1;var e=t.$options._parentListeners;e&&Ke(t,e)}(e),function(t){t._vnode=null,t._staticTrees=null;var e=t.$options,n=t.$vnode=e._parentVnode,s=n&&n.context;t.$slots=pe(e._renderChildren,s),t.$scopedSlots=i,t._c=function(e,i,n,s){return He(t,e,i,n,s,!1)},t.$createElement=function(e,i,n,s){return He(t,e,i,n,s,!0)};var r=n&&n.data;Ct(t,"$attrs",r&&r.attrs||i,null,!0),Ct(t,"$listeners",e._parentListeners||i,null,!0)}(e),ni(e,"beforeCreate"),function(t){var e=fe(t.$options.inject,t);e&&(xt(!1),Object.keys(e).forEach((function(i){Ct(t,i,e[i])})),xt(!0))}(e),function(t){t._watchers=[];var e=t.$options;e.props&&function(t,e){var i=t.$options.propsData||{},n=t._props={},s=t.$options._propKeys=[];t.$parent&&xt(!1);var r=function(r){s.push(r);var o=Dt(r,e,i,t);Ct(n,r,o),r in t||mi(t,"_props",r)};for(var o in e)r(o);xt(!0)}(t,e.props),e.methods&&function(t,e){for(var i in t.$options.props,e)t[i]="function"!=typeof e[i]?I:T(e[i],t)}(t,e.methods),e.data?function(t){var e=t.$options.data;l(e=t._data="function"==typeof e?function(t,e){ut();try{return t.call(e,e)}catch(t){return Ht(t,e,"data()"),{}}finally{dt()}}(e,t):e||{})||(e={});for(var i,n=Object.keys(e),s=t.$options.props,r=(t.$options.methods,n.length);r--;){var o=n[r];s&&y(s,o)||(i=void 0,36===(i=(o+"").charCodeAt(0))||95===i)||mi(t,"_data",o)}St(e,!0)}(t):St(t._data={},!0),e.computed&&function(t,e){var i=t._computedWatchers=Object.create(null),n=it();for(var s in e){var r=e[s],o="function"==typeof r?r:r.get;n||(i[s]=new gi(t,o||I,I,vi)),s in t||yi(t,s,r)}}(t,e.computed),e.watch&&e.watch!==Q&&function(t,e){for(var i in e){var n=e[i];if(Array.isArray(n))for(var s=0;s<n.length;s++)xi(t,i,n[s]);else xi(t,i,n)}}(t,e.watch)}(e),function(t){var e=t.$options.provide;e&&(t._provided="function"==typeof e?e.call(t):e)}(e),ni(e,"created"),e.$options.el&&e.$mount(e.$options.el)}}(Ci),function(t){Object.defineProperty(t.prototype,"$data",{get:function(){return this._data}}),Object.defineProperty(t.prototype,"$props",{get:function(){return this._props}}),t.prototype.$set=Tt,t.prototype.$delete=Et,t.prototype.$watch=function(t,e,i){var n=this;if(l(e))return xi(n,t,e,i);(i=i||{}).user=!0;var s=new gi(n,t,e,i);if(i.immediate){var r='callback for immediate watcher "'+s.expression+'"';ut(),zt(e,n,[s.value],n,r),dt()}return function(){s.teardown()}}}(Ci),function(t){var e=/^hook:/;t.prototype.$on=function(t,i){var n=this;if(Array.isArray(t))for(var s=0,r=t.length;s<r;s++)n.$on(t[s],i);else(n._events[t]||(n._events[t]=[])).push(i),e.test(t)&&(n._hasHookEvent=!0);return n},t.prototype.$once=function(t,e){var i=this;function n(){i.$off(t,n),e.apply(i,arguments)}return n.fn=e,i.$on(t,n),i},t.prototype.$off=function(t,e){var i=this;if(!arguments.length)return i._events=Object.create(null),i;if(Array.isArray(t)){for(var n=0,s=t.length;n<s;n++)i.$off(t[n],e);return i}var r,o=i._events[t];if(!o)return i;if(!e)return i._events[t]=null,i;for(var a=o.length;a--;)if((r=o[a])===e||r.fn===e){o.splice(a,1);break}return i},t.prototype.$emit=function(t){var e=this,i=e._events[t];if(i){i=i.length>1?E(i):i;for(var n=E(arguments,1),s='event handler for "'+t+'"',r=0,o=i.length;r<o;r++)zt(i[r],e,n,e,s)}return e}}(Ci),function(t){t.prototype._update=function(t,e){var i=this,n=i.$el,s=i._vnode,r=Qe(i);i._vnode=t,i.$el=s?i.__patch__(s,t):i.__patch__(i.$el,t,e,!1),r(),n&&(n.__vue__=null),i.$el&&(i.$el.__vue__=i),i.$vnode&&i.$parent&&i.$vnode===i.$parent._vnode&&(i.$parent.$el=i.$el)},t.prototype.$forceUpdate=function(){this._watcher&&this._watcher.update()},t.prototype.$destroy=function(){var t=this;if(!t._isBeingDestroyed){ni(t,"beforeDestroy"),t._isBeingDestroyed=!0;var e=t.$parent;!e||e._isBeingDestroyed||t.$options.abstract||m(e.$children,t),t._watcher&&t._watcher.teardown();for(var i=t._watchers.length;i--;)t._watchers[i].teardown();t._data.__ob__&&t._data.__ob__.vmCount--,t._isDestroyed=!0,t.__patch__(t._vnode,null),ni(t,"destroyed"),t.$off(),t.$el&&(t.$el.__vue__=null),t.$vnode&&(t.$vnode.parent=null)}}}(Ci),function(t){Me(t.prototype),t.prototype.$nextTick=function(t){return ee(t,this)},t.prototype._render=function(){var t,e=this,i=e.$options,n=i.render,s=i._parentVnode;s&&(e.$scopedSlots=me(s.data.scopedSlots,e.$slots,e.$scopedSlots)),e.$vnode=s;try{Xe=e,t=n.call(e._renderProxy,e.$createElement)}catch(i){Ht(i,e,"render"),t=e._vnode}finally{Xe=null}return Array.isArray(t)&&1===t.length&&(t=t[0]),t instanceof ft||(t=gt()),t.parent=s,t}}(Ci);var Ii=[String,RegExp,Array],Li={name:"keep-alive",abstract:!0,props:{include:Ii,exclude:Ii,max:[String,Number]},methods:{cacheVNode:function(){var t=this,e=t.cache,i=t.keys,n=t.vnodeToCache,s=t.keyToCache;if(n){var r=n.tag,o=n.componentInstance,a=n.componentOptions;e[s]={name:Ti(a),tag:r,componentInstance:o},i.push(s),this.max&&i.length>parseInt(this.max)&&Bi(e,i[0],i,this._vnode),this.vnodeToCache=null}}},created:function(){this.cache=Object.create(null),this.keys=[]},destroyed:function(){for(var t in this.cache)Bi(this.cache,t,this.keys)},mounted:function(){var t=this;this.cacheVNode(),this.$watch("include",(function(e){Oi(t,(function(t){return Ei(e,t)}))})),this.$watch("exclude",(function(e){Oi(t,(function(t){return!Ei(e,t)}))}))},updated:function(){this.cacheVNode()},render:function(){var t=this.$slots.default,e=Ge(t),i=e&&e.componentOptions;if(i){var n=Ti(i),s=this.include,r=this.exclude;if(s&&(!n||!Ei(s,n))||r&&n&&Ei(r,n))return e;var o=this.cache,a=this.keys,h=null==e.key?i.Ctor.cid+(i.tag?"::"+i.tag:""):e.key;o[h]?(e.componentInstance=o[h].componentInstance,m(a,h),a.push(h)):(this.vnodeToCache=e,this.keyToCache=h),e.data.keepAlive=!0}return e||t&&t[0]}},ji={KeepAlive:Li};!function(t){var e={get:function(){return N}};Object.defineProperty(t,"config",e),t.util={warn:at,extend:O,mergeOptions:At,defineReactive:Ct},t.set=Tt,t.delete=Et,t.nextTick=ee,t.observable=function(t){return St(t),t},t.options=Object.create(null),D.forEach((function(e){t.options[e+"s"]=Object.create(null)})),t.options._base=t,O(t.options.components,ji),function(t){t.use=function(t){var e=this._installedPlugins||(this._installedPlugins=[]);if(e.indexOf(t)>-1)return this;var i=E(arguments,1);return i.unshift(this),"function"==typeof t.install?t.install.apply(t,i):"function"==typeof t&&t.apply(null,i),e.push(t),this}}(t),function(t){t.mixin=function(t){return this.options=At(this.options,t),this}}(t),function(t){t.cid=0;var e=1;t.extend=function(t){t=t||{};var i=this,n=i.cid,s=t._Ctor||(t._Ctor={});if(s[n])return s[n];var r=t.name||i.options.name,o=function(t){this._init(t)};return(o.prototype=Object.create(i.prototype)).constructor=o,o.cid=e++,o.options=At(i.options,t),o.super=i,o.options.props&&function(t){var e=t.options.props;for(var i in e)mi(t.prototype,"_props",i)}(o),o.options.computed&&function(t){var e=t.options.computed;for(var i in e)yi(t.prototype,i,e[i])}(o),o.extend=i.extend,o.mixin=i.mixin,o.use=i.use,D.forEach((function(t){o[t]=i[t]})),r&&(o.options.components[r]=o),o.superOptions=i.options,o.extendOptions=t,o.sealedOptions=O({},o.options),s[n]=o,o}}(t),function(t){D.forEach((function(e){t[e]=function(t,i){return i?("component"===e&&l(i)&&(i.name=i.name||t,i=this.options._base.extend(i)),"directive"===e&&"function"==typeof i&&(i={bind:i,update:i}),this.options[e+"s"][t]=i,i):this.options[e+"s"][t]}}))}(t)}(Ci),Object.defineProperty(Ci.prototype,"$isServer",{get:it}),Object.defineProperty(Ci.prototype,"$ssrContext",{get:function(){return this.$vnode&&this.$vnode.ssrContext}}),Object.defineProperty(Ci,"FunctionalRenderContext",{value:Ae}),Ci.version="2.6.14";var Pi=g("style,class"),Mi=g("input,textarea,option,select,progress"),Ai=g("contenteditable,draggable,spellcheck"),Ri=g("events,caret,typing,plaintext-only"),Di=g("allowfullscreen,async,autofocus,autoplay,checked,compact,controls,declare,default,defaultchecked,defaultmuted,defaultselected,defer,disabled,enabled,formnovalidate,hidden,indeterminate,inert,ismap,itemscope,loop,multiple,muted,nohref,noresize,noshade,novalidate,nowrap,open,pauseonexit,readonly,required,reversed,scoped,seamless,selected,sortable,truespeed,typemustmatch,visible"),$i="http://www.w3.org/1999/xlink",Ni=function(t){return":"===t.charAt(5)&&"xlink"===t.slice(0,5)},Fi=function(t){return Ni(t)?t.slice(6,t.length):""},Wi=function(t){return null==t||!1===t};function Hi(t,e){return{staticClass:zi(t.staticClass,e.staticClass),class:r(t.class)?[t.class,e.class]:e.class}}function zi(t,e){return t?e?t+" "+e:t:e||""}function Vi(t){return Array.isArray(t)?function(t){for(var e,i="",n=0,s=t.length;n<s;n++)r(e=Vi(t[n]))&&""!==e&&(i&&(i+=" "),i+=e);return i}(t):h(t)?function(t){var e="";for(var i in t)t[i]&&(e&&(e+=" "),e+=i);return e}(t):"string"==typeof t?t:""}var Xi={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"},Yi=g("html,body,base,head,link,meta,style,title,address,article,aside,footer,header,h1,h2,h3,h4,h5,h6,hgroup,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,rtc,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,menuitem,summary,content,element,shadow,template,blockquote,iframe,tfoot"),Gi=g("svg,animate,circle,clippath,cursor,defs,desc,ellipse,filter,font-face,foreignobject,g,glyph,image,line,marker,mask,missing-glyph,path,pattern,polygon,polyline,rect,switch,symbol,text,textpath,tspan,use,view",!0),Ui=function(t){return Yi(t)||Gi(t)},qi=Object.create(null),Ji=g("text,number,password,search,email,tel,url"),Ki=Object.freeze({createElement:function(t,e){var i=document.createElement(t);return"select"!==t||e.data&&e.data.attrs&&void 0!==e.data.attrs.multiple&&i.setAttribute("multiple","multiple"),i},createElementNS:function(t,e){return document.createElementNS(Xi[t],e)},createTextNode:function(t){return document.createTextNode(t)},createComment:function(t){return document.createComment(t)},insertBefore:function(t,e,i){t.insertBefore(e,i)},removeChild:function(t,e){t.removeChild(e)},appendChild:function(t,e){t.appendChild(e)},parentNode:function(t){return t.parentNode},nextSibling:function(t){return t.nextSibling},tagName:function(t){return t.tagName},setTextContent:function(t,e){t.textContent=e},setStyleScope:function(t,e){t.setAttribute(e,"")}}),Zi={create:function(t,e){Qi(e)},update:function(t,e){t.data.ref!==e.data.ref&&(Qi(t,!0),Qi(e))},destroy:function(t){Qi(t,!0)}};function Qi(t,e){var i=t.data.ref;if(r(i)){var n=t.context,s=t.componentInstance||t.elm,o=n.$refs;e?Array.isArray(o[i])?m(o[i],s):o[i]===s&&(o[i]=void 0):t.data.refInFor?Array.isArray(o[i])?o[i].indexOf(s)<0&&o[i].push(s):o[i]=[s]:o[i]=s}}var tn=new ft("",{},[]),en=["create","activate","update","remove","destroy"];function nn(t,e){return t.key===e.key&&t.asyncFactory===e.asyncFactory&&(t.tag===e.tag&&t.isComment===e.isComment&&r(t.data)===r(e.data)&&function(t,e){if("input"!==t.tag)return!0;var i,n=r(i=t.data)&&r(i=i.attrs)&&i.type,s=r(i=e.data)&&r(i=i.attrs)&&i.type;return n===s||Ji(n)&&Ji(s)}(t,e)||o(t.isAsyncPlaceholder)&&s(e.asyncFactory.error))}function sn(t,e,i){var n,s,o={};for(n=e;n<=i;++n)r(s=t[n].key)&&(o[s]=n);return o}var rn={create:on,update:on,destroy:function(t){on(t,tn)}};function on(t,e){(t.data.directives||e.data.directives)&&function(t,e){var i,n,s,r=t===tn,o=e===tn,a=hn(t.data.directives,t.context),h=hn(e.data.directives,e.context),c=[],l=[];for(i in h)n=a[i],s=h[i],n?(s.oldValue=n.value,s.oldArg=n.arg,ln(s,"update",e,t),s.def&&s.def.componentUpdated&&l.push(s)):(ln(s,"bind",e,t),s.def&&s.def.inserted&&c.push(s));if(c.length){var u=function(){for(var i=0;i<c.length;i++)ln(c[i],"inserted",e,t)};r?he(e,"insert",u):u()}if(l.length&&he(e,"postpatch",(function(){for(var i=0;i<l.length;i++)ln(l[i],"componentUpdated",e,t)})),!r)for(i in a)h[i]||ln(a[i],"unbind",t,t,o)}(t,e)}var an=Object.create(null);function hn(t,e){var i,n,s=Object.create(null);if(!t)return s;for(i=0;i<t.length;i++)(n=t[i]).modifiers||(n.modifiers=an),s[cn(n)]=n,n.def=Rt(e.$options,"directives",n.name);return s}function cn(t){return t.rawName||t.name+"."+Object.keys(t.modifiers||{}).join(".")}function ln(t,e,i,n,s){var r=t.def&&t.def[e];if(r)try{r(i.elm,t,i,n,s)}catch(n){Ht(n,i.context,"directive "+t.name+" "+e+" hook")}}var un=[Zi,rn];function dn(t,e){var i=e.componentOptions;if(!(r(i)&&!1===i.Ctor.options.inheritAttrs||s(t.data.attrs)&&s(e.data.attrs))){var n,o,a=e.elm,h=t.data.attrs||{},c=e.data.attrs||{};for(n in r(c.__ob__)&&(c=e.data.attrs=O({},c)),c)o=c[n],h[n]!==o&&fn(a,n,o,e.data.pre);for(n in(U||J)&&c.value!==h.value&&fn(a,"value",c.value),h)s(c[n])&&(Ni(n)?a.removeAttributeNS($i,Fi(n)):Ai(n)||a.removeAttribute(n))}}function fn(t,e,i,n){n||t.tagName.indexOf("-")>-1?pn(t,e,i):Di(e)?Wi(i)?t.removeAttribute(e):(i="allowfullscreen"===e&&"EMBED"===t.tagName?"true":e,t.setAttribute(e,i)):Ai(e)?t.setAttribute(e,function(t,e){return Wi(e)||"false"===e?"false":"contenteditable"===t&&Ri(e)?e:"true"}(e,i)):Ni(e)?Wi(i)?t.removeAttributeNS($i,Fi(e)):t.setAttributeNS($i,e,i):pn(t,e,i)}function pn(t,e,i){if(Wi(i))t.removeAttribute(e);else{if(U&&!q&&"TEXTAREA"===t.tagName&&"placeholder"===e&&""!==i&&!t.__ieph){var n=function(e){e.stopImmediatePropagation(),t.removeEventListener("input",n)};t.addEventListener("input",n),t.__ieph=!0}t.setAttribute(e,i)}}var gn={create:dn,update:dn};function _n(t,e){var i=e.elm,n=e.data,o=t.data;if(!(s(n.staticClass)&&s(n.class)&&(s(o)||s(o.staticClass)&&s(o.class)))){var a=function(t){for(var e=t.data,i=t,n=t;r(n.componentInstance);)(n=n.componentInstance._vnode)&&n.data&&(e=Hi(n.data,e));for(;r(i=i.parent);)i&&i.data&&(e=Hi(e,i.data));return s=e.staticClass,o=e.class,r(s)||r(o)?zi(s,Vi(o)):"";var s,o}(e),h=i._transitionClasses;r(h)&&(a=zi(a,Vi(h))),a!==i._prevClass&&(i.setAttribute("class",a),i._prevClass=a)}}var mn,vn={create:_n,update:_n};function yn(t,e,i){var n=mn;return function s(){var r=e.apply(null,arguments);null!==r&&xn(t,s,i,n)}}var bn=Gt&&!(Z&&Number(Z[1])<=53);function wn(t,e,i,n){if(bn){var s=li,r=e;e=r._wrapper=function(t){if(t.target===t.currentTarget||t.timeStamp>=s||t.timeStamp<=0||t.target.ownerDocument!==document)return r.apply(this,arguments)}}mn.addEventListener(t,e,tt?{capture:i,passive:n}:i)}function xn(t,e,i,n){(n||mn).removeEventListener(t,e._wrapper||e,i)}function kn(t,e){if(!s(t.data.on)||!s(e.data.on)){var i=e.data.on||{},n=t.data.on||{};mn=e.elm,function(t){if(r(t.__r)){var e=U?"change":"input";t[e]=[].concat(t.__r,t[e]||[]),delete t.__r}r(t.__c)&&(t.change=[].concat(t.__c,t.change||[]),delete t.__c)}(i),ae(i,n,wn,xn,yn,e.context),mn=void 0}}var Sn,Cn={create:kn,update:kn};function Tn(t,e){if(!s(t.data.domProps)||!s(e.data.domProps)){var i,n,o=e.elm,a=t.data.domProps||{},h=e.data.domProps||{};for(i in r(h.__ob__)&&(h=e.data.domProps=O({},h)),a)i in h||(o[i]="");for(i in h){if(n=h[i],"textContent"===i||"innerHTML"===i){if(e.children&&(e.children.length=0),n===a[i])continue;1===o.childNodes.length&&o.removeChild(o.childNodes[0])}if("value"===i&&"PROGRESS"!==o.tagName){o._value=n;var c=s(n)?"":String(n);En(o,c)&&(o.value=c)}else if("innerHTML"===i&&Gi(o.tagName)&&s(o.innerHTML)){(Sn=Sn||document.createElement("div")).innerHTML="<svg>"+n+"</svg>";for(var l=Sn.firstChild;o.firstChild;)o.removeChild(o.firstChild);for(;l.firstChild;)o.appendChild(l.firstChild)}else if(n!==a[i])try{o[i]=n}catch(t){}}}}function En(t,e){return!t.composing&&("OPTION"===t.tagName||function(t,e){var i=!0;try{i=document.activeElement!==t}catch(t){}return i&&t.value!==e}(t,e)||function(t,e){var i=t.value,n=t._vModifiers;if(r(n)){if(n.number)return p(i)!==p(e);if(n.trim)return i.trim()!==e.trim()}return i!==e}(t,e))}var On={create:Tn,update:Tn},Bn=b((function(t){var e={},i=/:(.+)/;return t.split(/;(?![^(]*\))/g).forEach((function(t){if(t){var n=t.split(i);n.length>1&&(e[n[0].trim()]=n[1].trim())}})),e}));function In(t){var e=Ln(t.style);return t.staticStyle?O(t.staticStyle,e):e}function Ln(t){return Array.isArray(t)?B(t):"string"==typeof t?Bn(t):t}var jn,Pn=/^--/,Mn=/\s*!important$/,An=function(t,e,i){if(Pn.test(e))t.style.setProperty(e,i);else if(Mn.test(i))t.style.setProperty(C(e),i.replace(Mn,""),"important");else{var n=Dn(e);if(Array.isArray(i))for(var s=0,r=i.length;s<r;s++)t.style[n]=i[s];else t.style[n]=i}},Rn=["Webkit","Moz","ms"],Dn=b((function(t){if(jn=jn||document.createElement("div").style,"filter"!==(t=x(t))&&t in jn)return t;for(var e=t.charAt(0).toUpperCase()+t.slice(1),i=0;i<Rn.length;i++){var n=Rn[i]+e;if(n in jn)return n}}));function $n(t,e){var i=e.data,n=t.data;if(!(s(i.staticStyle)&&s(i.style)&&s(n.staticStyle)&&s(n.style))){var o,a,h=e.elm,c=n.staticStyle,l=n.normalizedStyle||n.style||{},u=c||l,d=Ln(e.data.style)||{};e.data.normalizedStyle=r(d.__ob__)?O({},d):d;var f=function(t,e){for(var i,n={},s=t;s.componentInstance;)(s=s.componentInstance._vnode)&&s.data&&(i=In(s.data))&&O(n,i);(i=In(t.data))&&O(n,i);for(var r=t;r=r.parent;)r.data&&(i=In(r.data))&&O(n,i);return n}(e);for(a in u)s(f[a])&&An(h,a,"");for(a in f)(o=f[a])!==u[a]&&An(h,a,null==o?"":o)}}var Nn={create:$n,update:$n},Fn=/\s+/;function Wn(t,e){if(e&&(e=e.trim()))if(t.classList)e.indexOf(" ")>-1?e.split(Fn).forEach((function(e){return t.classList.add(e)})):t.classList.add(e);else{var i=" "+(t.getAttribute("class")||"")+" ";i.indexOf(" "+e+" ")<0&&t.setAttribute("class",(i+e).trim())}}function Hn(t,e){if(e&&(e=e.trim()))if(t.classList)e.indexOf(" ")>-1?e.split(Fn).forEach((function(e){return t.classList.remove(e)})):t.classList.remove(e),t.classList.length||t.removeAttribute("class");else{for(var i=" "+(t.getAttribute("class")||"")+" ",n=" "+e+" ";i.indexOf(n)>=0;)i=i.replace(n," ");(i=i.trim())?t.setAttribute("class",i):t.removeAttribute("class")}}function zn(t){if(t){if("object"==typeof t){var e={};return!1!==t.css&&O(e,Vn(t.name||"v")),O(e,t),e}return"string"==typeof t?Vn(t):void 0}}var Vn=b((function(t){return{enterClass:t+"-enter",enterToClass:t+"-enter-to",enterActiveClass:t+"-enter-active",leaveClass:t+"-leave",leaveToClass:t+"-leave-to",leaveActiveClass:t+"-leave-active"}})),Xn=V&&!q,Yn="transition",Gn="animation",Un="transition",qn="transitionend",Jn="animation",Kn="animationend";Xn&&(void 0===window.ontransitionend&&void 0!==window.onwebkittransitionend&&(Un="WebkitTransition",qn="webkitTransitionEnd"),void 0===window.onanimationend&&void 0!==window.onwebkitanimationend&&(Jn="WebkitAnimation",Kn="webkitAnimationEnd"));var Zn=V?window.requestAnimationFrame?window.requestAnimationFrame.bind(window):setTimeout:function(t){return t()};function Qn(t){Zn((function(){Zn(t)}))}function ts(t,e){var i=t._transitionClasses||(t._transitionClasses=[]);i.indexOf(e)<0&&(i.push(e),Wn(t,e))}function es(t,e){t._transitionClasses&&m(t._transitionClasses,e),Hn(t,e)}function is(t,e,i){var n=ss(t,e),s=n.type,r=n.timeout,o=n.propCount;if(!s)return i();var a=s===Yn?qn:Kn,h=0,c=function(){t.removeEventListener(a,l),i()},l=function(e){e.target===t&&++h>=o&&c()};setTimeout((function(){h<o&&c()}),r+1),t.addEventListener(a,l)}var ns=/\b(transform|all)(,|$)/;function ss(t,e){var i,n=window.getComputedStyle(t),s=(n[Un+"Delay"]||"").split(", "),r=(n[Un+"Duration"]||"").split(", "),o=rs(s,r),a=(n[Jn+"Delay"]||"").split(", "),h=(n[Jn+"Duration"]||"").split(", "),c=rs(a,h),l=0,u=0;return e===Yn?o>0&&(i=Yn,l=o,u=r.length):e===Gn?c>0&&(i=Gn,l=c,u=h.length):u=(i=(l=Math.max(o,c))>0?o>c?Yn:Gn:null)?i===Yn?r.length:h.length:0,{type:i,timeout:l,propCount:u,hasTransform:i===Yn&&ns.test(n[Un+"Property"])}}function rs(t,e){for(;t.length<e.length;)t=t.concat(t);return Math.max.apply(null,e.map((function(e,i){return os(e)+os(t[i])})))}function os(t){return 1e3*Number(t.slice(0,-1).replace(",","."))}function as(t,e){var i=t.elm;r(i._leaveCb)&&(i._leaveCb.cancelled=!0,i._leaveCb());var n=zn(t.data.transition);if(!s(n)&&!r(i._enterCb)&&1===i.nodeType){for(var o=n.css,a=n.type,c=n.enterClass,l=n.enterToClass,u=n.enterActiveClass,d=n.appearClass,f=n.appearToClass,g=n.appearActiveClass,_=n.beforeEnter,m=n.enter,v=n.afterEnter,y=n.enterCancelled,b=n.beforeAppear,w=n.appear,x=n.afterAppear,k=n.appearCancelled,S=n.duration,C=Ze,T=Ze.$vnode;T&&T.parent;)C=T.context,T=T.parent;var E=!C._isMounted||!t.isRootInsert;if(!E||w||""===w){var O=E&&d?d:c,B=E&&g?g:u,I=E&&f?f:l,L=E&&b||_,j=E&&"function"==typeof w?w:m,P=E&&x||v,M=E&&k||y,R=p(h(S)?S.enter:S),D=!1!==o&&!q,$=ls(j),N=i._enterCb=A((function(){D&&(es(i,I),es(i,B)),N.cancelled?(D&&es(i,O),M&&M(i)):P&&P(i),i._enterCb=null}));t.data.show||he(t,"insert",(function(){var e=i.parentNode,n=e&&e._pending&&e._pending[t.key];n&&n.tag===t.tag&&n.elm._leaveCb&&n.elm._leaveCb(),j&&j(i,N)})),L&&L(i),D&&(ts(i,O),ts(i,B),Qn((function(){es(i,O),N.cancelled||(ts(i,I),$||(cs(R)?setTimeout(N,R):is(i,a,N)))}))),t.data.show&&(e&&e(),j&&j(i,N)),D||$||N()}}}function hs(t,e){var i=t.elm;r(i._enterCb)&&(i._enterCb.cancelled=!0,i._enterCb());var n=zn(t.data.transition);if(s(n)||1!==i.nodeType)return e();if(!r(i._leaveCb)){var o=n.css,a=n.type,c=n.leaveClass,l=n.leaveToClass,u=n.leaveActiveClass,d=n.beforeLeave,f=n.leave,g=n.afterLeave,_=n.leaveCancelled,m=n.delayLeave,v=n.duration,y=!1!==o&&!q,b=ls(f),w=p(h(v)?v.leave:v),x=i._leaveCb=A((function(){i.parentNode&&i.parentNode._pending&&(i.parentNode._pending[t.key]=null),y&&(es(i,l),es(i,u)),x.cancelled?(y&&es(i,c),_&&_(i)):(e(),g&&g(i)),i._leaveCb=null}));m?m(k):k()}function k(){x.cancelled||(!t.data.show&&i.parentNode&&((i.parentNode._pending||(i.parentNode._pending={}))[t.key]=t),d&&d(i),y&&(ts(i,c),ts(i,u),Qn((function(){es(i,c),x.cancelled||(ts(i,l),b||(cs(w)?setTimeout(x,w):is(i,a,x)))}))),f&&f(i,x),y||b||x())}}function cs(t){return"number"==typeof t&&!isNaN(t)}function ls(t){if(s(t))return!1;var e=t.fns;return r(e)?ls(Array.isArray(e)?e[0]:e):(t._length||t.length)>1}function us(t,e){!0!==e.data.show&&as(e)}var ds=function(t){var e,i,n={},h=t.modules,c=t.nodeOps;for(e=0;e<en.length;++e)for(n[en[e]]=[],i=0;i<h.length;++i)r(h[i][en[e]])&&n[en[e]].push(h[i][en[e]]);function l(t){var e=c.parentNode(t);r(e)&&c.removeChild(e,t)}function u(t,e,i,s,a,h,l){if(r(t.elm)&&r(h)&&(t=h[l]=mt(t)),t.isRootInsert=!a,!function(t,e,i,s){var a=t.data;if(r(a)){var h=r(t.componentInstance)&&a.keepAlive;if(r(a=a.hook)&&r(a=a.init)&&a(t,!1),r(t.componentInstance))return d(t,e),f(i,t.elm,s),o(h)&&function(t,e,i,s){for(var o,a=t;a.componentInstance;)if(r(o=(a=a.componentInstance._vnode).data)&&r(o=o.transition)){for(o=0;o<n.activate.length;++o)n.activate[o](tn,a);e.push(a);break}f(i,t.elm,s)}(t,e,i,s),!0}}(t,e,i,s)){var u=t.data,g=t.children,_=t.tag;r(_)?(t.elm=t.ns?c.createElementNS(t.ns,_):c.createElement(_,t),v(t),p(t,g,e),r(u)&&m(t,e),f(i,t.elm,s)):o(t.isComment)?(t.elm=c.createComment(t.text),f(i,t.elm,s)):(t.elm=c.createTextNode(t.text),f(i,t.elm,s))}}function d(t,e){r(t.data.pendingInsert)&&(e.push.apply(e,t.data.pendingInsert),t.data.pendingInsert=null),t.elm=t.componentInstance.$el,_(t)?(m(t,e),v(t)):(Qi(t),e.push(t))}function f(t,e,i){r(t)&&(r(i)?c.parentNode(i)===t&&c.insertBefore(t,e,i):c.appendChild(t,e))}function p(t,e,i){if(Array.isArray(e))for(var n=0;n<e.length;++n)u(e[n],i,t.elm,null,!0,e,n);else a(t.text)&&c.appendChild(t.elm,c.createTextNode(String(t.text)))}function _(t){for(;t.componentInstance;)t=t.componentInstance._vnode;return r(t.tag)}function m(t,i){for(var s=0;s<n.create.length;++s)n.create[s](tn,t);r(e=t.data.hook)&&(r(e.create)&&e.create(tn,t),r(e.insert)&&i.push(t))}function v(t){var e;if(r(e=t.fnScopeId))c.setStyleScope(t.elm,e);else for(var i=t;i;)r(e=i.context)&&r(e=e.$options._scopeId)&&c.setStyleScope(t.elm,e),i=i.parent;r(e=Ze)&&e!==t.context&&e!==t.fnContext&&r(e=e.$options._scopeId)&&c.setStyleScope(t.elm,e)}function y(t,e,i,n,s,r){for(;n<=s;++n)u(i[n],r,t,e,!1,i,n)}function b(t){var e,i,s=t.data;if(r(s))for(r(e=s.hook)&&r(e=e.destroy)&&e(t),e=0;e<n.destroy.length;++e)n.destroy[e](t);if(r(e=t.children))for(i=0;i<t.children.length;++i)b(t.children[i])}function w(t,e,i){for(;e<=i;++e){var n=t[e];r(n)&&(r(n.tag)?(x(n),b(n)):l(n.elm))}}function x(t,e){if(r(e)||r(t.data)){var i,s=n.remove.length+1;for(r(e)?e.listeners+=s:e=function(t,e){function i(){0==--i.listeners&&l(t)}return i.listeners=e,i}(t.elm,s),r(i=t.componentInstance)&&r(i=i._vnode)&&r(i.data)&&x(i,e),i=0;i<n.remove.length;++i)n.remove[i](t,e);r(i=t.data.hook)&&r(i=i.remove)?i(t,e):e()}else l(t.elm)}function k(t,e,i,n){for(var s=i;s<n;s++){var o=e[s];if(r(o)&&nn(t,o))return s}}function S(t,e,i,a,h,l){if(t!==e){r(e.elm)&&r(a)&&(e=a[h]=mt(e));var d=e.elm=t.elm;if(o(t.isAsyncPlaceholder))r(e.asyncFactory.resolved)?E(t.elm,e,i):e.isAsyncPlaceholder=!0;else if(o(e.isStatic)&&o(t.isStatic)&&e.key===t.key&&(o(e.isCloned)||o(e.isOnce)))e.componentInstance=t.componentInstance;else{var f,p=e.data;r(p)&&r(f=p.hook)&&r(f=f.prepatch)&&f(t,e);var g=t.children,m=e.children;if(r(p)&&_(e)){for(f=0;f<n.update.length;++f)n.update[f](t,e);r(f=p.hook)&&r(f=f.update)&&f(t,e)}s(e.text)?r(g)&&r(m)?g!==m&&function(t,e,i,n,o){for(var a,h,l,d=0,f=0,p=e.length-1,g=e[0],_=e[p],m=i.length-1,v=i[0],b=i[m],x=!o;d<=p&&f<=m;)s(g)?g=e[++d]:s(_)?_=e[--p]:nn(g,v)?(S(g,v,n,i,f),g=e[++d],v=i[++f]):nn(_,b)?(S(_,b,n,i,m),_=e[--p],b=i[--m]):nn(g,b)?(S(g,b,n,i,m),x&&c.insertBefore(t,g.elm,c.nextSibling(_.elm)),g=e[++d],b=i[--m]):nn(_,v)?(S(_,v,n,i,f),x&&c.insertBefore(t,_.elm,g.elm),_=e[--p],v=i[++f]):(s(a)&&(a=sn(e,d,p)),s(h=r(v.key)?a[v.key]:k(v,e,d,p))?u(v,n,t,g.elm,!1,i,f):nn(l=e[h],v)?(S(l,v,n,i,f),e[h]=void 0,x&&c.insertBefore(t,l.elm,g.elm)):u(v,n,t,g.elm,!1,i,f),v=i[++f]);d>p?y(t,s(i[m+1])?null:i[m+1].elm,i,f,m,n):f>m&&w(e,d,p)}(d,g,m,i,l):r(m)?(r(t.text)&&c.setTextContent(d,""),y(d,null,m,0,m.length-1,i)):r(g)?w(g,0,g.length-1):r(t.text)&&c.setTextContent(d,""):t.text!==e.text&&c.setTextContent(d,e.text),r(p)&&r(f=p.hook)&&r(f=f.postpatch)&&f(t,e)}}}function C(t,e,i){if(o(i)&&r(t.parent))t.parent.data.pendingInsert=e;else for(var n=0;n<e.length;++n)e[n].data.hook.insert(e[n])}var T=g("attrs,class,staticClass,staticStyle,key");function E(t,e,i,n){var s,a=e.tag,h=e.data,c=e.children;if(n=n||h&&h.pre,e.elm=t,o(e.isComment)&&r(e.asyncFactory))return e.isAsyncPlaceholder=!0,!0;if(r(h)&&(r(s=h.hook)&&r(s=s.init)&&s(e,!0),r(s=e.componentInstance)))return d(e,i),!0;if(r(a)){if(r(c))if(t.hasChildNodes())if(r(s=h)&&r(s=s.domProps)&&r(s=s.innerHTML)){if(s!==t.innerHTML)return!1}else{for(var l=!0,u=t.firstChild,f=0;f<c.length;f++){if(!u||!E(u,c[f],i,n)){l=!1;break}u=u.nextSibling}if(!l||u)return!1}else p(e,c,i);if(r(h)){var g=!1;for(var _ in h)if(!T(_)){g=!0,m(e,i);break}!g&&h.class&&ne(h.class)}}else t.data!==e.text&&(t.data=e.text);return!0}return function(t,e,i,a){if(!s(e)){var h,l=!1,d=[];if(s(t))l=!0,u(e,d);else{var f=r(t.nodeType);if(!f&&nn(t,e))S(t,e,d,null,null,a);else{if(f){if(1===t.nodeType&&t.hasAttribute(R)&&(t.removeAttribute(R),i=!0),o(i)&&E(t,e,d))return C(e,d,!0),t;h=t,t=new ft(c.tagName(h).toLowerCase(),{},[],void 0,h)}var p=t.elm,g=c.parentNode(p);if(u(e,d,p._leaveCb?null:g,c.nextSibling(p)),r(e.parent))for(var m=e.parent,v=_(e);m;){for(var y=0;y<n.destroy.length;++y)n.destroy[y](m);if(m.elm=e.elm,v){for(var x=0;x<n.create.length;++x)n.create[x](tn,m);var k=m.data.hook.insert;if(k.merged)for(var T=1;T<k.fns.length;T++)k.fns[T]()}else Qi(m);m=m.parent}r(g)?w([t],0,0):r(t.tag)&&b(t)}}return C(e,d,l),e.elm}r(t)&&b(t)}}({nodeOps:Ki,modules:[gn,vn,Cn,On,Nn,V?{create:us,activate:us,remove:function(t,e){!0!==t.data.show?hs(t,e):e()}}:{}].concat(un)});q&&document.addEventListener("selectionchange",(function(){var t=document.activeElement;t&&t.vmodel&&bs(t,"input")}));var fs={inserted:function(t,e,i,n){"select"===i.tag?(n.elm&&!n.elm._vOptions?he(i,"postpatch",(function(){fs.componentUpdated(t,e,i)})):ps(t,e,i.context),t._vOptions=[].map.call(t.options,ms)):("textarea"===i.tag||Ji(t.type))&&(t._vModifiers=e.modifiers,e.modifiers.lazy||(t.addEventListener("compositionstart",vs),t.addEventListener("compositionend",ys),t.addEventListener("change",ys),q&&(t.vmodel=!0)))},componentUpdated:function(t,e,i){if("select"===i.tag){ps(t,e,i.context);var n=t._vOptions,s=t._vOptions=[].map.call(t.options,ms);s.some((function(t,e){return!P(t,n[e])}))&&(t.multiple?e.value.some((function(t){return _s(t,s)})):e.value!==e.oldValue&&_s(e.value,s))&&bs(t,"change")}}};function ps(t,e,i){gs(t,e),(U||J)&&setTimeout((function(){gs(t,e)}),0)}function gs(t,e,i){var n=e.value,s=t.multiple;if(!s||Array.isArray(n)){for(var r,o,a=0,h=t.options.length;a<h;a++)if(o=t.options[a],s)r=M(n,ms(o))>-1,o.selected!==r&&(o.selected=r);else if(P(ms(o),n))return void(t.selectedIndex!==a&&(t.selectedIndex=a));s||(t.selectedIndex=-1)}}function _s(t,e){return e.every((function(e){return!P(e,t)}))}function ms(t){return"_value"in t?t._value:t.value}function vs(t){t.target.composing=!0}function ys(t){t.target.composing&&(t.target.composing=!1,bs(t.target,"input"))}function bs(t,e){var i=document.createEvent("HTMLEvents");i.initEvent(e,!0,!0),t.dispatchEvent(i)}function ws(t){return!t.componentInstance||t.data&&t.data.transition?t:ws(t.componentInstance._vnode)}var xs={bind:function(t,e,i){var n=e.value,s=(i=ws(i)).data&&i.data.transition,r=t.__vOriginalDisplay="none"===t.style.display?"":t.style.display;n&&s?(i.data.show=!0,as(i,(function(){t.style.display=r}))):t.style.display=n?r:"none"},update:function(t,e,i){var n=e.value;!n!=!e.oldValue&&((i=ws(i)).data&&i.data.transition?(i.data.show=!0,n?as(i,(function(){t.style.display=t.__vOriginalDisplay})):hs(i,(function(){t.style.display="none"}))):t.style.display=n?t.__vOriginalDisplay:"none")},unbind:function(t,e,i,n,s){s||(t.style.display=t.__vOriginalDisplay)}},ks={model:fs,show:xs},Ss={name:String,appear:Boolean,css:Boolean,mode:String,type:String,enterClass:String,leaveClass:String,enterToClass:String,leaveToClass:String,enterActiveClass:String,leaveActiveClass:String,appearClass:String,appearActiveClass:String,appearToClass:String,duration:[Number,String,Object]};function Cs(t){var e=t&&t.componentOptions;return e&&e.Ctor.options.abstract?Cs(Ge(e.children)):t}function Ts(t){var e={},i=t.$options;for(var n in i.propsData)e[n]=t[n];var s=i._parentListeners;for(var r in s)e[x(r)]=s[r];return e}function Es(t,e){if(/\d-keep-alive$/.test(e.tag))return t("keep-alive",{props:e.componentOptions.propsData})}var Os=function(t){return t.tag||_e(t)},Bs=function(t){return"show"===t.name},Is={name:"transition",props:Ss,abstract:!0,render:function(t){var e=this,i=this.$slots.default;if(i&&(i=i.filter(Os)).length){var n=this.mode,s=i[0];if(function(t){for(;t=t.parent;)if(t.data.transition)return!0}(this.$vnode))return s;var r=Cs(s);if(!r)return s;if(this._leaving)return Es(t,s);var o="__transition-"+this._uid+"-";r.key=null==r.key?r.isComment?o+"comment":o+r.tag:a(r.key)?0===String(r.key).indexOf(o)?r.key:o+r.key:r.key;var h=(r.data||(r.data={})).transition=Ts(this),c=this._vnode,l=Cs(c);if(r.data.directives&&r.data.directives.some(Bs)&&(r.data.show=!0),l&&l.data&&!function(t,e){return e.key===t.key&&e.tag===t.tag}(r,l)&&!_e(l)&&(!l.componentInstance||!l.componentInstance._vnode.isComment)){var u=l.data.transition=O({},h);if("out-in"===n)return this._leaving=!0,he(u,"afterLeave",(function(){e._leaving=!1,e.$forceUpdate()})),Es(t,s);if("in-out"===n){if(_e(r))return c;var d,f=function(){d()};he(h,"afterEnter",f),he(h,"enterCancelled",f),he(u,"delayLeave",(function(t){d=t}))}}return s}}},Ls=O({tag:String,moveClass:String},Ss);function js(t){t.elm._moveCb&&t.elm._moveCb(),t.elm._enterCb&&t.elm._enterCb()}function Ps(t){t.data.newPos=t.elm.getBoundingClientRect()}function Ms(t){var e=t.data.pos,i=t.data.newPos,n=e.left-i.left,s=e.top-i.top;if(n||s){t.data.moved=!0;var r=t.elm.style;r.transform=r.WebkitTransform="translate("+n+"px,"+s+"px)",r.transitionDuration="0s"}}delete Ls.mode;var As={Transition:Is,TransitionGroup:{props:Ls,beforeMount:function(){var t=this,e=this._update;this._update=function(i,n){var s=Qe(t);t.__patch__(t._vnode,t.kept,!1,!0),t._vnode=t.kept,s(),e.call(t,i,n)}},render:function(t){for(var e=this.tag||this.$vnode.data.tag||"span",i=Object.create(null),n=this.prevChildren=this.children,s=this.$slots.default||[],r=this.children=[],o=Ts(this),a=0;a<s.length;a++){var h=s[a];h.tag&&null!=h.key&&0!==String(h.key).indexOf("__vlist")&&(r.push(h),i[h.key]=h,(h.data||(h.data={})).transition=o)}if(n){for(var c=[],l=[],u=0;u<n.length;u++){var d=n[u];d.data.transition=o,d.data.pos=d.elm.getBoundingClientRect(),i[d.key]?c.push(d):l.push(d)}this.kept=t(e,null,c),this.removed=l}return t(e,null,r)},updated:function(){var t=this.prevChildren,e=this.moveClass||(this.name||"v")+"-move";t.length&&this.hasMove(t[0].elm,e)&&(t.forEach(js),t.forEach(Ps),t.forEach(Ms),this._reflow=document.body.offsetHeight,t.forEach((function(t){if(t.data.moved){var i=t.elm,n=i.style;ts(i,e),n.transform=n.WebkitTransform=n.transitionDuration="",i.addEventListener(qn,i._moveCb=function t(n){n&&n.target!==i||n&&!/transform$/.test(n.propertyName)||(i.removeEventListener(qn,t),i._moveCb=null,es(i,e))})}})))},methods:{hasMove:function(t,e){if(!Xn)return!1;if(this._hasMove)return this._hasMove;var i=t.cloneNode();t._transitionClasses&&t._transitionClasses.forEach((function(t){Hn(i,t)})),Wn(i,e),i.style.display="none",this.$el.appendChild(i);var n=ss(i);return this.$el.removeChild(i),this._hasMove=n.hasTransform}}}};Ci.config.mustUseProp=function(t,e,i){return"value"===i&&Mi(t)&&"button"!==e||"selected"===i&&"option"===t||"checked"===i&&"input"===t||"muted"===i&&"video"===t},Ci.config.isReservedTag=Ui,Ci.config.isReservedAttr=Pi,Ci.config.getTagNamespace=function(t){return Gi(t)?"svg":"math"===t?"math":void 0},Ci.config.isUnknownElement=function(t){if(!V)return!0;if(Ui(t))return!1;if(t=t.toLowerCase(),null!=qi[t])return qi[t];var e=document.createElement(t);return t.indexOf("-")>-1?qi[t]=e.constructor===window.HTMLUnknownElement||e.constructor===window.HTMLElement:qi[t]=/HTMLUnknownElement/.test(e.toString())},O(Ci.options.directives,ks),O(Ci.options.components,As),Ci.prototype.__patch__=V?ds:I,Ci.prototype.$mount=function(t,e){return function(t,e,i){var n;return t.$el=e,t.$options.render||(t.$options.render=gt),ni(t,"beforeMount"),n=function(){t._update(t._render(),i)},new gi(t,n,I,{before:function(){t._isMounted&&!t._isDestroyed&&ni(t,"beforeUpdate")}},!0),i=!1,null==t.$vnode&&(t._isMounted=!0,ni(t,"mounted")),t}(this,t=t&&V?function(t){return"string"==typeof t?document.querySelector(t)||document.createElement("div"):t}(t):void 0,e)},V&&setTimeout((function(){N.devtools&&nt&&nt.emit("init",Ci)}),0);const Rs=Ci;function Ds(t){const e=document.createElement("canvas"),i=e.getContext("2d"),{width:n,height:s,left:r,top:o}=t.getBoundingClientRect();e.style.width=n+"px",e.style.height=s+"px",e.style.userSelect="none";const a=window.devicePixelRatio;return e.width=Math.floor(n*a),e.height=Math.floor(s*a),t&&(t.style.position="relative",t.style.overflow="hidden",t.append(e)),{canvas:e,width:n,height:s,raw_width:e.width,raw_height:e.height,left:r,top:o,ctx:i,scale:a}}const $s=document.createElement("canvas");$s.width=1,$s.height=1;const Ns=$s.getContext("2d"),Fs=window.devicePixelRatio;function Ws(t){Ns.clearRect(0,0,5,5),Ns.save(),t(Ns),Ns.restore(),Ns.clearRect(0,0,5,5)}function Hs(t,e){const i=matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`);function n(){console.log("devicePixelRatio changed: "+window.devicePixelRatio),t(window.devicePixelRatio),Hs(t,e)}e((()=>{console.log("remove devicePixelRatio event handler"),i.removeEventListener("change",n,{once:!0})})),i.addEventListener("change",n,{once:!0})}Ns.scale(Fs,Fs);const{abs:zs,cos:Vs,sin:Xs,acos:Ys,atan2:Gs,sqrt:Us,pow:qs}=Math;function Js(t){return t<0?-qs(-t,1/3):qs(t,1/3)}const Ks=Math.PI,Zs=2*Ks,Qs=Ks/2,tr=Number.MAX_SAFE_INTEGER||9007199254740991,er=Number.MIN_SAFE_INTEGER||-9007199254740991,ir={x:0,y:0,z:0},nr={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(t,e){const i=e(t);let n=i.x*i.x+i.y*i.y;return void 0!==i.z&&(n+=i.z*i.z),Us(n)},compute:function(t,e,i){if(0===t)return e[0].t=0,e[0];const n=e.length-1;if(1===t)return e[n].t=1,e[n];const s=1-t;let r=e;if(0===n)return e[0].t=t,e[0];if(1===n){const e={x:s*r[0].x+t*r[1].x,y:s*r[0].y+t*r[1].y,t};return i&&(e.z=s*r[0].z+t*r[1].z),e}if(n<4){let e,o,a,h=s*s,c=t*t,l=0;2===n?(r=[r[0],r[1],r[2],ir],e=h,o=s*t*2,a=c):3===n&&(e=h*s,o=h*t*3,a=s*c*3,l=t*c);const u={x:e*r[0].x+o*r[1].x+a*r[2].x+l*r[3].x,y:e*r[0].y+o*r[1].y+a*r[2].y+l*r[3].y,t};return i&&(u.z=e*r[0].z+o*r[1].z+a*r[2].z+l*r[3].z),u}const o=JSON.parse(JSON.stringify(e));for(;o.length>1;){for(let e=0;e<o.length-1;e++)o[e]={x:o[e].x+(o[e+1].x-o[e].x)*t,y:o[e].y+(o[e+1].y-o[e].y)*t},void 0!==o[e].z&&(o[e]=o[e].z+(o[e+1].z-o[e].z)*t);o.splice(o.length-1,1)}return o[0].t=t,o[0]},computeWithRatios:function(t,e,i,n){const s=1-t,r=i,o=e;let a,h=r[0],c=r[1],l=r[2],u=r[3];return h*=s,c*=t,2===o.length?(a=h+c,{x:(h*o[0].x+c*o[1].x)/a,y:(h*o[0].y+c*o[1].y)/a,z:!!n&&(h*o[0].z+c*o[1].z)/a,t}):(h*=s,c*=2*s,l*=t*t,3===o.length?(a=h+c+l,{x:(h*o[0].x+c*o[1].x+l*o[2].x)/a,y:(h*o[0].y+c*o[1].y+l*o[2].y)/a,z:!!n&&(h*o[0].z+c*o[1].z+l*o[2].z)/a,t}):(h*=s,c*=1.5*s,l*=3*s,u*=t*t*t,4===o.length?(a=h+c+l+u,{x:(h*o[0].x+c*o[1].x+l*o[2].x+u*o[3].x)/a,y:(h*o[0].y+c*o[1].y+l*o[2].y+u*o[3].y)/a,z:!!n&&(h*o[0].z+c*o[1].z+l*o[2].z+u*o[3].z)/a,t}):void 0))},derive:function(t,e){const i=[];for(let n=t,s=n.length,r=s-1;s>1;s--,r--){const t=[];for(let i,s=0;s<r;s++)i={x:r*(n[s+1].x-n[s].x),y:r*(n[s+1].y-n[s].y)},e&&(i.z=r*(n[s+1].z-n[s].z)),t.push(i);i.push(t),n=t}return i},between:function(t,e,i){return e<=t&&t<=i||nr.approximately(t,e)||nr.approximately(t,i)},approximately:function(t,e,i){return zs(t-e)<=(i||1e-6)},length:function(t){const e=nr.Tvalues.length;let i=0;for(let n,s=0;s<e;s++)n=.5*nr.Tvalues[s]+.5,i+=nr.Cvalues[s]*nr.arcfn(n,t);return.5*i},map:function(t,e,i,n,s){return n+(t-e)/(i-e)*(s-n)},lerp:function(t,e,i){const n={x:e.x+t*(i.x-e.x),y:e.y+t*(i.y-e.y)};return void 0!==e.z&&void 0!==i.z&&(n.z=e.z+t*(i.z-e.z)),n},pointToString:function(t){let e=t.x+"/"+t.y;return void 0!==t.z&&(e+="/"+t.z),e},pointsToString:function(t){return"["+t.map(nr.pointToString).join(", ")+"]"},copy:function(t){return JSON.parse(JSON.stringify(t))},angle:function(t,e,i){const n=e.x-t.x,s=e.y-t.y,r=i.x-t.x,o=i.y-t.y;return Gs(n*o-s*r,n*r+s*o)},round:function(t,e){const i=""+t,n=i.indexOf(".");return parseFloat(i.substring(0,n+1+e))},dist:function(t,e){const i=t.x-e.x,n=t.y-e.y;return Us(i*i+n*n)},closest:function(t,e){let i,n,s=qs(2,63);return t.forEach((function(t,r){n=nr.dist(e,t),n<s&&(s=n,i=r)})),{mdist:s,mpos:i}},abcratio:function(t,e){if(2!==e&&3!==e)return!1;if(void 0===t)t=.5;else if(0===t||1===t)return t;const i=qs(t,e)+qs(1-t,e);return zs((i-1)/i)},projectionratio:function(t,e){if(2!==e&&3!==e)return!1;if(void 0===t)t=.5;else if(0===t||1===t)return t;const i=qs(1-t,e);return i/(qs(t,e)+i)},lli8:function(t,e,i,n,s,r,o,a){const h=(t-i)*(r-a)-(e-n)*(s-o);return 0!=h&&{x:((t*n-e*i)*(s-o)-(t-i)*(s*a-r*o))/h,y:((t*n-e*i)*(r-a)-(e-n)*(s*a-r*o))/h}},lli4:function(t,e,i,n){const s=t.x,r=t.y,o=e.x,a=e.y,h=i.x,c=i.y,l=n.x,u=n.y;return nr.lli8(s,r,o,a,h,c,l,u)},lli:function(t,e){return nr.lli4(t,t.c,e,e.c)},makeline:function(t,e){const i=t.x,n=t.y,s=e.x,r=e.y,o=(s-i)/3,a=(r-n)/3;return new fr(i,n,i+o,n+a,i+2*o,n+2*a,s,r)},findbbox:function(t){let e=tr,i=tr,n=er,s=er;return t.forEach((function(t){const r=t.bbox();e>r.x.min&&(e=r.x.min),i>r.y.min&&(i=r.y.min),n<r.x.max&&(n=r.x.max),s<r.y.max&&(s=r.y.max)})),{x:{min:e,mid:(e+n)/2,max:n,size:n-e},y:{min:i,mid:(i+s)/2,max:s,size:s-i}}},shapeintersections:function(t,e,i,n,s){if(!nr.bboxoverlap(e,n))return[];const r=[],o=[t.startcap,t.forward,t.back,t.endcap],a=[i.startcap,i.forward,i.back,i.endcap];return o.forEach((function(e){e.virtual||a.forEach((function(n){if(n.virtual)return;const o=e.intersects(n,s);o.length>0&&(o.c1=e,o.c2=n,o.s1=t,o.s2=i,r.push(o))}))})),r},makeshape:function(t,e,i){const n=e.points.length,s=t.points.length,r=nr.makeline(e.points[n-1],t.points[0]),o=nr.makeline(t.points[s-1],e.points[0]),a={startcap:r,forward:t,back:e,endcap:o,bbox:nr.findbbox([r,t,e,o]),intersections:function(t){return nr.shapeintersections(a,a.bbox,t,t.bbox,i)}};return a},getminmax:function(t,e,i){if(!i)return{min:0,max:0};let n,s,r=tr,o=er;-1===i.indexOf(0)&&(i=[0].concat(i)),-1===i.indexOf(1)&&i.push(1);for(let a=0,h=i.length;a<h;a++)n=i[a],s=t.get(n),s[e]<r&&(r=s[e]),s[e]>o&&(o=s[e]);return{min:r,mid:(r+o)/2,max:o,size:o-r}},align:function(t,e){const i=e.p1.x,n=e.p1.y,s=-Gs(e.p2.y-n,e.p2.x-i);return t.map((function(t){return{x:(t.x-i)*Vs(s)-(t.y-n)*Xs(s),y:(t.x-i)*Xs(s)+(t.y-n)*Vs(s)}}))},roots:function(t,e){e=e||{p1:{x:0,y:0},p2:{x:1,y:0}};const i=t.length-1,n=nr.align(t,e),s=function(t){return 0<=t&&t<=1};if(2===i){const t=n[0].y,e=n[1].y,i=n[2].y,r=t-2*e+i;if(0!==r){const n=-Us(e*e-t*i),o=-t+e;return[-(n+o)/r,-(-n+o)/r].filter(s)}return e!==i&&0===r?[(2*e-i)/(2*e-2*i)].filter(s):[]}const r=n[0].y,o=n[1].y,a=n[2].y;let h=3*o-r-3*a+n[3].y,c=3*r-6*o+3*a,l=-3*r+3*o,u=r;if(nr.approximately(h,0)){if(nr.approximately(c,0))return nr.approximately(l,0)?[]:[-u/l].filter(s);const t=Us(l*l-4*c*u),e=2*c;return[(t-l)/e,(-l-t)/e].filter(s)}c/=h,l/=h,u/=h;const d=(3*l-c*c)/3,f=d/3,p=(2*c*c*c-9*c*l+27*u)/27,g=p/2,_=g*g+f*f*f;let m,v,y,b,w;if(_<0){const t=-d/3,e=Us(t*t*t),i=-p/(2*e),n=Ys(i<-1?-1:i>1?1:i),r=2*Js(e);return y=r*Vs(n/3)-c/3,b=r*Vs((n+Zs)/3)-c/3,w=r*Vs((n+2*Zs)/3)-c/3,[y,b,w].filter(s)}if(0===_)return m=g<0?Js(-g):-Js(g),y=2*m-c/3,b=-m-c/3,[y,b].filter(s);{const t=Us(_);return m=Js(-g+t),v=Js(g+t),[m-v-c/3].filter(s)}},droots:function(t){if(3===t.length){const e=t[0],i=t[1],n=t[2],s=e-2*i+n;if(0!==s){const t=-Us(i*i-e*n),r=-e+i;return[-(t+r)/s,-(-t+r)/s]}return i!==n&&0===s?[(2*i-n)/(2*(i-n))]:[]}if(2===t.length){const e=t[0],i=t[1];return e!==i?[e/(e-i)]:[]}return[]},curvature:function(t,e,i,n,s){let r,o,a,h,c=0,l=0;const u=nr.compute(t,e),d=nr.compute(t,i),f=u.x*u.x+u.y*u.y;if(n?(r=Us(qs(u.y*d.z-d.y*u.z,2)+qs(u.z*d.x-d.z*u.x,2)+qs(u.x*d.y-d.x*u.y,2)),o=qs(f+u.z*u.z,1.5)):(r=u.x*d.y-u.y*d.x,o=qs(f,1.5)),0===r||0===o)return{k:0,r:0};if(c=r/o,l=o/r,!s){const s=nr.curvature(t-.001,e,i,n,!0).k,r=nr.curvature(t+.001,e,i,n,!0).k;h=(r-c+(c-s))/2,a=(zs(r-c)+zs(c-s))/2}return{k:c,r:l,dk:h,adk:a}},inflections:function(t){if(t.length<4)return[];const e=nr.align(t,{p1:t[0],p2:t.slice(-1)[0]}),i=e[2].x*e[1].y,n=e[3].x*e[1].y,s=e[1].x*e[2].y,r=18*(-3*i+2*n+3*s-e[3].x*e[2].y),o=18*(3*i-n-3*s),a=18*(s-i);if(nr.approximately(r,0)){if(!nr.approximately(o,0)){let t=-a/o;if(0<=t&&t<=1)return[t]}return[]}const h=o*o-4*r*a,c=Math.sqrt(h),l=2*r;return nr.approximately(l,0)?[]:[(c-o)/l,-(o+c)/l].filter((function(t){return 0<=t&&t<=1}))},bboxoverlap:function(t,e){const i=["x","y"],n=i.length;for(let s,r,o,a,h=0;h<n;h++)if(s=i[h],r=t[s].mid,o=e[s].mid,a=(t[s].size+e[s].size)/2,zs(r-o)>=a)return!1;return!0},expandbox:function(t,e){e.x.min<t.x.min&&(t.x.min=e.x.min),e.y.min<t.y.min&&(t.y.min=e.y.min),e.z&&e.z.min<t.z.min&&(t.z.min=e.z.min),e.x.max>t.x.max&&(t.x.max=e.x.max),e.y.max>t.y.max&&(t.y.max=e.y.max),e.z&&e.z.max>t.z.max&&(t.z.max=e.z.max),t.x.mid=(t.x.min+t.x.max)/2,t.y.mid=(t.y.min+t.y.max)/2,t.z&&(t.z.mid=(t.z.min+t.z.max)/2),t.x.size=t.x.max-t.x.min,t.y.size=t.y.max-t.y.min,t.z&&(t.z.size=t.z.max-t.z.min)},pairiteration:function(t,e,i){const n=t.bbox(),s=e.bbox(),r=1e5,o=i||.5;if(n.x.size+n.y.size<o&&s.x.size+s.y.size<o)return[(r*(t._t1+t._t2)/2|0)/r+"/"+(r*(e._t1+e._t2)/2|0)/r];let a=t.split(.5),h=e.split(.5),c=[{left:a.left,right:h.left},{left:a.left,right:h.right},{left:a.right,right:h.right},{left:a.right,right:h.left}];c=c.filter((function(t){return nr.bboxoverlap(t.left.bbox(),t.right.bbox())}));let l=[];return 0===c.length||(c.forEach((function(t){l=l.concat(nr.pairiteration(t.left,t.right,o))})),l=l.filter((function(t,e){return l.indexOf(t)===e}))),l},getccenter:function(t,e,i){const n=e.x-t.x,s=e.y-t.y,r=i.x-e.x,o=i.y-e.y,a=n*Vs(Qs)-s*Xs(Qs),h=n*Xs(Qs)+s*Vs(Qs),c=r*Vs(Qs)-o*Xs(Qs),l=r*Xs(Qs)+o*Vs(Qs),u=(t.x+e.x)/2,d=(t.y+e.y)/2,f=(e.x+i.x)/2,p=(e.y+i.y)/2,g=u+a,_=d+h,m=f+c,v=p+l,y=nr.lli8(u,d,g,_,f,p,m,v),b=nr.dist(y,t);let w,x=Gs(t.y-y.y,t.x-y.x),k=Gs(e.y-y.y,e.x-y.x),S=Gs(i.y-y.y,i.x-y.x);return x<S?((x>k||k>S)&&(x+=Zs),x>S&&(w=S,S=x,x=w)):S<k&&k<x?(w=S,S=x,x=w):S+=Zs,y.s=x,y.e=S,y.r=b,y},numberSort:function(t,e){return t-e}};class sr{constructor(t){this.curves=[],this._3d=!1,t&&(this.curves=t,this._3d=this.curves[0]._3d)}valueOf(){return this.toString()}toString(){return"["+this.curves.map((function(t){return nr.pointsToString(t.points)})).join(", ")+"]"}addCurve(t){this.curves.push(t),this._3d=this._3d||t._3d}length(){return this.curves.map((function(t){return t.length()})).reduce((function(t,e){return t+e}))}curve(t){return this.curves[t]}bbox(){const t=this.curves;for(var e=t[0].bbox(),i=1;i<t.length;i++)nr.expandbox(e,t[i].bbox());return e}offset(t){const e=[];return this.curves.forEach((function(i){e.push(...i.offset(t))})),new sr(e)}}const{abs:rr,min:or,max:ar,cos:hr,sin:cr,acos:lr,sqrt:ur}=Math,dr=Math.PI;class fr{constructor(t){let e=t&&t.forEach?t:Array.from(arguments).slice(),i=!1;if("object"==typeof e[0]){i=e.length;const t=[];e.forEach((function(e){["x","y","z"].forEach((function(i){void 0!==e[i]&&t.push(e[i])}))})),e=t}let n=!1;const s=e.length;if(i){if(i>4){if(1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");n=!0}}else if(6!==s&&8!==s&&9!==s&&12!==s&&1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");const r=this._3d=!n&&(9===s||12===s)||t&&t[0]&&void 0!==t[0].z,o=this.points=[];for(let t=0,i=r?3:2;t<s;t+=i){var a={x:e[t],y:e[t+1]};r&&(a.z=e[t+2]),o.push(a)}const h=this.order=o.length-1,c=this.dims=["x","y"];r&&c.push("z"),this.dimlen=c.length;const l=nr.align(o,{p1:o[0],p2:o[h]});this._linear=!l.some((t=>rr(t.y)>1e-4)),this._lut=[],this._t1=0,this._t2=1,this.update()}static quadraticFromPoints(t,e,i,n){if(void 0===n&&(n=.5),0===n)return new fr(e,e,i);if(1===n)return new fr(t,e,e);const s=fr.getABC(2,t,e,i,n);return new fr(t,s.A,i)}static cubicFromPoints(t,e,i,n,s){void 0===n&&(n=.5);const r=fr.getABC(3,t,e,i,n);void 0===s&&(s=nr.dist(e,r.C));const o=s*(1-n)/n,a=nr.dist(t,i),h=(i.x-t.x)/a,c=(i.y-t.y)/a,l=s*h,u=s*c,d=o*h,f=o*c,p=e.x-l,g=e.y-u,_=e.x+d,m=e.y+f,v=r.A,y=v.x+(p-v.x)/(1-n),b=v.y+(g-v.y)/(1-n),w=v.x+(_-v.x)/n,x=v.y+(m-v.y)/n,k={x:t.x+(y-t.x)/n,y:t.y+(b-t.y)/n},S={x:i.x+(w-i.x)/(1-n),y:i.y+(x-i.y)/(1-n)};return new fr(t,k,S,i)}static getUtils(){return nr}getUtils(){return fr.getUtils()}static get PolyBezier(){return sr}valueOf(){return this.toString()}toString(){return nr.pointsToString(this.points)}toSVG(){if(this._3d)return!1;const t=this.points,e=["M",t[0].x,t[0].y,2===this.order?"Q":"C"];for(let i=1,n=t.length;i<n;i++)e.push(t[i].x),e.push(t[i].y);return e.join(" ")}setRatios(t){if(t.length!==this.points.length)throw new Error("incorrect number of ratio values");this.ratios=t,this._lut=[]}verify(){const t=this.coordDigest();t!==this._print&&(this._print=t,this.update())}coordDigest(){return this.points.map((function(t,e){return""+e+t.x+t.y+(t.z?t.z:0)})).join("")}update(){this._lut=[],this.dpoints=nr.derive(this.points,this._3d),this.computedirection()}computedirection(){const t=this.points,e=nr.angle(t[0],t[this.order],t[1]);this.clockwise=e>0}length(){return nr.length(this.derivative.bind(this))}static getABC(t=2,e,i,n,s=.5){const r=nr.projectionratio(s,t),o=1-r,a={x:r*e.x+o*n.x,y:r*e.y+o*n.y},h=nr.abcratio(s,t);return{A:{x:i.x+(i.x-a.x)/h,y:i.y+(i.y-a.y)/h},B:i,C:a,S:e,E:n}}getABC(t,e){e=e||this.get(t);let i=this.points[0],n=this.points[this.order];return fr.getABC(this.order,i,e,n,t)}getLUT(t){if(this.verify(),t=t||100,this._lut.length===t)return this._lut;this._lut=[],t--;for(let e,i,n=0;n<t;n++)i=n/(t-1),e=this.compute(i),e.t=i,this._lut.push(e);return this._lut}on(e,i){i=i||5;const n=this.getLUT(),s=[];for(let t,r=0,o=0;r<n.length;r++)t=n[r],nr.dist(t,e)<i&&(s.push(t),o+=r/n.length);return!!s.length&&(t/=s.length)}project(t){const e=this.getLUT(),i=e.length-1,n=nr.closest(e,t),s=n.mpos,r=(s-1)/i,o=(s+1)/i,a=.1/i;let h,c,l=n.mdist,u=r,d=u;for(l+=1;u<o+a;u+=a)h=this.compute(u),c=nr.dist(t,h),c<l&&(l=c,d=u);return d=d<0?0:d>1?1:d,h=this.compute(d),h.t=d,h.d=l,h}get(t){return this.compute(t)}point(t){return this.points[t]}compute(t){return this.ratios?nr.computeWithRatios(t,this.points,this.ratios,this._3d):nr.compute(t,this.points,this._3d,this.ratios)}raise(){const t=this.points,e=[t[0]],i=t.length;for(let n,s,r=1;r<i;r++)n=t[r],s=t[r-1],e[r]={x:(i-r)/i*n.x+r/i*s.x,y:(i-r)/i*n.y+r/i*s.y};return e[i]=t[i-1],new fr(e)}derivative(t){return nr.compute(t,this.dpoints[0],this._3d)}dderivative(t){return nr.compute(t,this.dpoints[1],this._3d)}align(){let t=this.points;return new fr(nr.align(t,{p1:t[0],p2:t[t.length-1]}))}curvature(t){return nr.curvature(t,this.dpoints[0],this.dpoints[1],this._3d)}inflections(){return nr.inflections(this.points)}normal(t){return this._3d?this.__normal3(t):this.__normal2(t)}__normal2(t){const e=this.derivative(t),i=ur(e.x*e.x+e.y*e.y);return{x:-e.y/i,y:e.x/i}}__normal3(t){const e=this.derivative(t),i=this.derivative(t+.01),n=ur(e.x*e.x+e.y*e.y+e.z*e.z),s=ur(i.x*i.x+i.y*i.y+i.z*i.z);e.x/=n,e.y/=n,e.z/=n,i.x/=s,i.y/=s,i.z/=s;const r={x:i.y*e.z-i.z*e.y,y:i.z*e.x-i.x*e.z,z:i.x*e.y-i.y*e.x},o=ur(r.x*r.x+r.y*r.y+r.z*r.z);r.x/=o,r.y/=o,r.z/=o;const a=[r.x*r.x,r.x*r.y-r.z,r.x*r.z+r.y,r.x*r.y+r.z,r.y*r.y,r.y*r.z-r.x,r.x*r.z-r.y,r.y*r.z+r.x,r.z*r.z];return{x:a[0]*e.x+a[1]*e.y+a[2]*e.z,y:a[3]*e.x+a[4]*e.y+a[5]*e.z,z:a[6]*e.x+a[7]*e.y+a[8]*e.z}}hull(t){let e=this.points,i=[],n=[],s=0;for(n[s++]=e[0],n[s++]=e[1],n[s++]=e[2],3===this.order&&(n[s++]=e[3]);e.length>1;){i=[];for(let r,o=0,a=e.length-1;o<a;o++)r=nr.lerp(t,e[o],e[o+1]),n[s++]=r,i.push(r);e=i}return n}split(t,e){if(0===t&&e)return this.split(e).left;if(1===e)return this.split(t).right;const i=this.hull(t),n={left:2===this.order?new fr([i[0],i[3],i[5]]):new fr([i[0],i[4],i[7],i[9]]),right:2===this.order?new fr([i[5],i[4],i[2]]):new fr([i[9],i[8],i[6],i[3]]),span:i};return n.left._t1=nr.map(0,0,1,this._t1,this._t2),n.left._t2=nr.map(t,0,1,this._t1,this._t2),n.right._t1=nr.map(t,0,1,this._t1,this._t2),n.right._t2=nr.map(1,0,1,this._t1,this._t2),e?(e=nr.map(e,t,1,0,1),n.right.split(e).left):n}extrema(){const t={};let e=[];return this.dims.forEach(function(i){let n=function(t){return t[i]},s=this.dpoints[0].map(n);t[i]=nr.droots(s),3===this.order&&(s=this.dpoints[1].map(n),t[i]=t[i].concat(nr.droots(s))),t[i]=t[i].filter((function(t){return t>=0&&t<=1})),e=e.concat(t[i].sort(nr.numberSort))}.bind(this)),t.values=e.sort(nr.numberSort).filter((function(t,i){return e.indexOf(t)===i})),t}bbox(){const t=this.extrema(),e={};return this.dims.forEach(function(i){e[i]=nr.getminmax(this,i,t[i])}.bind(this)),e}overlaps(t){const e=this.bbox(),i=t.bbox();return nr.bboxoverlap(e,i)}offset(t,e){if(void 0!==e){const i=this.get(t),n=this.normal(t),s={c:i,n,x:i.x+n.x*e,y:i.y+n.y*e};return this._3d&&(s.z=i.z+n.z*e),s}if(this._linear){const e=this.normal(0),i=this.points.map((function(i){const n={x:i.x+t*e.x,y:i.y+t*e.y};return i.z&&e.z&&(n.z=i.z+t*e.z),n}));return[new fr(i)]}return this.reduce().map((function(e){return e._linear?e.offset(t)[0]:e.scale(t)}))}simple(){if(3===this.order){const t=nr.angle(this.points[0],this.points[3],this.points[1]),e=nr.angle(this.points[0],this.points[3],this.points[2]);if(t>0&&e<0||t<0&&e>0)return!1}const t=this.normal(0),e=this.normal(1);let i=t.x*e.x+t.y*e.y;return this._3d&&(i+=t.z*e.z),rr(lr(i))<dr/3}reduce(){let t,e,i=0,n=0,s=.01,r=[],o=[],a=this.extrema().values;for(-1===a.indexOf(0)&&(a=[0].concat(a)),-1===a.indexOf(1)&&a.push(1),i=a[0],t=1;t<a.length;t++)n=a[t],e=this.split(i,n),e._t1=i,e._t2=n,r.push(e),i=n;return r.forEach((function(t){for(i=0,n=0;n<=1;)for(n=i+s;n<=1.01;n+=s)if(e=t.split(i,n),!e.simple()){if(n-=s,rr(i-n)<s)return[];e=t.split(i,n),e._t1=nr.map(i,0,1,t._t1,t._t2),e._t2=nr.map(n,0,1,t._t1,t._t2),o.push(e),i=n;break}i<1&&(e=t.split(i,1),e._t1=nr.map(i,0,1,t._t1,t._t2),e._t2=t._t2,o.push(e))})),o}scale(t){const e=this.order;let i=!1;if("function"==typeof t&&(i=t),i&&2===e)return this.raise().scale(i);const n=this.clockwise,s=i?i(0):t,r=i?i(1):t,o=[this.offset(0,10),this.offset(1,10)],a=this.points,h=[],c=nr.lli4(o[0],o[0].c,o[1],o[1].c);if(!c)throw new Error("cannot scale this curve. Try reducing it first.");return[0,1].forEach((function(t){const i=h[t*e]=nr.copy(a[t*e]);i.x+=(t?r:s)*o[t].n.x,i.y+=(t?r:s)*o[t].n.y})),i?([0,1].forEach((function(s){if(2!==e||!s){var r=a[s+1],o={x:r.x-c.x,y:r.y-c.y},l=i?i((s+1)/e):t;i&&!n&&(l=-l);var u=ur(o.x*o.x+o.y*o.y);o.x/=u,o.y/=u,h[s+1]={x:r.x+l*o.x,y:r.y+l*o.y}}})),new fr(h)):([0,1].forEach((t=>{if(2===e&&t)return;const i=h[t*e],n=this.derivative(t),s={x:i.x+n.x,y:i.y+n.y};h[t+1]=nr.lli4(i,s,c,a[t+1])})),new fr(h))}outline(t,e,i,n){e=void 0===e?t:e;const s=this.reduce(),r=s.length,o=[];let a,h=[],c=0,l=this.length();const u=void 0!==i&&void 0!==n;function d(t,e,i,n,s){return function(r){const o=n/i,a=(n+s)/i,h=e-t;return nr.map(r,0,1,t+o*h,t+a*h)}}s.forEach((function(s){const r=s.length();u?(o.push(s.scale(d(t,i,l,c,r))),h.push(s.scale(d(-e,-n,l,c,r)))):(o.push(s.scale(t)),h.push(s.scale(-e))),c+=r})),h=h.map((function(t){return a=t.points,a[3]?t.points=[a[3],a[2],a[1],a[0]]:t.points=[a[2],a[1],a[0]],t})).reverse();const f=o[0].points[0],p=o[r-1].points[o[r-1].points.length-1],g=h[r-1].points[h[r-1].points.length-1],_=h[0].points[0],m=nr.makeline(g,f),v=nr.makeline(p,_),y=[m].concat(o).concat([v]).concat(h);return y.length,new sr(y)}outlineshapes(t,e,i){e=e||t;const n=this.outline(t,e).curves,s=[];for(let t=1,e=n.length;t<e/2;t++){const r=nr.makeshape(n[t],n[e-t],i);r.startcap.virtual=t>1,r.endcap.virtual=t<e/2-1,s.push(r)}return s}intersects(t,e){return t?t.p1&&t.p2?this.lineIntersects(t):(t instanceof fr&&(t=t.reduce()),this.curveintersects(this.reduce(),t,e)):this.selfintersects(e)}lineIntersects(t){const e=or(t.p1.x,t.p2.x),i=or(t.p1.y,t.p2.y),n=ar(t.p1.x,t.p2.x),s=ar(t.p1.y,t.p2.y);return nr.roots(this.points,t).filter((t=>{var r=this.get(t);return nr.between(r.x,e,n)&&nr.between(r.y,i,s)}))}selfintersects(t){const e=this.reduce(),i=e.length-2,n=[];for(let s,r,o,a=0;a<i;a++)r=e.slice(a,a+1),o=e.slice(a+2),s=this.curveintersects(r,o,t),n.push(...s);return n}curveintersects(t,e,i){const n=[];t.forEach((function(t){e.forEach((function(e){t.overlaps(e)&&n.push({left:t,right:e})}))}));let s=[];return n.forEach((function(t){const e=nr.pairiteration(t.left,t.right,i);e.length>0&&(s=s.concat(e))})),s}arcs(t){return t=t||.5,this._iterate(t,[])}_error(t,e,i,n){const s=(n-i)/4,r=this.get(i+s),o=this.get(n-s),a=nr.dist(t,e),h=nr.dist(t,r),c=nr.dist(t,o);return rr(h-a)+rr(c-a)}_iterate(t,e){let i,n=0,s=1;do{i=0,s=1;let r,o,a,h,c,l=this.get(n),u=!1,d=!1,f=s,p=1,g=0;do{if(d=u,h=a,f=(n+s)/2,g++,r=this.get(f),o=this.get(s),a=nr.getccenter(l,r,o),a.interval={start:n,end:s},u=this._error(a,l,n,s)<=t,c=d&&!u,c||(p=s),u){if(s>=1){if(a.interval.end=p=1,h=a,s>1){let t={x:a.x+a.r*hr(a.e),y:a.y+a.r*cr(a.e)};a.e+=nr.angle({x:a.x,y:a.y},t,this.get(1))}break}s+=(s-n)/2}else s=f}while(!c&&i++<100);if(i>=100)break;h=h||a,e.push(h),n=p}while(s<1);return e}}const pr={RIGHT:0,BOTTOM:1,LEFT:2,TOP:3,SELF:100},gr={DEFAULT:"DEFAULT",LINKING:"LINKING"};function _r(t){if(0===t.length)return{width:1,height:1,x:0,y:0};let e=1/0,i=1/0,n=-1/0,s=-1/0;for(let r in t){const o=t[r];o[0]<e&&(e=o[0]),o[0]>n&&(n=o[0]),o[1]<i&&(i=o[1]),o[1]>s&&(s=o[1])}return{width:Math.max(n-e,10),height:Math.max(s-i,10),x:e,y:i}}function mr(t){return t*t}function vr(t,e){return mr(t[0]-e[0])+mr(t[1]-e[1])}function yr(t,e,i){const n=vr(e,i);if(0===n)return vr(t,e);let s=((t[0]-e[0])*(i[0]-e[0])+(t[1]-e[1])*(i[1]-e[1]))/n;return s=Math.max(0,Math.min(1,s)),vr(t,[e[0]+s*(i[0]-e[0]),e[1]+s*(i[1]-e[1])])}function br(t,e){const i={fromDir:null,fromP:null,toDir:null,toP:null,distMin:1/0};return Object.keys(t).forEach((n=>{if(+n===pr.SELF)return;let s=t[n];Object.keys(e).forEach((t=>{if(+t===pr.SELF)return;let r=e[t];const o=vr(s,r);o<i.distMin&&Object.assign(i,{distMin:o,fromDir:+n,fromP:s,toDir:+t,toP:r})}))})),i}function wr(t,e,i,n){return e===pr.TOP?[t[0],t[1]-n]:e===pr.BOTTOM?[t[0],t[1]+n]:e===pr.LEFT?[t[0]-i,t[1]]:e===pr.RIGHT?[t[0]+i,t[1]]:void 0}function xr(t,e,i=pr.TOP,n=pr.TOP,s=0,r=0){const o=Math.max(Math.abs((t[0]-e[0])/2),s),a=Math.max(Math.abs((t[1]-e[1])/2),r),h=wr(t,i,o,a),c=wr(e,n,o,a),l=[pr.TOP,pr.LEFT].includes(n)?-5:5,u=[pr.TOP,pr.BOTTOM].includes(n);return[...h,...c,u?e[0]:e[0]+l,u?e[1]+l:e[1]]}function kr(t,e,i,n,s,r,o,a,h){var c=Math.pow(1-t,2)*(n-e)+2*t*(1-t)*(r-n)+t*t*(a-r),l=Math.pow(1-t,2)*(s-i)+2*t*(1-t)*(o-s)+t*t*(h-o);return-Math.atan2(c,l)+.5*Math.PI}function Sr(t,e,i,n=pr.TOP,s=pr.TOP,r=10,o=10,a){const h=Math.abs(n-s),c=n===pr.TOP||n===pr.BOTTOM;switch(t.length=0,h){case 0:if(n===pr.TOP){const n=Math.min(e[1],i[1])-o;t.push([e[0],n]),t.push([i[0],n])}if(n===pr.BOTTOM){const n=Math.max(e[1],i[1])+o;t.push([e[0],n]),t.push([i[0],n])}if(n===pr.LEFT){const n=Math.min(e[0],i[0])-r;t.push([n,e[1]]),t.push([n,i[1]])}if(n===pr.RIGHT){const n=Math.max(e[0],i[0])+r;t.push([n,e[1]]),t.push([n,i[1]])}break;case 1:case 3:if(a)c?(t.push([e[0],e[1]+o]),t.push([i[0]+r,e[1]+o]),t.push([i[0]+r,i[1]])):(t.push([e[0]+r,e[1]]),t.push([e[0]+r,i[1]+o]),t.push([i[0],i[1]+o]));else{const n=c?[e[0],i[1]]:[i[0],e[1]];t.push(n)}break;case 2:const s=[(e[0]-i[0])/2+i[0],(e[1]-i[1])/2+i[1]];c?(t.push([e[0],s[1]]),t.push([i[0],s[1]])):(t.push([s[0],e[1]]),t.push([s[0],i[1]]))}t.unshift(e),t.push(i)}function Cr(t,e){return[t[0]-e[0],t[1]-e[1]]}function Tr(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Er(t,e){return[t[0]*e,t[1]*e]}function Or(t,e){return t[0]!=t[2]&&t[1]!=t[3]&&e[0]!=e[2]&&e[1]!=e[3]&&!(t[2]<=e[0]||t[3]<=e[1]||t[0]>=e[2]||t[1]>=e[3])}function Br(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Ir(t,e){t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]}const Lr=Symbol("ishit"),jr=Symbol("isInViewBox");class Pr extends EventTarget{constructor(t={}){super(),Object.assign(this,t),this.visible=!0,this._belongs=void 0,this[Lr]=!1,this.borderWidth=t.borderWidth||0,this.borderColor=t.borderColor||"transparent",this.backgroundColor=t.backgroundColor||"transparent",this.shadowColor=t.shadowColor,this.shadowBlur=t.shadowBlur||5,this.shadowOffsetX=t.shadowOffsetX||0,this.shadowOffsetY=t.shadowOffsetY||0,this.opacity=t.opacity||1,this._boundingrect=[0,0,0,0]}get _isTargeting(){return this===(this._jflow._target.instance||this._jflow._target.link)}get _isMoving(){return this===this._jflow._getMovingTarget()&&this._jflow._target.status.movingState}get _isHit(){return this[Lr]}get _jflow(){return"jflow"===this._belongs.uniqueName?this._belongs:this._belongs._jflow}set _isHit(t){this[Lr]!==t&&this.dispatchEvent(new CustomEvent(t?"mouseenter":"mouseleave",{detail:{instance:this,jflow:this._jflow}})),this[Lr]=t}get isInViewBox(){return this[jr]}set _isInViewBox(t){t!==this[jr]&&(t?this.onEnterViewbox():this.onLeaveViewbox()),this[jr]=t}onEnterViewbox(){}onLeaveViewbox(){}setConfig(t){Object.keys(t).forEach((e=>{void 0!==t[e]&&null!==t[e]&&(this[e]=t[e])}))}render(t){throw"require render implement"}isHit(t){throw"require isHit implement"}getBoundingRect(){throw"require getBoundingRect implement"}calculateIntersection(){throw"require calculateIntersection implement"}getIntersectionsInFourDimension(){throw"require getIntersectionsInFourDimension implement"}getCenter(){return this.anchor}getBoundingDimension(){const t=instance.getBoundingRect();let e=1/0,i=-1/0,n=1/0,s=-1/0;return t.forEach((t=>{i=Math.max(i,t[1]),e=Math.min(e,t[1]),s=Math.max(s,t[0]),n=Math.min(n,t[0])})),{height:i-e,width:s-n}}bubbleEvent(t){t.detail.currentTarget=this,this.dispatchEvent(t),t.detail.bubbles&&(this._belongs.bubbleEvent?this._belongs.bubbleEvent(t):this._belongs.dispatchEvent(t))}calculateToRealWorld(t){return this._belongs&&this._belongs.calculateToRealWorld?this._belongs.calculateToRealWorld(t):t}calculateToRealWorldWithScalar(t){return this._jflow.scale*t}recalculateUp(){this.belongs&&this.belongs.recalculateUp()}destroy(){}}const Mr=Pr,Ar=class extends Mr{constructor(t={}){super(t),this._rawConfigs=t,this.anchor=t.anchor||[0,0],this.absolutePosition=t.absolutePosition}setConfig(t){Object.keys(t).forEach((e=>{void 0!==t[e]&&null!==t[e]&&(this[e]=t[e],this._rawConfigs[e]=t[e])}))}setAnchorX(t){this.anchor[0]=t}setAnchorY(t){this.anchor[1]=t}setAnchor(t,e){this.anchor[0]=t,this.anchor[1]=e}beforeRender(){return Or(this._belongs._getViewBox(),this.getBoundingRect())}clone(){const t=new(0,this.constructor)(this._rawConfigs);return t.visible=this.visible,t}},Rr=class extends Ar{constructor(t){super(t)}render(t){}isHit(t){return!1}calculateIntersection(t){return this.anchor}getBoundingRect(){const[t,e]=this.anchor;return[t,e,t,e]}getBoundingDimension(){return{width:0,height:0}}getIntersectionsInFourDimension(){const[t,e]=this.anchor;return{[pr.RIGHT]:[t+1,e],[pr.LEFT]:[t-1,e],[pr.BOTTOM]:[t,e+1],[pr.TOP]:[t,e-1]}}};class Dr{constructor(){this._map=new WeakMap}get(t){return this._map.get(t)}set(t){const e={layoutNode:void 0,jflowNode:void 0,jflowlinks:[],jflowFromLinks:[],jflowToLinks:[]};return this._map.set(t,e),e}has(t){return this._map.has(t)}delete(t){this._map.delete(t)}clear(){this._map.clear()}}const $r={initNodeWeakMap(){this.source_Layout_Render_NodeMap=new Dr},getRenderNodeBySource(t){const e=this.source_Layout_Render_NodeMap.get(t);if(e)return e.jflowNode},getLayoutNodeBySource(t){const e=this.source_Layout_Render_NodeMap.get(t);if(e)return e.layoutNode},getSourceRenderMeta(t){return this.source_Layout_Render_NodeMap.get(t)},_getMap(t){const e=this.source_Layout_Render_NodeMap;let i;return i=e.has(t)?e.get(t):e.set(t),i},setLayoutNodeBySource(t,e){this._getMap(t).layoutNode=e},setRenderNodeBySource(t,e){this._getMap(t).jflowNode=e},addLinkNodeBySource(t,e,i){let n=this._getMap(t);n.jflowFromLinks.push(i),n=this._getMap(e),n.jflowToLinks.push(i)},removeLinkNodeBySource(t,e,i){let n=this._getMap(t),s=n.jflowFromLinks.findIndex((t=>t===i));-1!==s&&n.jflowFromLinks.splice(s,1),n=this._getMap(e),s=n.jflowToLinks.findIndex((t=>t===i)),-1!==s&&n.jflowToLinks.splice(s,1)}},Nr=class extends Array{constructor(){super(),this._currentHit=null}render(t,e){let i;this.forEach((n=>{if(n._isMoving)i=n;else if(n.visible&&(!e||e(n))){if(n.beforeRender&&!n.beforeRender(t))return;t.save(),n.render(t),t.restore()}})),i&&(t.save(),i.render(t),t.restore())}resetHitStatus(){this._currentHit=null,this.forEach((t=>{t._stack&&t._stack.resetHitStatus(),t._isHit=!1}))}checkHit(t,e,i){let n=this.length-1;for(;n>=0;){const s=this[n];if(s.visible&&!s.ignoreHit){if(e&&e(s)){n--;continue}if(i&&!i(s)){n--;continue}const r=s.isHit(t,e);if(r)return this._currentHit!==s&&(this._currentHit&&(this._currentHit._isHit=!1),s._isHit=!0,this._currentHit=s),"boolean"!=typeof r?r:s;s._isHit=!1}n--}return this._currentHit=null,null}getBoundingRectPoints(){const t=[];return this.forEach((e=>{if(e.visible&&!e.absolutePosition){const i=e.getBoundingRect();t.push([i[0],i[1]]),t.push([i[2],i[3]])}})),t}getAnchorRectPoints(){const t=[];return this.forEach((e=>{e.visible&&!e.absolutePosition&&t.push(e.anchor)})),t}},Fr={instances:[],links:[],_stack:null,_linkStack:null,initStack({data:t}){this._stack=new Nr,this._linkStack=new Nr,t&&(this.instances=t.instances,this.links=t.links,this.instances.forEach((t=>{this._stack.push(t),t._belongs=this})),this.links.forEach((t=>{this._linkStack.push(t),t._belongs=this})))},addToStack(t){t._belongs=this,this._stack.push(t)},replaceFromStack(t,e){const i=this._stack.findIndex((e=>e===t));this._stack.splice(i,1,e),t._belongs=null,e._belongs=this},addToLinkStack(t){t._belongs=this,this._linkStack.push(t)},removeFromStack(t){const e=this._stack.findIndex((e=>e===t));-1!==e&&this._stack.splice(e,1)},removeFromLinkStack(t){const e=this._linkStack.findIndex((e=>e===t));-1!==e&&this._linkStack.splice(e,1)},emptyLink(){this._linkStack=new Nr},resetChildrenPosition(){this._stack.forEach((t=>{t.anchor=[0,0]}))},addInstanceToLink(t,e){this.addToStack(e);const{from:i,to:n}=t,s=this._linkStack.findIndex((e=>e===t)),r=t.__proto__.constructor,o=new r({from:i,to:e});o._belongs=this;const a=new r({from:e,to:n});a._belongs=this,this._linkStack.splice(s,1,o,a)},interateNodeStack(t){this._stack.forEach((e=>{t(e)}))}},Wr=Fr,Hr={_layout:null,initLayout(t){this._layout=t.layout},recalculateUp(){let t=!0;if(this.getBoundingDimension){const{width:e,height:i}=this.getBoundingDimension();this.resetChildrenPosition&&this.resetChildrenPosition(),this._getBoundingGroupRect&&this._getBoundingGroupRect(),this.reflow(),this._getBoundingGroupRect&&this._getBoundingGroupRect();const{width:n,height:s}=this.getBoundingDimension();t=e!==n||i!==s}else this.reflow();this._belongs&&t&&this._belongs.recalculateUp()},recalculate(){this.reflow(),this._getBoundingGroupRect&&this._getBoundingGroupRect()},staticCheck(t){return!!this._layout&&this._layout.staticCheck(t,this)},reflow(){this._layout&&this._layout.reflow(this)}},zr={_message:null,sendMessage(t){this._message=t},consumeMessage(){const t=this._message;return this._message=null,t},readMessage(){return this._message}},Vr={initAnime(){this.anime_queue=[],this.__animeClock__=void 0},requestJFlowAnime(t){const e=this.enqueueAnime(t);return this._runAnime(),e},enqueueAnime(t){const e={start:void 0,callback:t,cancel:()=>{this._cancelAnime(e),this._render()}};return this.anime_queue.push(e),e},_cancelAnime(t){const e=this.anime_queue.findIndex((e=>e===t));~e&&this.anime_queue.splice(e,1)},runAnime(){this._runAnime()},_runAnime(){this.anime_queue.length&&requestAnimationFrame((()=>{this.scheduleRender(),this._runAnime()}))},runAnimeFrame(){this.anime_queue.forEach((t=>{const e=Date.now();t.start||(t.start=e);const i=e-t.start;t.callback(i)}))}},Xr={captureMap(t,{padding:e=0,placement:i="normal"}){this._getBoundingGroupRect();const{width:n,height:s,x:r,y:o}=this.bounding_box;if(!this.miniMap){this.miniMap=Ds(t);const{width:e,height:i,raw_width:n,raw_height:s}=this.miniMap;this.addEventListener("zoompan",(()=>{this._renderMap&&this._renderMap()}));let r=!1;this.miniMap.canvas.addEventListener("pointerdown",(t=>{let{offsetX:e,offsetY:i,deltaX:n,deltaY:s}=t;r=!0,this._onMoveMap&&this._onMoveMap(e,i)})),this.miniMap.canvas.addEventListener("pointermove",(t=>{let{offsetX:n,offsetY:s,deltaX:o,deltaY:a}=t;r&&this._onMoveMap&&this._onMoveMap(n,s),(s<5||n<5||n>e-5||s>i-5)&&(r=!1)})),this.miniMap.canvas.addEventListener("pointerup",(()=>{r=!1}));const o=document.createElement("canvas");o.width=n,o.height=s,this.cacheMinimapCtx=o.getContext("2d")}const{width:a,height:h,raw_width:c,raw_height:l,left:u,top:d,scale:f,ctx:p}=this.miniMap,g=2*e,_=e,m=(a-g)/n,v=(h-g)/s,y=Math.min(m,v);let b=0,w=0;"center"===i?(w=(h-s*y)/2-o*y,b=(a-n*y)/2-r*y):m<v?(w=(h-s*y)/2-o*y,b=_):(b=(a-n*y)/2-r*y,w=_);const x=this.cacheMinimapCtx;x.setTransform(),x.clearRect(0,0,c,l),x.scale(f,f),x.transform(y,0,0,y,b,w);const k=[0,0,0,0];this.NodeRenderTop?(this._linkStack.render(x,(t=>(t.isInViewBox(k),!0))),this._stack.render(x)):(this._stack.render(x),this._linkStack.render(x,(t=>(t.isInViewBox(k),!0))));const S=x.getImageData(0,0,c,l);this._renderMap=()=>{p.save(),p.setTransform(),p.clearRect(0,0,c,l),p.scale(f,f),p.putImageData(S,0,0),p.transform(y,0,0,y,b,w);const[t,e,i,n]=this._getViewBox();p.beginPath(),p.rect(t,e,i-t,n-e),p.setTransform(),p.rect(0,0,c,l),p.clip("evenodd"),p.fillStyle="rgba(0,0,0,0.4)",p.fillRect(0,0,c,l),p.restore()},this._renderMap(),this._onMoveMap=(t,e)=>{const[i,n,s,r]=this._getViewBox(),o=[((s-i)/2+i)*y+b,((r-n)/2+n)*y+w];this._recalculatePosition((o[0]-t)/y*this.scale,(o[1]-e)/y*this.scale),this._render(),this._renderMap()}}};class Yr{constructor(t,e={}){this.anchor=[0,0],this.width=e.barWidth||4,this.height=e.barWidth||4,this.barMarginX=0,this.barMarginY=0,this.dir=t,this.plainColor=e.plainColor||"rgba(0, 0, 0, 0.15)",this.focusColor=e.focusColor||"rgba(0, 0, 0, 0.25)",this.isFocus=!1}render(t){const[e,i]=this.anchor;if(t.save(),t.beginPath(),"x"===this.dir){const n=this.height/2,s=i+n,r=i+this.height,o=e+this.width-2*this.barMarginX-n,a=e+this.barMarginX+n;t.moveTo(a,r),t.arc(a,s,n,Math.PI/2,Math.PI/2*3),t.lineTo(o,i),t.arc(o,s,n,-Math.PI/2,Math.PI/2),t.closePath()}else{const n=this.width/2,s=i+this.barMarginY+n,r=i+this.height-2*this.barMarginY-n,o=e+n,a=e+this.width;t.moveTo(e,s),t.arc(o,s,n,-Math.PI,0),t.lineTo(a,r),t.arc(o,r,n,0,Math.PI),t.closePath()}t.fillStyle=this.isFocus?this.focusColor:this.plainColor,t.fill(),t.restore()}isHit(t){const e=this.anchor,i=this.width,n=this.height;return t[0]>e[0]-5&&t[0]<e[0]+i+5&&t[1]>e[1]-5&&t[1]<e[1]+n+5}}const Gr={initScrollBar(t={}){const{barColor:e,barFocusColor:i,barMarginX:n,barMarginY:s,barWidth:r}=t;this._scrollbarEnable=!0,this._scrollbarX=new Yr("x",{plainColor:e,focusColor:i,barWidth:r}),this._scrollbarX.barMarginX=n||5,this._scrollbarY=new Yr("y",{plainColor:e,focusColor:i,barWidth:r}),this._scrollbarY.barMarginY=s||5,this._scrollBarStatus={dragging:!1,target:null,xscale:void 0,yscale:void 0,barInitX:0,barInitY:0},this.addEventListener("zoompan",(()=>{this.scrollBarOnPanAndZoom()})),this.scrollBarOnPanAndZoom(),this.canvas.addEventListener("pointerdown",(t=>{const{offsetX:e,offsetY:i,clientX:n,clientY:s}=t;this.onScrollbarPressStart(e,i,n,s)}))},checkScrollDragging(){return this._scrollBarStatus&&this._scrollBarStatus.dragging},onScrollbarPressStart(t,e,i,n){this._scrollbarX.isHit([t,e])&&Object.assign(this._scrollBarStatus,{dragging:!0,target:this._scrollbarX,barStartX:this._scrollbarX.anchor[0],barInitX:i}),this._scrollbarY.isHit([t,e])&&Object.assign(this._scrollBarStatus,{dragging:!0,target:this._scrollbarY,barStartY:this._scrollbarY.anchor[1],barInitY:n});const s=(t=>{const{offsetX:e,offsetY:i,clientX:n,clientY:s}=t;this.onDraggingScrollbar(e,i,n,s)}).bind(this);document.addEventListener("pointermove",s);const r=(t=>{Object.assign(this._scrollBarStatus,{dragging:!1,target:null,x:void 0,y:void 0}),document.removeEventListener("pointermove",s),document.removeEventListener("pointerup",r),this.canvas.removeEventListener("pointerup",r)}).bind(this);this.canvas.addEventListener("pointerup",r,{once:!0}),document.addEventListener("pointerup",r,{once:!0})},onDraggingScrollbar(t,e,i,n){if(this._scrollbarEnable&&this._scrollBarStatus.dragging){const{target:t,barInitX:e,barStartX:s,barInitY:r,barStartY:o,xscale:a,yscale:h,scollbarHeight:c,scollbarWidth:l,realR:u,realL:d,realT:f,realB:p}=this._scrollBarStatus,{actual_width:g,actual_height:_}=this.canvasMeta,{x:m,y:v}=this.bounding_box;if("x"===t.dir){const n=s+(i-e),r=(m-((u-d)*((t.anchor[0]=Math.max(Math.min(n,g-l),0))/g)+d))*this.scale;Object.assign(this.position,{offsetX:r-m*this.scale,x:r})}if("y"===t.dir){const e=o+(n-r),i=(v-((p-f)*((t.anchor[1]=Math.max(Math.min(e,_-c),0))/_)+f))*this.scale;Object.assign(this.position,{offsetY:i-v*this.scale,y:i})}return this.scheduleRender(),!0}return!1},checkScrollBarHover(t,e){if(this._scrollbarEnable){if(this._scrollbarX.isHit([t,e]))return this._scrollbarX.isFocus||(this._scrollbarX.isFocus=!0,this.scheduleRender()),this.canvas.style.cursor="default",!0;if(this._scrollbarY.isHit([t,e]))return this._scrollbarY.isFocus||(this._scrollbarY.isFocus=!0,this.scheduleRender()),this.canvas.style.cursor="default",!0}return!1},resetScrollBarHover(){this._scrollbarEnable&&(this._scrollbarY.isFocus||this._scrollbarX.isFocus)&&(this._scrollbarY.isFocus=!1,this._scrollbarX.isFocus=!1,this.scheduleRender())},_getScrollViewBoundingbox(){const{width:t,height:e,x:i,y:n}=this.bounding_box;return{width:t+240,height:e+240,x:i-120,y:n-120}},scrollBarOnPanAndZoom(){if(!this._scrollbarEnable||this._scrollBarStatus.dragging)return;const{width:t,height:e,x:i,y:n}=this._getScrollViewBoundingbox();let[s,r,o,a]=this._getViewBox();const h=Math.max(o,i+t),c=Math.min(s,i),l=Math.min(r,n),u=Math.max(a,n+e),d=o-s,f=a-r,{actual_width:p,actual_height:g}=this.canvasMeta,_=d/(h-c);if(_<1){const t=p*_,e=(s-c)*_*this.scale;this._scrollbarX.anchor=[e,g-10],this._scrollbarX.width=t,this._scrollBarStatus.scollbarWidth=t}const m=f/(u-l);if(m<1){const t=g*m,e=(r-l)*m*this.scale;this._scrollbarY.anchor=[p-10,e],this._scrollbarY.height=t,this._scrollBarStatus.scollbarHeight=t}Object.assign(this._scrollBarStatus,{yscale:m,xscale:_,realR:h,realL:c,realT:l,realB:u})},resetScollBarStatus(){this._scrollbarEnable&&Object.assign(this._scrollBarStatus,{dragging:!1,target:null,x:void 0,y:void 0})},renderScrollBar(t){if(this._scrollbarEnable){t.setTransform(),t.scale(this.dpr,this.dpr);const{xscale:e,yscale:i}=this._scrollBarStatus;e<1&&this._scrollbarX.render(t),i<1&&this._scrollbarY.render(t)}}},Ur={initSchedule(){this.__clock__=void 0},scheduleRender(t){requestAnimationFrame((e=>{this.__clock__!==e&&this.__render(),t&&t(e),this.__clock__=e}))}};class qr extends CustomEvent{constructor(t,e={}){super(t,{detail:{...e,originEvent:e.event,target:e.target,jflow:e.jflow,bubbles:e.bubbles||!1}})}}const Jr=qr,Kr={...Wr,...Hr,_setPadding(t){this.padding={top:t.paddingTop||t.padding||0,right:t.paddingRight||t.padding||0,bottom:t.paddingBottom||t.padding||0,left:t.paddingLeft||t.padding||0}},_setMargin(t){this.margin={top:t.marginTop||t.margin||0,right:t.marginRight||t.margin||0,bottom:t.marginBottom||t.margin||0,left:t.marginLeft||t.margin||0}},_getCenter(){const t=this.anchor,e=this.padding,i=this.margin,n=(i.left-i.right)/2,s=(i.top-i.bottom)/2,r=(e.left-e.right)/2+n,o=(e.top-e.bottom)/2+s;return this._shape.anchor=[t[0]+n,t[1]+s],[t[0]+r,t[1]+o]},setAnchorX(t){this.anchor[0]=t,this._getCenter()},setAnchorY(t){this.anchor[1]=t,this._getCenter()},setAnchor(t,e){this.anchor[0]=t,this.anchor[1]=e,this._getCenter()},_calculatePointBack(t){const[e,i]=t,[n,s]=this._getCenter();return[e-n,i-s]},_calculatePointBackWithPoint(t,e,i,n,s){const r=this.anchor,o=this.padding,a=this.margin;i[n]=t-(r[0]+(o.left-o.right)/2+(a.left-a.right)/2),i[s]=e-(r[1]+(o.top-o.bottom)/2+(a.top-a.bottom)/2)},calculateToCoordination(t){const[e,i]=t,[n,s]=this._getCenter(),r=[e+n,i+s];return this._belongs&&this._belongs.calculateToCoordination?this._belongs.calculateToCoordination(r):r},calculateToRealWorld(t){const[e,i]=t,[n,s]=this._getCenter(),r=[e+n,i+s];if(this._belongs&&this._belongs.calculateToRealWorld)return this._belongs.calculateToRealWorld(r)},clone(){const t=new(0,this.constructor)(Object.assign({},this._rawConfigs,{layout:this._layout&&this._layout.clone()}));return this.interateNodeStack((e=>{t.addToStack(e.clone())})),t.recalculate(),t.visible=this.visible,t},getBoundingDimension(){return{width:this.width,height:this.height}},getBoundingRect(){const t=this.anchor,e=this.width/2,i=this.height/2,n=t[0]-e,s=t[1]-i,r=t[0]+e,o=t[1]+i,a=this._boundingrect;return a[0]=n,a[1]=s,a[2]=r,a[3]=o,a},getIntersectionsInFourDimension(){let t=this.anchor;this._belongs&&this._belongs.calculateToCoordination&&(t=this._belongs.calculateToCoordination(t));const[e,i]=t,n=this.width/2,s=this.height/2;return{[pr.RIGHT]:[e+n,i],[pr.LEFT]:[e-n,i],[pr.BOTTOM]:[e,i+s],[pr.TOP]:[e,i-s],[pr.SELF]:[e+.618*n,i+.618*s]}},calculateIntersection(t){const[e,i]=t,[n,s]=this.anchor,r=this.width/2,o=this.height/2,a=n-e,h=s-i,c=o/r,l=Math.abs(h/a),u=e>n,d=i>s;let f,p;return l<c?(f=n+(u?r:-r),p=r*(d?l:-l)+s):(p=s+(d?o:-o),f=o/(u?l:-l)+n),[f,p]},onEnterViewbox(){this.interateNodeStack((t=>{t.onEnterViewbox()}))},onLeaveViewbox(){this.interateNodeStack((t=>{t.onLeaveViewbox()}))},destroy(){this._shape.destroy(),this.interateNodeStack((t=>{t.destroy()}))}};function Zr(t,e){return[t,e]}const Qr=function(t,e={}){const i="function"==typeof e.shapeShift?e.shapeShift:Zr;class n extends Ar{constructor(e){super(e),this.initStack(e),this.initLayout(e),this._shape=new t(e),this._shape.anchor=[0,0],this._shape._belongs=this,this._setPadding(e),this._setMargin(e),this.definedWidth=e.width,this.minWidth=e.minWidth,this.definedHeight=e.height,this.lock=e.lock??!0,this.display=e.display||"default",this.transparent=e.transparent??!1,this._getBoundingGroupRect(),this.reflow(),this._getBoundingGroupRect(),this._cacheViewBox=[]}}return Object.assign(n.prototype,Kr),Object.assign(n.prototype,{reflow(){Kr.reflow.call(this);const t=this.margin,[e,n]=i(this.width-t.left-t.right,this.height-t.top-t.bottom,this._shape);this._shape.width=e,this._shape.height=n},setConfig(t){this._shape.setConfig(t),this._setPadding(t),this._setMargin(t),"opacity"in t&&(this.opacity=t.opacity),t.layout&&this._layout!==t.layout&&(this._layout=t.layout)},_getBoundingGroupRect(){const t=_r(this._stack.getBoundingRectPoints()),e=this.padding,n=this.minWidth,s=this.definedWidth,r=t.width+e.left+e.right,o=t.height+e.top+e.bottom,a=n?Math.max(n,r):s||r,h=this.definedHeight||o;this._paddingWidth=a,this._paddingHeight=h;const[c,l]=i(a,h,this._shape);this._shape.width=c,this._shape.height=l;const u=this.margin;this.width=c+u.left+u.right,this.height=l+u.top+u.bottom},_getViewBox(){const t=this._belongs.getCacheViewBox(),e=this._cacheViewBox;return this._calculatePointBackWithPoint(t[0],t[1],e,0,1),this._calculatePointBackWithPoint(t[2],t[3],e,2,3),this._cacheViewBox},getCacheViewBox(){return this._cacheViewBox},render(t){t.save(),this._isMoving?t.globalAlpha=.6:1!==this.opacity&&(t.globalAlpha=this.opacity);const[e,i]=this._getCenter();this._shape.render(t),t.translate(e,i),this._stack.render(t),t.translate(-e,-i),t.restore()},isHit(t,e){const i=this._calculatePointBack(t);this._currentp=i;return this._stack.checkHit(i,e)||!this.transparent&&this._shape.isHit(t)}}),n},to=class extends Ar{constructor(t){super(t),this.type="Point",this.radius=t.radius||10,this._doCache()}setConfig(t){Object.keys(t).forEach((e=>{void 0!==t[e]&&null!==t[e]&&(this[e]=t[e],this._rawConfigs[e]=t[e])})),this._doCache()}_doCache(){this.width=2*this.radius,this.height=2*this.radius}render(t){t.save(),this._isMoving&&(t.globalAlpha=.6),t.beginPath(),t.arc(this.anchor[0],this.anchor[1],this.radius,0,2*Math.PI),t.fillStyle=this.backgroundColor,t.fill(),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor,t.stroke()),t.restore()}isHit(t){const e=this.anchor;return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)<this.radius*this.radius}getBoundingRect(){const t=this.anchor,e=this.radius,i=t[0]-e,n=t[1]-e,s=t[0]+e,r=t[1]+e,o=this._boundingrect;return o[0]=i,o[1]=n,o[2]=s,o[3]=r,o}calculateIntersection(t){const[e,i]=t,[n,s]=this.anchor,r=n-e,o=s-i,a=Math.sqrt(r*r+o*o),h=this.radius/a;return[n-h*r,s-h*o]}getIntersectionsInFourDimension(){const[t,e]=this.anchor,i=this.radius;return{[pr.RIGHT]:[t+i,e],[pr.LEFT]:[t-i,e],[pr.BOTTOM]:[t,e+i],[pr.TOP]:[t,e-i]}}calculateIntersectionInFourDimension(t,e){const[i,n]=t,[s,r]=this.anchor,o=this.radius,a=s-i,h=r-n,c={[pr.RIGHT]:[s+o,r],[pr.LEFT]:[s-o,r],[pr.BOTTOM]:[s,r+o],[pr.TOP]:[s,r-o]};let l=Math.abs(h)>Math.abs(a)?h<0?pr.BOTTOM:pr.TOP:a<0?pr.RIGHT:pr.LEFT;return{p:c[l],dir:l}}getBoundingDimension(){return{width:this.width,height:this.height}}},eo=class extends Ar{constructor(t={}){super(t),this.type="Rectangle",this.width=t.width||10,this.height=t.height||10,this.borderRadius=t.borderRadius||0,this._setBorder(t)}_setBorder(t){this.border={top:{color:t.border?.top?.borderColor||t.borderColor||"transparent",width:t.border?.top?.borderWidth||t.borderWidth||0,enable:t.border?.top?.borderWidth},right:{color:t.border?.right?.borderColor||t.borderColor||"transparent",width:t.border?.right?.borderWidth||t.borderWidth||0,enable:t.border?.right?.borderWidth},bottom:{color:t.border?.bottom?.borderColor||t.borderColor||"transparent",width:t.border?.bottom?.borderWidth||t.borderWidth||0,enable:t.border?.bottom?.borderWidth},left:{color:t.border?.left?.borderColor||t.borderColor||"transparent",width:t.border?.left?.borderWidth||t.borderWidth||0,enable:t.border?.left?.borderWidth}},this.borderColor=t.borderColor||"transparent",this.borderWidth=t.borderWidth||0}setConfig(t){Object.keys(t).forEach((e=>{void 0!==t[e]&&null!==t[e]&&(this[e]=t[e],this._rawConfigs[e]=t[e])})),this._setBorder(t)}render(t){t.save(),this._isMoving&&(t.globalAlpha=.6);const{borderRadius:e,anchor:i,width:n,height:s}=this,r=this.anchor[0]-this.width/2,o=this.anchor[1]-this.height/2,a=this.anchor[0]+this.width/2,h=this.anchor[1]+this.height/2;if(this.borderRadius?(t.beginPath(),t.moveTo(r+e,o),t.lineTo(r+n-e,o),t.quadraticCurveTo(r+n,o,r+n,o+e),t.lineTo(r+n,o+s-e),t.quadraticCurveTo(r+n,o+s,r+n-e,o+s),t.lineTo(r+e,o+s),t.quadraticCurveTo(r,o+s,r,o+s-e),t.lineTo(r,o+e),t.quadraticCurveTo(r,o,r+e,o),t.closePath()):(t.beginPath(),t.rect(this.anchor[0]-this.width/2,this.anchor[1]-this.height/2,this.width,this.height)),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor),this.shadowColor&&"transparent"!==this.shadowColor){t.shadowColor=this.shadowColor;const i=this._jflow.scale;t.shadowBlur=this.shadowBlur*i,t.shadowOffsetX=this.shadowOffsetX*i,t.shadowOffsetY=this.shadowOffsetY*i;let a=new Path2D;this.borderRadius?(a.moveTo(r+e,o),a.lineTo(r+n-e,o),a.quadraticCurveTo(r+n,o,r+n,o+e),a.lineTo(r+n,o+s-e),a.quadraticCurveTo(r+n,o+s,r+n-e,o+s),a.lineTo(r+e,o+s),a.quadraticCurveTo(r,o+s,r,o+s-e),a.lineTo(r,o+e),a.quadraticCurveTo(r,o,r+e,o),a.closePath()):a.rect(this.anchor[0]-this.width/2,this.anchor[1]-this.height/2,this.width,this.height),a.rect(r-10,o-10,this.width+20,this.height+20),t.save(),t.clip(a,"evenodd"),t.stroke(),t.restore()}if(t.fillStyle=this.backgroundColor,t.fill(),this.borderRadius&&this.borderWidth&&(t.shadowColor="transparent",t.stroke()),this.borderRadius){if(this.border.top.enable){const i=o-this.border.top.width/2;t.beginPath();let s=new Path2D;s.moveTo(r,i+e),s.quadraticCurveTo(r,i,r+e,i),s.lineTo(r+n-e,i),s.quadraticCurveTo(r+n,i,r+n,i+e),s.closePath(),t.clip(s),t.save(),t.shadowColor="transparent",t.fillStyle=this.border.top.color,t.rect(r,i,this.width,this.border.top.width),t.fill(),t.restore()}}else this.border.top.width&&(t.beginPath(),t.moveTo(r,o),t.lineTo(a,o),t.strokeStyle=this.border.top.color,t.lineWidth=this.border.top.width,t.stroke()),this.border.right.width&&(t.beginPath(),t.moveTo(a,o),t.lineTo(a,h),t.strokeStyle=this.border.right.color,t.lineWidth=this.border.right.width,t.stroke()),this.border.bottom.width&&(t.beginPath(),t.moveTo(a,h),t.lineTo(r,h),t.strokeStyle=this.border.bottom.color,t.lineWidth=this.border.bottom.width,t.stroke()),this.border.left.width&&(t.beginPath(),t.moveTo(r,h),t.lineTo(r,o),t.strokeStyle=this.border.left.color,t.lineWidth=this.border.left.width,t.stroke());t.restore()}isHit(t){const e=this.anchor,i=this.width/2,n=this.height/2;return t[0]>e[0]-i&&t[0]<e[0]+i&&t[1]>e[1]-n&&t[1]<e[1]+n}getBoundingRect(){const t=this.anchor,e=this.width/2,i=this.height/2,n=t[0]-e,s=t[1]-i,r=t[0]+e,o=t[1]+i,a=this._boundingrect;return a[0]=n,a[1]=s,a[2]=r,a[3]=o,a}getBoundingDimension(){return{height:this.height,width:this.width}}calculateIntersection(t){const[e,i]=t,[n,s]=this.anchor,r=this.width/2,o=this.height/2,a=n-e,h=s-i,c=o/r,l=Math.abs(h/a),u=e>n,d=i>s;let f,p;return l<c?(f=n+(u?r:-r),p=r*(d?l:-l)+s):(p=s+(d?o:-o),f=o/(u?l:-l)+n),[f,p]}getIntersectionsInFourDimension(){let t=this.anchor;this._belongs&&this._belongs.calculateToCoordination&&(t=this._belongs.calculateToCoordination(t));const[e,i]=t,n=this.width/2,s=this.height/2;return{[pr.RIGHT]:[e+n,i],[pr.LEFT]:[e-n,i],[pr.BOTTOM]:[e,i+s],[pr.TOP]:[e,i-s]}}calculateIntersectionInFourDimension(t,e){const[i,n]=t;let s=this.anchor;this._belongs&&this._belongs.calculateToCoordination&&(s=this._belongs.calculateToCoordination(s));const[r,o]=s,a=this.width/2,h=this.height/2,c={[pr.RIGHT]:[r+a,o],[pr.LEFT]:[r-a,o],[pr.BOTTOM]:[r,o+h],[pr.TOP]:[r,o-h]},l=r-i,u=o-n,d=h/a,f=i>r;let p=Math.abs(u/l)>d?n>o?pr.BOTTOM:pr.TOP:f?pr.RIGHT:pr.LEFT;return{p:c[p],dir:p}}},io=class extends Ar{constructor(t={}){super(t),this.type="Capsule",this.width=t.width||20,this.height=t.height||10}render(t){t.save(),this._isMoving&&(t.globalAlpha=.6),t.beginPath();const[e,i]=this.anchor,n=this.width/2,s=this.height/2,r=e-n+s,o=e+n-s,a=i-s,h=i+s;t.moveTo(r,a),t.lineTo(o,a),t.arc(o,i,s,-Math.PI/2,Math.PI/2),t.lineTo(r,h),t.arc(r,i,s,Math.PI/2,Math.PI/2*3),t.fillStyle=this.backgroundColor,this.shadowColor&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),t.fill(),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor,t.stroke()),t.restore()}isHit(t){const e=this.anchor,i=this.width/2,n=this.height/2,s=Math.abs(i-n),r=e[0]-i+n,o=e[0]+i-n,a=n*n;return t[0]>e[0]-s&&t[0]<e[0]+s&&t[1]>e[1]-n&&t[1]<e[1]+n||Math.pow(t[0]-r,2)+Math.pow(t[1]-e[1],2)<a||Math.pow(t[0]-o,2)+Math.pow(t[1]-e[1],2)<a}getBoundingRect(){const t=this.anchor,e=this.width/2,i=this.height/2,n=t[0]-e,s=t[1]-i,r=t[0]+e,o=t[1]+i,a=this._boundingrect;return a[0]=n,a[1]=s,a[2]=r,a[3]=o,a}getBoundingDimension(){return{height:this.height,width:this.width}}getIntersectionsInFourDimension(){let t=this.anchor;this._belongs&&this._belongs.calculateToCoordination&&(t=this._belongs.calculateToCoordination(t));const[e,i]=t,n=this.width/2,s=this.height/2;return{[pr.RIGHT]:[e+n,i],[pr.LEFT]:[e-n,i],[pr.BOTTOM]:[e,i+s],[pr.TOP]:[e,i-s]}}},no=class extends io{render(t){t.save(),this._isMoving&&(t.globalAlpha=.6),t.beginPath();const[e,i]=this.anchor,n=this.width/2,s=this.height/2,r=i-s+n,o=i+s-n,a=e-n,h=e+n;t.moveTo(a,r),t.arc(e,r,n,-Math.PI,0),t.lineTo(h,o),t.arc(e,o,n,0,Math.PI),t.closePath(),t.fillStyle=this.backgroundColor,this.shadowColor&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),t.fill(),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor,t.stroke()),t.restore()}isHit(t,e){const[i,n]=this.anchor,s=this.width/2,r=this.height/2,o=Math.abs(r-s),a=n-r+s,h=n+r-s,c=s*s;return t[0]>i-s&&t[0]<i+s&&t[1]>n-o&&t[1]<n+o||Math.pow(t[0]-i,2)+Math.pow(t[1]-a,2)<c||Math.pow(t[0]-i,2)+Math.pow(t[1]-h,2)<c}},so=class extends Ar{constructor(t={}){super(t),this.type="Rhombus",this.height=t.diagonalsV||10,this.width=t.diagonalsH||20}render(t){t.save(),this._isMoving&&(t.globalAlpha=.6);const e=this.width/2,i=this.height/2,n=this.anchor;if(t.translate(n[0],n[1]),t.beginPath(),t.moveTo(0,-i),t.lineTo(e,0),t.lineTo(0,i),t.lineTo(-e,0),t.closePath(),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor),this.shadowColor){t.shadowColor=this.shadowColor;const n=this._jflow.scale;t.shadowBlur=this.shadowBlur*n,t.shadowOffsetX=this.shadowOffsetX*n,t.shadowOffsetY=this.shadowOffsetY*n;let s=new Path2D;s.moveTo(0,-i),s.lineTo(e,0),s.lineTo(0,i),s.lineTo(-e,0),s.closePath(),s.rect(-e-10,-i-10,this.width+20,this.height+20),t.save(),t.clip(s,"evenodd"),t.stroke(),t.restore()}t.fillStyle=this.backgroundColor,t.fill(),this.borderWidth&&(t.shadowColor="transparent",t.stroke()),t.translate(-n[0],-n[1]),t.restore()}isHit(t){const e=this.height/2,i=this.width/2,n=this.anchor;return Math.abs(t[0]-n[0])/i+Math.abs(t[1]-n[1])/e<=1}getBoundingRect(){const t=this.anchor,e=this.width/2,i=this.height/2,n=t[0]-e,s=t[1]-i,r=t[0]+e,o=t[1]+i,a=this._boundingrect;return a[0]=n,a[1]=s,a[2]=r,a[3]=o,a}getBoundingDimension(){return{height:this.height,width:this.width}}getIntersectionsInFourDimension(){let t=this.anchor;this._belongs&&this._belongs.calculateToCoordination&&(t=this._belongs.calculateToCoordination(t));const[e,i]=t,n=this.width/2,s=this.height/2;return{[pr.RIGHT]:[e+n,i],[pr.LEFT]:[e-n,i],[pr.BOTTOM]:[e,i+s],[pr.TOP]:[e,i-s],[pr.SELF]:[e+.618*n,i+.618*s]}}},ro=class extends Ar{constructor(t={}){super(t),this.type="Diamond",this.width=t.width||20,this.height=t.height||10,this.side=t.side||6,this._doCache()}setConfig(t){Object.keys(t).forEach((e=>{void 0!==t[e]&&null!==t[e]&&(this[e]=t[e],this._rawConfigs[e]=t[e])})),this._doCache()}_doCache(){this.sinSIDE=Math.sin(Math.PI/3)*this.side,this.cosSIDE=Math.cos(Math.PI/3)*this.side}render(t){const[e,i]=this.anchor,n=this.width/2,s=this.height/2,r=s/1.732,o=e-n+r,a=e+n-r,h=e+n,c=e-n,l=i-s,u=i+s;this._cachePoints=[[a,l],[h,i],[a,u],[o,u],[c,i],[o,l]],t.save(),this._isMoving&&(t.globalAlpha=.6),t.beginPath();const{side:d,sinSIDE:f,cosSIDE:p}=this;t.moveTo(e,l),t.lineTo(a-d,l),t.quadraticCurveTo(a,l,a+p,l+f),t.lineTo(h-p,i-f),t.quadraticCurveTo(h,i,h-p,i+f),t.lineTo(a+p,u-f),t.quadraticCurveTo(a,u,a-d,u),t.lineTo(o+d,u),t.quadraticCurveTo(o,u,o-p,u-f),t.lineTo(c+p,i+f),t.quadraticCurveTo(c,i,c+p,i-f),t.lineTo(o-p,l+f),t.quadraticCurveTo(o,l,o+d,l),t.closePath(),t.fillStyle=this.backgroundColor,this.shadowColor&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),t.fill(),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor,t.stroke()),t.restore()}isHit(t){if(!this._cachePoints)return!1;const e=this._cachePoints;let i=!1;for(let n=0,s=e.length-1;n<e.length;n++)e[n][1]>t[1]!=e[s][1]>t[1]&&t[0]<(e[s][0]-e[n][0])*(t[1]-e[n][1])/(e[s][1]-e[n][1])+e[n][0]&&(i=!i),s=n;return i}getBoundingRect(){const t=this.anchor,e=this.width/2,i=this.height/2,n=t[0]-e,s=t[1]-i,r=t[0]+e,o=t[1]+i,a=this._boundingrect;return a[0]=n,a[1]=s,a[2]=r,a[3]=o,a}getBoundingDimension(){return{height:this.height,width:this.width}}getIntersectionsInFourDimension(){let t=this.anchor;this._belongs&&this._belongs.calculateToCoordination&&(t=this._belongs.calculateToCoordination(t));const[e,i]=t,n=this.width/2,s=this.height/2;return{[pr.RIGHT]:[e+n,i],[pr.LEFT]:[e-n,i],[pr.BOTTOM]:[e,i+s],[pr.TOP]:[e,i-s]}}};Math.sqrt(3);const oo=Symbol("ishit");class ao extends Yr{constructor(t,e={}){super(t,e),this.visible=!1}render(t){this.visible&&super.render(t)}setHit(t){this[oo]!==t&&(this.isFocus=t,this.onHit()),this[oo]=t}}class ho extends Ar{constructor(t){super(t),this.type="ScrollGroup",this.initStack(t),this.initLayout(t),this.initScrollBar(t),this._shape=new eo(t),this._shape.anchor=[0,0],this._shape._belongs=this,this.maxWidth=t.maxWidth||1/0,this.definedWidth=t.definedWidth,this.maxHeight=t.maxHeight||1/0,this.definedHeight=t.definedHeight,this.lock=t.lock??!0,this._offset=[0,0],this._getBoundingGroupRect(),this.reflow(),this._getBoundingGroupRect(),this._resetOffset(),this._cacheViewBox=[]}initScrollBar(t){const{barColor:e,barFocusColor:i,barMarginX:n,barMarginY:s,barWidth:r}=t;this._scrollbarX=new ao("x",{plainColor:e,focusColor:i,barWidth:r}),this._scrollbarY=new ao("y",{plainColor:e,focusColor:i,barWidth:r}),this._scrollbarX.barMarginX=n||1,this._scrollbarY.barMarginY=s||1;const o=()=>{this._jflow.scheduleRender()};this._scrollbarX.onHit=o,this._scrollbarY.onHit=o,this._scrollBarStatus={dragging:!1,target:null,barInitX:0,barInitY:0,barStartX:0,barStartY:0,hitScrollX:!1,hitScrollY:!1},this.addEventListener("instancePressStart",(t=>{if(this._scrollBarStatus.hitScrollX){t.detail.preventDefault(),t.detail.bubbles=!1;const e=t.detail.event.clientX;Object.assign(this._scrollBarStatus,{dragging:!0,target:this._scrollbarX,barStartX:this._scrollbarX.anchor[0],barInitX:e}),this.onScrollbarPressStart()}if(this._scrollBarStatus.hitScrollY){t.detail.preventDefault(),t.detail.bubbles=!1;const e=t.detail.event.clientY;Object.assign(this._scrollBarStatus,{dragging:!0,target:this._scrollbarY,barStartY:this._scrollbarY.anchor[1],barInitY:e}),this.onScrollbarPressStart()}}))}onScrollbarPressStart(){const t=this._jflow.canvas,e=(t=>{const{clientX:e,clientY:i}=t;this.onDraggingScrollbar(e,i)}).bind(this);document.addEventListener("pointermove",e);const i=(n=>{Object.assign(this._scrollBarStatus,{dragging:!1,target:null,barInitX:0,barInitY:0,barStartX:0,barStartY:0,hitScrollX:!1,hitScrollY:!1}),document.removeEventListener("pointermove",e),document.removeEventListener("pointerup",i),t.removeEventListener("pointerup",i)}).bind(this);t.addEventListener("pointerup",i,{once:!0}),document.addEventListener("pointerup",i,{once:!0})}onDraggingScrollbar(t,e){if(this._scrollbarX.visible&&this._scrollBarStatus.dragging){const i=this._jflow,n=i.scale,{target:s,barInitX:r,barStartX:o,barInitY:a,barStartY:h}=this._scrollBarStatus;if("x"===s.dir){const e=this._scrollbarX.width,a=this._outerWidth,h=o+(t-r)/n,c=(s.anchor[0]=Math.max(Math.min(h,a-e),0))/(a-e),l=(this._innerWidth-a)/2;this._offset[0]=l-(this._innerWidth-a)*c,i.scheduleRender()}if("y"===s.dir){const t=this._scrollbarY.height,r=this._outerHeight,o=h+(e-a)/n,c=(s.anchor[1]=Math.max(Math.min(o,r-t),0))/(r-t),l=(this._innerHeight-r)/2;this._offset[1]=l-(this._innerHeight-r)*c,i.scheduleRender()}}}setConfig(t){this._shape.setConfig(t)}_getBoundingGroupRect(){const t=_r(this._stack.getBoundingRectPoints()),e=t.width,i=t.height,n=this.definedWidth||Math.min(e,this.maxWidth),s=this.definedHeight||Math.min(i,this.maxHeight);this._innerWidth=e,this._outerWidth=n,this._innerHeight=i,this._outerHeight=s,this._shape.width=n,this._shape.height=s,this.width=n,this.height=s}_calculatePointBack(t){const[e,i]=t,[n,s]=this._offset,[r,o]=this.anchor;return[e-r-n,i-o-s]}_calculatePointBackWithPoint(t,e,i,n,s){const r=this.anchor,o=this._offset;i[n]=t-r[0]-o[0],i[s]=e-r[1]-o[1]}calculateToCoordination(t){const[e,i]=t,[n,s]=this.anchor,[r,o]=this._offset,a=[e+n-r,i+s-o];return this._belongs&&this._belongs.calculateToCoordination?this._belongs.calculateToCoordination(a):a}calculateToRealWorld(t){const[e,i]=t,[n,s]=this.anchor,[r,o]=this._offset,a=[e+n-r,i+s-o];if(this._belongs&&this._belongs.calculateToRealWorld)return this._belongs.calculateToRealWorld(a)}_getViewBox(){const t=this._cacheViewBox;return this._calculatePointBackWithPoint(0,0,t,0,1),this._calculatePointBackWithPoint(this.width,this.height,t,2,3),t}getCacheViewBox(){return this._cacheViewBox}_resetOffset(){this._offset=[Math.max((this._innerWidth-this._outerWidth)/2,0),Math.max((this._innerHeight-this._outerHeight)/2,0)],this._innerWidth>this._outerWidth?(this._scrollbarX.visible=!0,this._scrollbarX.width=this._outerWidth*this._outerWidth/this._innerWidth,this._scrollbarX.anchor=[0,this._outerHeight-4]):this._scrollbarX.visible=!1,this._innerHeight>this._outerHeight?(this._scrollbarY.visible=!0,this._scrollbarY.height=this._outerHeight*this._outerHeight/this._innerHeight,this._scrollbarY.anchor=[this._outerWidth-4,0]):this._scrollbarY.visible=!1}render(t){this._isMoving?t.globalAlpha=.6:1!==this.opacity&&(t.globalAlpha=this.opacity);const[e,i]=this.anchor,n=this.width,s=this.height,r=n/2,o=s/2,[a,h]=this._offset;t.translate(e,i),this._shape.render(t),t.translate(-r,-o),this._scrollbarX.visible&&this._scrollbarX.render(t),this._scrollbarY.visible&&this._scrollbarY.render(t),t.translate(r,o),t.save(),t.beginPath(),t.rect(-r,-o,n,s),t.clip(),t.translate(a,h),this._stack.render(t),this._linkStack.render(t),t.translate(-e-a,-i-h),t.restore()}isHit(t,e){const[i,n]=t,[s,r]=this.anchor,o=[i-s+this.width/2,n-r+this.height/2];if(this._scrollBarStatus.hitScrollX=!1,this._scrollBarStatus.hitScrollY=!1,this._scrollbarX.visible&&this._scrollbarX.isHit(o))return this._scrollBarStatus.hitScrollX=!0,this._scrollbarX.setHit(!0),!0;if(this._scrollbarX.setHit(!1),this._scrollbarY.visible&&this._scrollbarY.isHit(o))return this._scrollBarStatus.hitScrollY=!0,this._scrollbarY.setHit(!0),!0;if(this._scrollbarY.setHit(!1),this._shape.isHit([i-s,n-r])){const[t,o]=this._offset,a=[i-s-t,n-r-o];this._currentp=a;const h=this._stack.checkHit(a,e);if(h)return h}else this._stack.resetHitStatus();return!1}getBoundingDimension(){return{width:this.width,height:this.height}}getBoundingRect(){const t=this.anchor,e=this.width/2,i=this.height/2,n=t[0]-e,s=t[1]-i,r=t[0]+e,o=t[1]+i,a=this._boundingrect;return a[0]=n,a[1]=s,a[2]=r,a[3]=o,a}getIntersectionsInFourDimension(){let t=this.anchor;this._belongs&&this._belongs.calculateToCoordination&&(t=this._belongs.calculateToCoordination(t));const[e,i]=t,n=this.width/2,s=this.height/2;return{[pr.RIGHT]:[e+n,i],[pr.LEFT]:[e-n,i],[pr.BOTTOM]:[e,i+s],[pr.TOP]:[e,i-s],[pr.SELF]:[e+.618*n,i+.618*s]}}onEnterViewbox(){this.interateNodeStack((t=>{t.onEnterViewbox()}))}onLeaveViewbox(){this.interateNodeStack((t=>{t.onLeaveViewbox()}))}destroy(){this._shape.destroy(),this.interateNodeStack((t=>{t.destroy()}))}clone(){const t=new(0,this.constructor)(Object.assign({},this._rawConfigs,{layout:this._layout&&this._layout.clone()}));return this.interateNodeStack((e=>{t.addToStack(e.clone())})),t.recalculate(),t.visible=this.visible,t}}Object.assign(ho.prototype,Wr),Object.assign(ho.prototype,Hr),Object.assign(ho.prototype,{recalculateUp(){let t=!0;if(this.getBoundingDimension){const e=this._innerWidth,i=this._innerHeight;this.resetChildrenPosition&&this.resetChildrenPosition(),this._getBoundingGroupRect&&this._getBoundingGroupRect(),this.reflow(),this._getBoundingGroupRect&&this._getBoundingGroupRect();const n=this._innerWidth,s=this._innerHeight;t=e!==n||i!==s}else this.reflow();this._belongs&&t&&(this._resetOffset(),this._belongs.recalculateUp())},recalculate(){const{width:t,height:e}=this.getBoundingDimension();this.reflow(),this._getBoundingGroupRect&&this._getBoundingGroupRect();const{width:i,height:n}=this.getBoundingDimension();t===i&&e===n||this._resetOffset()}});const co=ho,lo={canvas:{wheel(t,e){t.preventDefault();let{offsetX:i,offsetY:n,deltaX:s,deltaY:r}=t;t.ctrlKey&&(r=-r),e.zoomHandler(i,n,s,r,t)}}},uo=class extends Mr{constructor(t={}){super(),this.from=t.from,this.to=t.to,this.fromDir=t.fromDir,this.toDir=t.toDir,this._cachePoints=null,this.backgroundColor=t.backgroundColor||"#000",this.isSelf=!!t.isSelf}isInViewBox(t){return!0}bringToTop(){const t=this._jflow._linkStack,e=t.findIndex((t=>t===this));t.splice(e,1),t.push(this),this._jflow._render()}},fo=class extends Ar{constructor(t){super(t),this.width=t.width,this.height=t.height,this.imageBuffer=document.createElement("canvas"),this.imageBuffer.width=this.width+2,this.imageBuffer.height=this.height+2,t.cache(this.imageBuffer.getContext("2d"))}render(t){const[e,i]=this.anchor;t.save(),t.translate(e,i),t.beginPath(),t.drawImage(this.imageBuffer,-this.width/2,-this.height/2),t.translate(-e,-i),t.restore()}getBoundingDimension(){return{height:this.height,width:this.width}}recalculate(){}getBoundingRect(){const t=this.anchor,e=this.width/2,i=this.height/2,n=t[0]-e,s=t[1]-i,r=t[0]+e,o=t[1]+i,a=this._boundingrect;return a[0]=n,a[1]=s,a[2]=r,a[3]=o,a}},po="left",go="right",_o=class extends eo{constructor(t){super(t),this.type="Text",this.content=t.content||"",this.fontFamily=t.fontFamily||"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Tahoma,Arial,Noto Sans,PingFang SC,Microsoft YaHei,Hiragino Sans GB,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji",this.fontSize=t.fontSize||"14px",this.fontWeight=t.fontWeight||"",this.textColor=t.textColor||"white",this.placeholderColor=t.placeholderColor||t.textColor||"white",this.textAlign=t.textAlign||"center",this.textBaseline=t.textBaseline||"middle",this.lineHeight=t.lineHeight,this.indent=t.indent||0,this.backgroundColor=t.backgroundColor,this.editable=t.editable,this.definedWidth=t.definedWidth,this.minWidth=t.minWidth||0,this.maxWidth=t.maxWidth,this.ellipsis=t.ellipsis,this.placeholder=t.placeholder||"",this.emptyWhenInput=t.emptyWhenInput||!1,this.editting=!1,this.disabled=t.disabled,this.cursorColor=t.cursorColor||"#60CFC4",this.textRangeColor=t.textRangeColor||"#4E75EC1A",this._status={editing:!1,cursorshow:!0,cursoranime:null,lastElapsed:0,refreshElapsed:!1,cursorDragging:!1,shiftOn:!1,oldVal:"",inputElement:null},this._cursorOffset=0,this._textRange={enable:!1,rangefrom:null,rangeTo:null,initialRange:null},this.editable&&this._makeFunctional(),this.preCalculateText(),this.shadowCache()}get currentContent(){return this.content||this.placeholder}get isEmpty(){return!this.content}preCalculateText(){Ws((t=>{t.beginPath(),t.font=`${this.fontSize} ${this.fontFamily}`,t.textAlign=this.textAlign,t.textBaseline=this.textBaseline;const e=parseInt(this.fontSize),i=this.currentContent,{fontBoundingBoxAscent:n,fontBoundingBoxDescent:s,width:r}=t.measureText(i);if(this._textWidth=this.indent+r,this.definedWidth){if(this.ellipsis&&this._textWidth>this.definedWidth){const t=this._calculateOffset(this.definedWidth-12);this.ellipsisContent=i.substring(0,t)+"..."}else this.ellipsisContent=i;this.width=this.definedWidth}else if(this.maxWidth&&this.ellipsis){if(this._textWidth>this.maxWidth){const t=this.maxWidth/this._textWidth,e=Math.floor(i.length*t-3);this.ellipsisContent=i.substring(0,e)+"..."}else this.ellipsisContent=i;this.width=Math.min(this.maxWidth,this._textWidth)}else this.width=Math.max(this.minWidth,this._textWidth);const o=Math.abs(n)+Math.abs(s)||e;this._textHeight=o,this.lineHeight?this.height=this.lineHeight:this.height=o}))}shadowCache(){const t=window.devicePixelRatio,e=this.width*t,i=this.height*t,n=this.indent*t,s=parseInt(this.fontSize)*t;this._shadowCache=new fo({width:e,height:i,cache:t=>{t.translate(e/2,i/2);const r=`${this.fontWeight} ${s}px ${this.fontFamily}`;t.font=r,t.textAlign=this.textAlign,t.textBaseline=this.textBaseline,t.fillStyle=this.isEmpty?this.placeholderColor:this.textColor;let o=this.currentContent;if(this.ellipsisContent&&(o=this.ellipsisContent),o)if(this.textAlign===po){const i=e/2;t.fillText(o,n/2-i,0)}else if(this.textAlign===go){const i=e/2;t.fillText(o,i,0)}else t.fillText(o,n/2,0)}})}setConfig(t){Object.keys(t).forEach((e=>{void 0!==t[e]&&null!==t[e]&&(this[e]=t[e],this._rawConfigs[e]=t[e])})),this.preCalculateText(),this.shadowCache()}click(){if(!this._status.editing){let t=!0;if(this.dispatchEvent(new Jr("edit",{target:this,preventDefault(){t=!1}})),!t)return;const e=this._belongs._currentp,i=this._jflow;this._cursorOffset=e?this._positionToCursorOffset(e):0;const n=function(t,e){const i=document.createElement("input");i.setAttribute("style","\n        width: 100px;\n        position: absolute;\n        left: 0;\n        top: 0;\n        border:none;\n        opacity: 0;\n        z-index: -1;\n        contain: strict;"),i.setAttribute("tabindex",-1),i.setAttribute("aria-hidden",!0),i.setAttribute("spellcheck",!1),i.setAttribute("autocorrect","off");let n=!1,s={ctrlOn:!1};return i.addEventListener("beforeinput",(e=>{e.preventDefault(),e.data&&(n||t("Input",e.data))})),i.addEventListener("compositionstart",(e=>{t("compositionstart"),n=!0})),i.addEventListener("compositionupdate",(e=>{t("compositionupdate",e.data)})),i.addEventListener("compositionend",(e=>{t("compositionend",e.data),i.value="",n=!1})),i.addEventListener("keyup",(e=>{switch(e.key){case"Shift":t("Shift",!1);break;case"Meta":case"Control":s.ctrlOn=!1}})),i.addEventListener("keydown",(e=>{switch(e.code){case"Enter":t("Enter");break;case"Backspace":t("Backspace");break;case"ArrowLeft":t("ArrowLeft");break;case"ArrowRight":t("ArrowRight");break;case"ArrowDown":t("ArrowDown");break;case"ArrowUp":t("ArrowUp")}switch(e.key){case"Shift":t("Shift",!0);break;case"Meta":case"Control":s.ctrlOn=!0;break;case"a":s.ctrlOn&&t("CtrlA")}})),i.addEventListener("keyup",(t=>{e("KeyUp",t)})),i.addEventListener("keydown",(t=>{e("KeyDown",t)})),i.addEventListener("copy",(e=>{e.preventDefault(),e.stopPropagation(),t("COPY",null,e)})),i.addEventListener("cut",(e=>{e.preventDefault(),e.stopPropagation(),t("CUT",null,e)})),i.addEventListener("paste",(e=>{e.preventDefault(),e.stopPropagation(),t("PASTE",null,e)})),i}(this._controlCallback.bind(this),this._defaultCallback.bind(this));i.DOMwrapper.append(n),n.focus({preventScroll:!0}),i.setFocusInstance(this),Object.assign(this._status,{editing:!0,oldVal:this.content,inputElement:n,cursoranime:i.requestJFlowAnime((t=>{const e=this._status.lastElapsed;this._status.refreshElapsed&&(this._status.lastElapsed=t,this._status.refreshElapsed=!1),t-e>500&&(this._status.cursorshow=!this._status.cursorshow,this._status.lastElapsed=t)}))}),this.emptyWhenInput&&(this.content=""),this.syncShadowInputPosition()}}_makeFunctional(){const t=t=>{this._status.editing=!1,this._status.inputElement&&this._status.inputElement.remove(),this._belongs&&this._jflow.scheduleRender()};this.addEventListener("dblclick",(t=>{t.currentTarget===this&&this._status.editing&&this._selectFullRange()})),this.addEventListener("click",(t=>{if(t.currentTarget===this){if(this._status.editing){const t=this._belongs._currentp,e=this._positionToCursorOffset(t);if(this._status.shiftOn){const t=this._textRange.initialRange;Object.assign(this._textRange,{rangefrom:Math.min(e,t),rangeTo:Math.max(e,t),enable:!0}),this._cursorOffset=this._textRange.rangeTo,this._status.inputElement.focus({preventScroll:!0})}else this._cursorOffset=e,this._status.inputElement.focus({preventScroll:!0}),this._refreshCursor(),this.syncShadowInputPosition()}this.click()}})),this.addEventListener("blur",(e=>{t(),this.dispatchEvent(new Jr("change",{target:this,oldVal:this._status.oldVal,val:this.content})),this._textRange.enable=!1,this._status.cursoranime.cancel(),Object.assign(this._status,{editing:!1,cursorshow:!0,cursoranime:null,lastElapsed:0,refreshElapsed:!1,cursorDragging:!1,shiftOn:!1,oldVal:"",inputElement:null})})),this.addEventListener("instancePressStart",(t=>{if(this._status.editing&&!this._status.shiftOn){t.detail.bubbles=!1,t.detail.preventDefault();const e=this._belongs._currentp,i=this._positionToCursorOffset(e);this._textRange.initialRange=i;const n=t.detail.jflow;let s=!1;const r=(t=>{s=!0;const{offsetX:e,offsetY:i}=t,r=n._calculatePointBack([e,i]);n._stack.checkHit(r);const o=this._belongs._currentp,a=this._positionToCursorOffset(o),h=this._textRange.initialRange;this._status.editing=!1,Object.assign(this._textRange,{rangefrom:Math.min(a,h),rangeTo:Math.max(a,h),enable:!0})}).bind(this);document.addEventListener("pointermove",r),document.addEventListener("pointerup",(t=>{if(document.removeEventListener("pointermove",r),!s)return void(this._textRange.initialRange=null);const e=this._textRange.rangeTo;this._cursorOffset=e,this._status.editing=!0,this._status.inputElement.focus({preventScroll:!0}),this._textRange.initialRange=null}),{once:!0})}}))}_positionToCursorOffset(t){const[e]=t,i=this.width/2,[n]=this.anchor,s=e-(n-i);let r=0;return r=s>=this._textWidth?this.content.length:this._calculateOffset(s),r}_calculateOffset(t){const e=this.content,i=e.length-1,n=this._textWidth;if(0===n)return 0;const s=n;let r=Math.floor(t/s*i);return Ws((n=>{let o,a,h;n.font=`${this.fontSize} ${this.fontFamily}`;let c=e.substring(0,r),l=e.substring(r-1,r),u=e.substring(r,r+1),d=n.measureText(c).width,f=n.measureText(l).width,p=n.measureText(u).width;o=d-f/2,a=d+p/2;do{if(o<=t&&a>=t)break;if(o>t){const i=a-t;h=r,r-=i<100?1:Math.floor(i/a*h),c=e.substring(r,h),d-=n.measureText(c).width}else if(a<t){const a=t-o;h=r,r+=a<100?1:Math.floor(a/(s-o)*(i-h)),c=e.substring(h,r),d+=n.measureText(c).width}l=e.substring(r-1,r),u=e.substring(r,r+1),f=n.measureText(l).width,p=n.measureText(u).width,o=d-f/2,a=d+p/2}while(r>=0&&r<=i)})),r}_refreshCursor(){this._status.editing&&Object.assign(this._status,{cursorshow:!0,refreshElapsed:!0}),this._textRange.enable&&(this._textRange.enable=!1)}render(t){if(this._isMoving&&(t.globalAlpha=.6),!t.disableCache&&!this._status.editing&&this._jflow.scale*parseInt(this.fontSize)<8){const[e,i]=this.anchor;return t.save(),t.translate(e,i),t.beginPath(),t.drawImage(this._shadowCache.imageBuffer,-this.width/2,-this.height/2,this.width,this.height),t.translate(-e,-i),void t.restore()}const e=`${this.fontWeight} ${this.fontSize} ${this.fontFamily}`;t.font!==e&&(t.font=e),t.textAlign!==this.textAlign&&(t.textAlign=this.textAlign),t.textBaseline!==this.textBaseline&&(t.textBaseline=this.textBaseline),t.fillStyle=this.isEmpty?this.placeholderColor:this.textColor;let i=this.currentContent;if(this.ellipsisContent&&(i=this.ellipsisContent),i)if(this.textAlign===po){const e=this.width/2;t.fillText(i,this.anchor[0]-e+this.indent/2,this.anchor[1])}else if(this.textAlign===go){const e=this.width/2;t.fillText(i,this.anchor[0]+e,this.anchor[1])}else t.fillText(i,this.anchor[0]+this.indent/2,this.anchor[1]);const n=this.width/2,s=this._textHeight,[r,o]=this.anchor,a=r-n,h=o-s/2;if(this._status.cursorshow&&this._status.editing){const e=this._cursorOffset,i=this.content.substring(0,e),n=a+t.measureText(i).width,s=this._textHeight/2;t.beginPath(),t.moveTo(n,o-s),t.lineTo(n,o+s),t.lineWidth=2,t.strokeStyle=this.cursorColor,t.stroke()}if(this._textRange.enable){const{rangefrom:e,rangeTo:i}=this._textRange,n=this.content.substring(0,e),r=this.content.substring(e,i),o=a+t.measureText(n).width,c=t.measureText(r).width;t.beginPath(),t.rect(o,h,c,s),t.fillStyle=this.textRangeColor,t.fill()}}_inputControl(t,e){if(this._textRange.enable&&(this._clearTextRange(),"Backspace"===t))return this.dispatchEvent(new Jr("input",{target:this,oldVal:this._status.oldVal,val:this.content})),this.refresh(),void this.syncShadowInputPosition();const i=this._cursorOffset,n=this.content;let s,r=n.substring(0,i);s=this.cacheIdx?n.substring(this.cacheIdx[1]):n.substring(i);let o=!1;switch(t){case"Input":r+=e,this._cursorOffset+=e.length,this.content=r+s;break;case"compositionstart":this.cacheIdx=[r.length,r.length];break;case"compositionupdate":r=r.substring(0,this.cacheIdx[0]),r+=e,this.content=r+s,this._cursorOffset=this.cacheIdx[0]+e.length,this.cacheIdx[1]=this.cacheIdx[0]+e.length;break;case"compositionend":r=r.substring(0,this.cacheIdx[0]),this._cursorOffset=this.cacheIdx[0]+e.length,this.cacheIdx=null,r+=e,this.content=r+s;break;case"Enter":if(this.cacheIdx)return;let t=!0;this.dispatchEvent(new Jr("enterkeypressed",{target:this,handler:e=>{t=e},stopInput(){o=!0}})),t&&this._jflow.blur();break;case"Backspace":r=r.substring(0,r.length-1),this._cursorOffset=Math.max(0,this._cursorOffset-1),this.content=r+s}o||this.dispatchEvent(new Jr("input",{target:this,oldVal:this._status.oldVal,val:this.content})),this.refresh(),this.syncShadowInputPosition()}refresh(){this.preCalculateText(),this._belongs.recalculateUp(),this._jflow.scheduleRender()}syncShadowInputPosition(){if(this._status.editing){const t=this.width/2,e=this.height/2;let i=this.anchor[0]-t;const n=this._cursorOffset;Ws((t=>{t.beginPath(),t.font=`${this.fontSize} ${this.fontFamily}`;const e=this.content.substring(0,n);i+=t.measureText(e).width}));const s=this.calculateToRealWorld([i,e]),r=this._jflow.canvasMeta,o=Math.min(r.actual_width-120,s[0]);this._status.inputElement.style.transform=`translate(${o}px, ${s[1]}px)`}}_controlCallback(t,e,i){switch(this._status.editing&&Object.assign(this._status,{cursorshow:!0,refreshElapsed:!0}),t){case"Input":case"compositionstart":case"compositionupdate":case"compositionend":case"Enter":case"Backspace":this._inputControl(t,e);break;case"ArrowLeft":this._textRange.enable&&(this._textRange.enable=!1),this._onArrowLeft();break;case"ArrowRight":this._textRange.enable&&(this._textRange.enable=!1),this._onArrowRight();break;case"Shift":this._onShiftToggle(e);break;case"CtrlA":this._selectFullRange();break;case"COPY":this._copy(i);break;case"CUT":this._cut(i);break;case"PASTE":this._paste(i)}}_onArrowLeft(){this._cursorOffset=Math.max(0,this._cursorOffset-1),this._jflow.scheduleRender(),this.syncShadowInputPosition()}_onArrowRight(){this._cursorOffset=Math.min(this.content.length,this._cursorOffset+1),this._jflow.scheduleRender(),this.syncShadowInputPosition()}_onShiftToggle(t){this._status.shiftOn=t,this._textRange.initialRange=t?this._cursorOffset:null}_selectFullRange(){this._textRange={enable:!0,rangefrom:0,rangeTo:this.content.length},this._cursorOffset=this.content.length}_clearTextRange(){if(this._textRange.enable){const{rangefrom:t,rangeTo:e}=this._textRange,i=this.content,n=i.substring(0,t),s=i.substring(e);this.content=n+s,this._cursorOffset=n.length,this._textRange.enable=!1}}_getSelection(){if(this._textRange.enable){const{rangefrom:t,rangeTo:e}=this._textRange;return this.content.substring(t,e)}return null}_copy(t){const e=this._getSelection();e&&t.clipboardData.setData("text/plain",e)}_cut(t){const e=this._getSelection();e&&(t.clipboardData.setData("text/plain",e),this._clearTextRange(),this.refresh())}_paste(t){let e=(t.clipboardData||window.clipboardData).getData("text"),i=!1;if(this.dispatchEvent(new Jr("paste",{target:this,content:e,preventDefault(){i=!0},resolvePasteContent(t){e=t(e)}})),i)return;this._clearTextRange();const n=this._cursorOffset,s=this.content,r=s.substring(0,n),o=s.substring(n);this.content=r+e+o,this._cursorOffset=(r+e).length,this.refresh()}_defaultCallback(t,e){switch(t){case"KeyDown":this.dispatchEvent(new Jr("keydown",{target:this,key:e.key,code:e.code,rawEvent:e}));break;case"KeyUp":this.dispatchEvent(new Jr("keyup",{target:this,key:e.key,code:e.code,rawEvent:e}))}}destroy(){this._jflow._focus.instance===this&&this._jflow.blur()}},mo=class extends eo{constructor(t){super(t),this.image=t.image,this.image.onload=()=>{this._jflow._render()},this.imageBounding={width:t.imageWidth||t.width,height:t.imageHeight||t.height}}setConfig(t){Object.keys(t).forEach((e=>{void 0!==t[e]&&null!==t[e]&&(this[e]=t[e],this._rawConfigs[e]=t[e])})),t.image&&!t.image.complete&&(this.image.onload=()=>{this._jflow._render()}),this.imageBounding={width:t.imageWidth||t.width||this.imageBounding.width,height:t.imageHeight||t.height||this.imageBounding.height}}render(t){t.save(),this._isMoving&&(t.globalAlpha=.6),eo.prototype.render.call(this,t);const e=this.anchor[0]-this.width/2,i=this.anchor[1]-this.height/2;this.opacity<1&&(t.globalAlpha=this.opacity),this.image.complete&&t.drawImage(this.image,e,i,this.imageBounding.width,this.imageBounding.height),t.restore()}},vo=class extends eo{constructor(t){super(t),this.domFactory=t.createDocument,this._dom=null}getRealWorldPosition(){const t=this.getBoundingRect();return this.calculateToRealWorld(t.slice(0,2))}render(t){if(!this._dom&&this.domFactory)requestAnimationFrame((()=>{if(!this._dom){const t=document.createElement("div"),e=this.getRealWorldPosition(),i=this._jflow.scale;t.setAttribute("style",`\n                        position: absolute;\n                        width: ${this.width}px;\n                        height: ${this.height}px;\n                        transform-origin: left top;\n                        top: 0;\n                        left: 0;\n                        transform: translate(${e[0]}px, ${e[1]}px) scale(${i});`),this._dom=t,this._jflow.DOMwrapper.appendChild(t),this.domFactory(t)}}));else{const t=this.getRealWorldPosition(),e=this._jflow.scale;this._dom.style.transform=`translate(${t[0]}px, ${t[1]}px) scale(${e})`}super.render(t)}onEnterViewbox(){this._dom&&(this._dom.style.display="block")}onLeaveViewbox(){this._dom&&(this._dom.style.display="none")}destroy(){this._dom&&this._jflow.DOMwrapper.removeChild(this._dom),super.destroy()}},yo=class extends uo{constructor(t){super(t),this.fontFamily=t.fontFamily="-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Tahoma,Arial,Noto Sans,PingFang SC,Microsoft YaHei,Hiragino Sans GB,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji",this.fontSize=t.fontSize||"12px",this.content=t.content||"",this.lineDash=t.lineDash,this.approximate=t.approximate||6,this._cacheAngle=void 0,this._cachePoints=[],this._cacheBoundingbox={from:[],to:[]}}_calculateAnchorPoints(){const t=this.from.calculateIntersection(this.to.getCenter()),e=this.to.calculateIntersection(this.from.getCenter());this._cachePoints[0]=t,this._cachePoints[1]=e;const i=e[0]-t[0],n=e[1]-t[1],s=Math.atan2(n,i);this._cacheAngle=s}isInViewBox(t){const e=this.from.getBoundingRect(),i=this.to.getBoundingRect(),n=this._cacheBoundingbox;return Br(n.from,e)&&!Br(n.to,i)||(Ir(n.from,e),Ir(n.to,i),this._calculateAnchorPoints()),!0}render(t){const[e,i]=this._cachePoints,n=this._cacheAngle,s=i[0]-e[0],r=i[1]-e[1];if(t.fillStyle=t.strokeStyle=this.backgroundColor,t.beginPath(),this.content){t.textAlign="center",t.font=`${this.fontSize} ${this.fontFamily}`,t.textBaseline="middle";const{actualBoundingBoxLeft:n,actualBoundingBoxRight:o,fontBoundingBoxAscent:a,fontBoundingBoxDescent:h}=t.measureText(this.content),c=s/2+e[0],l=r/2+e[1];t.fillText(this.content,c,l);const u=Math.abs(n)+Math.abs(o)+20,d=1.5*(Math.abs(a)+Math.abs(h));t.beginPath();let f=new Path2D;f.rect(c-u/2,l-d/2,u,d);const p=Math.min(i[0],e[0])-10,g=Math.min(i[1],e[1])-10,_=Math.abs(s)+20,m=Math.abs(r)+20;f.rect(p,g,_,m),t.clip(f,"evenodd")}t.moveTo(e[0],e[1]),t.lineTo(i[0],i[1]),this.lineDash&&(t.save(),t.setLineDash(this.lineDash)),t.stroke(),this.lineDash&&t.restore(),t.translate(i[0],i[1]),t.rotate(n),t.moveTo(0,0),t.lineTo(-5,-4),t.lineTo(-5,4),t.lineTo(0,0),t.fill(),t.rotate(-n),t.translate(-i[0],-i[1])}isHit(t){if(!this._cachePoints)return!1;const[e,i]=this._cachePoints;return yr(t,e,i)<this.approximate}},bo=Math.PI/180;class wo extends uo{constructor(t){super(t),this.approximate=t.approximate||6,this.radius=t.radius||0,this.minSpanX=t.minSpanX||10,this.minSpanY=t.minSpanY||10,this.lineDash=t.lineDash,this.doubleLink=t.doubleLink,this.fontFamily=t.fontFamily="-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Tahoma,Arial,Noto Sans,PingFang SC,Microsoft YaHei,Hiragino Sans GB,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji",this.fontSize=t.fontSize||"12px",this.content=t.content||"",this.isSelf=!!t.isSelf,this.noArrow=!!t.noArrow,this._cacheAngle=[],this._cachePoints=[],this._cacheBoundingbox={from:[],to:[]}}_calculateAnchorPoints(){const t=this.from.getIntersectionsInFourDimension(),e=this.to.getIntersectionsInFourDimension(),i=this._cacheAngle;if(this.isSelf)Sr(this._cachePoints,t[this.fromDir],e[pr.SELF],this.fromDir,this.toDir,this.minSpanX,this.minSpanY,!0),i[0]=this.fromDir,i[1]=this.toDir;else if(void 0!==this.fromDir&&void 0!==this.toDir)Sr(this._cachePoints,t[this.fromDir],e[this.toDir],this.fromDir,this.toDir,this.minSpanX,this.minSpanY),i[0]=this.fromDir,i[1]=this.toDir;else{const n=br(t,e);Sr(this._cachePoints,n.fromP,n.toP,n.fromDir,n.toDir,this.minSpanX,this.minSpanY),i[0]=n.fromDir,i[1]=n.toDir}}isInViewBox(t){return!!this._static||(this._calculateAnchorPoints(),function(t,e){let i=t[0],n=t.length,s=1;const[r,o,a,h]=e;for(;s<n;){const e=t[s];if(i[0]===e[0]){if(i[0]<a&&i[0]>r&&!(i[1]>h&&e[1]>h||i[1]<o&&e[1]<o))return!0}else if(i[1]<h&&i[1]>o&&!(i[0]>a&&e[0]>a||i[0]<r&&e[0]<r))return!0;i=e,s++}return!1}(this._cachePoints,t))}render(t){const e=this.radius,i=this._cachePoints,n=i[0],s=i[i.length-1],r=(this._cacheAngle[1]+2)%4*90*bo;if(t.fillStyle=t.strokeStyle=this.backgroundColor,this.doubleLink){const e=(this._cacheAngle[0]+2)%4*90*bo;t.beginPath(),t.translate(n[0],n[1]),t.rotate(e),t.moveTo(5,0),t.lineTo(0,-4),t.lineTo(0,4),t.lineTo(5,0),t.fill(),t.rotate(-e),t.translate(-n[0],-n[1])}if(t.beginPath(),t.moveTo(n[0],n[1]),i.slice(1,i.length-1).forEach(((n,s)=>{if(this.radius){const r=i[s],o=i[s+2],{p1:a,p2:h}=function(t,e,i,n){const s=Cr(e,t),r=Cr(e,i),o=Tr(s),a=Tr(r);if(!o||!a)return{p1:null,p2:null};const h=Er(s,n/o),c=Er(r,n/a);return{p1:Cr(e,h),p2:Cr(e,c)}}(r,n,o,e);a&&h?(t.lineTo(a[0],a[1]),t.quadraticCurveTo(n[0],n[1],h[0],h[1])):t.lineTo(n[0],n[1])}else t.lineTo(n[0],n[1])})),t.lineTo(s[0],s[1]),this.lineDash&&(t.save(),t.setLineDash(this.lineDash)),t.stroke(),this.lineDash&&t.restore(),this.noArrow||(t.beginPath(),t.translate(s[0],s[1]),t.rotate(r),t.moveTo(0,0),t.lineTo(-5,-4),t.lineTo(-5,4),t.lineTo(0,0),t.fill(),t.rotate(-r),t.translate(-s[0],-s[1])),this.content)switch(t.beginPath(),t.font=`${this.fontSize} ${this.fontFamily}`,this.fromDir){case pr.BOTTOM:t.textAlign="left",t.fillText(this.content,n[0]+2,n[1]+10);break;case pr.RIGHT:t.textAlign="left",t.fillText(this.content,n[0]+10,n[1]-2)}}isHit(t){if(this._static)return!1;if(!this._cachePoints)return!1;const e=this._cachePoints;let i=e[0];const n=e.slice(1);do{const e=n.shift();if(e&&yr(t,i,e)<this.approximate)return!0;i=e}while(i);return!1}cloneStatic(){const t=new wo({});return Object.assign(t,{radius:this.radius,_cachePoints:this._cachePoints,_cacheAngle:this._cacheAngle,backgroundColor:this.backgroundColor,doubleLink:this.doubleLink,radius:this.radius,lineDash:this.lineDash,noArrow:this.noArrow,content:this.content,fontSize:this.fontSize,fontFamily:this.fontFamily,fromDir:this.fromDir,_static:!0}),t}}const xo=wo,ko=Math.PI/180,So=class extends uo{constructor(t){super(t),this.approximate=t.approximate||6,this.minSpanX=t.minSpanX||0,this.minSpanY=t.minSpanY||0,this.lineDash=t.lineDash,this.doubleLink=t.doubleLink,this.fontFamily=t.fontFamily="-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Tahoma,Arial,Noto Sans,PingFang SC,Microsoft YaHei,Hiragino Sans GB,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji",this.fontSize=t.fontSize||"12px",this.content=t.content||"",this.isSelf=!!t.isSelf}_calculateAnchorPoints(){const t=this.from.getIntersectionsInFourDimension(),e=this.to.getIntersectionsInFourDimension();if(this.isSelf){const i=xr(t[this.fromDir],e[pr.SELF],this.fromDir,pr.BOTTOM,this.minSpanX,this.minSpanY);this._cachePoints=[...t[this.fromDir],...i],this._cacheAngle=[this.fromDir,pr.BOTTOM]}else if(void 0!==this.fromDir&&void 0!==this.toDir){const i=xr(t[this.fromDir],e[this.toDir],this.fromDir,this.toDir,this.minSpanX,this.minSpanY);this._cachePoints=[...t[this.fromDir],...i],this._cacheAngle=[this.fromDir,this.toDir]}else{const i=br(t,e),n=xr(i.fromP,i.toP,i.fromDir,i.toDir);this._cachePoints=[...i.fromP,...n],this._cacheAngle=[i.fromDir,i.toDir]}}render(t){this._calculateAnchorPoints();const e=this._cachePoints,i=kr.apply(null,[1,...e]);if(t.fillStyle=t.strokeStyle=this.backgroundColor,this.doubleLink){const i=(this._cacheAngle[0]+2)%4*90*ko;t.beginPath(),t.translate(e[0],e[1]),t.rotate(i),t.moveTo(5,0),t.lineTo(0,-4),t.lineTo(0,4),t.lineTo(5,0),t.fill(),t.rotate(-i),t.translate(-e[0],-e[1])}if(t.beginPath(),t.moveTo(e[0],e[1]),t.bezierCurveTo(...e.slice(2)),this.lineDash&&(t.save(),t.setLineDash(this.lineDash)),t.stroke(),this.lineDash&&t.restore(),t.beginPath(),t.translate(e[6],e[7]),t.rotate(i),t.moveTo(5,0),t.lineTo(0,-4),t.lineTo(0,4),t.lineTo(5,0),t.fill(),t.rotate(-i),t.translate(-e[6],-e[7]),this.content){t.beginPath();const i=e[0]>e[6];let[n,s,r]=function(t,e){const i=.5,n=.125*e[0]+.375*e[2]+.375*e[4]+.125*e[6],s=.125*e[1]+.375*e[3]+.375*e[5]+.125*e[7],r=i*i*(e[2]-e[0])+.5*(e[4]-e[2])+t*t*(e[6]-e[4]),o=i*i*(e[3]-e[1])+.5*(e[5]-e[3])+t*t*(e[7]-e[5]);return[n,s,Math.atan2(o,r)]}(.5,e);t.translate(n,s),t.rotate(r),i&&t.rotate(Math.PI),t.font=`${this.fontSize} ${this.fontFamily}`,t.textAlign="center",t.fillText(this.content,0,-(parseInt(this.fontSize)||12)/4),i&&t.rotate(Math.PI),t.rotate(-r),t.translate(-n,-s)}}isHit(t){if(!this._cachePoints)return!1;const e=function(t,e){const i=new fr(...e).project({x:t[0],y:t[1]});return vr(t,[i.x,i.y])}(t,this._cachePoints);return e<this.approximate}};class Co{constructor(t={}){this.direction=t.direction||"vertical",this.gap=t.gap??5,this.alignment=t.alignment||"center",this.justify=t.justify||"center",this._rawConfigs=t}reflow(t){const e=t._stack.filter((t=>t.visible&&!t.absolutePosition)),i=t._stack.filter((t=>t.visible&&t.absolutePosition)),n=t.width-t.padding.left-t.padding.right;if("vertical"===this.direction){let s=0,r=0,o=0,a=0;const h=e.concat(i);h.forEach(((t,e)=>{"block"===t.display&&(t.width=0,t.resetChildrenPosition(),t.reflow(),t._getBoundingGroupRect())})),e.forEach(((t,e)=>{const{width:i,height:n}=t.getBoundingDimension(),h=e>0?this.gap:0;"outstretch"!==t.display&&(o=Math.max(i,o)),a+=n+h,s+=n/2+h+r,r=n/2,t.anchor=[0,s]})),h.forEach(((e,i)=>{if("block"===e.display)e.resetChildrenPosition(),e.width=o,e.reflow();else if("outstretch"===e.display){const i=t._belongs.width-t._belongs.padding.left-t._belongs.padding.right;e.resetChildrenPosition(),e.width=Math.max(i,o),e.reflow()}})),o=Math.max(n,o),a/=2,"start"===this.alignment&&e.forEach(((t,e)=>{const{width:i}=t.getBoundingDimension();t.anchor[0]=-(o-i)/2,t.anchor[1]-=a})),"end"===this.alignment&&e.forEach(((t,e)=>{const{width:i}=t.getBoundingDimension();t.anchor[0]=(o-i)/2,t.anchor[1]-=a})),"center"===this.alignment&&e.forEach(((t,e)=>{const{width:i}=t.getBoundingDimension();t.anchor[1]-=a}))}if("horizontal"===this.direction){let t=0,i=0,s=0,r=0,o=0;if(e.forEach(((e,n)=>{const{width:a,height:h}=e.getBoundingDimension(),c=n>0?this.gap:0;s=Math.max(h,s),r+=a+c,o+=a,t+=a/2+c+i,i=a/2,e.anchor=[t,0]})),"start"===this.justify){const t=n/2;e.forEach(((e,i)=>{e.anchor[0]-=t}))}if("end"===this.justify){const t=n/2-r;e.forEach(((e,i)=>{e.anchor[0]+=t}))}if("center"===this.justify){const t=r/2;e.forEach(((e,i)=>{e.anchor[0]-=t}))}if("space-between"===this.justify&&e.length>1){const t=Math.max(n,r),i=(t-r)/(e.length-1),s=t/2;e.forEach(((t,e)=>{t.anchor[0]+=i*e-s}))}"start"===this.alignment&&e.forEach(((t,e)=>{const{height:i}=t.getBoundingDimension();t.anchor[1]=-(s-i)/2})),"end"===this.alignment&&e.forEach(((t,e)=>{const{height:i}=t.getBoundingDimension();t.anchor[1]=(s-i)/2}))}if(i.length){"block"===t.display?t.getBoundingDimension():t._getBoundingGroupRect();const e=t.width/2,n=t.height/2,s=(t.padding.top-t.padding.bottom)/2,r=(t.padding.left-t.padding.right)/2;i.forEach((t=>{t.anchor=this._resolveAbsoluteAnchor(t.absolutePosition,t,e,n,r,s)}))}}_resolveAbsoluteAnchor(t,e,i,n,s,r){const{top:o,right:a,bottom:h,left:c,centerX:l,centerY:u}=t,{width:d,height:f}=e.getBoundingDimension(),p=d/2,g=f/2;let _=0,m=0;return"number"==typeof o&&(_=o+g-n-r),"number"==typeof a&&(m=i-a-p-s),"number"==typeof h&&(_=n-h-g-r),"number"==typeof c&&(m=c+p-i-s),"number"==typeof l&&(m=l),"number"==typeof u&&(_=u),[m,_]}clone(){return new Co(this._rawConfigs)}}const To=Co,Eo="input",Oo="control",Bo="input",Io="compositionstart",Lo="compositionupdate",jo="compositionend",Po="enter",Mo="delete",Ao="backspace",Ro="arrowLeft",Do="arrowRight",$o="arrowUp",No="arrowDown",Fo="undo",Wo="redo",Ho="shift_down",zo="shift_up",Vo="ctrla",Xo="startedit",Yo="editclick",Go="shiftonclick",Uo="doubleclick";class qo extends EventTarget{_inputElement=null;constructor(t){super(),this._inputElement=function(t){const e=document.createElement("input");e.setAttribute("style","\n        width: 100px;\n        position: absolute;\n        left: 0;\n        top: 0;\n        border:none;\n        opacity: 0;\n        z-index: -1;\n        contain: strict;"),e.setAttribute("tabindex",-1),e.setAttribute("aria-hidden",!0),e.setAttribute("spellcheck",!1),e.setAttribute("autocorrect","off");let i=!1,n={ctrlOn:!1,shiftOn:!1};return e.addEventListener("beforeinput",(e=>{e.preventDefault(),e.data&&(i||t(Bo,e.data))})),e.addEventListener("compositionstart",(e=>{t(Io),i=!0})),e.addEventListener("compositionupdate",(e=>{t(Lo,e.data)})),e.addEventListener("compositionend",(n=>{t(jo,n.data),e.value="",i=!1})),e.addEventListener("keyup",(e=>{if(!i)switch(e.key){case"Shift":t(zo),n.shiftOn=!1;break;case"Meta":case"Control":n.ctrlOn=!1}})),e.addEventListener("keydown",(e=>{if(!i){switch(e.code){case"Enter":t(Po);break;case"Backspace":t(Ao);break;case"Delete":t(Mo);break;case"ArrowLeft":t(Ro);break;case"ArrowRight":t(Do);break;case"ArrowDown":t(No);break;case"ArrowUp":t($o)}switch(e.key){case"Shift":t(Ho),n.shiftOn=!0;break;case"Meta":case"Control":n.ctrlOn=!0;break;case"a":n.ctrlOn&&t(Vo);break;case"c":n.ctrlOn&&t("ctrlc");break;case"v":n.ctrlOn&&t("ctrlv");break;case"x":n.ctrlOn&&t("ctrlx");break;case"y":n.ctrlOn&&(e.preventDefault(),t(Wo));break;case"z":n.ctrlOn&&n.shiftOn?t(Wo):n.ctrlOn&&t(Fo)}}})),e}(this.controlCallback.bind(this)),t.append(this._inputElement),this._inputElement.focus()}controlCallback(t,e){switch(t){case Bo:case Io:case Lo:case jo:case Po:case Ao:case Mo:this.dispatchEvent(new CustomEvent(Eo,{detail:{kind:t,data:e}}));break;case Ro:case Do:case $o:case No:case Vo:case Ho:case zo:case Fo:case Wo:this.dispatchEvent(new CustomEvent(Oo,{detail:{kind:t}}))}}focus(){this._inputElement.focus({preventScroll:!0})}syncPosition(t,e){this._inputElement.style.transform=`translate(${t}px, ${e}px)`}destroy(){this._inputElement.remove()}}const Jo=qo;class Ko{_lines=[];get(t){return this._lines[t]}getLineAbove(t){let e=0;const i=this._lines;for(;e<i.length&&!(i[e].reduceHeight>t);)e++;return Math.min(e,i.length-1)}truncate(t){const e=Zo.create(t);return this._lines=[e],e}push(t){this._lines.push(t)}forEach(t){this._lines.forEach(t)}length(){return this._lines.length}}class Zo{width=0;anchorY=0;height=0;reduceHeight=0;_elements=[];static create(t){return new Zo(t)}constructor(t={}){Object.assign(this,t)}_elements=[];get(t){return this._elements[t]}length(){return this._elements.length}insert(t,e){this._elements.splice(t,0,e)}push(t){this._elements.push(t)}tail(){return this._elements[this._elements.length-1]}copy(){return this._elements.slice()}getColumnNearest(t,e,i,n){const s=this._elements;if(t>=this.width){const t=s.length-1,e=s[t];let i=0;return"text"===e.type&&(i=e.source.length),[t,i]}{let r=0,o=0,a=0,h=null;for(;r<s.length-1;){o=a;const i=s[r];if("text"!==i.type){const t=h&&"text"===h.type?2*e:e;a+=i.width+t}else a+=i.width;if(a>t){h=i;break}h=i,r++}a<=t&&(o=a);const c=s[r];if("text"===c.type){const e=function(t,e,i,n){const s=e.source,r=s.length-1;if(0===e.width)return 0;const o=e.width;let a=Math.floor(t/o*r);return Ws((e=>{let h,c,l;e.font=`${i} ${n}`;let u=s.substring(0,a),d=s.substring(a-1,a),f=s.substring(a,a+1),p=e.measureText(u).width,g=e.measureText(d).width,_=e.measureText(f).width;h=p-g/2,c=p+_/2;do{if(h<=t&&c>=t)break;if(h>t){const i=c-t;l=a,a-=i<100?1:Math.floor(i/c*l),u=s.substring(a,l),p-=e.measureText(u).width}else if(c<t){const i=t-h;l=a,a+=i<100?1:Math.floor(i/(o-h)*(r-l)),u=s.substring(l,a),p+=e.measureText(u).width}d=s.substring(a-1,a),f=s.substring(a,a+1),g=e.measureText(d).width,_=e.measureText(f).width,h=p-g/2,c=p+_/2}while(a>=0&&a<=r)})),a}(t-o,c,i,n);return[r,e]}return t-o>h.width/2?[r+1,0]:[r,0]}}forEach(t){this._elements.forEach(t)}}class Qo{static create(t){const e=new Qo;return e.from(t),e}_textElements=[];_records=[];_caretRecord=null;insertBefore(t,e){const i=this.findIndex(t);this.inersetAt(i,e)}insertAfter(t,e){const i=this.findIndex(t);this.get(i+1)&&e.setNeedWrap(t.needWrap||t.isTail),this.inersetAt(i+1,e)}findIndex(t){return this._textElements.findIndex((e=>e===t))}get(t){return this._textElements[t]}from(t){this._textElements=t}inersetAt(t,e){this.splice(t,0,e)}push(t){this.splice(this.length(),0,t)}remove(t){this.splice(t,1)}splice(){const t=this._textElements.splice(...arguments);this._records.push({op:"splice",args:arguments,removed:t})}copy(){return this._textElements.slice()}isEmpty(){return 1===this._textElements.length&&""===this._textElements[0].source}forEach(t){this._textElements.forEach(t)}tail(){return this._textElements[this._textElements.length-1]}filter(t){return this._textElements.filter(t)}length(){return this._textElements.length}startRecord(){return this._caretRecord={before:null,after:null},this._records=[],this._records}getRecord(){return this._records}recordBeforeCaret(t){this._caretRecord.before=t.toRange()}recordAfterCaret(t){this._caretRecord.after=t.toRange()}getCaretRecord(){return this._caretRecord}collectRecords(){return this._records}}class ta{needWrap=!1;width=0;reduceWidth=0;height=0;anchorX=0;anchorY=0;dirty=!0;isTail=!1;constructor(t,e){this.type=t,this.source=e}setSource(t,e){const i=this.source;this.source=t,this.dirty=!0,e&&e.push({op:"setSource",args:[this,t,i]})}setNeedWrap(t,e){const i=this.needWrap;this.needWrap=t,i!==t&&e&&e.push({op:"setNeedWrap",args:[this,t,i]})}shift(t,e){if("text"===this.type){const i=this.source.length,n=t+e;return n<0?"prev":n>i?"next":"self"}return e>0?"next":e<0?"prev":void 0}tailOffset(){return"text"===this.type?this.needWrap||this.isTail?this.source.length:Math.max(0,this.source.length-1):0}headOffset(){return 0}}function ea(t){return 1===t.length&&"setSource"===t[0].op}class ia{static length=50;_undo=[];_redo=[];_editor=null;write(t,e){if(0===t.length)return;if(ea(t)){const i=t[0],n=this.getLastUndo();if(n&&ea(n._batch)){const t=n._batch[0];if(t.args[0]===i.args[0])return t.args[1]=i.args[1],void(n._caretMetaTo=e.after)}}const i=new na(t);i._caretMetaFrom=e.before,i._caretMetaTo=e.after,this._undo.push(i),this._undo.length>ia.length&&this._undo.splice(0,1),this._redo.length&&(this._redo=[])}getLastUndo(){return this._undo[this._undo.length-1]}undo(){const t=this._undo.pop();return t&&(t.undo(this._editor),this._redo.push(t)),t}redo(){let t=this._redo.pop();for(;t&&t.SKIP_REDO;)t=this._redo.pop();return t&&(t.redo(this._editor),this._undo.push(t)),t}}class na{_batch=[];_caretMetaFrom=null;_caretMetaTo=null;constructor(t){this._batch=t}updateCaretMetaTo(t){this._caretMetaTo=t}undo(t){this._batch.slice().reverse().forEach((e=>{switch(e.op){case"range":const[i,n]=e.args,s=t._range;s.setInitialRange(i),s.setRange(n),s.enable();break;case"setSource":const[r,o,a]=e.args;r.source=a,r.dirty=!0;break;case"setNeedWrap":const[h,c,l]=e.args;h.needWrap=l,h.dirty=!0;break;case"splice":const u=t._flattenTxtElem,[d,f,...p]=e.args,g=e.removed;let _=0;p&&(_=p.length),u.splice(d,_,...g)}})),t._caret.fromRange(this._caretMetaFrom)}redo(t){this._batch.forEach((e=>{switch(e.op){case"setSource":const[i,n,s]=e.args;i.source=n,i.dirty=!0;break;case"setNeedWrap":const[r,o,a]=e.args;r.needWrap=o,r.dirty=!0;break;case"splice":t._flattenTxtElem.splice(...e.args)}})),t._caret.fromRange(this._caretMetaTo)}}const sa=class{static create(t){return new this(t)}constructor(t){this._editor=t}exec(){}};class ra extends sa{static name=Ro;exec(){const t=this._editor;t._range.disable();const e=t._flattenTxtElem,i=t._caret,n=i.getRow(),s=i.getColumn(),[r,o]=s,a=t._area.get(n),h=a.get(r),c=e.findIndex(h);switch(h.shift(o,-1)){case"prev":if(r>0){const t=a.get(r-1);i.setColumn([r-1,t.tailOffset()])}else if(c>0){const s=n-1,r=t._area.get(s).length()-1,o=e.get(c-1).tailOffset();i.setRow(s),i.setColumn([r,o])}break;case"self":i.setColumn(1,o-1)}i.refresh(),t.syncShadowInputPosition(),t._jflow._render()}}class oa extends sa{static name=Do;exec(){const t=this._editor;t._range.disable();const e=t._flattenTxtElem,i=t._caret,n=i.getRow(),s=i.getColumn(),[r,o]=s,a=t._area.get(n),h=a.get(r),c=e.findIndex(h);switch(h.shift(o,1,c===e.length()-1)){case"next":if(r<a.length()-1){const t=a.get(r+1);"text"===h.type&&"text"!==t.type?i.setColumn([r+2,t.headOffset()]):i.setColumn([r+1,t.headOffset()])}else if(c<e.length()-1){const t=n+1,s=e.get(c+1).headOffset();i.setRow(t),i.setColumn([0,s])}break;case"self":i.setColumn(1,o+1)}i.refresh(),t.syncShadowInputPosition(),t._jflow._render()}}class aa extends sa{static name=$o;exec(){this._editor._range.disable();const t=this._editor._caret.getRow()-1;t>-1&&this._handler(t)}}class ha extends sa{static name=No;exec(){this._editor._range.disable();const t=this._editor._caret.getRow()+1;t<this._editor._area.length()&&this._handler(t)}}const ca={_handler(t){const e=this._editor,i=e._caret,n=i.getRow(),s=i.getColumn(),[r,o]=s,a=e._area;let h=a.get(n).get(r),c=h.reduceWidth;o>0&&(c+=e.measureTextWidth(h.source.substring(0,o)));const l=a.get(t).getColumnNearest(c,e.elementSpace,e.fontSize,e.fontFamily);i.setRow(t),i.setColumn(l),i.refresh(),e.syncShadowInputPosition(),e._jflow._render()}};function la(t,e,i,n){if(!t)return[i,!1];if("text"===t.type&&"text"===e.type){const i=t.source.length;return t.setSource(t.source+e.source,n),t.setNeedWrap(e.needWrap,n),[i,!0]}return[i,!1]}Object.assign(aa.prototype,ca),Object.assign(ha.prototype,ca);class ua extends sa{static name=Eo;cacheIdx=null;exec(t,e){const i=this._editor,n=i._range,s=i._caret,r=i._flattenTxtElem,o=i._undoredo,a=r.startRecord();if(r.recordBeforeCaret(s),n.isEnable()&&(n.delete(i,a),t===Ao||t===Mo))return r.collectRecords(),r.recordAfterCaret(s),this._editor.refresh(),void o.write(a,r.getCaretRecord());const h=s.getRow();let[c,l]=s.getColumn();const u=i._area,d=u.get(h);let f=d.get(c),p=d.get(c-1),g="";if("text"===f.type)g=f.source;else if("text"===p?.type)g=p.source,f=p,l=g.length,s.setColumn([c-1,g.length]);else{const t=new ta("text","");r.insertBefore(f,t),f=t}let _,m=g.substring(0,l);switch(_=this.cacheIdx?g.substring(this.cacheIdx[1]):g.substring(l),t){case Bo:if(/\r?\n/.test(e)){let t=e.split(/\r?\n/);t=t.replace(/\t/,"");let i=r.findIndex(f),n=t.shift();f.setSource(m+n,a);let o=h+1;for(i++;t.length>1;){const e=new ta("text",t.shift());e.setNeedWrap(!0,a),o++,r.inersetAt(i,e),i++}n=t.shift();const c=r.get(i);if(c&&"text"===c.type)c.setSource(n+c.source,a);else{const t=new ta("text",n);r.inersetAt(i,t)}s.setRow(o),s.setColumn([0,n.length])}else m+=e,s.setColumn(1,s.getColumn(1)+e.length),f.setSource(m+_,a);break;case Io:this.cacheIdx=[m.length,m.length];break;case Lo:m=m.substring(0,this.cacheIdx[0]),m+=e,f.setSource(m+_,a);const t=this.cacheIdx[0]+e.length;s.setColumn(1,t),this.cacheIdx[1]=t;break;case jo:m=m.substring(0,this.cacheIdx[0]),s.setColumn(1,this.cacheIdx[0]+e.length),this.cacheIdx=null,m+=e,f.setSource(m+_,a);break;case Po:f.setSource(m,a),f.setNeedWrap(!0,a);const i=new ta("text",_);r.insertAfter(f,i),s.setRow(h+1),s.setColumn([0,0]);break;case Ao:switch(f.shift(l,-1)){case"prev":let t=r.findIndex(f);if(c>0){r.splice(t-1,1),t-=1;const[e,i]=la(r.get(t-1),f,0,a);i&&r.remove(t),s.setColumn([c-(e>0?2:1),e])}else if(t>0){const e=h-1,i=u.get(e).length()-1,[n,o]=la(r.get(t-1),f,0,a);o&&r.remove(t),s.setRow(e),s.setColumn([i,n])}break;case"self":m=m.substring(0,m.length-1),s.setColumn(1,s.getColumn(1)-1),f.setSource(m+_,a)}break;case Mo:switch(f.shift(l,1)){case"next":let t=r.findIndex(f);if(c<d.length()-1){r.splice(t+1,1);const e=r.get(t+1),[i,n]=la(f,e,f.source.length,a);n&&r.remove(t+1),s.setColumn([c,i])}else if(t<r.length()-1){const e=r.get(t+1),[i,n]=la(f,e,f.source.length,a);n&&r.remove(t+1),s.setColumn([c,i])}break;case"self":_=_.substring(1),f.setSource(m+_,a)}}r.collectRecords(),r.recordAfterCaret(s),o.write(a,r.getCaretRecord()),this._editor.refresh()}}class da extends sa{static name=Xo;exec(){const t=this._editor;if(!this._startEdit())return;const e=t._jflow;t.moveCaretByHitPoint(),t.createShadowInput(),t._caret.animate(e),t.syncShadowInputPosition()}_startEdit(){let t=!0;const e=this._editor;return e.dispatchEvent(new Jr("edit",{target:e,preventDefault(){t=!1}})),t}}class fa extends sa{static name=Yo;exec(){const t=this._editor;t.moveCaretByHitPoint(),t._caret.refresh(),t.syncShadowInputPosition(),t._range.disable()}}class pa extends sa{static name=Uo;exec(){const t=this._editor;t.moveCaretByHitPoint();const e=t._caret,i=t._range,n=t._area,s=e.getRow(),r=n.get(s),o=r.length()-1;i.setInitialRange([s,0,0]),i.setRange([s,o,r.tail().tailOffset()]),i.handleCaret(e),i.enable(),t.syncShadowInputPosition()}}class ga extends sa{static name=zo;exec(){this._editor._range.setInitialRange(null),this._editor.toggleShift(!1)}}class _a extends sa{static name=Ho;exec(){const t=this._editor._range,e=this._editor._caret;t.setInitialRange(e.toRange()),this._editor.toggleShift(!0)}}class ma extends sa{static name=Go;exec(){const t=this._editor;t.moveCaretByHitPoint();const e=this._editor._caret,i=this._editor._range;i.setRange(e.toRange()),i.enable(),i.handleCaret(e),e.refresh(),t.syncShadowInputPosition()}}class va extends sa{static name=Vo;exec(){const t=this._editor,e=t._caret,i=t._range,n=t._area,s=n.length()-1,r=n.get(s),o=r.length()-1;i.setInitialRange([0,0,0]),i.setRange([s,o,r.tail().tailOffset()]),i.handleCaret(e),i.enable(),t.syncShadowInputPosition()}}class ya extends sa{static name=Fo;exec(){this._editor._range.disable(),this._editor._undoredo.undo(),this._editor.refresh()}}class ba extends sa{static name=Wo;exec(){this._editor._range.disable(),this._editor._undoredo.redo(),this._editor.refresh()}}class wa extends Ar{get currentLineHeight(){return this.lineHeight||parseInt(this.fontSize)}constructor(t){super(t),this.initStack(t),this.initLayout(t),this._undoredo=new ia,this._undoredo._editor=this,this._caret=new class{_row=0;_column=[0,0];_status={show:!0,anime:null,lastElapsed:0,refreshElapsed:!1};setRow(t){this._row=t}setColumn(t,e){void 0!==e?this._column[t]=e:this._column=t}getRow(){return this._row}getColumn(t){return void 0!==t?this._column[t]:this._column}animate(t){this._status.anime=t.requestJFlowAnime((t=>{const e=this._status.lastElapsed;this._status.refreshElapsed&&(this._status.lastElapsed=t,this._status.refreshElapsed=!1),t-e>500&&(this._status.show=!this._status.show,this._status.lastElapsed=t)}))}cancelAnimate(){this._status.anime.cancel(),Object.assign(this._status,{show:!0,anime:null,lastElapsed:0})}isShow(){return this._status.show}refresh(){Object.assign(this._status,{show:!0,refreshElapsed:!0})}toRange(){return[this._row,...this._column]}fromRange(t){this._row=t[0],this._column=t.slice(1)}},this._range=new class{_enable=!1;_rangeFrom=null;_rangeTo=null;_initialRange=null;setInitialRange(t){this._initialRange=t}getRangeFrom(){return this._rangeFrom}getRangeTo(){return this._rangeTo}isEnable(){return this._enable}enable(){this._enable=!0}disable(){this._enable=!1}handleCaret(t){const[e,i,n]=this._rangeTo;t.setRow(e),t.setColumn([i,n])}setRange(t){const e=this._initialRange;this._compareRange(e,t)?(this._rangeFrom=e,this._rangeTo=t):(this._rangeFrom=t,this._rangeTo=e)}_compareRange(t,e){return!(t[0]>e[0]||t[0]===e[0]&&t[1]>e[1]||t[0]===e[0]&&t[1]===e[1]&&t[2]>e[2])}delete(t,e){if(this._enable){const i=t._area,n=t._caret,s=this._rangeFrom,r=this._rangeTo,o=i.get(s[0]).get(s[1]),a=i.get(r[0]).get(r[1]);let[h,c,l]=s;if(e.push({op:"range",args:[s.slice(),r.slice()]}),o===a){const t=o.source;o.setSource(t.substring(0,s[2])+t.substring(r[2]),e),o.dirty=!0}else{const i=t._flattenTxtElem;let n,u,d="",f="";const p=i.findIndex(o),g=i.findIndex(a);let _=!1;if("text"===o.type?d=o.source.substring(0,s[2]):n=i.get(p-1),"text"===a.type?(f=a.source.substring(r[2]),_=a.needWrap):u=i.get(g-1),n)if(i.splice(p,g-p+1),"text"===n.type)n.needWrap?h-=1:c-=1,l=n.source.length,n.setSource(n.source+f,e),n.dirty=!0,n.setNeedWrap(_,e);else{const t=new ta("text",d+f);t.setNeedWrap(_,e),i.splice(p,0,t)}else if(i.splice(p,g-p),u){const t=new ta("text",d);i.splice(p,0,t)}else a.setSource(d+f,e),a.dirty=!0;0===i.length()&&i.push(new ta("text",""))}this.disable(),n.setRow(h),n.setColumn([c,l])}}},this._shadowInput=void 0,this.textColor=t.textColor||"transparent",this.fontFamily=t.fontFamily||"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Tahoma,Arial,Noto Sans,PingFang SC,Microsoft YaHei,Hiragino Sans GB,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji",this.fontSize=t.fontSize||"28px",this.fontWeight=t.fontWeight||"",this.elementSpace=t.elementSpace||5,this.lineSpace=t.lineSpace||5,this.placeholder=t.placeholder||"",this.placeholderColor=t.placeholderColor||"#eee",this.cursorColor=t.cursorColor||"#60CFC4",this.textRangeColor=t.textRangeColor||"#4E75EC1A",this.minWidth=t.minWidth||0,this.resolver=()=>{const e=t.resolver();return 0!==e.length&&"text"===e[e.length-1].type||e.push(new ta("text","")),e},this._area=new Ko,this._flattenTxtElem=Qo.create(this.resolver()),this._status={editing:!1,dragover:!1},this.commands=new Map,this.registCommand(da),this.registCommand(fa),this.registCommand(ga),this.registCommand(_a),this.registCommand(ma),this.registCommand(ua),this.registCommand(ra),this.registCommand(oa),this.registCommand(aa),this.registCommand(ha),this.registCommand(va),this.registCommand(pa),this.registCommand(ya),this.registCommand(ba),this._makeFunctional(),this._cacheViewBox=[]}registCommand(t){this.commands.has(t.name)||this.commands.set(t.name,t.create(this))}_makeFunctional(){this.addEventListener("dblclick",(t=>{t.currentTarget===this&&(t.detail.bubbles=!1,this._status.editing&&this.execCommand(Uo))})),this.addEventListener("click",(t=>{if(t.currentTarget!==this)return;let e;t.detail.bubbles=!1,e=this._status.editing?this._status.shiftOn?Go:Yo:Xo,this.execCommand(e)})),this.addEventListener("blur",(t=>{this._status.editing=!1,this._shadowInput&&this._shadowInput.destroy(),this._belongs&&this._jflow._render(),this.dispatchEvent(new Jr("change",{target:this,textElements:this._flattenTxtElem.copy()})),this._range.disable(),this._caret.cancelAnimate()})),this.addEventListener("instancePressStart",(t=>{if(this._status.editing&&!this._status.shiftOn){t.detail.bubbles=!1,t.detail.preventDefault();const e=this._currentp,i=this._positionToCursorOffset(e),n=this._range;n.setInitialRange([i.row,...i.column]);const s=t.detail.jflow;let r=!1;const o=(t=>{this._status.editing=!1,r=!0;const{offsetX:e,offsetY:i}=t,o=s._calculatePointBack([e,i]);s._stack.checkHit(o);const a=this._currentp,h=this._positionToCursorOffset(a);n.setRange([h.row,...h.column]),n.enable()}).bind(this);document.addEventListener("pointermove",o),document.addEventListener("pointerup",(t=>{document.removeEventListener("pointermove",o),n.setInitialRange(null),r&&(n.handleCaret(this._caret),this._status.editing=!0,this._shadowInput.focus())}),{once:!0})}})),this.addEventListener("dragenter",(()=>{this.moveCaretByHitPoint(),this._status.dragover=!0})),this.addEventListener("dragover",(()=>{this.moveCaretByHitPoint()})),this.addEventListener("dragleave",(()=>{this._status.dragover=!1}));const t=(t=>{if(!this._status.dragover)return;t.detail.bubbles=!1,this._status.dragover=!1;const e=this._caret,i=e.getRow(),n=e.getColumn(),s=this._area.get(i);let[r,o]=n;const a=s.get(r),h=s.get(r-1);let c=this._flattenTxtElem,l=c.findIndex(a);"text"!==a.type&&"text"===h?.type&&(o=h.source.length,l=c.findIndex(h));const u=c.length();this.dispatchEvent(new Jr("insert",{...t.detail,type:t.type,textElements:c.copy(),idx:l,offset:o})),c=this._flattenTxtElem,this._status.editing&&(c.length()>u&&e.setColumn([r+c.length()-u,0]),this._shadowInput.focus()),this._status.editing&&this._caret.refresh(),this.syncShadowInputPosition(),this._range.disable()}).bind(this);this.addEventListener("pressEnd",t),this.addEventListener("drop",t)}toggleShift(t){this._status.shiftOn=t}execCommand(t){this.commands.get(t).exec()}createShadowInput(){const t=this._jflow;this._shadowInput=new Jo(t.DOMwrapper),this._shadowInput.addEventListener(Oo,(t=>{const e=t.detail.kind;this.execCommand(e)})),this._shadowInput.addEventListener(Eo,(t=>{const e=t.detail.kind,i=t.detail.data;this.commands.get(Eo).exec(e,i)})),this._status.editing=!0,t.setFocusInstance(this)}moveCaretByHitPoint(){const t=this._currentp,e=this._caret,{row:i,column:n}=this._positionToCursorOffset(t);e.setRow(i),e.setColumn(n)}refresh(){this.recalculateUp(),this.syncShadowInputPosition(),this._jflow._render()}refreshTextElements(){this._flattenTxtElem=Qo.create(this.resolver())}_positionToCursorOffset(t){const[e,i]=t,n=this._area,s=e+this.width/2,r=i+this.height/2,o=n.getLineAbove(r);return{row:o,column:n.get(o).getColumnNearest(s,this.elementSpace,this.fontSize,this.fontFamily)}}_caretToPosition(){const t=this._caret.getRow(),e=this._caret.getColumn(),i=this._area.get(t),[n,s]=e,r=i.get(n),o=this._flattenTxtElem.findIndex(r),a=this._flattenTxtElem.get(o-1);let h,c=this.currentLineHeight/2;if("text"===r.type){const t=r.source.substring(0,s);Ws((e=>{e.beginPath(),e.font=`${this.fontSize} ${this.fontFamily}`,h=r.anchorX-r.width/2+e.measureText(t).width}))}else h=r.anchorX-r.width/2,c=Math.max(c,r.height/2);return 0===s&&a&&"text"!==a.type&&(c=Math.max(c,a.height/2)),[h,c,i.anchorY,a,r]}syncShadowInputPosition(){if(this._status.editing){const[t,e,i]=this._caretToPosition(),n=this.calculateToRealWorld([t,i+e]),s=this._jflow.canvasMeta,r=Math.min(s.actual_width-120,n[0]);this._shadowInput.syncPosition(r,n[1]),this._shadowInput.focus()}}render(t){t.save(),this._isMoving?t.globalAlpha=.6:1!==this.opacity&&(t.globalAlpha=this.opacity);const[e,i]=this.anchor,n=this._jflow,s=this._area;t.translate(e,i);const r=this._flattenTxtElem;if(r.isEmpty())return t.beginPath(),t.font=`${this.fontWeight} ${this.fontSize} ${this.fontFamily}`,t.textAlign="center",t.textBaseline="middle",t.fillStyle=this.placeholderColor,t.fillText(this.placeholder,0,0),this._randerCursor(t),t.translate(-e,-i),void t.restore();t.beginPath(),t.font=`${this.fontWeight} ${this.fontSize} ${this.fontFamily}`,t.textAlign="center",t.textBaseline="middle",t.fillStyle=this.textColor,s.forEach((e=>{e.forEach((e=>{"text"===e.type&&t.fillText(e.source,e.anchorX,e.anchorY)}))})),r.forEach((e=>{if("text"!==e.type){const i=n.getRenderNodeBySource(e.source);i.visible&&(t.save(),i.render(t),t.restore())}})),this._randerCursor(t),this._renderRange(t),t.translate(-e,-i),t.restore()}_randerCursor(t){if(this._caret.isShow()&&(this._status.editing||this._status.dragover)){const[e,i,n]=this._caretToPosition();t.beginPath(),t.moveTo(e,n-i),t.lineTo(e,n+i),t.lineWidth=2,t.strokeStyle=this.cursorColor,t.stroke()}}_renderRange(t){const e=this._range;if(e.isEnable()){const i=this._area,n=this.textRangeColor,s=this.height,r=this.width,o=this.lineSpace,[a,h,c]=e.getRangeFrom(),[l,u,d]=e.getRangeTo();if(a===l){if(h===u&&c==d)return;const e=i.get(a);let r=a===i.length()-1?0:o;const l=e.reduceHeight-r-e.height-s/2,f=e.height,p=this._measureElementOffsetX(e.get(h),c,t),g=this._measureElementOffsetX(e.get(u),d,t);t.beginPath(),t.rect(p,l,g-p,f),t.fillStyle=n,t.fill()}else{let e=a,f=!0;for(;e<=l;){const a=i.get(e);let p=e===i.length()-1?0:o;const g=a.reduceHeight-p-a.height-s/2,_=a.height;if(f){const e=a.get(h),i=this._measureElementOffsetX(e,c,t),s=a.tail(),r=s.anchorX+s.width/2;t.beginPath(),t.rect(i,g,r-i,_),t.fillStyle=n,t.fill()}else if(e===l){const e=a.get(u),i=this._measureElementOffsetX(e,d,t);t.beginPath(),t.rect(-r/2,g,e.reduceWidth+(i-e.anchorX+e.width/2),_),t.fillStyle=n,t.fill()}else t.beginPath(),t.rect(-r/2,g,a.width,_),t.fillStyle=n,t.fill();f=!1,e++}}}}_measureElementOffsetX(t,e,i){return"text"!==t.type||0===e?t.anchorX-t.width/2:t.anchorX-t.width/2+i.measureText(t.source.substring(0,e)).width}measureTextWidth(t){let e;return Ws((i=>{i.font=`${this.fontSize} ${this.fontFamily}`,e=i.measureText(t).width})),e}getBoundingDimension(){return{width:this.width,height:this.height}}getBoundingRect(){const t=this.anchor,e=this.width/2,i=this.height/2,n=t[0]-e,s=t[1]-i,r=t[0]+e,o=t[1]+i,a=this._boundingrect;return a[0]=n,a[1]=s,a[2]=r,a[3]=o,a}_getViewBox(){const t=this._belongs.getCacheViewBox(),e=this._cacheViewBox;return this._calculatePointBackWithPoint(t[0],t[1],e,0,1),this._calculatePointBackWithPoint(t[2],t[3],e,2,3),this._cacheViewBox}getCacheViewBox(){return this._cacheViewBox}calculateToCoordination(t){const[e,i]=t,[n,s]=this.anchor,r=[e+n,i+s];return this._belongs&&this._belongs.calculateToCoordination?this._belongs.calculateToCoordination(r):r}calculateToRealWorld(t){const[e,i]=t,[n,s]=this.anchor,r=[e+n,i+s];if(this._belongs&&this._belongs.calculateToRealWorld)return this._belongs.calculateToRealWorld(r)}_calculatePointBack(t){const[e,i]=t,[n,s]=this.anchor;return[e-n,i-s]}_calculatePointBackWithPoint(t,e,i,n,s){i[n]=t-this.anchor[0],i[s]=e-this.anchor[1]}isHit(t,e){const i=this._calculatePointBack(t),n=this._jflow;this._currentp=i;let s=[];this._flattenTxtElem.forEach((t=>{if("text"!==t.type){const e=n.getRenderNodeBySource(t.source);e.visible&&s.push(e)}}));const r=this._stack.checkHit(i,e,(t=>s.includes(t)));if(r)return r;const o=this.anchor,a=this.width/2,h=this.height/2;return t[0]>o[0]-a&&t[0]<o[0]+a&&t[1]>o[1]-h&&t[1]<o[1]+h}clone(){return new fo({width:this.width,height:this.height,cache:t=>{const[e,i]=this.anchor;t.translate(-e+this.width/2,-i+this.height/2),this.render(t)}})}destroy(){this._jflow._focus.instance===this&&this._jflow.blur()}}Object.assign(wa.prototype,Wr),Object.assign(wa.prototype,Hr),Object.assign(wa.prototype,{_getBoundingGroupRect(){},resetChildrenPosition(){},reflow(){let t=this.currentLineHeight;const e=this._flattenTxtElem,i=this._area;if(e.isEmpty()){let n=0;const s=e.get(0);return Ws((t=>{t.font=`${this.fontSize} ${this.fontFamily}`,n=t.measureText(this.placeholder).width})),i.truncate({height:t,reduceHeight:t}).insert(0,s),Object.assign(s,{anchorX:-n/2,height:t,isTail:!0}),this.width=n,void(this.height=t)}const n=this._jflow;Ws((t=>{t.font=`${this.fontSize} ${this.fontFamily}`,e.forEach((e=>{"text"===e.type&&e.dirty&&(e.width=t.measureText(e.source).width,e.dirty=!1)}))}));const s=new Ko;s.truncate({height:t});let r=s.get(0),o=0,a=0,h=null;const c=this.lineSpace,l=this.elementSpace;e.forEach((e=>{if(r.push(e),e.reduceWidth=r.width,"text"===e.type)e.height=t,r.width+=e.width,e.needWrap&&(o+=r.height+c,r.reduceHeight=o,a=Math.max(r.width,a),r=Zo.create({height:t}),s.push(r));else{const t=n.getRenderNodeBySource(e.source);e.height=t.height,r.height=Math.max(r.height,t.height);const i=h&&"text"!==h.type?l:2*l;r.width+=t.width+i}h=e})),e.tail().isTail=!0,o+=r.height,r.reduceHeight=o,a=Math.max(this.minWidth,Math.max(r.width,a));const u=a/2;let d=-o/2,f=0;s.forEach((t=>{const{height:e,reduceHeight:i}=t,s=d+f+e/2;t.anchorY=s;let r=-u,o=null;t.forEach((t=>{if("text"===t.type)t.anchorY=s,t.anchorX=r+t.width/2,r+=t.width;else{const e=n.getRenderNodeBySource(t.source),i=!o||"text"===o.type,a=i?2*l:l;t.width=e.width,t.anchorY=s,t.anchorX=r+t.width/2+(i?a/2:0),e.anchor=[t.anchorX,t.anchorY],r+=t.width+a}o=t})),f=i})),this._area=s,this.width=a,this.height=o}});const xa=wa,ka=Qr(eo),Sa=Qr(io),Ca=Qr(so),Ta=Qr(ro,{shapeShift:(t,e)=>[t+.28865*e,e]}),Ea=Qr(class extends ro{constructor(t){super(t)}render(t){t.save(),this._isMoving&&(t.globalAlpha=.6),t.beginPath();const[e,i]=this.anchor,n=this.width/2,s=this.height/2,r=n/1.732,o=i-s,a=i+s,h=i-s+r,c=i+s-r,l=e-n,u=e+n;t.moveTo(e,o),t.lineTo(u,h),t.lineTo(u,c),t.lineTo(e,a),t.lineTo(l,c),t.lineTo(l,h),t.closePath(),t.fillStyle=this.backgroundColor,this.shadowColor&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),t.fill(),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor,t.stroke()),t.restore(),this._cachePoints=[[e,o],[u,h],[u,c],[e,a],[l,c],[l,h]]}},{shapeShift:(t,e)=>[t,e+.5773*t]}),Oa=Qr(no),Ba=Qr(to,{shapeShift(t,e,i){const n=Math.ceil(Math.sqrt(t*t+e*e)/2);i.radius=n;const s=2*n;return[s,s]}});class Ia extends EventTarget{constructor(t){super(),this.uniqueName="jflow",this.eventAdapter=new class{constructor(t={}){this.plugin=function(){let t={pointerDown:!1,dirty:!1};return{canvas:{wheel:function(t,e){t.preventDefault();let{offsetX:i,offsetY:n,deltaX:s,deltaY:r}=t;t.ctrlKey?(r=-r,e.zoomHandler(i,n,s,r,t)):e.panHandler(-s,-r,t)},pointerdown:function(e,i){const{offsetX:n,offsetY:s,deltaY:r,button:o}=e;0===o&&(t.pointerDown=!0,i.pressStartHandler(n,s,e))},pointermove:function(e,i){const{offsetX:n,offsetY:s}=e;t.pointerDown&&(t.dirty=!0),i.pressMoveHandler(n,s,e)},pointerup:function(e,i){e.preventDefault();const{offsetX:n,offsetY:s,button:r}=e;0===r&&t.pointerDown&&t.dirty&&(t.pointerDown=!1,t.dirty=!1,i.pressUpHanlder(!1,e))},contextmenu:function(t,e){t.preventDefault(),t.stopPropagation();const{offsetX:i,offsetY:n}=t;e.contextMenuHanlder(i,n,t)},dblclick:function(t,e){t.preventDefault(),t.stopPropagation();const{offsetX:i,offsetY:n}=t;e.dblclickHandler(i,n,t)},click:function(e,i){e.preventDefault(),e.stopPropagation();const{offsetX:n,offsetY:s}=e;t.dirty||(t.pointerDown=!1,t.dirty=!1,i.clickHanlder(n,s,e))}},document:{pointerup:function(t,e){e.pressUpHanlder(!0,t)}}}}(),this.use(t),this.canvasHandlers=[],this.documentHandlers=[]}use(t={}){const{canvas:e,document:i}=t;if(e)for(let t in e)e.hasOwnProperty(t)&&(this.plugin.canvas[t]=e[t]);if(i)for(let t in i)i.hasOwnProperty(t)&&(this.plugin.document[t]=i[t])}apply(t){const{canvas:e,document:i}=this.plugin,n=t.canvas;for(let i in e){const s=e[i];function r(e){s(e,t)}n.addEventListener(i,r),this.canvasHandlers.push({eventName:i,handlerWrapperd:r})}for(let e in i){let n,s={};function r(e){n(e,t)}"function"==typeof i[e]?n=i[e]:(n=i[e].handler,Object.assign(s,i[e].options)),document.addEventListener(e,r,s),this.documentHandlers.push({eventName:e,handlerWrapperd:r,options:s})}}unload(t){const e=t.canvas;this.canvasHandlers.forEach((({eventName:t,handlerWrapperd:i})=>{e.removeEventListener(t,i)})),this.documentHandlers.forEach((({eventName:t,handlerWrapperd:e,options:i})=>{console.log("unload",t),document.removeEventListener(t,e,i)}))}}(t.eventAdapter),this.initNodeWeakMap(),this.initAnime(),this.initStack(t),this.initLayout(t),this.ctx=null,this.canvas=null,this.dpr=1,this.padding=20,this.position=null,this.scale=null,this.initialZoom=t.initialZoom,this.initialPosition=t.setInitialPosition,this.maxZoom=t.maxZoom||3,this.minZoom=t.minZoom||.5,this.NodeRenderTop=!!t.NodeRenderTop,this.worldMargin=t.worldMargin,this.draggingbehavior=Object.assign({panInBorder:{enable:!0,padding:20,deltamovement:8,allowMovingTargetInPan:!0}},t.draggingbehavior||{}),this.scrollBarBehavior=Object.assign({enable:!0},t.scrollBarBehavior||{}),this.offeset=null,this._lastState={x:null,y:null,dragging:!1,processing:!1},this._lastDragState={target:null,targetLink:null,processing:!1},this._target={instance:null,link:null,moving:null,isInstanceDirty:!1,isLinkDirty:!1,cache:{stack:null,belongs:null,point:null},meta:{x:void 0,y:void 0,initialX:void 0,initialY:void 0},status:{dragovering:!1,dragging:!1,processing:!1,movingState:!1}},this._focus={instance:null},this._dragOverTarget=null,this.allowDrop=t.allowDrop,this._tempNode=null,this._tempLink=null,this.mode=gr.DEFAULT,this._allowMovingTarget=!0,this.canvasMeta={},this._cacheViewBox=[]}setMovingTargets(t){Object.assign(this._target,{moving:t})}setTempDraggingInstance(t){t._belongs=this,this._tempNode=t,Object.assign(this._target,{moving:[this._tempNode],dragging:!0})}removeTempDraggingInstance(){if(this._tempNode){const t=this._tempNode.anchor;return this._tempNode=null,t}}preventDefaultDragging(){this._allowMovingTarget=!1}allowDefaultDragging(){this._allowMovingTarget=!0}$mount(t){const{canvas:e,ctx:i,scale:n,width:s,height:r,raw_width:o,raw_height:a,left:h,top:c}=Ds(t);this.reflow(),this.ctx=i,this.DOMwrapper=t,this.canvas=e,this.canvas.setAttribute("data-jflow",!0),this.canvas.$jflow=this,this.canvasMeta={width:o,height:a,actual_width:s,actual_height:r},this.dpr=n,this._getBoundingGroupRect();const l=this.padding,{width:u,height:d,x:f,y:p}=this.bounding_box,g={x:l,y:l,width:s-2*l,height:r-2*l},_={x:0,y:0,offsetX:0,offsetY:0},m=g.width/u,v=g.height/d,y=m<=v?"x":"y";let b;b=this.initialZoom?this.initialZoom:Math.min(m,v),this.scale=b,b>this.maxZoom&&(this.maxZoom=b),b<this.minZoom&&(this.minZoom=b);const w=f*b,x=p*b,k=g.width,S=g.height;if(this.initialPosition){const{x:t,y:e}=this.initialPosition(w,x,k,S,g.x,g.y,s,r,f,p,u,d);_.x=t,_.y=e}else _.x="x"===y?g.x:(k-u*b)/2+l,_.y="y"===y?g.y:(S-d*b)/2+l;_.offsetX=_.x-w,_.offsetY=_.y-x,this.position=_,this._readyToRender=!0,this.scrollBarBehavior.enable&&this.initScrollBar(this.scrollBarBehavior),this.__render(),this._createEventHandler(),Hs((t=>{this.dpr=t,this.resizeCanvas(),this.scheduleRender()}),(t=>{this.destroyDprListener=t}))}setLinkingMode(t,e,i){const n=this.getRenderNodeBySource(t);this._tempNode=new Rr,this._tempLink=e(i?{from:this._tempNode,to:n}:{from:n,to:this._tempNode}),this.sendMessage({instance:t}),this.mode=gr.LINKING}isInLinkingMode(){return this.mode===gr.LINKING}setLinkingLink(t){this.mode===gr.LINKING&&this._tempLink.setConfig(t)}resetLinkingLink(){this.mode===gr.LINKING&&this._tempLink.setConfig({to:this._tempNode})}clearTemp(){this._tempNode&&(this._tempNode.destroy(),this._tempNode=null),this._tempLink&&(this._tempLink.destroy(),this._tempLink=null),this._render()}preventClearTemp(){this._preventClearTemp=!0}resizeCanvas(){if(this.canvas&&this.DOMwrapper){const{width:t,height:e,raw_width:i,raw_height:n}=function(t,e){const{width:i,height:n,left:s,top:r}=e.getBoundingClientRect();t.style.width=i+"px",t.style.height=n+"px";const o=window.devicePixelRatio;return t.width=Math.floor(i*o),t.height=Math.floor(n*o),{width:i,height:n,raw_width:t.width,raw_height:t.height}}(this.canvas,this.DOMwrapper);this.canvasMeta={width:i,height:n,actual_width:t,actual_height:e}}}setFocusInstance(t){this._focus.instance=t}focusOn(t){const e=this._calculatePointBack([this.canvasMeta.actual_width/2,this.canvasMeta.actual_height/2]);let i=t.anchor;t._belongs.calculateToCoordination&&(i=t._belongs.calculateToCoordination(i));const n=(e[0]-i[0])*this.scale,s=(e[1]-i[1])*this.scale;this._recalculatePosition(n,s),this._render()}_getBoundingGroupRect(){const t=this._stack.getBoundingRectPoints();if(this.bounding_box){this.bounding_box=_r(t);const{x:e,y:i}=this.bounding_box,n=this.scale;this.position.x=this.position.offsetX+e*n,this.position.y=this.position.offsetY+i*n}else this.bounding_box=_r(t)}_createEventHandler(){const t=this.canvas;let e;this.eventAdapter.apply(this);const i=()=>{this.eventAdapter.unload(this),this.destroyDprListener()};if(e=i,this.allowDrop){const n=this._onDragover.bind(this),s=this._onDrop.bind(this),r=this._onDragLeave.bind(this);t.addEventListener("dragstart",(t=>{t.preventDefault()})),t.addEventListener("dragover",n),t.addEventListener("drop",s),t.addEventListener("dragleave",r),e=()=>{i(),t.removeEventListener("dragover",n),t.removeEventListener("drop",s),t.removeEventListener("dragleave",r)}}this.destroy=e}_targetLockOn(t,e){let i=this._calculatePointBack(t);const n=i;this._currentp=i;let s=this._stack;const r=this._getViewBox(),o=s.checkHit(i,(t=>this._target.status.dragging&&t===this._getMovingTarget()),(t=>Or(r,t.getBoundingRect())));let a,h=this._linkStack;if(o&&o._belongs!==this||(a=h.checkHit(i,(t=>{if(!this._target.status.dragging)return!1;const e=this._getMovingTarget();return t.from===e||t.to===e}))),a||(a=h.checkHit(i,(t=>!t.ON_TOP))),Object.assign(this._target,{instance:o,link:a,isInstanceDirty:o===this._target.instance,isLinkDirty:a===this._target.link}),Object.assign(this._target.cache,{stack:s,belongs:this,point:i,topLayerPoint:n}),Object.assign(this._target.meta,{x:t[0],y:t[1]}),"pressStart"===e&&!this._target.status.dragging&&!this._target.status.dragovering){let t=o;for(;t&&t._belongs.lock&&t!==this;)t=t._belongs;this.setMovingTargets(t&&[t]),t&&o.bubbleEvent(new Jr("afterResolveMovingTarget",{event:e,target:t,jflow:this,bubbles:!0}))}return["pressStart","click","dblclick","contextclick"].includes(e)&&this._focus.instance&&this._focus.instance!==o&&(this._focus.instance.dispatchEvent(new Jr("blur",{relatedTarget:o})),this._focus.instance=null),this._target}blur(){this._focus.instance&&(this._focus.instance.dispatchEvent(new Jr("blur",{relatedTarget:null})),this._focus.instance=null)}_getMovingTarget(){return this._target.moving&&this._target.moving[0]}_processDragOver(t,e){if(this._dragOverTarget!==t){const i=this.readMessage()?.instance;this._dragCurrentData=i;const{point:n}=this._target.cache;if(this._dragOverTarget){const t=this._dragOverTarget;t.dispatchEvent(new Jr("dragleave",{event:e,instance:t,target:i,jflow:this,point:n}))}t&&t.dispatchEvent(new Jr("dragenter",{event:e,instance:t,target:i,jflow:this,point:n})),this._dragOverTarget=t}else this._dragOverTarget&&this._dragOverTarget.dispatchEvent(new Jr("dragover",{event:e,instance:t,jflow:this,target:this._dragCurrentData}));this._processPanInBorder()}_processPanInBorder(){if(this.draggingbehavior?.panInBorder?.enable&&(this.draggingbehavior.panInBorder.timer||(this.draggingbehavior.panInBorder.timer=Date.now()),Date.now()-this.draggingbehavior.panInBorder.timer>500)){const[t,e,i,n]=this._cacheViewBox,[s,r]=this._currentp,{padding:o,deltamovement:a}=this.draggingbehavior.panInBorder;let h=0,c=0;s<t+o&&(h=a),s>i-o&&(h=-a),r<e+o&&(c=a),r>n-o&&(c=-a),this.__processOverAnime&&this.__processOverAnime.cancel(),h||c?this.__processOverAnime=this.requestJFlowAnime((()=>{this.panHandler(h,c)})):this.draggingbehavior.panInBorder.timer=null}}_onDragover(t){if(t.preventDefault(),t.stopPropagation(),this._lastDragState.processing)return;this._lastDragState.processing=!0;const{offsetX:e,offsetY:i}=t;Object.assign(this._target.status,{dragovering:!0}),this._targetLockOn([e,i]);const n=this._target.instance||this._target.link;this._processDragOver(n,t),this._target.isLinkDirty||this._target.isInstanceDirty?Promise.resolve().then((()=>{this._render(),this._target.isLinkDirty=!1,this._target.isInstanceDirty=!1,this._lastDragState.processing=!1})):this._lastDragState.processing=!1}_cancelPanInBorder(){this.__processOverAnime&&this.__processOverAnime.cancel(),this.draggingbehavior?.panInBorder&&(this.draggingbehavior.panInBorder.timer=null)}_onDragLeave(){this._cancelPanInBorder()}_onDrop(t){this._cancelPanInBorder();const e=this.consumeMessage()?.instance;if(this._dragOverTarget){const e=this._dragOverTarget;e.dispatchEvent(new Jr("dragoverend",{event:t,instance:e})),this._dragOverTarget=null}const{link:i,instance:n}=this._target,{point:s,belongs:r}=this._target.cache;i?i.dispatchEvent(new Jr("drop",{event:t,instance:e,link:i,jflow:this,belongs:r,point:s})):n?n.bubbleEvent(new Jr("drop",{event:t,instance:e,jflow:this,target:n,point:s,bubbles:!0})):this.dispatchEvent(new Jr("drop",{event:t,instance:e,jflow:this,target:n,point:s})),requestAnimationFrame((()=>{this.cancelDrop()}))}cancelDrop(){this._target.instance=null,this._target.link=null,Object.assign(this._target.status,{dragovering:!1})}zoomHandler(t,e,i,n,s){if(this._zooming)return;this._zooming=!0;const{width:r,height:o,x:a,y:h}=this.bounding_box,{actual_width:c,actual_height:l}=this.canvasMeta;let u=this.minZoom;if(this.worldMargin){const t=this.worldMargin,e=r+2*t,i=o+2*t;u=Math.max(u,Math.max(c/e,l/i))}let d=this.scale;d*=n>0?1.05:1/1.05,d=Math.min(this.maxZoom,Math.max(u,d));var f=d-this.scale,p=r*this.scale,g=o*this.scale,_=r*f,m=o*f,v=-(t-this.position.x)/p,y=-(e-this.position.y)/g;this.scale=d,this._recalculatePosition(v*_,y*m),this.dispatchEvent(new Jr("zoompan",{deltaX:0,deltaY:0})),this.scheduleRender((()=>{this._zooming=!1}))}panHandler(t,e,i){if(this._panning)return;this._panning=!0;const{dragging:n}=this._target.status;if(n){const i=this._target.moving;i&&this.draggingbehavior.panInBorder.allowMovingTargetInPan&&i.forEach((i=>{i.anchor[0]+=-t/this.scale,i.anchor[1]+=-e/this.scale}))}this._recalculatePosition(t,e),this.dispatchEvent(new Jr("zoompan",{deltaX:t,deltaY:e})),this.scheduleRender((()=>{this._panning=!1}))}pressStartHandler(t,e,i){if(this.checkScrollDragging())return;Object.assign(this._target.meta,{initialX:t,initialY:e});const{link:n,instance:s}=this._targetLockOn([t,e],"pressStart");if(this.mode===gr.LINKING)return;if(Object.assign(this._target.status,{dragging:!0,processing:!1}),this._target.moving){const t=this._getMovingTarget();t.dispatchEvent(new Jr("pressStart",{event:i,instance:t,jflow:this}))}const r=this._resolveLockOnTarget(n,s);r&&r.bubbleEvent(new Jr("instancePressStart",{event:i,target:r,jflow:this,bubbles:!0,preventDefault:()=>{this._preventPressSequeence=!0,this._clearTarget(),document.addEventListener("pointerup",(t=>{t.preventDefault(),t.stopPropagation(),this._preventPressSequeence=!1}),{once:!0})}})),this._preventPressSequeence||this.dispatchEvent(new Jr("jflowPressStart",{event:i,jflow:this}))}pressMoveHandler(t,e,i){if(this._preventPressSequeence)return;if(this.checkScrollDragging())return;const{dragging:n,processing:s}=this._target.status,{x:r,y:o}=this._target.meta;if(!n){if(this.checkScrollBarHover(t,e))return;this.resetScrollBarHover()}if(!n&&!s){const{link:n,instance:s}=this._targetLockOn([t,e]),r=this._resolveLockOnTarget(n,s);if(r?r.bubbleEvent(new Jr("instancemousemove",{event:i,instance:r,jflow:this,bubbles:!0})):this.dispatchEvent(new Jr("instancemousemove",{event:i,instance:null,jflow:this})),this.mode===gr.LINKING)return this._tempNode.anchor=this._currentp,this.scheduleRender((()=>{this._target.isLinkDirty=!1,this._target.isInstanceDirty=!1,this._target.status.processing=!1})),void this._processPanInBorder()}if(this.dispatchEvent(new Jr("canvasmousemove",{event:i,jflow:this})),!n)return;if(s)return;const a=this._target.moving;this._target.status.movingState=!0,this._target.status.processing=!0;const h=t-r,c=e-o;a?this._allowMovingTarget&&a.forEach((t=>{t.anchor[0]+=h/this.scale,t.anchor[1]+=c/this.scale})):(this._recalculatePosition(h,c),this.dispatchEvent(new Jr("zoompan",{deltaX:h,deltaY:c})));const{instance:l,link:u}=this._targetLockOn([t,e]);this._processDragOver(l||u,i),this.scheduleRender((()=>{this._target.isLinkDirty=!1,this._target.isInstanceDirty=!1,this._target.status.processing=!1}))}pressUpHanlder(t,e){if(!this._preventPressSequeence){if(this.__processOverAnime&&this.__processOverAnime.cancel(),this._cancelPanInBorder(),this._target.meta,this.mode===gr.LINKING){const t=this._target.instance,i=this.consumeMessage();let n=!1;const s=()=>{n=!0};if(t)t.bubbleEvent(new Jr("link",{event:e,target:t,jflow:this,payload:i,bubbles:!0,link:this._tempLink,preventDefault:s}));else{const{offsetX:t,offsetY:n}=e;this.dispatchEvent(new Jr("link",{event:e,jflow:this,payload:i,anchor:this._calculatePointBack([t,n]),link:this._tempLink,preventDefault:s}))}if(n)return;return this._clearTarget(),this._preventClearTemp||(this._tempNode&&(this._tempNode.destroy(),this._tempNode=null),this._tempLink&&(this._tempLink.destroy(),this._tempLink=null)),this._preventClearTemp=!1,this.mode=gr.DEFAULT,void this._render()}if(this._target.moving){let t=!1;if(this._layout.static&&(t=this.staticCheck(this._getMovingTarget())),!t&&this._target.link){const{point:t,belongs:i}=this._target.cache,n=this._target.link,s=this._getMovingTarget();n.dispatchEvent(new Jr("drop",{event:e,instance:s,link:n,jflow:this,belongs:i})),this._target.link=null,this._target.instance=null}this._target.moving&&(this._target.instance?this._target.instance.bubbleEvent(new Jr("pressEnd",{event:e,instance:this._getMovingTarget(),jflow:this,target:this._target.instance,bubbles:!0})):this.dispatchEvent(new Jr("pressEnd",{event:e,instance:this._getMovingTarget(),jflow:this}))),this._target.moving=null,this.removeTempDraggingInstance(),this._render()}this._clearTarget()}}clickHanlder(t,e,i){const{link:n,instance:s,meta:r}=this._targetLockOn([t,e],"click");if(Math.abs(r.initialX-r.x)<1&&Math.abs(r.initialY-r.y)<1){if(i.target!==this.canvas)return this._clearTarget(),void Object.assign(this._target.meta,{initialX:void 0,initialY:void 0});const{topLayerPoint:t}=this._target.cache,e=this._resolveLockOnTarget(n,s);if(e){const n=e;n.bubbleEvent(new Jr("click",{event:i,jflow:this,target:n,topLayerPoint:t,bubbles:!0}))}else this.dispatchEvent(new Jr("click",{event:i,jflow:this,topLayerPoint:t}));this._clearTarget(),Object.assign(this._target.meta,{initialX:void 0,initialY:void 0})}}contextMenuHanlder(t,e,i){const{link:n,instance:s}=this._targetLockOn([t,e],"contextclick"),{topLayerPoint:r}=this._target.cache,o=this._resolveLockOnTarget(n,s);if(o){const t=o;t.bubbleEvent(new Jr("contextclick",{event:i,jflow:this,target:t,topLayerPoint:r,bubbles:!0}))}else this.dispatchEvent(new Jr("contextclick",{event:i,jflow:this,topLayerPoint:r}))}dblclickHandler(t,e,i){const{link:n,instance:s}=this._targetLockOn([t,e],"dblclick"),{topLayerPoint:r}=this._target.cache,o=this._resolveLockOnTarget(n,s);if(o){const t=o;t.bubbleEvent(new Jr("dblclick",{event:i,jflow:this,target:t,topLayerPoint:r,bubbles:!0}))}else this.dispatchEvent(new Jr("dblclick",{event:i,jflow:this,topLayerPoint:r}))}_resolveLockOnTarget(t,e){return t?.ON_TOP?t:e||t}_clearTarget(){Object.assign(this._target.meta,{x:void 0,y:void 0}),Object.assign(this._target.status,{dragging:!1,processing:!1,movingState:!1}),Object.assign(this._target,{instance:null,link:null,moving:null})}_recalculatePosition(t,e,i){const{x:n,y:s,width:r,height:o}=this.bounding_box,{actual_width:a,actual_height:h}=this.canvasMeta;if(void 0===i&&(i=this.scale),this.worldMargin){const c=this.worldMargin,l=(n+r+c)*i-a,u=(n-c)*i,d=n*i,f=this.position.x+t-d;this.position.offsetX=Math.min(Math.max(-l,f),-u),this.position.x=this.position.offsetX+d;const p=(s+o+c)*i-h,g=(s-c)*i,_=s*i,m=this.position.y+e-_;this.position.offsetY=Math.min(Math.max(-p,m),-g),this.position.y=this.position.offsetY+_}else this.position.x+=t,this.position.y+=e,this.position.offsetX=this.position.x-n*i,this.position.offsetY=this.position.y-s*i}calculateToRealWorld(t){const e=this.scale,i=this.position;return[t[0]*e+i.offsetX,t[1]*e+i.offsetY]}_calculatePointBack(t){const e=this.scale,i=this.position;return[(t[0]-i.offsetX)/e,(t[1]-i.offsetY)/e]}_calculatePointBackWithPoint(t,e,i,n,s){const r=this.scale,o=this.position;i[n]=(t-o.offsetX)/r,i[s]=(e-o.offsetY)/r}_calculateDistance(t){return this.scale*t}_resetTransform(){const{width:t,height:e}=this.canvasMeta,i=this.position,n=this.scale,s=this.ctx;s.setTransform(),s.clearRect(0,0,t,e),s.scale(this.dpr,this.dpr),s.transform(n,0,0,n,i.offsetX,i.offsetY)}resetTransform(t){const e=this.position,i=this.scale;t.setTransform(),t.scale(this.dpr,this.dpr),t.transform(i,0,0,i,e.offsetX,e.offsetY)}_getViewBox(){const t=this._cacheViewBox;return this._calculatePointBackWithPoint(0,0,t,0,1),this._calculatePointBackWithPoint(this.canvasMeta.actual_width,this.canvasMeta.actual_height,t,2,3),t}setNodeToTopLayer(t){const e=this._stack.findIndex((e=>e===t));if(-1!==e){const[t]=this._stack.splice(e,1);this._stack.push(t)}}getCacheViewBox(){return this._cacheViewBox}_render(){this.scheduleRender()}__render(){if(!this._readyToRender)return;this.runAnimeFrame(),this._resetTransform();const t=this.ctx;this.dispatchEvent(new Jr("beforeJflowRender",{ctx:t}));const e=this._getViewBox();this.NodeRenderTop?(this._linkStack.render(t,(t=>!t.ON_TOP&&t.isInViewBox(e))),this._stack.render(t,(t=>{const i=Or(e,t.getBoundingRect());return t._isInViewBox=i,i})),this._linkStack.render(t,(t=>t.ON_TOP&&t.isInViewBox(e)))):(this._stack.render(t,(t=>{const i=Or(e,t.getBoundingRect());return t._isInViewBox=i,i})),this._linkStack.render(t,(t=>t.isInViewBox(e)))),this._tempNode&&(t.save(),this._tempNode.render(t),t.restore()),this._tempLink&&(t.save(),this._tempLink.isInViewBox(e),this._tempLink.render(t),t.restore()),this.dispatchEvent(new Jr("afterJflowRender",{ctx:t})),this.renderScrollBar(t)}}Object.assign(Ia.prototype,zr),Object.assign(Ia.prototype,Wr),Object.assign(Ia.prototype,Hr),Object.assign(Ia.prototype,$r),Object.assign(Ia.prototype,Vr),Object.assign(Ia.prototype,Xr),Object.assign(Ia.prototype,Ur),Object.assign(Ia.prototype,Gr);const La=Ia,ja={provide(){return{addToStack:this.addToStack,removeFromStack:this.removeFromStack}},data:()=>({stack:[]}),methods:{addToStack(t,e){this._jflowInstance.addToStack(t),e&&t._jflow.setRenderNodeBySource(e,t)},removeFromStack(t){this._jflowInstance.removeFromStack(t)},onStackChangeHandler(){this._jflowInstance.recalculate(),this._jflowInstance.reflow()}}},Pa={mixins:[ja],provide(){return{renderJFlow:this.renderJFlow,getJFlow:this.getInstance,addToLinkStack:this.addToLinkStack,removeFromLinkStack:this.removeFromLinkStack}},props:{configs:{type:Object,default:function(){return{}}},loading:Boolean,genVueComponentKey:{type:Function}},data:()=>({renderNodes:[],renderLinks:[]}),render:function(t){return this.renderNodes.length?t("div",[...this.renderNodes.map((({type:t,source:e,layoutNode:i})=>{if(!this.$scopedSlots[t]){if(!this.$scopedSlots.jflowcommon)return null;t="jflowcommon"}if(i.__vnode__)return i.__vnode__;const[n]=this.$scopedSlots[t]({source:e,layoutNode:i});return this.genVueComponentKey&&(n.key=this.genVueComponentKey(e)),i.__vnode__=n,n})).filter((t=>!!t)),...this.renderLinks.map((t=>{let e=t.type||"plainlink";if(!this.$scopedSlots[e])return null;if(t.__vnode__)return t.__vnode__;const[i]=this.$scopedSlots[e]({configs:t});if(this.genVueComponentKey){const e=this.genVueComponentKey(t.from.source),n=this.genVueComponentKey(t.to.source),s=t.part;i.key=`${e}-${n}-${s}`}return t.__vnode__=i,i}))]):t("div",this.$slots.default)},created(){this._jflowInstance=new La(this.configs),this.$emit("update:loading",!0),this.genNodeLinkMeta(),this.syncNodeLink()},mounted(){this.mountJFlow()},beforeDestroy(){this._jflowInstance?.destroy()},methods:{mountJFlow(){this._jflowInstance.$mount(this.$el),Object.keys(this.$listeners).map((t=>{const e=this.$listeners[t].bind(this);this._jflowInstance.addEventListener(t,e)})),this.$emit("update:loading",!1)},genNodeLinkMeta(){this.nodes=this._jflowInstance._layout.flowStack.map((t=>{const{type:e,layoutNode:i,source:n}=t,s=this._jflowInstance.source_Layout_Render_NodeMap;let r;return r=s.has(n)?s.get(n):s.set(n),r.layoutNode=i,t})),this.links=this._jflowInstance._layout.flowLinkStack.slice()},syncNodeLink(){this.renderNodes=this.nodes.slice(),this.renderLinks=this.links.slice()},reflow(t,e){this.genNodeLinkMeta(),this.syncNodeLink(),this.$nextTick((()=>{t&&t(),this._jflowInstance.recalculate(),this._jflowInstance.scheduleRender((()=>{e&&e()}))}))},getInstance(){return this._jflowInstance},renderJFlow(){this.__renderInSchedule__||(this.__renderInSchedule__=!0,this.$nextTick((()=>{this._jflowInstance._render(),this.__renderInSchedule__=!1})))},addToLinkStack(t,e,i){this._jflowInstance.addToLinkStack(t),e&&i&&t._jflow.addLinkNodeBySource(e,i,t)},removeFromLinkStack(t,e,i){this._jflowInstance.removeFromLinkStack(t),e&&i&&t._jflow.removeLinkNodeBySource(e,i,t)}}};var Ma=n(243),Aa=n.n(Ma);function Ra(t){const i="string"==typeof t?e[t]:t;return{inject:["addToStack","removeFromStack"],props:{configs:{type:Object,default:function(){return{}}},visible:{type:Boolean,default:!0},source:{type:Object}},watch:{configs(t,e){const i=Aa()(t,e);0!==Object.keys(i).length&&this._jflowInstance.setConfig(t)},$listeners(t,e){let i=[],n=[];const s=Object.keys(t).map((e=>({event:e,handler:t[e]}))),r=Object.keys(e).map((t=>({event:t,handler:e[t]})));s.forEach((t=>{const e=t.handler;r.find((t=>t.handler===e))||i.push(t)})),r.forEach((t=>{const e=t.handler;s.find((t=>t.handler===e))||n.push(t)})),i.forEach((t=>{this._jflowInstance.addEventListener(t.event,t.handler)})),n.forEach((t=>{this._jflowInstance.removeEventListener(t.event,t.handler)}))},visible(t){this._jflowInstance.visible=t},source(t){this._jflowInstance._jflow.setRenderNodeBySource(t,this._jflowInstance)}},render:function(t){return null},created(){this._jflowInstance=new i(this.configs),this._jflowInstance.visible=this.visible,this.bindListeners(),this.addToStack(this._jflowInstance,this.source)},destroyed(){this._jflowInstance.destroy(),this.removeFromStack(this._jflowInstance)},methods:{bindListeners(){Object.keys(this.$listeners).map((t=>{const e=this.$listeners[t];this._jflowInstance.addEventListener(t,e)}))}}}}function Da(t,i){const n="string"==typeof t?e[t]:t;return{inject:["addToLinkStack","removeFromLinkStack","getJFlow"],props:{configs:{type:Object,default:function(){return{}}},from:Object,to:Object},render:function(t){return null},created(){const t=this.getJFlow(),e=t.getRenderNodeBySource(this.from),i=t.getRenderNodeBySource(this.to);this.createInstance(e,i)},mounted(){this.unwatch=this.$watch((()=>[this.from,this.to,this.configs]),(()=>{this.refreshConfig()}))},methods:{createInstance(t,e){t&&e&&(this._jflowInstance=new n({...this.configs,from:t,to:e}),this.bindListeners(),this.addToLinkStack(this._jflowInstance,this.from,this.to))},refreshConfig(){const t=this.getJFlow(),e=t.getRenderNodeBySource(this.from),i=t.getRenderNodeBySource(this.to);this._jflowInstance?this._jflowInstance.setConfig({...this.configs,from:e,to:i}):this.createInstance(e,i)},bindListeners(){Object.keys(this.$listeners).map((t=>{const e=this.$listeners[t];this._jflowInstance.addEventListener(t,e)}))}},destroyed(){this.unwatch(),this._jflowInstance&&this.removeFromLinkStack(this._jflowInstance,this.from,this.to)}}}function $a(t){const i="string"==typeof t?e[t]:t;return{mixins:[ja],inject:{addToBelongStack:{from:"addToStack"},removeFromBelongStack:{from:"removeFromStack"},renderJFlow:{from:"renderJFlow"}},render:function(t){return t("jflow-group",this.$slots.default)},props:{configs:{type:Object,default:function(){return{}}},visible:{type:Boolean,default:!0},source:{type:Object}},watch:{configs(t,e){JSON.stringify(t)!==JSON.stringify(e)&&this._jflowInstance.setConfig(t)},$listeners(t,e){let i=[],n=[];const s=Object.keys(t).map((e=>({event:e,handler:t[e]}))),r=Object.keys(e).map((t=>({event:t,handler:e[t]})));s.forEach((t=>{const e=t.handler;r.find((t=>t.handler===e))||i.push(t)})),r.forEach((t=>{const e=t.handler;s.find((t=>t.handler===e))||n.push(t)})),i.forEach((t=>{this._jflowInstance.addEventListener(t.event,t.handler)})),n.forEach((t=>{this._jflowInstance.removeEventListener(t.event,t.handler)}))},visible(t){this._jflowInstance.visible=t},source(t){this._jflowInstance._jflow.setRenderNodeBySource(t,this._jflowInstance)}},created(){this._jflowInstance=new i(this.configs),this._jflowInstance.visible=this.visible,Object.keys(this.$listeners).map((t=>{const e=this.$listeners[t].bind(this);this._jflowInstance.addEventListener(t,e)})),this.addToBelongStack(this._jflowInstance,this.source)},mounted(){this._jflowInstance.recalculate()},updated(){this._jflowInstance.recalculateUp()},destroyed(){this._jflowInstance.destroy(),this.removeFromBelongStack(this._jflowInstance)}}}const Na={mixins:[ja],inject:{addToBelongStack:{from:"addToStack"},removeFromBelongStack:{from:"removeFromStack"},renderJFlow:{from:"renderJFlow"}},data:()=>({nodes:[]}),props:{configs:{type:Object,default:function(){return{}}},visible:{type:Boolean,default:!0},source:{type:Object},genVueComponentKey:{type:Function}},watch:{configs(t,e){JSON.stringify(t)!==JSON.stringify(e)&&this._jflowInstance.setConfig(t)},$listeners(t,e){let i=[],n=[];const s=Object.keys(t).map((e=>({event:e,handler:t[e]}))),r=Object.keys(e).map((t=>({event:t,handler:e[t]})));s.forEach((t=>{const e=t.handler;r.find((t=>t.handler===e))||i.push(t)})),r.forEach((t=>{const e=t.handler;s.find((t=>t.handler===e))||n.push(t)})),i.forEach((t=>{this._jflowInstance.addEventListener(t.event,t.handler)})),n.forEach((t=>{this._jflowInstance.removeEventListener(t.event,t.handler)}))},visible(t){this._jflowInstance.visible=t},source(t){this._jflowInstance._jflow.setRenderNodeBySource(t,this._jflowInstance)}},created(){this._jflowInstance=new xa(this.configs),this._jflowInstance.visible=this.visible,Object.keys(this.$listeners).map((t=>{const e=this.$listeners[t].bind(this);this._jflowInstance.addEventListener(t,e)})),this.addToBelongStack(this._jflowInstance,this.source),this.genTextElementMeta()},mounted(){this._jflowInstance.recalculate()},updated(){this._jflowInstance.recalculateUp()},destroyed(){this._jflowInstance.destroy(),this.removeFromBelongStack(this._jflowInstance)},render:function(t){return this.nodes.length?t("div",this.nodes.map((t=>{let{type:e,source:i}=t;if(!this.$scopedSlots[e]){if(!this.$scopedSlots.jflowcommon)return;e="jflowcommon"}if(t.__vnode__)return t.__vnode__;const[n]=this.$scopedSlots[e]({source:i,textElement:t});return this.genVueComponentKey&&(n.key=this.genVueComponentKey(i)),t.__vnode__=n,n}))):t("jflow-group",this.$slots.default)},methods:{genTextElementMeta(){this.nodes=this._jflowInstance._flattenTxtElem.filter((t=>"text"!==t.type))},reflow(){this._jflowInstance.refreshTextElements(),this.genTextElementMeta(),this.$nextTick((()=>{this._jflowInstance.refresh()}))}}},Fa=[{name:"Jflow",component:Pa},{name:"Group",component:$a("Group")},...["CapsuleGroup","CapsuleVerticalGroup","DiamondGroup","DiamondVerticalGroup","RhombusGroup","PointGroup","ScrollGroup"].map((t=>({name:t,component:$a(t)}))),...["Point","Rectangle","Capsule","Diamond","Rhombus","Text","Icon","ShadowDom","TextEditor"].map((t=>({name:t,component:Ra(t)}))),...["Link","PolyLink","BezierLink"].map((t=>({name:t,component:Da(t)}))),{name:"TextGroup",component:Na}];customElements.define("jflow-group",class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}});const Wa={install:(t,e={})=>{let i="j";e&&e.prefix&&(i=e.prefix),Fa.forEach((e=>{t.component(`${i}${e.name}`,e.component)})),e.customInstance&&Object.keys(e.customInstance).forEach((n=>{t.component(`${i}${n}`,Ra(e.customInstance[n]))})),e.customGroups&&Object.keys(e.customGroups).forEach((n=>{t.component(`${i}${n}`,$a(e.customGroups[n]))})),e.customLink&&Object.keys(e.customLink).forEach((n=>{t.component(`${i}${n}`,Da(e.customLink[n]))}))}};function Ha(t,e,i,n,s,r,o,a){var h,c="function"==typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=i,c._compiled=!0),n&&(c.functional=!0),r&&(c._scopeId="data-v-"+r),o?(h=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),s&&s.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(o)},c._ssrRegister=h):s&&(h=a?function(){s.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:s),h)if(c.functional){c._injectStyles=h;var l=c.render;c.render=function(t,e){return h.call(e),l(t,e)}}else{var u=c.beforeCreate;c.beforeCreate=u?[].concat(u,h):[h]}return{exports:t,options:c}}window.$jflow_version="0.1.0";var za=Ha({props:{node:Object,odd:Boolean},computed:{groupConfig:()=>({layout:new To({direction:"horizontal",gap:5}),paddingTop:4,paddingBottom:4,margin:2,paddingLeft:10,backgroundColor:"transparent",borderWidth:0})}},(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("j-group",t._g({attrs:{source:t.node,configs:t.groupConfig}},t.$listeners),[i("j-text",{attrs:{configs:{fontSize:"12px",minWidth:110,textAlign:"left",textColor:"#1C1E21",content:t.node.name+"<"+("string"==typeof t.node.ref?t.node.ref:t.node.ref.name)+">"}}})],1)}),[],!1,null,null,null);const Va=Ha({components:{"er-property":za.exports},props:{node:Object},data(){return console.log(this.node),{folded:!1,configs:{layout:new To({direction:"vertical",gap:0}),borderColor:"#A3BF69",backgroundColor:"#ECF2E1",borderWidth:2,borderRadius:0},bodyConfigs:{layout:new To({direction:"vertical",gap:0,alignment:"start"}),display:"block",backgroundColor:"#fff",borderRadius:0,borderColor:"#A3BF69",borderWidth:2},headerConfigs:{layout:new To({direction:"horizontal",gap:0,alignment:"center"}),paddingTop:2,paddingBottom:2,paddingLeft:15,paddingRight:15},propertyConfig:{layout:new To({direction:"vertical",gap:0,alignment:"start"}),border:{bottom:{borderColor:"#A3BF69",borderWidth:2}}}}}},(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("j-group",t._g({attrs:{source:t.node,configs:t.configs}},t.$listeners),[i("j-group",{attrs:{configs:t.headerConfigs}},[i("j-text",{attrs:{configs:{fontSize:"16px",fontWeight:"bold",textColor:"#1C1E21",textAlign:"center",content:t.node.name}}})],1),t._v(" "),i("j-group",{attrs:{configs:t.bodyConfigs}},[i("j-group",{attrs:{configs:t.propertyConfig}},[t.node.properties&&t.node.properties.length?t._l(t.node.properties,(function(t){return i("er-property",{key:t.name,attrs:{node:t}})})):t._e(),t._v(" "),t.node.param&&t.node.param.length?[i("j-text",{attrs:{configs:{fontSize:"12px",textColor:"#1C1E21",textAlign:"left",content:"params:"}}}),t._v(" "),t._l(t.node.param,(function(t){return i("er-property",{key:t.name,attrs:{node:t}})}))]:t._e(),t._v(" "),t.node.return&&t.node.return.length?[i("j-text",{attrs:{configs:{fontSize:"12px",textColor:"#1C1E21",textAlign:"left",content:"returns:"}}}),t._v(" "),t._l(t.node.return,(function(t){return i("er-property",{key:t.name,attrs:{node:t}})}))]:t._e()],2)],1)],1)}),[],!1,null,null,null).exports,Xa=Ha({props:{node:Object},data(){let t,e;return"entity"===this.node.concept&&(t="#37371F",e="#fff"),(this.node.isStructure||"structure"===this.node.concept)&&(t="#EA9010",e="#fff"),"logic"===this.node.concept&&(t="#90BE6D",e="#000"),"viewlogic"===this.node.concept&&(t="#C9E3AC",e="#000"),"view"===this.node.concept&&(t="#EAEFBD",e="#000"),{folded:!1,textColor:e,configs:{layout:new To({direction:"vertical",gap:0}),borderColor:"#A3BF69",backgroundColor:t,borderWidth:2,borderRadius:0,padding:20}}}},(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("j-group",t._g({attrs:{source:t.node,configs:t.configs}},t.$listeners),[i("j-text",{attrs:{configs:{fontSize:"16px",fontWeight:"bold",textColor:t.textColor,textAlign:"center",content:t.node.name}}})],1)}),[],!1,null,null,null).exports;class Ya{constructor(t){this.type="Property",this.source=t,this.name=t.name,this.refName=t.ref.name}}class Ga{constructor(t,e){this.type=e,this.source=t,this.name=t.name,this.properties=(t.properties||[]).map((t=>new Ya(t)))}}let Ua=0;function qa(t,e){return t.find((t=>{for(const i of e)if(i===t)return!0;return!1}))}function Ja(t,e){return 0===e.length?[]:t.filter((t=>e.includes(t.source)))}let Ka=0,Za=[],Qa=[],th=[],eh=[],ih=[];function nh(t){const e={id:Ka++,concept:"view",source:t,name:t.name,logics:[]};t.logics.map((i=>{return n=`${t.name}/${i.name}`,s=i,r=e,void ih.push({id:Ka++,concept:"viewlogic",name:n,param:s.param.slice(),return:s.return.slice(),refByLogic:[],refByView:[r],refByViewLogic:[]});var n,s,r})),th.push(e)}function sh(t){eh.push({level:0,id:Ka++,concept:"logic",source:t,name:t.name,param:t.param.slice(),return:t.return.slice(),refByLogic:[],refByView:[],refByViewLogic:[]})}function rh(t){let e=Qa.find((e=>e.name===t));return e||(e={id:Ka++,concept:"entity",isStructure:t.includes(".structures."),name:t},Qa.push(e),e)}function oh(t){return{id:Ka++,concept:"property",ref:rh(t.ref),name:t.name}}function ah(t){Za.push({id:Ka++,concept:"structure",source:t,name:t.structure,properties:t.properties.map(oh),refByLogic:[],refByView:[],refByViewLogic:[]})}function hh(t){const e="logic"===t.concept,i=t.source,n=t.refByViewLogic,s=t.refByView,r=t.refByLogic;i.refByViewLogic.forEach((({view:t,logic:e})=>{const i=`${t}/${e}`,s=ih.find((t=>t.name===i));s&&n.push(s)})),i.refByView.forEach((t=>{const e=th.find((e=>e.name===t));e&&s.push(e)})),i.refByLogic.forEach((t=>{const i=eh.find((e=>e.name===t));i&&(e&&i.level++,r.push(i))}))}var ch=Ha({name:"jflow-er-diagram",components:{"j-er-node-comp":Va,"j-plain-node":Xa},data:()=>({jflowloading:!1,configs:{allowDrop:!0,layout:{},initialZoom:1,minZoom:1e-4,NodeRenderTop:!0},filterContent:"",showProperty:!1,curData:null,currJSON:""}),computed:{statistics(){return this.curData?`entities: ${this.curData.entities.length}, structures: ${this.curData.structures.length}, logics: ${this.curData.logics.length}, views: ${this.curData.views.length}`:""}},methods:{genVueComponentKey:t=>t.id,rerender(){this.configs.layout.reOrder(this.curData),this.$refs.jflow.reflow()},toggleView(){this.configs.layout.toggleView(),this.rerender()},toggleLogic(){this.configs.layout.toggleLogic(),this.rerender()},toggleStructure(){this.configs.layout.toggleStructure(),this.rerender()},toggleLcap(){this.configs.layout.toggleLcap(),this.rerender()},toggleFilterMultiRef(){this.configs.layout.toggleFilterMultiRef(),this.rerender()},togglePrimary(){this.configs.layout.togglePrimaryFilter(),this.rerender()},toggleFilterMultiRefLogic(){this.configs.layout.toggleMultiLogicRefFilter(),this.rerender()},doFilter(t){this.configs.layout.doFilter(this.filterContent,t),this.rerender()},toggleProperty(){this.showProperty=!this.showProperty,this.configs.layout.toggleProperty(this.showProperty),this.rerender()},importData(){this.$refs.datamodal.showModal()},importJSON(){const t=Object.freeze((e=JSON.parse(this.currJSON),Ka=0,Qa=[],Za=[],th=[],eh=[],ih=[],e.views.map(nh),e.logics.map(sh),e.structures.map(ah),eh.forEach((t=>{hh(t)})),Za.forEach((t=>{hh(t)})),{structures:Za.slice(),views:th.slice(),viewLogics:ih.slice(),logics:eh.slice(),entities:Qa.slice()}));var e;this.curData=t,this.$refs.jflow?this.rerender():this.configs.layout=new class{constructor(t){this.static=!1,this.flowStack=[],this.flowLinkStack=[],this.erNodes=[],this.viewVisible=!0,this.logicVisible=!0,this.structureVisible=!0,this.LCAPvisible=!1,this.multiRefFilter=!1,this.multiLogicRefFilter=!1,this.primaryFilter=!1,this.filterContent="",this.filterPart="",this.showProperty=!1,this.reOrder(t)}reOrder(t){this.flowStack=[],this.flowLinkStack=[],this.source=t;const{structures:e,views:i,viewLogics:n,logics:s,entities:r}=t;let o=new Set,a=new Set,h=new Set,c=new Set,l=new Set;const u=this.filterContent.toLocaleLowerCase(),d=t=>e=>{if(this.filterPart===t)return e.name.toLowerCase().includes(u)};let f=r.map((t=>new Ga(t,"Entity"))),p=e.map((t=>new Ga(t,"Structure"))),g=s.map((t=>new Ga(t,"Logic"))),_=n.map((t=>new Ga(t,"ViewLogic"))),m=i.map((t=>new Ga(t,"View")));u&&"View"===this.filterPart&&(m.filter(d("View")).forEach((t=>{h.add(t.source)})),_.forEach((t=>{qa(t.source.refByView,h)&&c.add(t.source)})),g.forEach((t=>{(qa(t.source.refByViewLogic,c)||qa(t.source.refByView,h))&&a.add(t.source)})),p.forEach((t=>{(qa(t.source.refByViewLogic,c)||qa(t.source.refByLogic,a)||qa(t.source.refByView,h))&&(t.source.properties.forEach((t=>{l.add(t.ref)})),o.add(t.source))}))),u&&"ViewLogic"===this.filterPart&&(_.filter(d("ViewLogic")).forEach((t=>{c.add(t.source),t.source.refByView.forEach((t=>{h.add(t)}))})),g.forEach((t=>{qa(t.source.refByViewLogic,c)&&a.add(t.source)})),p.forEach((t=>{(qa(t.source.refByViewLogic,c)||qa(t.source.refByLogic,a)||qa(t.source.refByView,h))&&(t.source.properties.forEach((t=>{l.add(t.ref)})),o.add(t.source))}))),u&&"Logic"===this.filterPart&&(g.filter(d("Logic")).forEach((t=>{a.add(t.source),t.source.refByViewLogic.forEach((t=>{c.add(t),t.refByView.forEach((t=>{h.add(t)}))}))})),p.forEach((t=>{(qa(t.source.refByViewLogic,c)||qa(t.source.refByLogic,a)||qa(t.source.refByView,h))&&(t.source.properties.forEach((t=>{l.add(t.ref)})),o.add(t.source))}))),u&&"Structure"===this.filterPart&&p.filter(d("Structure")).forEach((t=>{o.add(t.source),t.source.properties.forEach((t=>{l.add(t.ref)})),t.source.refByLogic.forEach((t=>{a.add(t),t.refByViewLogic.forEach((t=>{c.add(t),t.refByView.forEach((t=>{h.add(t)}))}))})),t.source.refByViewLogic.forEach((t=>{c.add(t),t.refByView.forEach((t=>{h.add(t)}))}))})),u&&(f=Ja(f,Array.from(l)),p=Ja(p,Array.from(o)),g=Ja(g,Array.from(a)),_=Ja(_,Array.from(c)),m=Ja(m,Array.from(h))),this.viewVisible||(m=[],_=[]),this.logicVisible||(g=[]),this.structureVisible||(p=[],f=[]),[...f,...p,...g,..._,...m].forEach((t=>{this.flowStack.push({type:t.type,source:t.source,layoutNode:t})}));const v=t=>{const e="logic"===t.source.concept,i=t.source;i.refByLogic.forEach((i=>{const n=g.find((t=>t.name===i.name));n&&(e?this.flowLinkStack.push({from:t,to:n,fromDir:2,toDir:0,part:Ua++}):this.flowLinkStack.push({from:t,to:n,fromDir:0,toDir:2,part:Ua++}))})),i.refByViewLogic.forEach((e=>{const i=_.find((t=>t.name===e.name));i&&this.flowLinkStack.push({from:t,to:i,fromDir:0,toDir:2,part:Ua++})})),i.refByView.forEach((e=>{const i=m.find((t=>t.name===e.name));i&&this.flowLinkStack.push({from:t,to:i,fromDir:0,toDir:2,part:Ua++})}))};p.forEach((t=>{t.source.properties.forEach((e=>{const i=f.find((t=>t.name===e.ref.name));i&&this.flowLinkStack.push({from:i,to:t,fromDir:0,toDir:2,part:Ua++})})),v(t)})),g.forEach((t=>{v(t)})),_.forEach((t=>{const e=t.source.refByView[0],i=m.find((t=>t.name===e.name));i&&this.flowLinkStack.push({from:t,to:i,fromDir:0,toDir:2,part:Ua++})}));let y=Array.from(g.reduce(((t,e)=>{const i=e.source.level;return t.has(i)||t.set(i,{level:i,nodes:[]}),t.get(i).nodes.push(e),t}),new Map).values()).sort(((t,e)=>e.level-t.level));Object.assign(this,{entityNodes:f,structNodes:p,logicNodes:g,viewLogicsNodes:_,viewNodes:m,logicLevelNodes:y})}staticCheck(t,e){return!1}reflow(t){const{entityNodes:e,structNodes:i,logicNodes:n,viewLogicsNodes:s,viewNodes:r,logicLevelNodes:o}=this;function a(e,i=0,n){let s=0,r=0;return e.forEach(((e,i)=>{const o=t.getRenderNodeBySource(e.source),{width:a,height:h}=o.getBoundingDimension();r=Math.max(a,r);const c=h/2;i>0&&(s+=c),o.anchor[1]=s,n&&n(e,s),s+=c+20})),i+=r/2,e.forEach((e=>{t.getRenderNodeBySource(e.source).anchor[0]=i})),i+=r/2}let h=[e,i,o].reduce(((t,e)=>0===e.length?t:e[0].nodes?e.reduce(((t,e)=>a(e.nodes,t)+200),t):a(e,t)+200),0),c=null,l=0;h=a(s,h,((e,i)=>{const n=e.source.refByView[0].name;if(n!==c){const s=e.source.refByView[0],r=t.getRenderNodeBySource(s),{width:o}=r.getBoundingDimension();l=Math.max(o,l),r.anchor[1]=i,c=n}}))+200,h+=l/2,r.forEach((e=>{t.getRenderNodeBySource(e.source).anchor[0]=h}))}toggleView(){this.viewVisible=!this.viewVisible}toggleLogic(){this.logicVisible=!this.logicVisible}toggleStructure(){this.structureVisible=!this.structureVisible}toggleLcap(){this.LCAPvisible=!this.LCAPvisible}toggleFilterMultiRef(){this.multiRefFilter=!this.multiRefFilter}togglePrimaryFilter(){this.primaryFilter=!this.primaryFilter}toggleMultiLogicRefFilter(){this.multiLogicRefFilter=!this.multiLogicRefFilter}doFilter(t,e){this.filterPart=e,this.filterContent=t}toggleProperty(t){this.showProperty=t}}(t)}}},(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{display:"block",width:"100vw",height:"90vh",border:"1px solid #000",overflow:"visible",position:"relative"}},[t._m(0),t._v(" "),i("div",{staticStyle:{display:"block",width:"100%",height:"100%"}},[t.curData?i("j-jflow",{ref:"jflow",staticStyle:{width:"100%",height:"100%"},attrs:{configs:t.configs,"gen-vue-component-key":t.genVueComponentKey},scopedSlots:t._u([{key:"Structure",fn:function(e){var n=e.source;return[t.showProperty?i("j-er-node-comp",{attrs:{node:n}}):i("j-plain-node",{attrs:{node:n}})]}},{key:"ViewLogic",fn:function(e){var n=e.source;return[t.showProperty?i("j-er-node-comp",{attrs:{node:n}}):i("j-plain-node",{attrs:{node:n}})]}},{key:"Logic",fn:function(e){var n=e.source;return[t.showProperty?i("j-er-node-comp",{attrs:{node:n}}):i("j-plain-node",{attrs:{node:n}})]}},{key:"View",fn:function(t){var e=t.source;return[i("j-plain-node",{attrs:{node:e}})]}},{key:"Entity",fn:function(t){var e=t.source;return[i("j-plain-node",{attrs:{node:e}})]}},{key:"plainlink",fn:function(t){var e=t.configs;return[i("jBezierLink",{attrs:{configs:e,from:e.from.source,to:e.to.source}})]}}],null,!1,149633744)}):t._e()],1),t._v(" "),i("div",[i("button",{on:{click:function(e){return t.$refs.scriptdialog.showModal()}}},[t._v("get script")]),t._v(" "),i("button",{on:{click:t.importData}},[t._v("import data")]),t._v(" "),i("span",[t._v(t._s(t.statistics))]),t._v(" "),i("br"),t._v(" "),i("button",{on:{click:t.toggleView}},[t._v("toggle View ("+t._s(t.configs.layout.viewVisible)+")")]),t._v(" "),i("button",{on:{click:t.toggleLogic}},[t._v("toggle Logic ("+t._s(t.configs.layout.logicVisible)+")")]),t._v(" "),i("button",{on:{click:t.toggleStructure}},[t._v("toggle Sturcture ("+t._s(t.configs.layout.structureVisible)+")")]),t._v(" "),i("br"),t._v(" "),i("label",[t._v("\n            filterBy: "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.filterContent,expression:"filterContent"}],domProps:{value:t.filterContent},on:{input:function(e){e.target.composing||(t.filterContent=e.target.value)}}}),t._v(" "),i("button",{on:{click:function(e){return t.doFilter("Structure")}}},[t._v("Struture")]),t._v(" "),i("button",{on:{click:function(e){return t.doFilter("Logic")}}},[t._v("Logic")]),t._v(" "),i("button",{on:{click:function(e){return t.doFilter("ViewLogic")}}},[t._v("ViewLogic")]),t._v(" "),i("button",{on:{click:function(e){return t.doFilter("View")}}},[t._v("View")])]),t._v(" "),i("button",{on:{click:t.toggleProperty}},[t._v("toggle property ("+t._s(t.showProperty)+")")])]),t._v(" "),i("dialog",{ref:"datamodal"},[i("form",{attrs:{method:"dialog"}},[i("p",[i("label",[i("span",{staticStyle:{"vertical-align":"top"}},[t._v("json: ")]),t._v(" "),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.currJSON,expression:"currJSON"}],staticStyle:{"white-space":"pre",width:"600px",height:"400px"},domProps:{value:t.currJSON},on:{input:function(e){e.target.composing||(t.currJSON=e.target.value)}}})])]),t._v(" "),i("div",[i("button",{attrs:{value:"cancel"}},[t._v("close")]),t._v(" "),i("button",{attrs:{id:"confirmBtn",value:"default"},on:{click:t.importJSON}},[t._v("confirm")])])])]),t._v(" "),i("dialog",{ref:"scriptdialog"},[t._m(1)])])}),[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{position:"absolute",left:"20px",top:"10px"}},[i("span",{staticClass:"legend entity"},[t._v("Entity")]),t._v(" "),i("span",{staticClass:"legend structure"},[t._v("Structure")]),t._v(" "),i("span",{staticClass:"legend globallogic"},[t._v("GlobalLogic")]),t._v(" "),i("span",{staticClass:"legend viewlogic"},[t._v("ViewLogic")]),t._v(" "),i("span",{staticClass:"legend view"},[t._v("View")])])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("form",{attrs:{method:"dialog"}},[i("textarea",{staticStyle:{"white-space":"pre",width:"600px",height:"400px"}},[t._v("            function figureOutRefs(result) {\n                const refByLogic = [];\n                const refByView = [];\n                const refByViewLogic = [];\n                const refByOther = [];\n                for (const entry of result) {\n                    const n = entry[0];\n                    \n                    switch(n.concept) {\n                        case 'Logic': \n                            refByLogic.push(entry[0].name);\n                            break;\n                        case 'View':\n                            let v = entry[1];\n                            function iterate(node, lastName) {\n                                node.children.forEach(c => {\n                                    if(c.node.concept === 'View') {\n                                        iterate(c, `${lastName}/${c.node.name}`);\n                                    } else {\n                                        if(c.node.concept === 'Logic') {\n                                            refByViewLogic.push({\n                                                view: lastName,\n                                                logic: c.node.name,\n                                            })\n                                        } else if(lastName) {\n                                            refByView.push(lastName)\n                                        }\n                                    }\n                                })\n                            }\n                            iterate(v, v.node.name);\n                            break;\n                        default: \n                            refByOther.push(entry[0].name);\n                    }\n                }\n                return {\n                    refByLogic,\n                    refByView,\n                    refByOther,\n                    refByViewLogic,\n                }\n            }\n            \n            function getTypeKey(node) {\n                return (node.typeAnnotation || node.__TypeAnnotation)?.typeKey;\n            }\n            Promise.all([\n                Promise.all($data.app.logics.map(async s => { \n                    const result = await window.globalData.naslServer.findReferences(s);\n                    const {\n                        refByLogic,\n                        refByView,\n                        refByOther,\n                        refByViewLogic\n                    } = figureOutRefs(result);\n            \n                    return {\n                        name: s.name,\n                        param: s.params.map(p => ({\n                            ref: getTypeKey(p),\n                            name: p.name,\n                        })),\n                        return: s.returns.map(p => ({\n                            ref: getTypeKey(p),\n                            name: p.name,\n                        })),\n                        refByLogic:  Array.from(new Set(refByLogic)),\n                        refByView: Array.from(new Set(refByView)),\n                        refByViewLogic,\n                        refByOther\n                    }\n                })).then(res => {\n                    return res\n                }),\n                Promise.all($data.app.structures.map(async s => { \n                    const result = await window.globalData.naslServer.findReferences(s);\n                    const {\n                        refByLogic,\n                        refByView,\n                        refByViewLogic,\n                        refByOther,\n                    } = figureOutRefs(result);\n                    \n                    return {\n                        structure: s.name,\n                        properties: s.properties.map(p => {\n                            return {\n                                ref: getTypeKey(p),\n                                name: p.name\n                            }\n                        }),\n                        refByLogic,\n                        refByView: Array.from(new Set(refByView)),\n                        refByViewLogic,\n                        refByOther\n                    }\n                })).then(res => {\n                    return res\n                }),\n                Promise.resolve(\n                    $data.app.frontends.map(f => f.views.map(v => {\n                        const viewNames = [];\n                        function iterate(viewNode, lastName) {\n                            viewNames.push({\n                                name: lastName,\n                                logics: viewNode.logics.map(l => ({\n                                    name: l.name,\n                                    param: l.params.map(p => ({\n                                        ref: getTypeKey(p),\n                                        name: p.name,\n                                    })),\n                                    return: l.returns.map(p => ({\n                                        ref: getTypeKey(p),\n                                        name: p.name,\n                                    }))\n                                })),   \n                            });\n                            viewNode.children.forEach(c => {\n                                iterate(c, `${lastName}/${c.name}`);\n                            })\n                        }\n                        iterate(v, `${f.name}/${v.name}`);\n                        return viewNames;\n                    }).reduce((accu, curr) => accu.concat(curr), [])).flat())\n            ]).then(([logics, structures, views]) => {\n                console.log(JSON.stringify({ logics, structures, views }, null, '\\t'));\n            })\n                        \n        ")]),t._v(" "),i("button",{attrs:{value:"cancel"}},[t._v("close")])])}],!1,null,null,null);const lh=ch.exports;Rs.config.productionTip=!1,Rs.use(Wa),new Rs({render:t=>t(lh)}).$mount("#app")})()})();